!function($){var FE=function(element,options){this.id=++$.FE.ID;var presets={};options&&options.documentReady&&(presets.toolbarButtons=["fullscreen","undo","redo","getPDF","print","|","bold","italic","underline","color","clearFormatting","|","alignLeft","alignCenter","alignRight","alignJustify","|","formatOL","formatUL","indent","outdent","-","paragraphFormat","|","fontFamily","|","fontSize","|","insertLink","insertImage","quote"],presets.paragraphFormatSelection=!0,presets.fontFamilySelection=!0,presets.fontSizeSelection=!0,presets.placeholderText="",presets.quickInsertEnabled=!1,presets.charCounterCount=!1),this.opts=$.extend(!0,{},$.extend({},FE.DEFAULTS,presets,"object"==typeof options&&options));var opts_string=JSON.stringify(this.opts);$.FE.OPTS_MAPPING[opts_string]=$.FE.OPTS_MAPPING[opts_string]||this.id,this.sid=$.FE.OPTS_MAPPING[opts_string],$.FE.SHARED[this.sid]=$.FE.SHARED[this.sid]||{},this.shared=$.FE.SHARED[this.sid],this.shared.count=(this.shared.count||0)+1,this.$oel=$(element),this.$oel.data("froala.editor",this),this.o_doc=element.ownerDocument,this.o_win="defaultView"in this.o_doc?this.o_doc.defaultView:this.o_doc.parentWindow;var c_scroll=$(this.o_win).scrollTop();this.$oel.on("froala.doInit",$.proxy((function(){this.$oel.off("froala.doInit"),this.doc=this.$el.get(0).ownerDocument,this.win="defaultView"in this.doc?this.doc.defaultView:this.doc.parentWindow,this.$doc=$(this.doc),this.$win=$(this.win),this.opts.pluginsEnabled||(this.opts.pluginsEnabled=Object.keys($.FE.PLUGINS)),this.opts.initOnClick?(this.load($.FE.MODULES),this.$el.on("touchstart.init",(function(){$(this).data("touched",!0)})),this.$el.on("touchmove.init",(function(){$(this).removeData("touched")})),this.$el.on("mousedown.init touchend.init dragenter.init focus.init",$.proxy((function(e){if("touchend"==e.type&&!this.$el.data("touched"))return!0;if(1===e.which||!e.which){this.$el.off("mousedown.init touchstart.init touchmove.init touchend.init dragenter.init focus.init"),this.load($.FE.MODULES),this.load($.FE.PLUGINS);var target=e.originalEvent&&e.originalEvent.originalTarget;target&&"IMG"==target.tagName&&$(target).trigger("mousedown"),"touchend"==e.type&&this.image&&e.originalEvent&&e.originalEvent.target&&$(e.originalEvent.target).is("img")&&setTimeout($.proxy((function(){this.image.edit($(e.originalEvent.target))}),this),100),this.ready=!0,this.events.trigger("initialized")}}),this)),this.events.trigger("initializationDelayed")):(this.load($.FE.MODULES),this.load($.FE.PLUGINS),$(this.o_win).scrollTop(c_scroll),this.ready=!0,this.events.trigger("initialized"))}),this)),this._init()};FE.DEFAULTS={initOnClick:!1,pluginsEnabled:null},FE.MODULES={},FE.PLUGINS={},FE.VERSION="2.9.3",FE.INSTANCES=[],FE.OPTS_MAPPING={},FE.SHARED={},FE.ID=0,FE.prototype._init=function(){var tag_name=this.$oel.prop("tagName");this.$oel.closest("label").length>=1&&console.warn("Note! It is not recommended to initialize the Froala Editor within a label tag.");var initOnDefault=$.proxy((function(){"TEXTAREA"!=tag_name&&(this._original_html=this._original_html||this.$oel.html()),this.$box=this.$box||this.$oel,this.opts.fullPage&&(this.opts.iframe=!0),this.opts.iframe?(this.$iframe=$('<iframe src="about:blank" frameBorder="0">'),this.$wp=$("<div></div>"),this.$box.html(this.$wp),this.$wp.append(this.$iframe),this.$iframe.get(0).contentWindow.document.open(),this.$iframe.get(0).contentWindow.document.write("<!DOCTYPE html>"),this.$iframe.get(0).contentWindow.document.write("<html><head></head><body></body></html>"),this.$iframe.get(0).contentWindow.document.close(),this.$el=this.$iframe.contents().find("body"),this.el=this.$el.get(0),this.$head=this.$iframe.contents().find("head"),this.$html=this.$iframe.contents().find("html"),this.iframe_document=this.$iframe.get(0).contentWindow.document,this.$oel.trigger("froala.doInit")):(this.$el=$("<div></div>"),this.el=this.$el.get(0),this.$wp=$("<div></div>").append(this.$el),this.$box.html(this.$wp),this.$oel.trigger("froala.doInit"))}),this),initOnTextarea=$.proxy((function(){this.$box=$("<div>"),this.$oel.before(this.$box).hide(),this._original_html=this.$oel.val(),this.$oel.parents("form").on("submit."+this.id,$.proxy((function(){this.events.trigger("form.submit")}),this)),this.$oel.parents("form").on("reset."+this.id,$.proxy((function(){this.events.trigger("form.reset")}),this)),initOnDefault()}),this),initOnA=$.proxy((function(){this.$el=this.$oel,this.el=this.$el.get(0),this.$el.attr("contenteditable",!0).css("outline","none").css("display","inline-block"),this.opts.multiLine=!1,this.opts.toolbarInline=!1,this.$oel.trigger("froala.doInit")}),this),initOnImg=$.proxy((function(){this.$el=this.$oel,this.el=this.$el.get(0),this.opts.toolbarInline=!1,this.$oel.trigger("froala.doInit")}),this),editInPopup=$.proxy((function(){this.$el=this.$oel,this.el=this.$el.get(0),this.opts.toolbarInline=!1,this.$oel.on("click.popup",(function(e){e.preventDefault()})),this.$oel.trigger("froala.doInit")}),this);this.opts.editInPopup?editInPopup():"TEXTAREA"==tag_name?initOnTextarea():"A"==tag_name?initOnA():"IMG"==tag_name?initOnImg():"BUTTON"==tag_name||"INPUT"==tag_name?(this.opts.editInPopup=!0,this.opts.toolbarInline=!1,editInPopup()):initOnDefault()},FE.prototype.load=function(module_list){for(var m_name in module_list)if(module_list.hasOwnProperty(m_name)){if(this[m_name])continue;if($.FE.PLUGINS[m_name]&&this.opts.pluginsEnabled.indexOf(m_name)<0)continue;if(this[m_name]=new module_list[m_name](this),this[m_name]._init&&(this[m_name]._init(),this.opts.initOnClick&&"core"==m_name))return!1}},FE.prototype.destroy=function(){this.destroying=!0,this.shared.count--,this.events.$off();var html=this.html.get();if(this.opts.iframe&&(this.events.disableBlur(),this.win.focus(),this.events.enableBlur()),this.events.trigger("destroy",[],!0),this.events.trigger("shared.destroy",void 0,!0),0===this.shared.count){for(var k in this.shared)this.shared.hasOwnProperty(k)&&(this.shared[k],$.FE.SHARED[this.sid][k]=null);delete $.FE.SHARED[this.sid]}this.$oel.parents("form").off("."+this.id),this.$oel.off("click.popup"),this.$oel.removeData("froala.editor"),this.$oel.off("froalaEditor"),this.core.destroy(html),$.FE.INSTANCES.splice($.FE.INSTANCES.indexOf(this),1)},$.fn.froalaEditor=function(option){for(var arg_list=[],i=0;i<arguments.length;i++)arg_list.push(arguments[i]);if("string"==typeof option){var returns=[];return this.each((function(){var context,nm,editor=$(this).data("froala.editor");if(!editor)return console.warn("Editor should be initialized before calling the "+option+" method.");if(option.indexOf(".")>0&&editor[option.split(".")[0]]?(editor[option.split(".")[0]]&&(context=editor[option.split(".")[0]]),nm=option.split(".")[1]):(context=editor,nm=option.split(".")[0]),!context[nm])return $.error("Method "+option+" does not exist in Froala Editor.");var returned_value=context[nm].apply(editor,arg_list.slice(1));void 0===returned_value?returns.push(this):0===returns.length&&returns.push(returned_value)})),1==returns.length?returns[0]:returns}if("object"==typeof option||!option)return this.each((function(){if(!$(this).data("froala.editor")){new FE(this,option)}}))},$.fn.froalaEditor.Constructor=FE,$.FroalaEditor=FE,$.FE=FE}(jQuery),function($){$.FE.XS=0,$.FE.SM=1,$.FE.MD=2,$.FE.LG=3;$.FE.LinkRegExCommon="[a-z\\u0080-\\u009f\\u00a1-\\uffff0-9-_.]{1,}",$.FE.LinkRegExEnd="((:[0-9]{1,5})|)(((\\/|\\?|#)[a-z\\u00a1-\\uffff0-9@?\\|!^=%&amp;/~+#-\\'*-_{}]*)|())",$.FE.LinkRegExTLD="(("+$.FE.LinkRegExCommon+")(\\.(com|net|org|edu|mil|gov|co|biz|info|me|dev)))",$.FE.LinkRegExHTTP="((ftp|http|https):\\/\\/"+$.FE.LinkRegExCommon+")",$.FE.LinkRegExAuth="((ftp|http|https):\\/\\/[\\u0021-\\uffff]{1,}@"+$.FE.LinkRegExCommon+")",$.FE.LinkRegExWWW="(www\\."+$.FE.LinkRegExCommon+"\\.[a-z0-9-]{2,24})",$.FE.LinkRegEx="("+$.FE.LinkRegExTLD+"|"+$.FE.LinkRegExHTTP+"|"+$.FE.LinkRegExWWW+"|"+$.FE.LinkRegExAuth+")"+$.FE.LinkRegExEnd,$.FE.LinkProtocols=["mailto","tel","sms","notes","data","october"],$.FE.MAIL_REGEX=/.+@.+\..+/i,$.FE.MODULES.helpers=function(editor){function _browser(){var browser={},ie_version=function(){var ua,rv=-1;return"Microsoft Internet Explorer"==navigator.appName?(ua=navigator.userAgent,null!==new RegExp("MSIE ([0-9]{1,}[\\.0-9]{0,})").exec(ua)&&(rv=parseFloat(RegExp.$1))):"Netscape"==navigator.appName&&(ua=navigator.userAgent,null!==new RegExp("Trident/.*rv:([0-9]{1,}[\\.0-9]{0,})").exec(ua)&&(rv=parseFloat(RegExp.$1))),rv}();if(ie_version>0)browser.msie=!0;else{var ua=navigator.userAgent.toLowerCase(),match=/(edge)[ \/]([\w.]+)/.exec(ua)||/(chrome)[ \/]([\w.]+)/.exec(ua)||/(webkit)[ \/]([\w.]+)/.exec(ua)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(ua)||/(msie) ([\w.]+)/.exec(ua)||ua.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(ua)||[],matched={browser:match[1]||"",version:match[2]||"0"};match[1]&&(browser[matched.browser]=!0),browser.chrome?browser.webkit=!0:browser.webkit&&(browser.safari=!0)}return browser.msie&&(browser.version=ie_version),browser}function isIOS(){return/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&!isWindowsPhone()}function isAndroid(){return/(Android)/g.test(navigator.userAgent)&&!isWindowsPhone()}function isBlackberry(){return/(Blackberry)/g.test(navigator.userAgent)}function isWindowsPhone(){return/(Windows Phone)/gi.test(navigator.userAgent)}function getPX(val){return parseInt(val,10)||0}var default_alignment;var is_mac=null;return{_init:function(){editor.browser=_browser(),function(){function overrideNodeMethod(prototype,methodName){var oldMethod=prototype[methodName];prototype[methodName]=function(query){var nodeList,gaveId=!1,gaveContainer=!1;if(query&&query.match(scopeRE)){query=query.replace(scopeRE,""),this.parentNode||(container.appendChild(this),gaveContainer=!0);var parentNode=this.parentNode;return this.id||(this.id="rootedQuerySelector_id_"+(new Date).getTime(),gaveId=!0),nodeList=oldMethod.call(parentNode,"#"+this.id+" "+query),gaveId&&(this.id=""),gaveContainer&&container.removeChild(this),nodeList}return oldMethod.call(this,query)}}var container=editor.o_doc.createElement("div");try{container.querySelectorAll(":scope *")}catch(e){var scopeRE=/^\s*:scope/gi;overrideNodeMethod(Element.prototype,"querySelector"),overrideNodeMethod(Element.prototype,"querySelectorAll"),overrideNodeMethod(HTMLElement.prototype,"querySelector"),overrideNodeMethod(HTMLElement.prototype,"querySelectorAll")}}(),Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(s){var ancestor=this;if(!ancestor)return null;if(!document.documentElement.contains(this))return null;do{if(ancestor.matches(s))return ancestor;ancestor=ancestor.parentElement}while(null!==ancestor);return null})},isIOS:isIOS,isMac:function(){return null==is_mac&&(is_mac=navigator.platform.toUpperCase().indexOf("MAC")>=0),is_mac},isAndroid:isAndroid,isBlackberry:isBlackberry,isWindowsPhone:isWindowsPhone,isMobile:function(){return isAndroid()||isIOS()||isBlackberry()},isEmail:function(url){return!/^(https?:|ftps?:|)\/\//i.test(url)&&$.FE.MAIL_REGEX.test(url)},requestAnimationFrame:function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(callback){window.setTimeout(callback,1e3/60)}},getPX:getPX,screenSize:function(){var $test=$('<div class="fr-visibility-helper"></div>').appendTo("body:first");try{var size=getPX($test.css("margin-left"));return $test.remove(),size}catch(ex){return $.FE.LG}},isTouch:function(){return"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch},sanitizeURL:function(url){return/^(https?:|ftps?:|)\/\//i.test(url)||/^([A-Za-z]:(\\){1,2}|[A-Za-z]:((\\){1,2}[^\\]+)+)(\\)?$/i.test(url)||new RegExp("^("+$.FE.LinkProtocols.join("|")+"):\\/\\/","i").test(url)?url:url=encodeURIComponent(url).replace(/%23/g,"#").replace(/%2F/g,"/").replace(/%25/g,"%").replace(/mailto%3A/gi,"mailto:").replace(/file%3A/gi,"file:").replace(/sms%3A/gi,"sms:").replace(/tel%3A/gi,"tel:").replace(/notes%3A/gi,"notes:").replace(/data%3Aimage/gi,"data:image").replace(/blob%3A/gi,"blob:").replace(/%3A(\d)/gi,":$1").replace(/webkit-fake-url%3A/gi,"webkit-fake-url:").replace(/%3F/g,"?").replace(/%3D/g,"=").replace(/%26/g,"&").replace(/&amp;/g,"&").replace(/%2C/g,",").replace(/%3B/g,";").replace(/%2B/g,"+").replace(/%40/g,"@").replace(/%5B/g,"[").replace(/%5D/g,"]").replace(/%7B/g,"{").replace(/%7D/g,"}")},isArray:function(obj){return obj&&!obj.propertyIsEnumerable("length")&&"object"==typeof obj&&"number"==typeof obj.length},RGBToHex:function(rgb){function hex(x){return("0"+parseInt(x,10).toString(16)).slice(-2)}try{return rgb&&"transparent"!==rgb?/^#[0-9A-F]{6}$/i.test(rgb)?rgb:("#"+hex((rgb=rgb.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/))[1])+hex(rgb[2])+hex(rgb[3])).toUpperCase():""}catch(ex){return null}},HEXtoRGB:function(hex){hex=hex.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(m,r,g,b){return r+r+g+g+b+b}));var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return result?"rgb("+parseInt(result[1],16)+", "+parseInt(result[2],16)+", "+parseInt(result[3],16)+")":""},isURL:function(url){return!!/^(https?:|ftps?:|)\/\//i.test(url)&&(url=String(url).replace(/</g,"%3C").replace(/>/g,"%3E").replace(/"/g,"%22").replace(/ /g,"%20"),new RegExp("^"+$.FE.LinkRegExHTTP+$.FE.LinkRegExEnd+"$","gi").test(url))},getAlignment:function($block){var alignment=($block.css("text-align")||"").replace(/-(.*)-/g,"");if(["left","right","justify","center"].indexOf(alignment)<0){if(!default_alignment){var $div=$('<div dir="'+("rtl"==editor.opts.direction?"rtl":"auto")+'" style="text-align: '+editor.$el.css("text-align")+'; position: fixed; left: -3000px;"><span id="s1">.</span><span id="s2">.</span></div>');$("body:first").append($div);var l1=$div.find("#s1").get(0).getBoundingClientRect().left,l2=$div.find("#s2").get(0).getBoundingClientRect().left;$div.remove(),default_alignment=l1<l2?"left":"right"}alignment=default_alignment}return alignment},scrollTop:function(){return editor.o_win.pageYOffset?editor.o_win.pageYOffset:editor.o_doc.documentElement&&editor.o_doc.documentElement.scrollTop?editor.o_doc.documentElement.scrollTop:editor.o_doc.body.scrollTop?editor.o_doc.body.scrollTop:0},scrollLeft:function(){return editor.o_win.pageXOffset?editor.o_win.pageXOffset:editor.o_doc.documentElement&&editor.o_doc.documentElement.scrollLeft?editor.o_doc.documentElement.scrollLeft:editor.o_doc.body.scrollLeft?editor.o_doc.body.scrollLeft:0},isInViewPort:function(el){var rect=el.getBoundingClientRect();return(rect={top:Math.round(rect.top),bottom:Math.round(rect.bottom)}).top>=0&&rect.bottom<=(window.innerHeight||document.documentElement.clientHeight)||rect.top<=0&&rect.bottom>=(window.innerHeight||document.documentElement.clientHeight)}}}}(jQuery),function($){$.FE.MODULES.events=function(editor){var _do_blur,_events={};function _assignEvent($el,evs,handler){$on($el,evs,handler)}function focus(do_focus){if(void 0===do_focus&&(do_focus=!0),!editor.$wp)return!1;if(editor.helpers.isIOS()){editor.$win.get(0).focus();var offsetY=0===editor.$win.scrollTop()?1:editor.$win.scrollTop();window.scrollTo(0,offsetY)}if(editor.core.hasFocus())return!1;if(!editor.core.hasFocus()&&do_focus){var st=editor.$win.scrollTop();if(editor.browser.msie&&editor.$box&&editor.$box.css("position","fixed"),editor.browser.msie&&editor.$wp&&editor.$wp.css("overflow","visible"),editor.browser.msie&&editor.$sc&&editor.$sc.css("position","fixed"),disableBlur(),editor.$el.focus(),editor.events.trigger("focus"),enableBlur(),editor.browser.msie&&editor.$sc&&editor.$sc.css("position",""),editor.browser.msie&&editor.$box&&editor.$box.css("position",""),editor.browser.msie&&editor.$wp&&editor.$wp.css("overflow","auto"),st!=editor.$win.scrollTop()&&editor.$win.scrollTop(st),!editor.selection.info(editor.el).atStart)return!1}if(!editor.core.hasFocus()||editor.$el.find(".fr-marker").length>0)return!1;if(editor.selection.info(editor.el).atStart&&editor.selection.isCollapsed()&&null!=editor.html.defaultTag()){var marker=editor.markers.insert();if(marker&&!editor.node.blockParent(marker)){$(marker).remove();var element=editor.$el.find(editor.html.blockTagsQuery()).get(0);element&&($(element).prepend($.FE.MARKERS),editor.selection.restore())}else marker&&$(marker).remove()}}var focused=!1;function enableBlur(){_do_blur=!0}function disableBlur(){_do_blur=!1}function blurActive(){return _do_blur}function on(name,callback,first){var callbacks,names=name.split(" ");if(names.length>1){for(var i=0;i<names.length;i++)on(names[i],callback,first);return!0}void 0===first&&(first=!1),callbacks=0!==name.indexOf("shared.")?_events[name]=_events[name]||[]:editor.shared._events[name]=editor.shared._events[name]||[],first?callbacks.unshift(callback):callbacks.push(callback)}var $_events=[];function $on($el,evs,selector,callback,shared){"function"==typeof selector&&(shared=callback,callback=selector,selector=!1);var ary=shared?editor.shared.$_events:$_events,id=shared?editor.sid:editor.id;callback=function(callback){return function(){if(!editor.destroying)return callback.apply(this,arguments)}}(callback),selector?$el.on(evs.split(" ").join(".ed"+id+" ")+".ed"+id,selector,callback):$el.on(evs.split(" ").join(".ed"+id+" ")+".ed"+id,callback),ary.push([$el,evs.split(" ").join(".ed"+id+" ")+".ed"+id])}function _$off(evs){for(var i=0;i<evs.length;i++)evs[i][0].off(evs[i][1])}function trigger(name,args,force){if(!editor.edit.isDisabled()||force){var callbacks,val;if(0!==name.indexOf("shared."))callbacks=_events[name];else{if(editor.shared.count>0)return!1;callbacks=editor.shared._events[name]}if(callbacks)for(var i=0;i<callbacks.length;i++)if(!1===(val=callbacks[i].apply(editor,args)))return!1;return!1!==(val=editor.$oel.triggerHandler("froalaEditor."+name,$.merge([editor],args||[])))&&val}}function _destroy(){for(var k in _events)_events.hasOwnProperty(k)&&delete _events[k]}function _sharedDestroy(){for(var k in editor.shared._events)editor.shared._events.hasOwnProperty(k)&&delete editor.shared._events[k]}return{_init:function(){editor.shared.$_events=editor.shared.$_events||[],editor.shared._events={},editor.helpers.isMobile()?(editor._mousedown="touchstart",editor._mouseup="touchend",editor._move="touchmove",editor._mousemove="touchmove"):(editor._mousedown="mousedown",editor._mouseup="mouseup",editor._move="",editor._mousemove="mousemove"),_assignEvent(editor.$el,"click mouseup mousedown touchstart touchend dragenter dragover dragleave dragend drop dragstart",(function(e){trigger(e.type,[e])})),on("mousedown",(function(){for(var i=0;i<$.FE.INSTANCES.length;i++)$.FE.INSTANCES[i]!=editor&&$.FE.INSTANCES[i].popups&&$.FE.INSTANCES[i].popups.areVisible()&&$.FE.INSTANCES[i].$el.find(".fr-marker").remove()})),_assignEvent(editor.$win,editor._mousedown,(function(e){trigger("window.mousedown",[e]),enableBlur()})),_assignEvent(editor.$win,editor._mouseup,(function(e){trigger("window.mouseup",[e])})),_assignEvent(editor.$win,"cut copy keydown keyup touchmove touchend",(function(e){trigger("window."+e.type,[e])})),_assignEvent(editor.$doc,"dragend drop",(function(e){trigger("document."+e.type,[e])})),_assignEvent(editor.$el,"keydown keypress keyup input",(function(e){trigger(e.type,[e])})),_assignEvent(editor.$el,"focus",(function(e){blurActive()&&(focus(!1),!1===focused&&trigger(e.type,[e]))})),_assignEvent(editor.$el,"blur",(function(e){blurActive()&&!0===focused&&(trigger(e.type,[e]),enableBlur())})),$on(editor.$el,"mousedown",'[contenteditable="true"]',(function(){disableBlur(),editor.$el.blur()})),on("focus",(function(){focused=!0})),on("blur",(function(){focused=!1})),enableBlur(),_assignEvent(editor.$el,"cut copy paste beforepaste",(function(e){trigger(e.type,[e])})),on("destroy",_destroy),on("shared.destroy",_sharedDestroy)},on:on,trigger:trigger,bindClick:function($element,selector,handler){$on($element,editor._mousedown,selector,(function(e){editor.edit.isDisabled()||function(e){var $btn=$(e.currentTarget);editor.edit.isDisabled()||editor.node.hasClass($btn.get(0),"fr-disabled")?e.preventDefault():"mousedown"===e.type&&1!==e.which||(editor.helpers.isMobile()||e.preventDefault(),(editor.helpers.isAndroid()||editor.helpers.isWindowsPhone())&&0===$btn.parents(".fr-dropdown-menu").length&&(e.preventDefault(),e.stopPropagation()),$btn.addClass("fr-selected"),editor.events.trigger("commands.mousedown",[$btn]))}(e)}),!0),$on($element,editor._mouseup+" "+editor._move,selector,(function(e){editor.edit.isDisabled()||function(e,handler){var $btn=$(e.currentTarget);if(editor.edit.isDisabled()||editor.node.hasClass($btn.get(0),"fr-disabled"))return e.preventDefault(),!1;if("mouseup"===e.type&&1!==e.which)return!0;if(!editor.node.hasClass($btn.get(0),"fr-selected"))return!0;if("touchmove"!=e.type){if(e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault(),!editor.node.hasClass($btn.get(0),"fr-selected"))return editor.button.getButtons(".fr-selected",!0).removeClass("fr-selected"),!1;if(editor.button.getButtons(".fr-selected",!0).removeClass("fr-selected"),$btn.data("dragging")||$btn.attr("disabled"))return $btn.removeData("dragging"),!1;var timeout=$btn.data("timeout");timeout&&(clearTimeout(timeout),$btn.removeData("timeout")),handler.apply(editor,[e])}else $btn.data("timeout")||$btn.data("timeout",setTimeout((function(){$btn.data("dragging",!0)}),100))}(e,handler)}),!0),$on($element,"mousedown click mouseup",selector,(function(e){editor.edit.isDisabled()||e.stopPropagation()}),!0),on("window.mouseup",(function(){editor.edit.isDisabled()||($element.find(selector).removeClass("fr-selected"),enableBlur())})),$on($element,"mouseenter",selector,(function(){$(this).hasClass("fr-options")&&$(this).prev(".fr-btn").addClass("fr-btn-hover"),$(this).next(".fr-btn").hasClass("fr-options")&&$(this).next(".fr-btn").addClass("fr-btn-hover")})),$on($element,"mouseleave",selector,(function(){$(this).hasClass("fr-options")&&$(this).prev(".fr-btn").removeClass("fr-btn-hover"),$(this).next(".fr-btn").hasClass("fr-options")&&$(this).next(".fr-btn").removeClass("fr-btn-hover")}))},disableBlur:disableBlur,enableBlur:enableBlur,blurActive:blurActive,focus:focus,chainTrigger:function(name,param,force){if(!editor.edit.isDisabled()||force){var callbacks,resp;if(0!==name.indexOf("shared."))callbacks=_events[name];else{if(editor.shared.count>0)return!1;callbacks=editor.shared._events[name]}if(callbacks)for(var i=0;i<callbacks.length;i++)void 0!==(resp=callbacks[i].apply(editor,[param]))&&(param=resp);return void 0!==(resp=editor.$oel.triggerHandler("froalaEditor."+name,$.merge([editor],[param])))&&(param=resp),param}},$on:$on,$off:function(){_$off($_events),$_events=[],0===editor.shared.count&&(_$off(editor.shared.$_events),editor.shared.$_events=[])}}}}(jQuery),function($){$.FE.MODULES.node=function(editor){function getContents(node){return node&&"IFRAME"!=node.tagName?Array.prototype.slice.call(node.childNodes||[]):[]}function isBlock(node){return!!node&&(node.nodeType==Node.ELEMENT_NODE&&$.FE.BLOCK_TAGS.indexOf(node.tagName.toLowerCase())>=0)}function rawAttributes(node){var attrs={},atts=node.attributes;if(atts)for(var i=0;i<atts.length;i++){var att=atts[i];attrs[att.nodeName]=att.value}return attrs}function attributes(node){for(var str="",atts=rawAttributes(node),keys=Object.keys(atts).sort(),i=0;i<keys.length;i++){var nodeName=keys[i],value=atts[nodeName];value.indexOf("'")<0&&value.indexOf('"')>=0?str+=" "+nodeName+"='"+value+"'":value.indexOf('"')>=0&&value.indexOf("'")>=0?str+=" "+nodeName+'="'+(value=value.replace(/"/g,"&quot;"))+'"':str+=" "+nodeName+'="'+value+'"'}return str}function isElement(node){return node===editor.el}return{isBlock:isBlock,isEmpty:function(el,ignore_markers){if(!el)return!0;if(el.querySelector("table"))return!1;var contents=getContents(el);1==contents.length&&isBlock(contents[0])&&(contents=getContents(contents[0]));for(var has_br=!1,i=0;i<contents.length;i++){var node=contents[i];if((!ignore_markers||!editor.node.hasClass(node,"fr-marker"))&&(node.nodeType!=Node.TEXT_NODE||0!==node.textContent.length)){if("BR"!=node.tagName&&(node.textContent||"").replace(/\u200B/gi,"").replace(/\n/g,"").length>0)return!1;if(has_br)return!1;"BR"==node.tagName&&(has_br=!0)}}return!(el.querySelectorAll($.FE.VOID_ELEMENTS.join(",")).length-el.querySelectorAll("br").length)&&(!el.querySelector(editor.opts.htmlAllowedEmptyTags.join(":not(.fr-marker),")+":not(.fr-marker)")&&(!(el.querySelectorAll($.FE.BLOCK_TAGS.join(",")).length>1)&&!el.querySelector(editor.opts.htmlDoNotWrapTags.join(":not(.fr-marker),")+":not(.fr-marker)")))},blockParent:function(node){for(;node&&node.parentNode!==editor.el&&(!node.parentNode||!editor.node.hasClass(node.parentNode,"fr-inner"));)if(isBlock(node=node.parentNode))return node;return null},deepestParent:function(node,until,simple_enter){if(void 0===until&&(until=[]),void 0===simple_enter&&(simple_enter=!0),until.push(editor.el),until.indexOf(node.parentNode)>=0||node.parentNode&&editor.node.hasClass(node.parentNode,"fr-inner")||node.parentNode&&$.FE.SIMPLE_ENTER_TAGS.indexOf(node.parentNode.tagName)>=0&&simple_enter)return null;for(;until.indexOf(node.parentNode)<0&&node.parentNode&&!editor.node.hasClass(node.parentNode,"fr-inner")&&($.FE.SIMPLE_ENTER_TAGS.indexOf(node.parentNode.tagName)<0||!simple_enter)&&(!isBlock(node)||!isBlock(node.parentNode)||!simple_enter);)node=node.parentNode;return node},rawAttributes:rawAttributes,attributes:attributes,clearAttributes:function(node){for(var atts=node.attributes,i=atts.length-1;i>=0;i--){var att=atts[i];node.removeAttribute(att.nodeName)}},openTagString:function(node){return"<"+node.tagName.toLowerCase()+attributes(node)+">"},closeTagString:function(node){return"</"+node.tagName.toLowerCase()+">"},isFirstSibling:function isFirstSibling(node,ignore_markers){void 0===ignore_markers&&(ignore_markers=!0);for(var sibling=node.previousSibling;sibling&&ignore_markers&&editor.node.hasClass(sibling,"fr-marker");)sibling=sibling.previousSibling;return!sibling||sibling.nodeType==Node.TEXT_NODE&&""===sibling.textContent&&isFirstSibling(sibling)},isLastSibling:function isLastSibling(node,ignore_markers){void 0===ignore_markers&&(ignore_markers=!0);for(var sibling=node.nextSibling;sibling&&ignore_markers&&editor.node.hasClass(sibling,"fr-marker");)sibling=sibling.nextSibling;return!sibling||sibling.nodeType==Node.TEXT_NODE&&""===sibling.textContent&&isLastSibling(sibling)},isList:function(node){return!!node&&["UL","OL"].indexOf(node.tagName)>=0},isLink:function(node){return!!node&&(node.nodeType==Node.ELEMENT_NODE&&"a"==node.tagName.toLowerCase())},isElement:isElement,contents:getContents,isVoid:function(node){return node&&node.nodeType==Node.ELEMENT_NODE&&$.FE.VOID_ELEMENTS.indexOf((node.tagName||"").toLowerCase())>=0},hasFocus:function(node){return node===editor.doc.activeElement&&(!editor.doc.hasFocus||editor.doc.hasFocus())&&!!(isElement(node)||node.type||node.href||~node.tabIndex)},isEditable:function(node){return(!node.getAttribute||"false"!=node.getAttribute("contenteditable"))&&["STYLE","SCRIPT"].indexOf(node.tagName)<0},isDeletable:function(node){return node&&node.nodeType==Node.ELEMENT_NODE&&node.getAttribute("class")&&(node.getAttribute("class")||"").indexOf("fr-deletable")>=0},hasClass:function(el,cls){return el instanceof $&&(el=el.get(0)),el&&el.classList&&el.classList.contains(cls)},filter:function(callback){return editor.browser.msie?callback:{acceptNode:callback}}}}}(jQuery),function($){$.FE.INVISIBLE_SPACE="&#8203;",$.FE.START_MARKER='<span class="fr-marker" data-id="0" data-type="true" style="display: none; line-height: 0;">'+$.FE.INVISIBLE_SPACE+"</span>",$.FE.END_MARKER='<span class="fr-marker" data-id="0" data-type="false" style="display: none; line-height: 0;">'+$.FE.INVISIBLE_SPACE+"</span>",$.FE.MARKERS=$.FE.START_MARKER+$.FE.END_MARKER,$.FE.MODULES.markers=function(editor){function insert(){if(!editor.$wp)return null;try{var range=editor.selection.ranges(0),containter=range.commonAncestorContainer;if(editor.core.isEmpty())return editor.selection.setAtStart(editor.el),editor.$el.find(".fr-marker:first").replaceWith('<span class="fr-single-marker" style="display: none; line-height: 0;">'+$.FE.INVISIBLE_SPACE+"</span>"),editor.$el.find(".fr-marker").remove(),editor.$el.find(".fr-single-marker").removeClass("fr-single-marker").addClass("fr-marker").get(0);if(containter!=editor.el&&0===editor.$el.find(containter).length)return null;var boundary=range.cloneRange(),original_range=range.cloneRange();boundary.collapse(!0);var mk=$('<span class="fr-marker" style="display: none; line-height: 0;">'+$.FE.INVISIBLE_SPACE+"</span>",editor.doc)[0];if(boundary.insertNode(mk),mk=editor.$el.find("span.fr-marker").get(0)){for(var sibling=mk.nextSibling;sibling&&sibling.nodeType===Node.TEXT_NODE&&0===sibling.textContent.length;)$(sibling).remove(),sibling=editor.$el.find("span.fr-marker").get(0).nextSibling;return editor.selection.clear(),editor.selection.get().addRange(original_range),mk}return null}catch(ex){console.warn("MARKER",ex)}}function remove(){editor.$el.find(".fr-marker").remove()}return{place:function(range,marker,id){var mk,contents,sibling;try{var boundary=range.cloneRange();if(boundary.collapse(marker),boundary.insertNode(function(marker,id){return $('<span class="fr-marker" data-id="'+id+'" data-type="'+marker+'" style="display: '+(editor.browser.safari?"none":"inline-block")+'; line-height: 0;">'+$.FE.INVISIBLE_SPACE+"</span>",editor.doc)[0]}(marker,id)),!0===marker)for(sibling=(mk=editor.$el.find('span.fr-marker[data-type="true"][data-id="'+id+'"]').get(0)).nextSibling;sibling&&sibling.nodeType===Node.TEXT_NODE&&0===sibling.textContent.length;)$(sibling).remove(),sibling=mk.nextSibling;if(!0===marker&&!range.collapsed){for(;!editor.node.isElement(mk.parentNode)&&!sibling;)$(mk.parentNode).after(mk),sibling=mk.nextSibling;if(sibling&&sibling.nodeType===Node.ELEMENT_NODE&&editor.node.isBlock(sibling)&&"HR"!==sibling.tagName){contents=[sibling];do{sibling=contents[0],contents=editor.node.contents(sibling)}while(contents[0]&&editor.node.isBlock(contents[0]));$(sibling).prepend($(mk))}}if(!1===marker&&!range.collapsed){if((sibling=(mk=editor.$el.find('span.fr-marker[data-type="false"][data-id="'+id+'"]').get(0)).previousSibling)&&sibling.nodeType===Node.ELEMENT_NODE&&editor.node.isBlock(sibling)&&"HR"!==sibling.tagName){contents=[sibling];do{sibling=contents[contents.length-1],contents=editor.node.contents(sibling)}while(contents[contents.length-1]&&editor.node.isBlock(contents[contents.length-1]));$(sibling).append($(mk))}mk.parentNode&&["TD","TH"].indexOf(mk.parentNode.tagName)>=0&&mk.parentNode.previousSibling&&!mk.previousSibling&&$(mk.parentNode.previousSibling).append(mk)}var dom_marker=editor.$el.find('span.fr-marker[data-type="'+marker+'"][data-id="'+id+'"]').get(0);return dom_marker&&(dom_marker.style.display="none"),dom_marker}catch(ex){return null}},insert:insert,split:function(){editor.selection.isCollapsed()||editor.selection.remove();var marker=editor.$el.find(".fr-marker").get(0);if(null==marker&&(marker=insert()),null==marker)return null;var deep_parent=editor.node.deepestParent(marker);if(deep_parent||(deep_parent=editor.node.blockParent(marker))&&"LI"!=deep_parent.tagName&&(deep_parent=null),deep_parent)if(editor.node.isBlock(deep_parent)&&editor.node.isEmpty(deep_parent))"LI"!=deep_parent.tagName||deep_parent.parentNode.firstElementChild!=deep_parent||editor.node.isEmpty(deep_parent.parentNode)?$(deep_parent).replaceWith('<span class="fr-marker"></span>'):$(deep_parent).append('<span class="fr-marker"></span>');else if(editor.cursor.isAtStart(marker,deep_parent))$(deep_parent).before('<span class="fr-marker"></span>'),$(marker).remove();else if(editor.cursor.isAtEnd(marker,deep_parent))$(deep_parent).after('<span class="fr-marker"></span>'),$(marker).remove();else{var node=marker,close_str="",open_str="";do{node=node.parentNode,close_str+=editor.node.closeTagString(node),open_str=editor.node.openTagString(node)+open_str}while(node!=deep_parent);$(marker).replaceWith('<span id="fr-break"></span>');var h=editor.node.openTagString(deep_parent)+$(deep_parent).html()+editor.node.closeTagString(deep_parent);h=h.replace(/<span id="fr-break"><\/span>/g,close_str+'<span class="fr-marker"></span>'+open_str),$(deep_parent).replaceWith(h)}return editor.$el.find(".fr-marker").get(0)},insertAtPoint:function(e){var start,x=e.clientX,y=e.clientY;remove();var range=null;if(void 0!==editor.doc.caretPositionFromPoint?(start=editor.doc.caretPositionFromPoint(x,y),(range=editor.doc.createRange()).setStart(start.offsetNode,start.offset),range.setEnd(start.offsetNode,start.offset)):void 0!==editor.doc.caretRangeFromPoint&&(start=editor.doc.caretRangeFromPoint(x,y),(range=editor.doc.createRange()).setStart(start.startContainer,start.startOffset),range.setEnd(start.startContainer,start.startOffset)),null!==range&&void 0!==editor.win.getSelection){var sel=editor.win.getSelection();sel.removeAllRanges(),sel.addRange(range)}else if(void 0!==editor.doc.body.createTextRange)try{(range=editor.doc.body.createTextRange()).moveToPoint(x,y);var end_range=range.duplicate();end_range.moveToPoint(x,y),range.setEndPoint("EndToEnd",end_range),range.select()}catch(ex){return!1}insert()},remove:remove}}}(jQuery),function($){$.FE.MODULES.selection=function(editor){function text(){var text="";return editor.win.getSelection?text=editor.win.getSelection():editor.doc.getSelection?text=editor.doc.getSelection():editor.doc.selection&&(text=editor.doc.selection.createRange().text),text.toString()}function get(){return editor.win.getSelection?editor.win.getSelection():editor.doc.getSelection?editor.doc.getSelection():editor.doc.selection.createRange()}function ranges(index){var sel=get(),ranges=[];if(sel&&sel.getRangeAt&&sel.rangeCount){ranges=[];for(var i=0;i<sel.rangeCount;i++)ranges.push(sel.getRangeAt(i))}else ranges=editor.doc.createRange?[editor.doc.createRange()]:[];return void 0!==index?ranges[index]:ranges}function clear(){var sel=get();try{sel.removeAllRanges?sel.removeAllRanges():sel.empty?sel.empty():sel.clear&&sel.clear()}catch(ex){}}function rangeElement(rangeContainer,offset){var node=rangeContainer;return node.nodeType==Node.ELEMENT_NODE&&node.childNodes.length>0&&node.childNodes[offset]&&(node=node.childNodes[offset]),node.nodeType==Node.TEXT_NODE&&(node=node.parentNode),node}function save(){if(editor.$wp){editor.markers.remove();var range,i,rgs=ranges(),new_ranges=[];for(i=0;i<rgs.length;i++)if(rgs[i].startContainer!==editor.doc||editor.browser.msie){var collapsed=(range=rgs[i]).collapsed,start_m=editor.markers.place(range,!0,i),end_m=editor.markers.place(range,!1,i);if(void 0!==start_m&&start_m||!collapsed||($(".fr-marker").remove(),editor.selection.setAtEnd(editor.el)),editor.el.normalize(),editor.browser.safari&&!collapsed)try{(range=editor.doc.createRange()).setStartAfter(start_m),range.setEndBefore(end_m),new_ranges.push(range)}catch(ex){}}if(editor.browser.safari&&new_ranges.length)for(editor.selection.clear(),i=0;i<new_ranges.length;i++)editor.selection.get().addRange(new_ranges[i])}}function restore(){var i,markers=editor.el.querySelectorAll('.fr-marker[data-type="true"]');if(!editor.$wp)return editor.markers.remove(),!1;if(0===markers.length)return!1;if(editor.browser.msie||editor.browser.edge)for(i=0;i<markers.length;i++)markers[i].style.display="inline-block";editor.core.hasFocus()||editor.browser.msie||editor.browser.webkit||editor.$el.focus(),clear();var sel=get();for(i=0;i<markers.length;i++){var id=$(markers[i]).data("id"),start_marker=markers[i],range=editor.doc.createRange(),end_marker=editor.$el.find('.fr-marker[data-type="false"][data-id="'+id+'"]');(editor.browser.msie||editor.browser.edge)&&end_marker.css("display","inline-block");var ghost=null;if(end_marker.length>0){end_marker=end_marker[0];try{for(var tmp,special_case=!1,s_node=start_marker.nextSibling;s_node&&s_node.nodeType==Node.TEXT_NODE&&0===s_node.textContent.length;)tmp=s_node,s_node=s_node.nextSibling,$(tmp).remove();for(var x,y,e_node=end_marker.nextSibling;e_node&&e_node.nodeType==Node.TEXT_NODE&&0===e_node.textContent.length;)tmp=e_node,e_node=e_node.nextSibling,$(tmp).remove();if(start_marker.nextSibling==end_marker||end_marker.nextSibling==start_marker){for(var first_node=start_marker.nextSibling==end_marker?start_marker:end_marker,last_node=first_node==start_marker?end_marker:start_marker,prev_node=first_node.previousSibling;prev_node&&prev_node.nodeType==Node.TEXT_NODE&&0===prev_node.length;)tmp=prev_node,prev_node=prev_node.previousSibling,$(tmp).remove();if(prev_node&&prev_node.nodeType==Node.TEXT_NODE)for(;prev_node&&prev_node.previousSibling&&prev_node.previousSibling.nodeType==Node.TEXT_NODE;)prev_node.previousSibling.textContent=prev_node.previousSibling.textContent+prev_node.textContent,prev_node=prev_node.previousSibling,$(prev_node.nextSibling).remove();for(var next_node=last_node.nextSibling;next_node&&next_node.nodeType==Node.TEXT_NODE&&0===next_node.length;)tmp=next_node,next_node=next_node.nextSibling,$(tmp).remove();if(next_node&&next_node.nodeType==Node.TEXT_NODE)for(;next_node&&next_node.nextSibling&&next_node.nextSibling.nodeType==Node.TEXT_NODE;)next_node.nextSibling.textContent=next_node.textContent+next_node.nextSibling.textContent,next_node=next_node.nextSibling,$(next_node.previousSibling).remove();if(prev_node&&(editor.node.isVoid(prev_node)||editor.node.isBlock(prev_node))&&(prev_node=null),next_node&&(editor.node.isVoid(next_node)||editor.node.isBlock(next_node))&&(next_node=null),prev_node&&next_node&&prev_node.nodeType==Node.TEXT_NODE&&next_node.nodeType==Node.TEXT_NODE){$(start_marker).remove(),$(end_marker).remove();var len=prev_node.textContent.length;prev_node.textContent=prev_node.textContent+next_node.textContent,$(next_node).remove(),editor.opts.htmlUntouched||editor.spaces.normalize(prev_node),range.setStart(prev_node,len),range.setEnd(prev_node,len),special_case=!0}else!prev_node&&next_node&&next_node.nodeType==Node.TEXT_NODE?($(start_marker).remove(),$(end_marker).remove(),editor.opts.htmlUntouched||editor.spaces.normalize(next_node),ghost=$(editor.doc.createTextNode("​")),$(next_node).before(ghost),range.setStart(next_node,0),range.setEnd(next_node,0),special_case=!0):!next_node&&prev_node&&prev_node.nodeType==Node.TEXT_NODE&&($(start_marker).remove(),$(end_marker).remove(),editor.opts.htmlUntouched||editor.spaces.normalize(prev_node),ghost=$(editor.doc.createTextNode("​")),$(prev_node).after(ghost),range.setStart(prev_node,prev_node.textContent.length),range.setEnd(prev_node,prev_node.textContent.length),special_case=!0)}if(!special_case)(editor.browser.chrome||editor.browser.edge)&&start_marker.nextSibling==end_marker?(x=_normalizedMarker(end_marker,range,!0)||range.setStartAfter(end_marker),y=_normalizedMarker(start_marker,range,!1)||range.setEndBefore(start_marker)):(start_marker.previousSibling==end_marker&&(end_marker=(start_marker=end_marker).nextSibling),end_marker.nextSibling&&"BR"===end_marker.nextSibling.tagName||!end_marker.nextSibling&&editor.node.isBlock(start_marker.previousSibling)||start_marker.previousSibling&&"BR"==start_marker.previousSibling.tagName||(start_marker.style.display="inline",end_marker.style.display="inline",ghost=$(editor.doc.createTextNode("​"))),x=_normalizedMarker(start_marker,range,!0)||$(start_marker).before(ghost)&&range.setStartBefore(start_marker),y=_normalizedMarker(end_marker,range,!1)||$(end_marker).after(ghost)&&range.setEndAfter(end_marker)),"function"==typeof x&&x(),"function"==typeof y&&y()}catch(ex){console.warn("RESTORE RANGE",ex)}}ghost&&ghost.remove();try{sel.addRange(range)}catch(ex){console.warn("ADD RANGE",ex)}}editor.markers.remove()}function _normalizedMarker(marker,range,start){var len,prev_node=marker.previousSibling,next_node=marker.nextSibling;return prev_node&&next_node&&prev_node.nodeType==Node.TEXT_NODE&&next_node.nodeType==Node.TEXT_NODE?(len=prev_node.textContent.length,start?(next_node.textContent=prev_node.textContent+next_node.textContent,$(prev_node).remove(),$(marker).remove(),editor.opts.htmlUntouched||editor.spaces.normalize(next_node),function(){range.setStart(next_node,len)}):(prev_node.textContent=prev_node.textContent+next_node.textContent,$(next_node).remove(),$(marker).remove(),editor.opts.htmlUntouched||editor.spaces.normalize(prev_node),function(){range.setEnd(prev_node,len)})):prev_node&&!next_node&&prev_node.nodeType==Node.TEXT_NODE?(len=prev_node.textContent.length,start?(editor.opts.htmlUntouched||editor.spaces.normalize(prev_node),function(){range.setStart(prev_node,len)}):(editor.opts.htmlUntouched||editor.spaces.normalize(prev_node),function(){range.setEnd(prev_node,len)})):!(!next_node||prev_node||next_node.nodeType!=Node.TEXT_NODE)&&(start?(editor.opts.htmlUntouched||editor.spaces.normalize(next_node),function(){range.setStart(next_node,0)}):(editor.opts.htmlUntouched||editor.spaces.normalize(next_node),function(){range.setEnd(next_node,0)}))}function isCollapsed(){for(var rgs=ranges(),i=0;i<rgs.length;i++)if(!rgs[i].collapsed)return!1;return!0}function info(el){var selRange,testRange,atStart=!1,atEnd=!1;if(editor.win.getSelection){var sel=editor.win.getSelection();sel.rangeCount&&((testRange=(selRange=sel.getRangeAt(0)).cloneRange()).selectNodeContents(el),testRange.setEnd(selRange.startContainer,selRange.startOffset),atStart=""===testRange.toString(),testRange.selectNodeContents(el),testRange.setStart(selRange.endContainer,selRange.endOffset),atEnd=""===testRange.toString())}else editor.doc.selection&&"Control"!=editor.doc.selection.type&&((testRange=(selRange=editor.doc.selection.createRange()).duplicate()).moveToElementText(el),testRange.setEndPoint("EndToStart",selRange),atStart=""===testRange.text,testRange.moveToElementText(el),testRange.setEndPoint("StartToEnd",selRange),atEnd=""===testRange.text);return{atStart:atStart,atEnd:atEnd}}function _emptyInnerNodes(node,first){void 0===first&&(first=!0);var h=$(node).html();h&&h.replace(/\u200b/g,"").length!=h.length&&$(node).html(h.replace(/\u200b/g,""));for(var contents=editor.node.contents(node),j=0;j<contents.length;j++)contents[j].nodeType!=Node.ELEMENT_NODE?$(contents[j]).remove():(_emptyInnerNodes(contents[j],0===j),0===j&&(first=!1));node.nodeType==Node.TEXT_NODE?$(node).replaceWith('<span data-first="true" data-text="true"></span>'):first&&$(node).attr("data-first",!0)}function _filterFrInner(){return 0===$(this).find("fr-inner").length}function _processNodeDelete($node,should_delete){var contents=editor.node.contents($node.get(0));["TD","TH"].indexOf($node.get(0).tagName)>=0&&1==$node.find(".fr-marker").length&&editor.node.hasClass(contents[0],"fr-marker")&&$node.attr("data-del-cell",!0);for(var i=0;i<contents.length;i++){var node=contents[i];editor.node.hasClass(node,"fr-marker")?should_delete=(should_delete+1)%2:should_delete?$(node).find(".fr-marker").length>0?should_delete=_processNodeDelete($(node),should_delete):["TD","TH"].indexOf(node.tagName)<0&&!editor.node.hasClass(node,"fr-inner")?!editor.opts.keepFormatOnDelete||editor.$el.find("[data-first]").length>0||editor.node.isVoid(node)?$(node).remove():_emptyInnerNodes(node):editor.node.hasClass(node,"fr-inner")?0===$(node).find(".fr-inner").length?$(node).html("<br>"):$(node).find(".fr-inner").filter(_filterFrInner).html("<br>"):($(node).empty(),$(node).attr("data-del-cell",!0)):$(node).find(".fr-marker").length>0&&(should_delete=_processNodeDelete($(node),should_delete))}return should_delete}function inEditor(){try{if(!editor.$wp)return!1;for(var container=ranges(0).commonAncestorContainer;container&&!editor.node.isElement(container);)container=container.parentNode;return!!editor.node.isElement(container)}catch(ex){return!1}}function setAtStart(node,deep){if(!node||node.getElementsByClassName("fr-marker").length>0)return!1;for(var child=node.firstChild;child&&(editor.node.isBlock(child)||deep&&!editor.node.isVoid(child)&&child.nodeType==Node.ELEMENT_NODE);)node=child,child=child.firstChild;node.innerHTML=$.FE.MARKERS+node.innerHTML}function setAtEnd(node,deep){if(!node||node.getElementsByClassName("fr-marker").length>0)return!1;for(var child=node.lastChild;child&&(editor.node.isBlock(child)||deep&&!editor.node.isVoid(child)&&child.nodeType==Node.ELEMENT_NODE);)node=child,child=child.lastChild;var span=editor.doc.createElement("SPAN");for(span.setAttribute("id","fr-sel-markers"),span.innerHTML=$.FE.MARKERS;node.parentNode&&editor.opts.htmlAllowedEmptyTags&&editor.opts.htmlAllowedEmptyTags.indexOf(node.tagName.toLowerCase())>=0;)node=node.parentNode;node.appendChild(span);var nd=node.querySelector("#fr-sel-markers");nd.outerHTML=nd.innerHTML}return{text:text,get:get,ranges:ranges,clear:clear,element:function(){var sel=get();try{if(sel.rangeCount){var child,range=ranges(0),node=range.startContainer;if(editor.node.isElement(node)&&0===range.startOffset&&node.childNodes.length)for(;node.childNodes.length&&node.childNodes[0].nodeType===Node.ELEMENT_NODE;)node=node.childNodes[0];if(node.nodeType==Node.TEXT_NODE&&range.startOffset==(node.textContent||"").length&&node.nextSibling&&(node=node.nextSibling),node.nodeType==Node.ELEMENT_NODE){var node_found=!1;if(node.childNodes.length>0&&node.childNodes[range.startOffset]){for(child=node.childNodes[range.startOffset];child&&child.nodeType==Node.TEXT_NODE&&0===child.textContent.length;)child=child.nextSibling;if(child&&child.textContent.replace(/\u200B/g,"")===text().replace(/\u200B/g,"")&&(node=child,node_found=!0),!node_found&&node.childNodes.length>1&&range.startOffset>0&&node.childNodes[range.startOffset-1]){for(child=node.childNodes[range.startOffset-1];child&&child.nodeType==Node.TEXT_NODE&&0===child.textContent.length;)child=child.nextSibling;child&&child.textContent.replace(/\u200B/g,"")===text().replace(/\u200B/g,"")&&(node=child,node_found=!0)}}else!range.collapsed&&node.nextSibling&&node.nextSibling.nodeType==Node.ELEMENT_NODE&&(child=node.nextSibling)&&child.textContent.replace(/\u200B/g,"")===text().replace(/\u200B/g,"")&&(node=child,node_found=!0);!node_found&&node.childNodes.length>0&&$(node.childNodes[0]).text().replace(/\u200B/g,"")===text().replace(/\u200B/g,"")&&["BR","IMG","HR"].indexOf(node.childNodes[0].tagName)<0&&(node=node.childNodes[0])}for(;node.nodeType!=Node.ELEMENT_NODE&&node.parentNode;)node=node.parentNode;for(var p=node;p&&"HTML"!=p.tagName;){if(p==editor.el)return node;p=$(p).parent()[0]}}}catch(ex){}return editor.el},endElement:function(){var sel=get();try{if(sel.rangeCount){var child,range=ranges(0),node=range.endContainer;if(node.nodeType==Node.ELEMENT_NODE){var node_found=!1;node.childNodes.length>0&&node.childNodes[range.endOffset]&&$(node.childNodes[range.endOffset]).text()===text()?(node=node.childNodes[range.endOffset],node_found=!0):!range.collapsed&&node.previousSibling&&node.previousSibling.nodeType==Node.ELEMENT_NODE?(child=node.previousSibling)&&child.textContent.replace(/\u200B/g,"")===text().replace(/\u200B/g,"")&&(node=child,node_found=!0):!range.collapsed&&node.childNodes.length>0&&node.childNodes[range.endOffset]&&(child=node.childNodes[range.endOffset].previousSibling).nodeType==Node.ELEMENT_NODE&&child&&child.textContent.replace(/\u200B/g,"")===text().replace(/\u200B/g,"")&&(node=child,node_found=!0),!node_found&&node.childNodes.length>0&&$(node.childNodes[node.childNodes.length-1]).text()===text()&&["BR","IMG","HR"].indexOf(node.childNodes[node.childNodes.length-1].tagName)<0&&(node=node.childNodes[node.childNodes.length-1])}for(node.nodeType==Node.TEXT_NODE&&0===range.endOffset&&node.previousSibling&&node.previousSibling.nodeType==Node.ELEMENT_NODE&&(node=node.previousSibling);node.nodeType!=Node.ELEMENT_NODE&&node.parentNode;)node=node.parentNode;for(var p=node;p&&"HTML"!=p.tagName;){if(p==editor.el)return node;p=$(p).parent()[0]}}}catch(ex){}return editor.el},save:save,restore:restore,isCollapsed:isCollapsed,isFull:function(){if(isCollapsed())return!1;editor.selection.save();var i,els=editor.el.querySelectorAll("td, th, img, br");for(i=0;i<els.length;i++)els[i].nextSibling&&(els[i].innerHTML='<span class="fr-mk">'+$.FE.INVISIBLE_SPACE+"</span>"+els[i].innerHTML);var full=!1,inf=info(editor.el);for(inf.atStart&&inf.atEnd&&(full=!0),els=editor.el.querySelectorAll(".fr-mk"),i=0;i<els.length;i++)els[i].parentNode.removeChild(els[i]);return editor.selection.restore(),full},inEditor:inEditor,remove:function(){if(isCollapsed())return!0;var i;save();var _prevSibling=function(node){for(var prev_node=node.previousSibling;prev_node&&prev_node.nodeType==Node.TEXT_NODE&&0===prev_node.textContent.length;){var tmp=prev_node;prev_node=prev_node.previousSibling,$(tmp).remove()}return prev_node},_nextSibling=function(node){for(var next_node=node.nextSibling;next_node&&next_node.nodeType==Node.TEXT_NODE&&0===next_node.textContent.length;){var tmp=next_node;next_node=next_node.nextSibling,$(tmp).remove()}return next_node},start_markers=editor.$el.find('.fr-marker[data-type="true"]');for(i=0;i<start_markers.length;i++)for(var sm=start_markers[i];!(_prevSibling(sm)||editor.node.isBlock(sm.parentNode)||editor.$el.is(sm.parentNode)||editor.node.hasClass(sm.parentNode,"fr-inner"));)$(sm.parentNode).before(sm);var end_markers=editor.$el.find('.fr-marker[data-type="false"]');for(i=0;i<end_markers.length;i++){for(var em=end_markers[i];!(_nextSibling(em)||editor.node.isBlock(em.parentNode)||editor.$el.is(em.parentNode)||editor.node.hasClass(em.parentNode,"fr-inner"));)$(em.parentNode).after(em);em.parentNode&&editor.node.isBlock(em.parentNode)&&editor.node.isEmpty(em.parentNode)&&!editor.$el.is(em.parentNode)&&!editor.node.hasClass(em.parentNode,"fr-inner")&&editor.opts.keepFormatOnDelete&&$(em.parentNode).after(em)}if(function(){for(var markers=editor.$el.find(".fr-marker"),i=0;i<markers.length;i++)if($(markers[i]).parentsUntil('.fr-element, [contenteditable="true"]','[contenteditable="false"]').length)return!1;return!0}()){_processNodeDelete(editor.$el,0);var $first_node=editor.$el.find('[data-first="true"]');if($first_node.length)editor.$el.find(".fr-marker").remove(),$first_node.append($.FE.INVISIBLE_SPACE+$.FE.MARKERS).removeAttr("data-first"),$first_node.attr("data-text")&&$first_node.replaceWith($first_node.html());else for(editor.$el.find("table").filter((function(){return $(this).find("[data-del-cell]").length>0&&$(this).find("[data-del-cell]").length==$(this).find("td, th").length})).remove(),editor.$el.find("[data-del-cell]").removeAttr("data-del-cell"),start_markers=editor.$el.find('.fr-marker[data-type="true"]'),i=0;i<start_markers.length;i++){var start_marker=start_markers[i],next_node=start_marker.nextSibling,end_marker=editor.$el.find('.fr-marker[data-type="false"][data-id="'+$(start_marker).data("id")+'"]').get(0);if(end_marker){if(start_marker&&(!next_node||next_node!=end_marker)){var start_parent=editor.node.blockParent(start_marker),end_parent=editor.node.blockParent(end_marker),list_start=!1,list_end=!1;if(start_parent&&["UL","OL"].indexOf(start_parent.tagName)>=0&&(start_parent=null,list_start=!0),end_parent&&["UL","OL"].indexOf(end_parent.tagName)>=0&&(end_parent=null,list_end=!0),$(start_marker).after(end_marker),start_parent!=end_parent)if(null!=start_parent||list_start)if(null!=end_parent||list_end||0!==$(start_parent).parentsUntil(editor.$el,"table").length)start_parent&&end_parent&&0===$(start_parent).parentsUntil(editor.$el,"table").length&&0===$(end_parent).parentsUntil(editor.$el,"table").length&&0===$(start_parent).find(end_parent).length&&0===$(end_parent).find(start_parent).length&&($(start_parent).append($(end_parent).html()),$(end_parent).remove());else{for(next_node=start_parent;!next_node.nextSibling&&next_node.parentNode!=editor.el;)next_node=next_node.parentNode;for(next_node=next_node.nextSibling;next_node&&"BR"!=next_node.tagName;){var tmp_node=next_node.nextSibling;$(start_parent).append(next_node),next_node=tmp_node}next_node&&"BR"==next_node.tagName&&$(next_node).remove()}else{var deep_parent=editor.node.deepestParent(start_marker);deep_parent?($(deep_parent).after($(end_parent).html()),$(end_parent).remove()):0===$(end_parent).parentsUntil(editor.$el,"table").length&&($(start_marker).next().after($(end_parent).html()),$(end_parent).remove())}}}else end_marker=$(start_marker).clone().attr("data-type",!1),$(start_marker).after(end_marker)}}editor.$el.find("li:empty").remove(),editor.opts.keepFormatOnDelete||editor.html.fillEmptyBlocks(),editor.html.cleanEmptyTags(!0),editor.opts.htmlUntouched||(editor.clean.lists(),editor.$el.find("li:empty").append("<br>"),editor.spaces.normalize());var last_marker=editor.$el.find(".fr-marker:last").get(0),first_marker=editor.$el.find(".fr-marker:first").get(0);void 0!==last_marker&&void 0!==first_marker&&!last_marker.nextSibling&&first_marker.previousSibling&&"BR"==first_marker.previousSibling.tagName&&editor.node.isElement(last_marker.parentNode)&&editor.node.isElement(first_marker.parentNode)&&editor.$el.append("<br>"),restore()},blocks:function(){var i,blks=[],sel=get();if(inEditor()&&sel.rangeCount){var rngs=ranges();for(i=0;i<rngs.length;i++){var block_parent,range=rngs[i],start_node=rangeElement(range.startContainer,range.startOffset),end_node=rangeElement(range.endContainer,range.endOffset);(editor.node.isBlock(start_node)||editor.node.hasClass(start_node,"fr-inner"))&&blks.indexOf(start_node)<0&&blks.push(start_node),(block_parent=editor.node.blockParent(start_node))&&blks.indexOf(block_parent)<0&&blks.push(block_parent);for(var was_into=[],next_node=start_node;next_node!==end_node&&next_node!==editor.el;)was_into.indexOf(next_node)<0&&next_node.children&&next_node.children.length?(was_into.push(next_node),next_node=next_node.children[0]):next_node.nextSibling?next_node=next_node.nextSibling:next_node.parentNode&&(next_node=next_node.parentNode,was_into.push(next_node)),editor.node.isBlock(next_node)&&was_into.indexOf(next_node)<0&&blks.indexOf(next_node)<0&&(next_node!==end_node||range.endOffset>0)&&blks.push(next_node);editor.node.isBlock(end_node)&&blks.indexOf(end_node)<0&&range.endOffset>0&&blks.push(end_node),(block_parent=editor.node.blockParent(end_node))&&blks.indexOf(block_parent)<0&&blks.push(block_parent)}}for(i=blks.length-1;i>0;i--)$(blks[i]).find(blks).length&&blks.splice(i,1);return blks},info:info,setAtEnd:setAtEnd,setAtStart:setAtStart,setBefore:function(node,use_current_node){void 0===use_current_node&&(use_current_node=!0);for(var prev_node=node.previousSibling;prev_node&&prev_node.nodeType==Node.TEXT_NODE&&0===prev_node.textContent.length;)prev_node=prev_node.previousSibling;return prev_node?(editor.node.isBlock(prev_node)?setAtEnd(prev_node):"BR"==prev_node.tagName?$(prev_node).before($.FE.MARKERS):$(prev_node).after($.FE.MARKERS),!0):!!use_current_node&&(editor.node.isBlock(node)?setAtStart(node):$(node).before($.FE.MARKERS),!0)},setAfter:function(node,use_current_node){void 0===use_current_node&&(use_current_node=!0);for(var next_node=node.nextSibling;next_node&&next_node.nodeType==Node.TEXT_NODE&&0===next_node.textContent.length;)next_node=next_node.nextSibling;return next_node?(editor.node.isBlock(next_node)?setAtStart(next_node):$(next_node).before($.FE.MARKERS),!0):!!use_current_node&&(editor.node.isBlock(node)?setAtEnd(node):$(node).after($.FE.MARKERS),!0)},rangeElement:rangeElement}}}(jQuery),function($){$.extend($.FE.DEFAULTS,{htmlAllowedTags:["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","br","button","canvas","caption","cite","code","col","colgroup","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meter","nav","noscript","object","ol","optgroup","option","output","p","param","pre","progress","queue","rp","rt","ruby","s","samp","script","style","section","select","small","source","span","strike","strong","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","track","u","ul","var","video","wbr"],htmlRemoveTags:["script","style"],htmlAllowedAttrs:["accept","accept-charset","accesskey","action","align","allowfullscreen","allowtransparency","alt","aria-.*","async","autocomplete","autofocus","autoplay","autosave","background","bgcolor","border","charset","cellpadding","cellspacing","checked","cite","class","color","cols","colspan","content","contenteditable","contextmenu","controls","coords","data","data-.*","datetime","default","defer","dir","dirname","disabled","download","draggable","dropzone","enctype","for","form","formaction","frameborder","headers","height","hidden","high","href","hreflang","http-equiv","icon","id","ismap","itemprop","keytype","kind","label","lang","language","list","loop","low","max","maxlength","media","method","min","mozallowfullscreen","multiple","muted","name","novalidate","open","optimum","pattern","ping","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","reversed","rows","rowspan","sandbox","scope","scoped","scrolling","seamless","selected","shape","size","sizes","span","src","srcdoc","srclang","srcset","start","step","summary","spellcheck","style","tabindex","target","title","type","translate","usemap","value","valign","webkitallowfullscreen","width","wrap"],htmlAllowedStyleProps:[".*"],htmlAllowComments:!0,htmlUntouched:!1,fullPage:!1}),$.FE.HTML5Map={B:"STRONG",I:"EM",STRIKE:"S"},$.FE.MODULES.clean=function(editor){var allowedTagsRE,removeTagsRE,allowedAttrsRE,allowedStylePropsRE;function _removeInvisible(node){if(node.nodeType==Node.ELEMENT_NODE&&node.getAttribute("class")&&node.getAttribute("class").indexOf("fr-marker")>=0)return!1;var i,contents=editor.node.contents(node),markers=[];for(i=0;i<contents.length;i++)contents[i].nodeType!=Node.ELEMENT_NODE||editor.node.isVoid(contents[i])?contents[i].nodeType==Node.TEXT_NODE&&(contents[i].textContent=contents[i].textContent.replace(/\u200b/g,"")):contents[i].textContent.replace(/\u200b/g,"").length!=contents[i].textContent.length&&_removeInvisible(contents[i]);if(node.nodeType==Node.ELEMENT_NODE&&!editor.node.isVoid(node)&&(node.normalize(),contents=editor.node.contents(node),markers=node.querySelectorAll(".fr-marker"),contents.length-markers.length==0)){for(i=0;i<contents.length;i++)if(contents[i].nodeType==Node.ELEMENT_NODE&&(contents[i].getAttribute("class")||"").indexOf("fr-marker")<0)return!1;for(i=0;i<markers.length;i++)node.parentNode.insertBefore(markers[i].cloneNode(!0),node);return node.parentNode.removeChild(node),!1}}function _toHTML(el,is_pre){if(el.nodeType==Node.COMMENT_NODE)return"\x3c!--"+el.nodeValue+"--\x3e";if(el.nodeType==Node.TEXT_NODE)return is_pre?el.textContent.replace(/\&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):el.textContent.replace(/\&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\u00A0/g,"&nbsp;").replace(/\u0009/g,"");if(el.nodeType!=Node.ELEMENT_NODE)return el.outerHTML;if(el.nodeType==Node.ELEMENT_NODE&&["STYLE","SCRIPT","NOSCRIPT"].indexOf(el.tagName)>=0)return el.outerHTML;if(el.nodeType==Node.ELEMENT_NODE&&"svg"==el.tagName){var temp=document.createElement("div"),node_clone=el.cloneNode(!0);return temp.appendChild(node_clone),temp.innerHTML}if("IFRAME"==el.tagName)return el.outerHTML.replace(/\&lt;/g,"<").replace(/\&gt;/g,">");var contents=el.childNodes;if(0===contents.length)return el.outerHTML;for(var str="",i=0;i<contents.length;i++)"PRE"==el.tagName&&(is_pre=!0),str+=_toHTML(contents[i],is_pre);return editor.node.openTagString(el)+str+editor.node.closeTagString(el)}var scripts=[];function _cleanStyle(style){var cleaned_style=style.replace(/;;/gi,";");return";"!=(cleaned_style=cleaned_style.replace(/^;/gi,"")).charAt(cleaned_style.length)&&(cleaned_style+=";"),cleaned_style}function _cleanAttrs(attrs){var nm;for(nm in attrs)if(attrs.hasOwnProperty(nm)){var is_attr_allowed=nm.match(allowedAttrsRE),allowed_style_props_matches=null;"style"==nm&&editor.opts.htmlAllowedStyleProps.length&&(allowed_style_props_matches=attrs[nm].match(allowedStylePropsRE)),is_attr_allowed&&allowed_style_props_matches?attrs[nm]=_cleanStyle(allowed_style_props_matches.join(";")):is_attr_allowed&&("style"!=nm||allowed_style_props_matches)||delete attrs[nm]}for(var str="",keys=Object.keys(attrs).sort(),i=0;i<keys.length;i++)attrs[nm=keys[i]].indexOf('"')<0?str+=" "+nm+'="'+attrs[nm]+'"':str+=" "+nm+"='"+attrs[nm]+"'";return str}function _process(html,func){var i,el=document.implementation.createHTMLDocument("Froala DOC").createElement("DIV");$(el).append(html);var new_html="";if(el){var els=editor.node.contents(el);for(i=0;i<els.length;i++)func(els[i]);for(els=editor.node.contents(el),i=0;i<els.length;i++)new_html+=_toHTML(els[i])}return new_html}function exec(html,func,parse_head){scripts=[];var b_html=html=html.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,(function(str){return scripts.push(str),"[FROALA.EDITOR.SCRIPT "+(scripts.length-1)+"]"})).replace(/<noscript\b[^<]*(?:(?!<\/noscript>)<[^<]*)*<\/noscript>/gi,(function(str){return scripts.push(str),"[FROALA.EDITOR.NOSCRIPT "+(scripts.length-1)+"]"})).replace(/<meta((?:[\w\W]*?)) http-equiv="/g,'<meta$1 data-fr-http-equiv="').replace(/<img((?:[\w\W]*?)) src="/g,'<img$1 data-fr-src="'),h_html=null;return editor.opts.fullPage&&(b_html=editor.html.extractNode(html,"body")||(html.indexOf("<body")>=0?"":html),parse_head&&(h_html=editor.html.extractNode(html,"head")||"")),b_html=_process(b_html,func),h_html&&(h_html=_process(h_html,func)),function(dirty_html){return(dirty_html=(dirty_html=dirty_html.replace(/\[FROALA\.EDITOR\.SCRIPT ([\d]*)\]/gi,(function(str,a1){return editor.opts.htmlRemoveTags.indexOf("script")>=0?"":scripts[parseInt(a1,10)]}))).replace(/\[FROALA\.EDITOR\.NOSCRIPT ([\d]*)\]/gi,(function(str,a1){return editor.opts.htmlRemoveTags.indexOf("noscript")>=0?"":scripts[parseInt(a1,10)].replace(/\&lt;/g,"<").replace(/\&gt;/g,">")}))).replace(/<img((?:[\w\W]*?)) data-fr-src="/g,'<img$1 src="')}(function(body_html,head_html,original_html){if(editor.opts.fullPage){var doctype=editor.html.extractDoctype(original_html),html_attrs=_cleanAttrs(editor.html.extractNodeAttrs(original_html,"html"));return head_html=null==head_html?editor.html.extractNode(original_html,"head")||"<title></title>":head_html,doctype+"<html"+html_attrs+"><head"+_cleanAttrs(editor.html.extractNodeAttrs(original_html,"head"))+">"+head_html+"</head><body"+_cleanAttrs(editor.html.extractNodeAttrs(original_html,"body"))+">"+body_html+"</body></html>"}return body_html}(b_html,h_html,html))}function _convertHref(href){var div=editor.doc.createElement("DIV");return div.innerText=href,div.textContent}function _run(node){for(var contents=editor.node.contents(node),i=0;i<contents.length;i++)contents[i].nodeType!=Node.TEXT_NODE&&_run(contents[i]);!function(node){if("SPAN"==node.tagName&&(node.getAttribute("class")||"").indexOf("fr-marker")>=0)return!1;var pre,content;if("PRE"==node.tagName&&(content=(pre=node).innerHTML).indexOf("\n")>=0&&(pre.innerHTML=content.replace(/\n/g,"<br>")),node.nodeType==Node.ELEMENT_NODE&&(node.getAttribute("data-fr-src")&&0!==node.getAttribute("data-fr-src").indexOf("blob:")&&node.setAttribute("data-fr-src",editor.helpers.sanitizeURL(_convertHref(node.getAttribute("data-fr-src")))),node.getAttribute("href")&&node.setAttribute("href",editor.helpers.sanitizeURL(_convertHref(node.getAttribute("href")))),node.getAttribute("src")&&node.setAttribute("src",editor.helpers.sanitizeURL(_convertHref(node.getAttribute("src")))),node.getAttribute("data")&&node.setAttribute("data",editor.helpers.sanitizeURL(_convertHref(node.getAttribute("data")))),["TABLE","TBODY","TFOOT","TR"].indexOf(node.tagName)>=0&&(node.innerHTML=node.innerHTML.trim())),!editor.opts.pasteAllowLocalImages&&node.nodeType==Node.ELEMENT_NODE&&"IMG"==node.tagName&&node.getAttribute("data-fr-src")&&0===node.getAttribute("data-fr-src").indexOf("file://"))return node.parentNode.removeChild(node),!1;if(node.nodeType==Node.ELEMENT_NODE&&$.FE.HTML5Map[node.tagName]&&""===editor.node.attributes(node)){var tg=$.FE.HTML5Map[node.tagName],new_node="<"+tg+">"+node.innerHTML+"</"+tg+">";node.insertAdjacentHTML("beforebegin",new_node),(node=node.previousSibling).parentNode.removeChild(node.nextSibling)}if(editor.opts.htmlAllowComments||node.nodeType!=Node.COMMENT_NODE)if(node.tagName&&node.tagName.match(removeTagsRE))node.parentNode.removeChild(node);else if(node.tagName&&!node.tagName.match(allowedTagsRE)){if("svg"===node.tagName)node.parentNode.removeChild(node);else if(!editor.browser.safari||"path"!=node.tagName||!node.parentNode||"svg"!=node.parentNode.tagName)try{node.outerHTML=node.innerHTML}catch(ex){}}else{var attrs=node.attributes;if(attrs)for(var i=attrs.length-1;i>=0;i--){var attr=attrs[i],is_attr_allowed=attr.nodeName.match(allowedAttrsRE),allowed_style_props_matches=null;"style"==attr.nodeName&&editor.opts.htmlAllowedStyleProps.length&&(allowed_style_props_matches=attr.value.match(allowedStylePropsRE)),is_attr_allowed&&allowed_style_props_matches?attr.value=_cleanStyle(allowed_style_props_matches.join(";")):is_attr_allowed&&("style"!=attr.nodeName||allowed_style_props_matches)||node.removeAttribute(attr.nodeName)}}else 0!==node.data.indexOf("[FROALA.EDITOR")&&node.parentNode.removeChild(node)}(node)}return{_init:function(){editor.opts.fullPage&&$.merge(editor.opts.htmlAllowedTags,["head","title","style","link","base","body","html","meta"])},html:function(dirty_html,denied_tags,denied_attrs,full_page){void 0===denied_tags&&(denied_tags=[]),void 0===denied_attrs&&(denied_attrs=[]),void 0===full_page&&(full_page=!1);var i,allowed_tags=$.merge([],editor.opts.htmlAllowedTags);for(i=0;i<denied_tags.length;i++)allowed_tags.indexOf(denied_tags[i])>=0&&allowed_tags.splice(allowed_tags.indexOf(denied_tags[i]),1);var allowed_attrs=$.merge([],editor.opts.htmlAllowedAttrs);for(i=0;i<denied_attrs.length;i++)allowed_attrs.indexOf(denied_attrs[i])>=0&&allowed_attrs.splice(allowed_attrs.indexOf(denied_attrs[i]),1);return allowed_attrs.push("data-fr-.*"),allowed_attrs.push("fr-.*"),allowedTagsRE=new RegExp("^"+allowed_tags.join("$|^")+"$","gi"),allowedAttrsRE=new RegExp("^"+allowed_attrs.join("$|^")+"$","gi"),removeTagsRE=new RegExp("^"+editor.opts.htmlRemoveTags.join("$|^")+"$","gi"),allowedStylePropsRE=editor.opts.htmlAllowedStyleProps.length?new RegExp("((^|;|\\s)"+editor.opts.htmlAllowedStyleProps.join(":.+?(?=;|$))|((^|;|\\s)")+":.+?(?=(;)|$))","gi"):null,dirty_html=exec(dirty_html,_run,!0)},toHTML5:function(){var els=editor.el.querySelectorAll(Object.keys($.FE.HTML5Map).join(","));if(els.length){var sel_saved=!1;editor.el.querySelector(".fr-marker")||(editor.selection.save(),sel_saved=!0);for(var i=0;i<els.length;i++)""===editor.node.attributes(els[i])&&$(els[i]).replaceWith("<"+$.FE.HTML5Map[els[i].tagName]+">"+els[i].innerHTML+"</"+$.FE.HTML5Map[els[i].tagName]+">");sel_saved&&editor.selection.restore()}},tables:function(){!function(){for(var trs=editor.el.querySelectorAll("tr"),i=0;i<trs.length;i++){for(var children=trs[i].children,ok=!0,j=0;j<children.length;j++)if("TH"!=children[j].tagName){ok=!1;break}if(!1!==ok&&0!==children.length){for(var tr=trs[i];tr&&"TABLE"!=tr.tagName&&"THEAD"!=tr.tagName;)tr=tr.parentNode;var thead=tr;"THEAD"!=thead.tagName&&(thead=editor.doc.createElement("THEAD"),tr.insertBefore(thead,tr.firstChild)),thead.appendChild(trs[i])}}}()},lists:function(){!function(){var lis=[],filterListItem=function(li){return!editor.node.isList(li.parentNode)};do{if(lis.length){var li=lis[0],ul=editor.doc.createElement("ul");li.parentNode.insertBefore(ul,li);do{var tmp=li;li=li.nextSibling,ul.appendChild(tmp)}while(li&&"LI"==li.tagName)}lis=[];for(var li_sel=editor.el.querySelectorAll("li"),i=0;i<li_sel.length;i++)filterListItem(li_sel[i])&&lis.push(li_sel[i])}while(lis.length>0)}(),function(){for(var sibling_lists=editor.el.querySelectorAll("ol + ol, ul + ul"),k=0;k<sibling_lists.length;k++){var list=sibling_lists[k];if(editor.node.isList(list.previousSibling)&&editor.node.openTagString(list)==editor.node.openTagString(list.previousSibling)){for(var childs=editor.node.contents(list),i=0;i<childs.length;i++)list.previousSibling.appendChild(childs[i]);list.parentNode.removeChild(list)}}}(),function(){for(var lists=editor.el.querySelectorAll("ul, ol"),i=0;i<lists.length;i++)for(var contents=editor.node.contents(lists[i]),$li=null,j=contents.length-1;j>=0;j--)"LI"!=contents[j].tagName&&"UL"!=contents[j].tagName&&"OL"!=contents[j].tagName?($li||($li=$("<li>")).insertBefore(contents[j]),$li.prepend(contents[j])):$li=null}(),function(){var i,do_remove,lst;do{do_remove=!1;var empty_lis=editor.el.querySelectorAll("li:empty");for(i=0;i<empty_lis.length;i++)empty_lis[i].parentNode.removeChild(empty_lis[i]);var remaining_lists=editor.el.querySelectorAll("ul, ol");for(i=0;i<remaining_lists.length;i++)(lst=remaining_lists[i]).querySelector("LI")||(do_remove=!0,lst.parentNode.removeChild(lst))}while(!0===do_remove)}(),function(){for(var direct_lists=editor.el.querySelectorAll("ul > ul, ol > ol, ul > ol, ol > ul"),i=0;i<direct_lists.length;i++){var list=direct_lists[i],prev_li=list.previousSibling;prev_li&&("LI"==prev_li.tagName?prev_li.appendChild(list):$(list).wrap("<li></li>"))}}(),function(){for(var nested_lists=editor.el.querySelectorAll("li > ul, li > ol"),i=0;i<nested_lists.length;i++){var lst=nested_lists[i];if(lst.nextSibling){var node=lst.nextSibling,$new_li=$("<li>");$(lst.parentNode).after($new_li);do{var tmp=node;node=node.nextSibling,$new_li.append(tmp)}while(node)}}}(),function(){for(var nested_lists=editor.el.querySelectorAll("li > ul, li > ol"),i=0;i<nested_lists.length;i++){var lst=nested_lists[i];if(editor.node.isFirstSibling(lst))$(lst).before("<br/>");else if(lst.previousSibling&&"BR"==lst.previousSibling.tagName){for(var prev_node=lst.previousSibling.previousSibling;prev_node&&editor.node.hasClass(prev_node,"fr-marker");)prev_node=prev_node.previousSibling;prev_node&&"BR"!=prev_node.tagName&&$(lst.previousSibling).remove()}}}(),function(){for(var empty_lis=editor.el.querySelectorAll("li:empty"),i=0;i<empty_lis.length;i++)$(empty_lis[i]).remove()}()},invisibleSpaces:function(dirty_html){return dirty_html.replace(/\u200b/g,"").length==dirty_html.length?dirty_html:editor.clean.exec(dirty_html,_removeInvisible)},exec:exec}}}(jQuery),function($){$.FE.MODULES.spaces=function(editor){function _normalizeNode(node,browser_way){var p_node=node.previousSibling,n_node=node.nextSibling,txt=node.textContent,parent_node=node.parentNode;if(!editor.html.isPreformatted(parent_node)){browser_way&&(txt=txt.replace(/[\f\n\r\t\v ]{2,}/g," "),n_node&&"BR"!==n_node.tagName&&!editor.node.isBlock(n_node)||!(editor.node.isBlock(parent_node)||editor.node.isLink(parent_node)&&!parent_node.nextSibling||editor.node.isElement(parent_node))||(txt=txt.replace(/[\f\n\r\t\v ]{1,}$/g,"")),p_node&&"BR"!==p_node.tagName&&!editor.node.isBlock(p_node)||!(editor.node.isBlock(parent_node)||editor.node.isLink(parent_node)&&!parent_node.previousSibling||editor.node.isElement(parent_node))||(txt=txt.replace(/^[\f\n\r\t\v ]{1,}/g,"")),(editor.node.isBlock(n_node)||editor.node.isBlock(p_node))&&(txt=txt.replace(/^[\f\n\r\t\v ]{1,}/g,""))," "===txt&&(p_node&&editor.node.isVoid(p_node)||n_node&&editor.node.isVoid(n_node))&&!(p_node&&n_node&&editor.node.isVoid(p_node)||n_node&&p_node&&editor.node.isVoid(n_node))&&(txt="")),(!p_node&&editor.node.isBlock(n_node)||!n_node&&editor.node.isBlock(p_node))&&editor.node.isBlock(parent_node)&&parent_node!==editor.el&&(txt=txt.replace(/^[\f\n\r\t\v ]{1,}/g,"")),browser_way||(txt=txt.replace(new RegExp($.FE.UNICODE_NBSP,"g")," "));for(var new_text="",t=0;t<txt.length;t++)32!=txt.charCodeAt(t)||0!==t&&32!=new_text.charCodeAt(t-1)||p_node&&n_node&&editor.node.isVoid(p_node)||p_node&&n_node&&editor.node.isVoid(n_node)?new_text+=txt[t]:new_text+=$.FE.UNICODE_NBSP;(!n_node||n_node&&editor.node.isBlock(n_node)||n_node&&n_node.nodeType==Node.ELEMENT_NODE&&editor.win.getComputedStyle(n_node)&&"block"==editor.win.getComputedStyle(n_node).display)&&(editor.node.isVoid(p_node)||(new_text=new_text.replace(/ $/,$.FE.UNICODE_NBSP))),!p_node||editor.node.isVoid(p_node)||editor.node.isBlock(p_node)||1!==(new_text=new_text.replace(/^\u00A0([^ $])/," $1")).length||160!==new_text.charCodeAt(0)||!n_node||editor.node.isVoid(n_node)||editor.node.isBlock(n_node)||editor.node.hasClass(p_node,"fr-marker")&&editor.node.hasClass(n_node,"fr-marker")||(new_text=" "),browser_way||(new_text=new_text.replace(/([^ \u00A0])\u00A0([^ \u00A0])/g,"$1 $2")),node.textContent!=new_text&&(node.textContent=new_text)}}function normalize(el,browser_way){if(void 0!==el&&el||(el=editor.el),void 0===browser_way&&(browser_way=!1),!el.getAttribute||"false"!=el.getAttribute("contenteditable"))if(el.nodeType==Node.TEXT_NODE)_normalizeNode(el,browser_way);else if(el.nodeType==Node.ELEMENT_NODE)for(var walker=editor.doc.createTreeWalker(el,NodeFilter.SHOW_TEXT,editor.node.filter((function(node){for(var temp_node=node.parentNode;temp_node&&temp_node!==editor.el;){if("STYLE"==temp_node.tagName||"IFRAME"==temp_node.tagName)return!1;if("PRE"===temp_node.tagName)return!1;temp_node=temp_node.parentNode}return null!=node.textContent.match(/([ \u00A0\f\n\r\t\v]{2,})|(^[ \u00A0\f\n\r\t\v]{1,})|([ \u00A0\f\n\r\t\v]{1,}$)/g)&&!editor.node.hasClass(node.parentNode,"fr-marker")})),!1);walker.nextNode();)_normalizeNode(walker.currentNode,browser_way)}return{normalize:normalize,normalizeAroundCursor:function(){for(var nodes=[],markers=editor.el.querySelectorAll(".fr-marker"),i=0;i<markers.length;i++){for(var node=null,p_node=editor.node.blockParent(markers[i]),next_node=(node=p_node||markers[i]).nextSibling,prev_node=node.previousSibling;next_node&&"BR"==next_node.tagName;)next_node=next_node.nextSibling;for(;prev_node&&"BR"==prev_node.tagName;)prev_node=prev_node.previousSibling;node&&nodes.indexOf(node)<0&&nodes.push(node),prev_node&&nodes.indexOf(prev_node)<0&&nodes.push(prev_node),next_node&&nodes.indexOf(next_node)<0&&nodes.push(next_node)}for(var j=0;j<nodes.length;j++)normalize(nodes[j])}}}}(jQuery),function($){$.FE.UNICODE_NBSP=String.fromCharCode(160),$.FE.VOID_ELEMENTS=["area","base","br","col","embed","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"],$.FE.BLOCK_TAGS=["address","article","aside","audio","blockquote","canvas","details","dd","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","li","main","nav","noscript","ol","output","p","pre","section","table","tbody","td","tfoot","th","thead","tr","ul","video"],$.extend($.FE.DEFAULTS,{htmlAllowedEmptyTags:["textarea","a","i","iframe","object","video","style","script",".icon",".bi",".fa",".fr-emoticon",".fr-inner","path","line"],htmlDoNotWrapTags:["figure","script","style"],htmlSimpleAmpersand:!1,htmlIgnoreCSSProperties:[],htmlExecuteScripts:!0}),$.FE.MODULES.html=function(editor){function defaultTag(){return editor.opts.enter==$.FE.ENTER_P?"p":editor.opts.enter==$.FE.ENTER_DIV?"div":editor.opts.enter==$.FE.ENTER_BR?null:void 0}function isPreformatted(node,look_up){return!(!node||node===editor.el)&&(look_up?-1!=["PRE","SCRIPT","STYLE"].indexOf(node.tagName)||isPreformatted(node.parentNode,look_up):-1!=["PRE","SCRIPT","STYLE"].indexOf(node.tagName))}function emptyBlocks(around_markers){var i,empty_blocks=[],els=[];if(around_markers){var markers=editor.el.querySelectorAll(".fr-marker");for(i=0;i<markers.length;i++){var p_node=editor.node.blockParent(markers[i])||markers[i];if(p_node){var next_node=p_node.nextSibling,prev_node=p_node.previousSibling;p_node&&els.indexOf(p_node)<0&&editor.node.isBlock(p_node)&&els.push(p_node),prev_node&&editor.node.isBlock(prev_node)&&els.indexOf(prev_node)<0&&els.push(prev_node),next_node&&editor.node.isBlock(next_node)&&els.indexOf(next_node)<0&&els.push(next_node)}}}else els=editor.el.querySelectorAll(blockTagsQuery());var qr=blockTagsQuery();for(qr+=","+$.FE.VOID_ELEMENTS.join(","),qr+=", .fr-inner",qr+=","+editor.opts.htmlAllowedEmptyTags.join(":not(.fr-marker),")+":not(.fr-marker)",i=els.length-1;i>=0;i--)if(!(els[i].textContent&&els[i].textContent.replace(/\u200B|\n/g,"").length>0||els[i].querySelectorAll(qr).length>0)){for(var contents=editor.node.contents(els[i]),found=!1,j=0;j<contents.length;j++)if(contents[j].nodeType!=Node.COMMENT_NODE&&contents[j].textContent&&contents[j].textContent.replace(/\u200B|\n/g,"").length>0){found=!0;break}found||empty_blocks.push(els[i])}return empty_blocks}function blockTagsQuery(){return $.FE.BLOCK_TAGS.join(", ")}function cleanEmptyTags(remove_blocks){var elms,ok,els=$.merge([],$.FE.VOID_ELEMENTS);els=$.merge(els,editor.opts.htmlAllowedEmptyTags),els=void 0===remove_blocks?$.merge(els,$.FE.BLOCK_TAGS):$.merge(els,$.FE.NO_DELETE_TAGS),elms=editor.el.querySelectorAll("*:empty:not("+els.join("):not(")+"):not(.fr-marker)");do{ok=!1;for(var i=0;i<elms.length;i++)0!==elms[i].attributes.length&&void 0===elms[i].getAttribute("href")||(elms[i].parentNode.removeChild(elms[i]),ok=!0);elms=editor.el.querySelectorAll("*:empty:not("+els.join("):not(")+"):not(.fr-marker)")}while(elms.length&&ok)}function _wrapElement(el,temp){var default_tag=defaultTag();if(temp&&(default_tag="div"),default_tag){for(var main_doc=editor.doc.createDocumentFragment(),anchor=null,found=!1,node=el.firstChild,changed=!1;node;){var next_node=node.nextSibling;if(node.nodeType==Node.ELEMENT_NODE&&(editor.node.isBlock(node)||editor.opts.htmlDoNotWrapTags.indexOf(node.tagName.toLowerCase())>=0&&!editor.node.hasClass(node,"fr-marker")))anchor=null,main_doc.appendChild(node.cloneNode(!0));else if(node.nodeType!=Node.ELEMENT_NODE&&node.nodeType!=Node.TEXT_NODE)anchor=null,main_doc.appendChild(node.cloneNode(!0));else if("BR"==node.tagName)null==anchor?(anchor=editor.doc.createElement(default_tag),changed=!0,temp&&(anchor.setAttribute("class","fr-temp-div"),anchor.setAttribute("data-empty",!0)),anchor.appendChild(node.cloneNode(!0)),main_doc.appendChild(anchor)):!1===found&&(anchor.appendChild(editor.doc.createElement("br")),temp&&(anchor.setAttribute("class","fr-temp-div"),anchor.setAttribute("data-empty",!0))),anchor=null;else{var txt=node.textContent;node.nodeType!==Node.TEXT_NODE||txt.replace(/\n/g,"").replace(/(^ *)|( *$)/g,"").length>0||txt.replace(/(^ *)|( *$)/g,"").length&&txt.indexOf("\n")<0?(null==anchor&&(anchor=editor.doc.createElement(default_tag),changed=!0,temp&&anchor.setAttribute("class","fr-temp-div"),main_doc.appendChild(anchor),found=!1),anchor.appendChild(node.cloneNode(!0)),found||editor.node.hasClass(node,"fr-marker")||node.nodeType==Node.TEXT_NODE&&0===txt.replace(/ /g,"").length||(found=!0)):changed=!0}node=next_node}changed&&(el.innerHTML="",el.appendChild(main_doc))}}function _wrapElements(els,temp){for(var i=els.length-1;i>=0;i--)_wrapElement(els[i],temp)}function _wrap(temp,tables,blockquote,inner,li){if(!editor.$wp)return!1;void 0===temp&&(temp=!1),void 0===tables&&(tables=!1),void 0===blockquote&&(blockquote=!1),void 0===inner&&(inner=!1),void 0===li&&(li=!1);var wp_st=editor.$wp.scrollTop();_wrapElement(editor.el,temp),inner&&_wrapElements(editor.el.querySelectorAll(".fr-inner"),temp),tables&&_wrapElements(editor.el.querySelectorAll("td, th"),temp),blockquote&&_wrapElements(editor.el.querySelectorAll("blockquote"),temp),li&&_wrapElements(editor.el.querySelectorAll("li"),temp),wp_st!=editor.$wp.scrollTop()&&editor.$wp.scrollTop(wp_st)}function cleanBlankSpaces(el){if(void 0===el&&(el=editor.el),el&&["SCRIPT","STYLE","PRE"].indexOf(el.tagName)>=0)return!1;for(var walker=editor.doc.createTreeWalker(el,NodeFilter.SHOW_TEXT,editor.node.filter((function(node){return null!=node.textContent.match(/([ \n]{2,})|(^[ \n]{1,})|([ \n]{1,}$)/g)})),!1);walker.nextNode();){var node=walker.currentNode;if(!isPreformatted(node.parentNode,!0)){var is_block_or_element=editor.node.isBlock(node.parentNode)||editor.node.isElement(node.parentNode),txt=node.textContent.replace(/(?!^)( ){2,}(?!$)/g," ").replace(/\n/g," ").replace(/^[ ]{2,}/g," ").replace(/[ ]{2,}$/g," ");if(is_block_or_element){var p_node=node.previousSibling,n_node=node.nextSibling;p_node&&n_node&&" "==txt?txt=editor.node.isBlock(p_node)&&editor.node.isBlock(n_node)?"":" ":(p_node||(txt=txt.replace(/^ */,"")),n_node||(txt=txt.replace(/ *$/,"")))}node.textContent=txt}}}function _extractMatch(html,re,id){var matches=new RegExp(re,"gi").exec(html);return matches?matches[id]:null}function getDoctype(doc){var node=doc.doctype,doctype="<!DOCTYPE html>";return node&&(doctype="<!DOCTYPE "+node.name+(node.publicId?' PUBLIC "'+node.publicId+'"':"")+(!node.publicId&&node.systemId?" SYSTEM":"")+(node.systemId?' "'+node.systemId+'"':"")+">"),doctype}function _processBR(br){var parent_node=br.parentNode;if(parent_node&&(editor.node.isBlock(parent_node)||editor.node.isElement(parent_node))&&["TD","TH"].indexOf(parent_node.tagName)<0){for(var prev_node=br.previousSibling,next_node=br.nextSibling;prev_node&&(prev_node.nodeType==Node.TEXT_NODE&&0===prev_node.textContent.replace(/\n|\r/g,"").length||editor.node.hasClass(prev_node,"fr-tmp"));)prev_node=prev_node.previousSibling;if(next_node)return!1;prev_node&&parent_node&&"BR"!=prev_node.tagName&&!editor.node.isBlock(prev_node)&&!next_node&&parent_node.textContent.replace(/\u200B/g,"").length>0&&prev_node.textContent.length>0&&!editor.node.hasClass(prev_node,"fr-marker")&&(editor.el==parent_node&&!next_node&&editor.opts.enter==$.FE.ENTER_BR&&editor.browser.msie||br.parentNode.removeChild(br))}else!parent_node||editor.node.isBlock(parent_node)||editor.node.isElement(parent_node)||br.previousSibling||br.nextSibling||!editor.node.isDeletable(br.parentNode)||_processBR(br.parentNode)}function _normalize(){editor.opts.htmlUntouched||(cleanEmptyTags(),_wrap(),cleanBlankSpaces(),editor.spaces.normalize(null,!0),editor.html.fillEmptyBlocks(),editor.clean.lists(),editor.clean.tables(),editor.clean.toHTML5(),editor.html.cleanBRs()),editor.selection.restore(),checkIfEmpty(),editor.placeholder.refresh()}function checkIfEmpty(){editor.node.isEmpty(editor.el)&&(null!=defaultTag()?editor.el.querySelector(blockTagsQuery())||editor.el.querySelector(editor.opts.htmlDoNotWrapTags.join(":not(.fr-marker),")+":not(.fr-marker)")||(editor.core.hasFocus()?(editor.$el.html("<"+defaultTag()+">"+$.FE.MARKERS+"<br/></"+defaultTag()+">"),editor.selection.restore()):editor.$el.html("<"+defaultTag()+"><br/></"+defaultTag()+">")):editor.el.querySelector("*:not(.fr-marker):not(br)")||(editor.core.hasFocus()?(editor.$el.html($.FE.MARKERS+"<br/>"),editor.selection.restore()):editor.$el.html("<br/>")))}function extractNode(html,tag){return _extractMatch(html,"<"+tag+"[^>]*?>([\\w\\W]*)</"+tag+">",1)}function extractNodeAttrs(html,tag){var $dv=$("<div "+(_extractMatch(html,"<"+tag+"([^>]*?)>",1)||"")+">");return editor.node.rawAttributes($dv.get(0))}function extractDoctype(html){return(_extractMatch(html,"<!DOCTYPE([^>]*?)>",0)||"<!DOCTYPE html>").replace(/\n/g," ").replace(/ {2,}/g," ")}function _setHtml($node,html){editor.opts.htmlExecuteScripts?$node.html(html):$node.get(0).innerHTML=html}function _specifity(selector){var regex;(regex=/:not\(([^\)]*)\)/g).test(selector)&&(selector=selector.replace(regex,"     $1 "));var s=100*(selector.match(/(#[^\s\+>~\.\[:]+)/g)||[]).length+10*(selector.match(/(\[[^\]]+\])/g)||[]).length+10*(selector.match(/(\.[^\s\+>~\.\[:]+)/g)||[]).length+10*(selector.match(/(:[\w-]+\([^\)]*\))/gi)||[]).length+10*(selector.match(/(:[^\s\+>~\.\[:]+)/g)||[]).length+(selector.match(/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi)||[]).length;return s+=((selector=(selector=selector.replace(/[\*\s\+>~]/g," ")).replace(/[#\.]/g," ")).match(/([^\s\+>~\.\[:]+)/g)||[]).length}function _processOnGet(el){if(editor.events.trigger("html.processGet",[el]),el&&el.getAttribute&&""===el.getAttribute("class")&&el.removeAttribute("class"),el&&el.getAttribute&&""===el.getAttribute("style")&&el.removeAttribute("style"),el&&el.nodeType==Node.ELEMENT_NODE){var i,els=el.querySelectorAll('[class=""],[style=""]');for(i=0;i<els.length;i++){var _el=els[i];""===_el.getAttribute("class")&&_el.removeAttribute("class"),""===_el.getAttribute("style")&&_el.removeAttribute("style")}if("BR"===el.tagName)_processBR(el);else{var brs=el.querySelectorAll("br");for(i=0;i<brs.length;i++)_processBR(brs[i])}}}function _sortElementsBySpec(a,b){return a[3]-b[3]}function _hasBlockTags(html){var tmp=editor.doc.createElement("div");return tmp.innerHTML=html,null!==tmp.querySelector(blockTagsQuery())}function cleanWhiteTags(ignore_selection){var current_el=null;if(void 0===ignore_selection&&(current_el=editor.selection.element()),editor.opts.keepFormatOnDelete)return!1;var possible_elements,removed,current_white=current_el?(current_el.textContent.match(/\u200B/g)||[]).length-current_el.querySelectorAll(".fr-marker").length:0;if((editor.el.textContent.match(/\u200B/g)||[]).length-editor.el.querySelectorAll(".fr-marker").length==current_white)return!1;do{removed=!1,possible_elements=editor.el.querySelectorAll("*:not(.fr-marker)");for(var i=0;i<possible_elements.length;i++){var el=possible_elements[i];if(current_el!=el){var text=el.textContent;0===el.children.length&&1===text.length&&8203==text.charCodeAt(0)&&"TD"!==el.tagName&&($(el).remove(),removed=!0)}}}while(removed)}return{defaultTag:defaultTag,isPreformatted:isPreformatted,emptyBlocks:emptyBlocks,emptyBlockTagsQuery:function(){return $.FE.BLOCK_TAGS.join(":empty, ")+":empty"},blockTagsQuery:blockTagsQuery,fillEmptyBlocks:function(around_markers){var blocks=emptyBlocks(around_markers);editor.node.isEmpty(editor.el)&&editor.opts.enter===$.FE.ENTER_BR&&blocks.push(editor.el);for(var i=0;i<blocks.length;i++){var block=blocks[i];"false"===block.getAttribute("contenteditable")||block.querySelector(editor.opts.htmlAllowedEmptyTags.join(":not(.fr-marker),")+":not(.fr-marker)")||editor.node.isVoid(block)||"TABLE"!=block.tagName&&"TBODY"!=block.tagName&&"TR"!=block.tagName&&"UL"!=block.tagName&&"OL"!=block.tagName&&block.appendChild(editor.doc.createElement("br"))}if(editor.browser.msie&&editor.opts.enter==$.FE.ENTER_BR){var contents=editor.node.contents(editor.el);contents.length&&contents[contents.length-1].nodeType==Node.TEXT_NODE&&editor.$el.append("<br>")}},cleanEmptyTags:cleanEmptyTags,cleanWhiteTags:cleanWhiteTags,cleanBlankSpaces:cleanBlankSpaces,blocks:function(){return editor.$el.get(0).querySelectorAll(blockTagsQuery())},getDoctype:getDoctype,set:function(html){var string,doc,matches,clean_html=editor.clean.html((html||"").trim(),[],[],editor.opts.fullPage);if(editor.opts.fullPage){var body_html=extractNode(clean_html,"body")||(clean_html.indexOf("<body")>=0?"":clean_html),body_attrs=extractNodeAttrs(clean_html,"body"),head_html=extractNode(clean_html,"head")||"<title></title>",head_attrs=extractNodeAttrs(clean_html,"head"),head_bad_html=$("<div>").append(head_html).contents().each((function(){(this.nodeType==Node.COMMENT_NODE||["BASE","LINK","META","NOSCRIPT","SCRIPT","STYLE","TEMPLATE","TITLE"].indexOf(this.tagName)>=0)&&this.parentNode.removeChild(this)})).end().html().trim();head_html=$("<div>").append(head_html).contents().map((function(){return this.nodeType==Node.COMMENT_NODE?"\x3c!--"+this.nodeValue+"--\x3e":["BASE","LINK","META","NOSCRIPT","SCRIPT","STYLE","TEMPLATE","TITLE"].indexOf(this.tagName)>=0?this.outerHTML:""})).toArray().join("");var doctype=extractDoctype(clean_html),html_attrs=extractNodeAttrs(clean_html,"html");_setHtml(editor.$el,head_bad_html+"\n"+body_html),editor.node.clearAttributes(editor.el),editor.$el.attr(body_attrs),editor.$el.addClass("fr-view"),editor.$el.attr("spellcheck",editor.opts.spellcheck),editor.$el.attr("dir",editor.opts.direction),_setHtml(editor.$head,head_html),editor.node.clearAttributes(editor.$head.get(0)),editor.$head.attr(head_attrs),editor.node.clearAttributes(editor.$html.get(0)),editor.$html.attr(html_attrs),editor.iframe_document.doctype.parentNode.replaceChild((string=doctype,doc=editor.iframe_document,(matches=string.match(/<!DOCTYPE ?([^ ]*) ?([^ ]*) ?"?([^"]*)"? ?"?([^"]*)"?>/i))?doc.implementation.createDocumentType(matches[1],matches[3],matches[4]):doc.implementation.createDocumentType("html")),editor.iframe_document.doctype)}else _setHtml(editor.$el,clean_html);var disabled=editor.edit.isDisabled();editor.edit.on(),editor.core.injectStyle(editor.opts.iframeDefaultStyle+editor.opts.iframeStyle),_normalize(),editor.opts.useClasses||(editor.$el.find("[fr-original-class]").each((function(){this.setAttribute("class",this.getAttribute("fr-original-class")),this.removeAttribute("fr-original-class")})),editor.$el.find("[fr-original-style]").each((function(){this.setAttribute("style",this.getAttribute("fr-original-style")),this.removeAttribute("fr-original-style")}))),disabled&&editor.edit.off(),editor.events.trigger("html.set")},get:function(keep_markers,keep_classes){if(!editor.$wp)return editor.$oel.clone().removeClass("fr-view").removeAttr("contenteditable").get(0).outerHTML;var html="";editor.events.trigger("html.beforeGet");var i,j,updated_elms=[],elms_info={},elems_specs=[],inputs=editor.el.querySelectorAll("input, textarea");for(i=0;i<inputs.length;i++)inputs[i].setAttribute("value",inputs[i].value);if(!editor.opts.useClasses&&!keep_classes){var ignoreRegEx=new RegExp("^"+editor.opts.htmlIgnoreCSSProperties.join("$|^")+"$","gi");for(i=0;i<editor.doc.styleSheets.length;i++){var rules,head_style=0;try{rules=editor.doc.styleSheets[i].cssRules,editor.doc.styleSheets[i].ownerNode&&"STYLE"==editor.doc.styleSheets[i].ownerNode.nodeType&&(head_style=1)}catch(ex){}if(rules)for(var idx=0,len=rules.length;idx<len;idx++)if(rules[idx].selectorText&&rules[idx].style.cssText.length>0){var elms,selector=rules[idx].selectorText.replace(/body |\.fr-view /g,"").replace(/::/g,":");try{elms=editor.el.querySelectorAll(selector)}catch(ex){elms=[]}for(j=0;j<elms.length;j++){!elms[j].getAttribute("fr-original-style")&&elms[j].getAttribute("style")?(elms[j].setAttribute("fr-original-style",elms[j].getAttribute("style")),updated_elms.push(elms[j])):elms[j].getAttribute("fr-original-style")||(elms[j].setAttribute("fr-original-style",""),updated_elms.push(elms[j])),elms_info[elms[j]]||(elms_info[elms[j]]={});for(var spec=1e3*head_style+_specifity(rules[idx].selectorText),css_text=rules[idx].style.cssText.split(";"),k=0;k<css_text.length;k++){var rule=css_text[k].trim().split(":")[0];if(rule&&(!rule.match(ignoreRegEx)&&(elms_info[elms[j]][rule]||(elms_info[elms[j]][rule]=0,(elms[j].getAttribute("fr-original-style")||"").indexOf(rule+":")>=0&&(elms_info[elms[j]][rule]=1e4)),spec>=elms_info[elms[j]][rule]&&(elms_info[elms[j]][rule]=spec,css_text[k].trim().length)))){var info=css_text[k].trim().split(":");info.splice(0,1),elems_specs.push([elms[j],rule.trim(),info.join(":").trim(),spec])}}}}}for(elems_specs.sort(_sortElementsBySpec),i=0;i<elems_specs.length;i++){var specs_elem=elems_specs[i];specs_elem[0].style[specs_elem[1]]=specs_elem[2]}for(i=0;i<updated_elms.length;i++)if(updated_elms[i].getAttribute("class")&&(updated_elms[i].setAttribute("fr-original-class",updated_elms[i].getAttribute("class")),updated_elms[i].removeAttribute("class")),(updated_elms[i].getAttribute("fr-original-style")||"").trim().length>0){var original_rules=updated_elms[i].getAttribute("fr-original-style").split(";");for(j=0;j<original_rules.length;j++)if(original_rules[j].indexOf(":")>0){var splits=original_rules[j].split(":"),original_rule=splits[0];splits.splice(0,1),updated_elms[i].style[original_rule.trim()]=splits.join(":").trim()}}}if(editor.node.isEmpty(editor.el))editor.opts.fullPage&&(html=getDoctype(editor.iframe_document),html+="<html"+editor.node.attributes(editor.$html.get(0))+">"+editor.$html.find("head").get(0).outerHTML+"<body></body></html>");else if(void 0===keep_markers&&(keep_markers=!1),editor.opts.fullPage){html=getDoctype(editor.iframe_document),editor.$el.removeClass("fr-view");var heightMin=editor.opts.heightMin,height=editor.opts.height,heightMax=editor.opts.heightMax;editor.opts.heightMin=null,editor.opts.height=null,editor.opts.heightMax=null,editor.size.refresh(),html+="<html"+editor.node.attributes(editor.$html.get(0))+">"+editor.$html.html()+"</html>",editor.opts.heightMin=heightMin,editor.opts.height=height,editor.opts.heightMax=heightMax,editor.size.refresh(),editor.$el.addClass("fr-view")}else html=editor.$el.html();if(!editor.opts.useClasses&&!keep_classes)for(i=0;i<updated_elms.length;i++)updated_elms[i].getAttribute("fr-original-class")&&(updated_elms[i].setAttribute("class",updated_elms[i].getAttribute("fr-original-class")),updated_elms[i].removeAttribute("fr-original-class")),null!=updated_elms[i].getAttribute("fr-original-style")&&void 0!==updated_elms[i].getAttribute("fr-original-style")?(0!==updated_elms[i].getAttribute("fr-original-style").length?updated_elms[i].setAttribute("style",updated_elms[i].getAttribute("fr-original-style")):updated_elms[i].removeAttribute("style"),updated_elms[i].removeAttribute("fr-original-style")):updated_elms[i].removeAttribute("style");editor.opts.fullPage&&(html=(html=(html=(html=(html=(html=(html=(html=html.replace(/<style data-fr-style="true">(?:[\w\W]*?)<\/style>/g,"")).replace(/<link([^>]*)data-fr-style="true"([^>]*)>/g,"")).replace(/<style(?:[\w\W]*?)class="firebugResetStyles"(?:[\w\W]*?)>(?:[\w\W]*?)<\/style>/g,"")).replace(/<body((?:[\w\W]*?)) spellcheck="true"((?:[\w\W]*?))>((?:[\w\W]*?))<\/body>/g,"<body$1$2>$3</body>")).replace(/<body((?:[\w\W]*?)) contenteditable="(true|false)"((?:[\w\W]*?))>((?:[\w\W]*?))<\/body>/g,"<body$1$3>$4</body>")).replace(/<body((?:[\w\W]*?)) dir="([\w]*)"((?:[\w\W]*?))>((?:[\w\W]*?))<\/body>/g,"<body$1$3>$4</body>")).replace(/<body((?:[\w\W]*?))class="([\w\W]*?)(fr-rtl|fr-ltr)([\w\W]*?)"((?:[\w\W]*?))>((?:[\w\W]*?))<\/body>/g,'<body$1class="$2$4"$5>$6</body>')).replace(/<body((?:[\w\W]*?)) class=""((?:[\w\W]*?))>((?:[\w\W]*?))<\/body>/g,"<body$1$2>$3</body>")),editor.opts.htmlSimpleAmpersand&&(html=html.replace(/\&amp;/gi,"&")),editor.events.trigger("html.afterGet"),keep_markers||(html=html.replace(/<span[^>]*? class\s*=\s*["']?fr-marker["']?[^>]+>\u200b<\/span>/gi,"")),html=editor.clean.invisibleSpaces(html),html=editor.clean.exec(html,_processOnGet);var new_html=editor.events.chainTrigger("html.get",html);return"string"==typeof new_html&&(html=new_html),html=(html=html.replace(/<pre(?:[\w\W]*?)>(?:[\w\W]*?)<\/pre>/g,(function(str){return str.replace(/<br>/g,"\n")}))).replace(/<meta((?:[\w\W]*?)) data-fr-http-equiv="/g,'<meta$1 http-equiv="')},getSelected:function(){var sel,parent,wrapSelection=function(container,node){for(;node&&(node.nodeType==Node.TEXT_NODE||!editor.node.isBlock(node))&&!editor.node.isElement(node)&&!editor.node.hasClass(node,"fr-inner");)node&&node.nodeType!=Node.TEXT_NODE&&$(container).wrapInner(editor.node.openTagString(node)+editor.node.closeTagString(node)),node=node.parentNode;node&&container.innerHTML==node.innerHTML&&(container.innerHTML=node.outerHTML)},html="";if(void 0!==editor.win.getSelection){editor.browser.mozilla&&(editor.selection.save(),editor.$el.find('.fr-marker[data-type="false"]').length>1&&(editor.$el.find('.fr-marker[data-type="false"][data-id="0"]').remove(),editor.$el.find('.fr-marker[data-type="false"]:last').attr("data-id","0"),editor.$el.find(".fr-marker").not('[data-id="0"]').remove()),editor.selection.restore());for(var ranges=editor.selection.ranges(),i=0;i<ranges.length;i++){var container=document.createElement("div");container.appendChild(ranges[i].cloneContents()),wrapSelection(container,(sel=void 0,parent=void 0,parent=null,editor.win.getSelection?(sel=editor.win.getSelection())&&sel.rangeCount&&(parent=sel.getRangeAt(0).commonAncestorContainer).nodeType!=Node.ELEMENT_NODE&&(parent=parent.parentNode):(sel=editor.doc.selection)&&"Control"!=sel.type&&(parent=sel.createRange().parentElement()),null!=parent&&($.inArray(editor.el,$(parent).parents())>=0||parent==editor.el)?parent:null)),$(container).find(".fr-element").length>0&&(container=editor.el),html+=container.innerHTML}}else void 0!==editor.doc.selection&&"Text"==editor.doc.selection.type&&(html=editor.doc.selection.createRange().htmlText);return html},insert:function(dirty_html,clean,do_split){var clean_html,html,tmp;if(editor.selection.isCollapsed()||editor.selection.remove(),clean_html=clean?dirty_html:editor.clean.html(dirty_html),dirty_html.indexOf('class="fr-marker"')<0&&(html=clean_html,(tmp=editor.doc.createElement("div")).innerHTML=html,editor.selection.setAtEnd(tmp,!0),clean_html=tmp.innerHTML),editor.node.isEmpty(editor.el)&&!editor.opts.keepFormatOnDelete&&_hasBlockTags(clean_html))editor.el.innerHTML=clean_html;else{var marker=editor.markers.insert();if(marker){editor.node.isLastSibling(marker)&&$(marker).parent().hasClass("fr-deletable")&&$(marker).insertAfter($(marker).parent());var block_parent=editor.node.blockParent(marker);if((_hasBlockTags(clean_html)||do_split)&&(editor.node.deepestParent(marker)||block_parent&&"LI"==block_parent.tagName)){if(block_parent&&"LI"==block_parent.tagName&&(clean_html=function(html){if(!editor.html.defaultTag())return html;var tmp=editor.doc.createElement("div");tmp.innerHTML=html;for(var default_tag_els=tmp.querySelectorAll(":scope > "+editor.html.defaultTag()),i=default_tag_els.length-1;i>=0;i--){var el=default_tag_els[i];editor.node.isBlock(el.previousSibling)||(el.previousSibling&&!editor.node.isEmpty(el)&&$("<br>").insertAfter(el.previousSibling),el.outerHTML=el.innerHTML)}return tmp.innerHTML}(clean_html)),!(marker=editor.markers.split()))return!1;marker.outerHTML=clean_html}else marker.outerHTML=clean_html}else editor.el.innerHTML=editor.el.innerHTML+clean_html}_normalize(),editor.keys.positionCaret(),editor.events.trigger("html.inserted")},wrap:_wrap,unwrap:function(){editor.$el.find("div.fr-temp-div").each((function(){this.previousSibling&&this.previousSibling.nodeType===Node.TEXT_NODE&&$(this).before("<br>"),$(this).attr("data-empty")||!this.nextSibling||editor.node.isBlock(this.nextSibling)&&!$(this.nextSibling).hasClass("fr-temp-div")?$(this).replaceWith($(this).html()):$(this).replaceWith($(this).html()+"<br>")})),editor.$el.find(".fr-temp-div").removeClass("fr-temp-div").filter((function(){return""===$(this).attr("class")})).removeAttr("class")},escapeEntities:function(str){return str.replace(/</gi,"&lt;").replace(/>/gi,"&gt;").replace(/"/gi,"&quot;").replace(/'/gi,"&#39;")},checkIfEmpty:checkIfEmpty,extractNode:extractNode,extractNodeAttrs:extractNodeAttrs,extractDoctype:extractDoctype,cleanBRs:function(){for(var brs=editor.el.getElementsByTagName("br"),i=0;i<brs.length;i++)_processBR(brs[i])},_init:function(){if(editor.$wp){var cleanTags=function(){cleanWhiteTags(),editor.placeholder&&setTimeout(editor.placeholder.refresh,0)};editor.events.on("mouseup",cleanTags),editor.events.on("keydown",cleanTags),editor.events.on("contentChanged",checkIfEmpty)}}}}}(jQuery),function($){$.extend($.FE.DEFAULTS,{height:null,heightMax:null,heightMin:null,width:null}),$.FE.MODULES.size=function(editor){function syncIframe(){refresh(),editor.opts.height&&editor.$el.css("minHeight",editor.opts.height-editor.helpers.getPX(editor.$el.css("padding-top"))-editor.helpers.getPX(editor.$el.css("padding-bottom"))),editor.$iframe.height(editor.$el.outerHeight(!0))}function refresh(){editor.opts.heightMin?editor.$el.css("minHeight",editor.opts.heightMin):editor.$el.css("minHeight",""),editor.opts.heightMax?(editor.$wp.css("maxHeight",editor.opts.heightMax),editor.$wp.css("overflow","auto")):(editor.$wp.css("maxHeight",""),editor.$wp.css("overflow","")),editor.opts.height?(editor.$wp.height(editor.opts.height),editor.$wp.css("overflow","auto"),editor.$el.css("minHeight",editor.opts.height-editor.helpers.getPX(editor.$el.css("padding-top"))-editor.helpers.getPX(editor.$el.css("padding-bottom")))):(editor.$wp.css("height",""),editor.opts.heightMin||editor.$el.css("minHeight",""),editor.opts.heightMax||editor.$wp.css("overflow","")),editor.opts.width&&editor.$box.width(editor.opts.width)}return{_init:function(){if(!editor.$wp)return!1;refresh(),editor.$iframe&&(editor.events.on("keyup keydown",(function(){setTimeout(syncIframe,0)}),!0),editor.events.on("commands.after html.set init initialized paste.after",syncIframe))},syncIframe:syncIframe,refresh:refresh}}}(jQuery),function($){$.extend($.FE.DEFAULTS,{language:null}),$.FE.LANGUAGE={},$.FE.MODULES.language=function(editor){var lang;return{_init:function(){$.FE.LANGUAGE&&(lang=$.FE.LANGUAGE[editor.opts.language]),lang&&lang.direction&&(editor.opts.direction=lang.direction)},translate:function(str){return lang&&lang.translation[str]&&lang.translation[str].length?lang.translation[str]:str}}}}(jQuery),function($){$.extend($.FE.DEFAULTS,{placeholderText:"Type something"}),$.FE.MODULES.placeholder=function(editor){function show(){editor.$placeholder||(editor.$placeholder=$('<span class="fr-placeholder"></span>'),editor.$wp.append(editor.$placeholder));var margin_offset=editor.opts.iframe?editor.$iframe.prev().outerHeight(!0):editor.$el.prev().outerHeight(!0),margin_top=0,margin_left=0,margin_right=0,padding_top=0,padding_left=0,padding_right=0,contents=editor.node.contents(editor.el),alignment=$(editor.selection.element()).css("text-align");if(contents.length&&contents[0].nodeType==Node.ELEMENT_NODE){var $first_node=$(contents[0]);(!editor.opts.toolbarInline||editor.$el.prev().length>0)&&editor.ready&&(margin_top=editor.helpers.getPX($first_node.css("margin-top")),padding_top=editor.helpers.getPX($first_node.css("padding-top")),margin_left=editor.helpers.getPX($first_node.css("margin-left")),margin_right=editor.helpers.getPX($first_node.css("margin-right")),padding_left=editor.helpers.getPX($first_node.css("padding-left")),padding_right=editor.helpers.getPX($first_node.css("padding-right"))),editor.$placeholder.css("font-size",$first_node.css("font-size")),editor.$placeholder.css("line-height",$first_node.css("line-height"))}else editor.$placeholder.css("font-size",editor.$el.css("font-size")),editor.$placeholder.css("line-height",editor.$el.css("line-height"));if(editor.$wp.addClass("show-placeholder"),editor.$placeholder.css({marginTop:Math.max(editor.helpers.getPX(editor.$el.css("margin-top")),margin_top)+(margin_offset||0),paddingTop:Math.max(editor.helpers.getPX(editor.$el.css("padding-top")),padding_top),paddingLeft:Math.max(editor.helpers.getPX(editor.$el.css("padding-left")),padding_left),marginLeft:Math.max(editor.helpers.getPX(editor.$el.css("margin-left")),margin_left),paddingRight:Math.max(editor.helpers.getPX(editor.$el.css("padding-right")),padding_right),marginRight:Math.max(editor.helpers.getPX(editor.$el.css("margin-right")),margin_right),textAlign:alignment}).text(editor.language.translate(editor.opts.placeholderText||editor.$oel.attr("placeholder")||"")),editor.$placeholder.html(editor.$placeholder.text().replace(/\n/g,"<br>")),editor.size.refresh(),editor.$placeholder.height()>editor.$el.height()){var oldHeight=editor.opts.heightMin;editor.opts.heightMin=editor.$placeholder.height()+editor.$tb?editor.$tb.height():0,editor.size.refresh(),editor.opts.heightMin=oldHeight}}function hide(){editor.$wp.removeClass("show-placeholder"),editor.size.refresh()}function refresh(){if(!editor.$wp)return!1;editor.core.isEmpty()?show():hide()}return{_init:function(){if(!editor.$wp)return!1;editor.events.on("init input keydown keyup contentChanged initialized",refresh)},show:show,hide:hide,refresh:refresh,isVisible:function(){return!!editor.$wp&&editor.node.hasClass(editor.$wp.get(0),"show-placeholder")}}}}(jQuery),jQuery.FE.MODULES.edit=function(editor){function disableDesign(){if(editor.browser.mozilla)try{editor.doc.execCommand("enableObjectResizing",!1,"false"),editor.doc.execCommand("enableInlineTableEditing",!1,"false")}catch(ex){}if(editor.browser.msie)try{editor.doc.body.addEventListener("mscontrolselect",(function(e){return e.preventDefault(),!1}))}catch(ex){}}var disabled=!1;function isDisabled(){return disabled}return{_init:function(){editor.events.on("focus",(function(){isDisabled()?editor.edit.off():editor.edit.on()}))},on:function(){editor.$wp?(editor.$el.attr("contenteditable",!0),editor.$el.removeClass("fr-disabled").attr("aria-disabled",!1),editor.$tb&&editor.$tb.removeClass("fr-disabled").removeAttr("aria-disabled"),disableDesign()):editor.$el.is("a")&&editor.$el.attr("contenteditable",!0),disabled=!1},off:function(){editor.events.disableBlur(),editor.$wp?(editor.$el.attr("contenteditable",!1),editor.$el.addClass("fr-disabled").attr("aria-disabled",!0),editor.$tb&&editor.$tb.addClass("fr-disabled").attr("aria-disabled",!0)):editor.$el.is("a")&&editor.$el.attr("contenteditable",!1),editor.events.enableBlur(),disabled=!0},disableDesign:disableDesign,isDisabled:isDisabled}},function($){$.extend($.FE.DEFAULTS,{documentReady:!1,editorClass:null,typingTimer:500,iframe:!1,requestWithCORS:!0,requestWithCredentials:!1,requestHeaders:{},useClasses:!0,spellcheck:!0,iframeDefaultStyle:'html{margin:0px;height:auto;}body{height:auto;padding:10px;background:transparent;color:#000000;position:relative;z-index: 2;-webkit-user-select:auto;margin:0px;overflow:hidden;min-height:20px;}body:after{content:"";display:block;clear:both;}body::-moz-selection{background:#b5d6fd;color:#000;}body::selection{background:#b5d6fd;color:#000;}',iframeStyle:"",iframeStyleFiles:[],direction:"auto",zIndex:1,tabIndex:null,disableRightClick:!1,scrollableContainer:"body",keepFormatOnDelete:!1,theme:null}),$.FE.MODULES.core=function(editor){function _initStyle(){if(editor.$box.addClass("fr-box"+(editor.opts.editorClass?" "+editor.opts.editorClass:"")),editor.$box.attr("role","application"),editor.$wp.addClass("fr-wrapper"),editor.opts.documentReady&&editor.$box.addClass("fr-document"),editor.opts.iframe||editor.$el.addClass("fr-element fr-view"),editor.opts.iframe){editor.$iframe.addClass("fr-iframe"),editor.$el.addClass("fr-view");for(var i=0;i<editor.o_doc.styleSheets.length;i++){var rules;try{rules=editor.o_doc.styleSheets[i].cssRules}catch(ex){}if(rules)for(var idx=0,len=rules.length;idx<len;idx++)!rules[idx].selectorText||0!==rules[idx].selectorText.indexOf(".fr-view")&&0!==rules[idx].selectorText.indexOf(".fr-element")||rules[idx].style.cssText.length>0&&(0===rules[idx].selectorText.indexOf(".fr-view")?editor.opts.iframeStyle+=rules[idx].selectorText.replace(/\.fr-view/g,"body")+"{"+rules[idx].style.cssText+"}":editor.opts.iframeStyle+=rules[idx].selectorText.replace(/\.fr-element/g,"body")+"{"+rules[idx].style.cssText+"}")}}"auto"!=editor.opts.direction&&editor.$box.removeClass("fr-ltr fr-rtl").addClass("fr-"+editor.opts.direction),editor.$el.attr("dir",editor.opts.direction),editor.$wp.attr("dir",editor.opts.direction),editor.opts.zIndex>1&&editor.$box.css("z-index",editor.opts.zIndex),editor.opts.theme&&editor.$box.addClass(editor.opts.theme+"-theme"),editor.opts.tabIndex=editor.opts.tabIndex||editor.$oel.attr("tabIndex"),editor.opts.tabIndex&&editor.$el.attr("tabIndex",editor.opts.tabIndex)}return{_init:function(){if($.FE.INSTANCES.push(editor),editor.drag_support={filereader:"undefined"!=typeof FileReader,formdata:!!editor.win.FormData,progress:"upload"in new XMLHttpRequest},editor.$wp){_initStyle(),editor.html.set(editor._original_html),editor.$el.attr("spellcheck",editor.opts.spellcheck),editor.helpers.isMobile()&&(editor.$el.attr("autocomplete",editor.opts.spellcheck?"on":"off"),editor.$el.attr("autocorrect",editor.opts.spellcheck?"on":"off"),editor.$el.attr("autocapitalize",editor.opts.spellcheck?"on":"off")),editor.opts.disableRightClick&&editor.events.$on(editor.$el,"contextmenu",(function(e){if(2==e.button)return!1}));try{editor.doc.execCommand("styleWithCSS",!1,!1)}catch(ex){}}"TEXTAREA"==editor.$oel.get(0).tagName&&(editor.events.on("contentChanged",(function(){editor.$oel.val(editor.html.get())})),editor.events.on("form.submit",(function(){editor.$oel.val(editor.html.get())})),editor.events.on("form.reset",(function(){editor.html.set(editor._original_html)})),editor.$oel.val(editor.html.get())),editor.helpers.isIOS()&&editor.events.$on(editor.$doc,"selectionchange",(function(){editor.$doc.get(0).hasFocus()||editor.$win.get(0).focus()})),editor.events.trigger("init"),editor.opts.autofocus&&!editor.opts.initOnClick&&editor.$wp&&editor.events.on("initialized",(function(){editor.events.focus(!0)}))},destroy:function(html){"TEXTAREA"==editor.$oel.get(0).tagName&&editor.$oel.val(html),editor.$box&&editor.$box.removeAttr("role"),editor.$wp&&("TEXTAREA"==editor.$oel.get(0).tagName?(editor.$el.html(""),editor.$wp.html(""),editor.$box.replaceWith(editor.$oel),editor.$oel.show()):(editor.$wp.replaceWith(html),editor.$el.html(""),editor.$box.removeClass("fr-view fr-ltr fr-box "+(editor.opts.editorClass||"")),editor.opts.theme&&editor.$box.addClass(editor.opts.theme+"-theme"))),this.$wp=null,this.$el=null,this.el=null,this.$box=null},isEmpty:function(){return editor.node.isEmpty(editor.el)},getXHR:function(url,method){var xhr=new XMLHttpRequest;for(var header in xhr.open(method,url,!0),editor.opts.requestWithCredentials&&(xhr.withCredentials=!0),editor.opts.requestHeaders)editor.opts.requestHeaders.hasOwnProperty(header)&&xhr.setRequestHeader(header,editor.opts.requestHeaders[header]);return xhr},injectStyle:function(style){if(editor.opts.iframe){editor.$head.find("style[data-fr-style], link[data-fr-style]").remove(),editor.$head.append('<style data-fr-style="true">'+style+"</style>");for(var i=0;i<editor.opts.iframeStyleFiles.length;i++){var $link=$('<link data-fr-style="true" rel="stylesheet" href="'+editor.opts.iframeStyleFiles[i]+'">');$link.get(0).addEventListener("load",editor.size.syncIframe),editor.$head.append($link)}}},hasFocus:function(){return editor.browser.mozilla&&editor.helpers.isMobile()?editor.selection.inEditor():editor.node.hasFocus(editor.el)||editor.$el.find("*:focus").length>0},sameInstance:function($obj){if(!$obj)return!1;var inst=$obj.data("instance");return!!inst&&inst.id==editor.id}}}}(jQuery),function($){$.FE.MODULES.cursorLists=function(editor){function _firstParentLI(node){for(var p_node=node;"LI"!=p_node.tagName;)p_node=p_node.parentNode;return p_node}function _firstParentList(node){for(var p_node=node;!editor.node.isList(p_node);)p_node=p_node.parentNode;return p_node}return{_startEnter:function(marker){var ul,li=_firstParentLI(marker),next_li=li.nextSibling,prev_li=li.previousSibling,default_tag=editor.html.defaultTag();if(editor.node.isEmpty(li,!0)&&next_li){for(var o_str="",c_str="",p_node=marker.parentNode;!editor.node.isList(p_node)&&p_node.parentNode&&("LI"!==p_node.parentNode.tagName||p_node.parentNode===li);)o_str=editor.node.openTagString(p_node)+o_str,c_str+=editor.node.closeTagString(p_node),p_node=p_node.parentNode;o_str=editor.node.openTagString(p_node)+o_str,c_str+=editor.node.closeTagString(p_node);var str="";for(str=p_node.parentNode&&"LI"==p_node.parentNode.tagName?c_str+"<li>"+$.FE.MARKERS+"<br>"+o_str:default_tag?c_str+"<"+default_tag+">"+$.FE.MARKERS+"<br></"+default_tag+">"+o_str:c_str+$.FE.MARKERS+"<br>"+o_str;["UL","OL"].indexOf(p_node.tagName)<0||p_node.parentNode&&"LI"===p_node.parentNode.tagName;)p_node=p_node.parentNode;$(li).replaceWith('<span id="fr-break"></span>');var html=editor.node.openTagString(p_node)+$(p_node).html()+editor.node.closeTagString(p_node);html=html.replace(/<span id="fr-break"><\/span>/g,str),$(p_node).replaceWith(html),editor.$el.find("li:empty").remove()}else if(prev_li&&next_li||!editor.node.isEmpty(li,!0)){for(var br_str="<br>",nd=marker.parentNode;nd&&"LI"!=nd.tagName;)br_str=editor.node.openTagString(nd)+br_str+editor.node.closeTagString(nd),nd=nd.parentNode;$(li).before("<li>"+br_str+"</li>"),$(marker).remove()}else if(prev_li){ul=_firstParentList(li);for(var new_str=$.FE.MARKERS+"<br>",ndx=marker.parentNode;ndx&&"LI"!=ndx.tagName;)new_str=editor.node.openTagString(ndx)+new_str+editor.node.closeTagString(ndx),ndx=ndx.parentNode;ul.parentNode&&"LI"==ul.parentNode.tagName?$(ul.parentNode).after("<li>"+new_str+"</li>"):default_tag?$(ul).after("<"+default_tag+">"+new_str+"</"+default_tag+">"):$(ul).after(new_str),$(li).remove()}else(ul=_firstParentList(li)).parentNode&&"LI"==ul.parentNode.tagName?next_li?$(ul.parentNode).before(editor.node.openTagString(li)+$.FE.MARKERS+"<br></li>"):$(ul.parentNode).after(editor.node.openTagString(li)+$.FE.MARKERS+"<br></li>"):default_tag?$(ul).before("<"+default_tag+">"+$.FE.MARKERS+"<br></"+default_tag+">"):$(ul).before($.FE.MARKERS+"<br>"),$(li).remove()},_middleEnter:function(marker){for(var li=_firstParentLI(marker),str="",node=marker,o_str="",c_str="";node!=li;){var cls="A"==(node=node.parentNode).tagName&&editor.cursor.isAtEnd(marker,node)?"fr-to-remove":"";o_str=editor.node.openTagString($(node).clone().addClass(cls).get(0))+o_str,c_str=editor.node.closeTagString(node)+c_str}str=c_str+str+o_str+$.FE.MARKERS+(editor.opts.keepFormatOnDelete?$.FE.INVISIBLE_SPACE:""),$(marker).replaceWith('<span id="fr-break"></span>');var html=editor.node.openTagString(li)+$(li).html()+editor.node.closeTagString(li);html=html.replace(/<span id="fr-break"><\/span>/g,str),$(li).replaceWith(html)},_endEnter:function(marker){for(var li=_firstParentLI(marker),end_str=$.FE.MARKERS,start_str="",node=marker,add_invisible=!1;node!=li;){var cls="A"==(node=node.parentNode).tagName&&editor.cursor.isAtEnd(marker,node)?"fr-to-remove":"";add_invisible||node==li||editor.node.isBlock(node)||(add_invisible=!0,start_str+=$.FE.INVISIBLE_SPACE),start_str=editor.node.openTagString($(node).clone().addClass(cls).get(0))+start_str,end_str+=editor.node.closeTagString(node)}var str=start_str+end_str;$(marker).remove(),$(li).after(str)},_backspace:function(marker){var li=_firstParentLI(marker),prev_li=li.previousSibling;if(prev_li){prev_li=$(prev_li).find(editor.html.blockTagsQuery()).get(-1)||prev_li,$(marker).replaceWith($.FE.MARKERS);var contents=editor.node.contents(prev_li);contents.length&&"BR"==contents[contents.length-1].tagName&&$(contents[contents.length-1]).remove(),$(li).find(editor.html.blockTagsQuery()).not("ol, ul, table").each((function(){this.parentNode==li&&$(this).replaceWith($(this).html()+(editor.node.isEmpty(this)?"":"<br>"))}));for(var tmp,node=editor.node.contents(li)[0];node&&!editor.node.isList(node);)tmp=node.nextSibling,$(prev_li).append(node),node=tmp;for(prev_li=li.previousSibling;node;)tmp=node.nextSibling,$(prev_li).append(node),node=tmp;(contents=editor.node.contents(prev_li)).length>1&&"BR"===contents[contents.length-1].tagName&&$(contents[contents.length-1]).remove(),$(li).remove()}else{var ul=_firstParentList(li);if($(marker).replaceWith($.FE.MARKERS),ul.parentNode&&"LI"==ul.parentNode.tagName){var prev_node=ul.previousSibling;editor.node.isBlock(prev_node)?($(li).find(editor.html.blockTagsQuery()).not("ol, ul, table").each((function(){this.parentNode==li&&$(this).replaceWith($(this).html()+(editor.node.isEmpty(this)?"":"<br>"))})),$(prev_node).append($(li).html())):$(ul).before($(li).html())}else{var default_tag=editor.html.defaultTag();default_tag&&0===$(li).find(editor.html.blockTagsQuery()).length?$(ul).before("<"+default_tag+">"+$(li).html()+"</"+default_tag+">"):$(ul).before($(li).html())}$(li).remove(),editor.html.wrap(),0===$(ul).find("li").length&&$(ul).remove()}},_del:function(marker){var contents,li=_firstParentLI(marker),next_li=li.nextSibling;if(next_li){(contents=editor.node.contents(next_li)).length&&"BR"==contents[0].tagName&&$(contents[0]).remove(),$(next_li).find(editor.html.blockTagsQuery()).not("ol, ul, table").each((function(){this.parentNode==next_li&&$(this).replaceWith($(this).html()+(editor.node.isEmpty(this)?"":"<br>"))}));for(var tmp,last_node=marker,node=editor.node.contents(next_li)[0];node&&!editor.node.isList(node);)tmp=node.nextSibling,$(last_node).after(node),last_node=node,node=tmp;for(;node;)tmp=node.nextSibling,$(li).append(node),node=tmp;$(marker).replaceWith($.FE.MARKERS),$(next_li).remove()}else{for(var next_node=li;!next_node.nextSibling&&next_node!=editor.el;)next_node=next_node.parentNode;if(next_node==editor.el)return!1;if(next_node=next_node.nextSibling,editor.node.isBlock(next_node))$.FE.NO_DELETE_TAGS.indexOf(next_node.tagName)<0&&($(marker).replaceWith($.FE.MARKERS),(contents=editor.node.contents(li)).length&&"BR"==contents[contents.length-1].tagName&&$(contents[contents.length-1]).remove(),$(li).append($(next_node).html()),$(next_node).remove());else for((contents=editor.node.contents(li)).length&&"BR"==contents[contents.length-1].tagName&&$(contents[contents.length-1]).remove(),$(marker).replaceWith($.FE.MARKERS);next_node&&!editor.node.isBlock(next_node)&&"BR"!=next_node.tagName;)$(li).append($(next_node)),next_node=next_node.nextSibling}}}}}(jQuery),function($){$.FE.NO_DELETE_TAGS=["TH","TD","TR","TABLE","FORM"],$.FE.SIMPLE_ENTER_TAGS=["TH","TD","LI","DL","DT","FORM"],$.FE.MODULES.cursor=function(editor){function _atEnd(node){return!!node&&(!!editor.node.isBlock(node)||(node.nextSibling&&node.nextSibling.nodeType==Node.TEXT_NODE&&0===node.nextSibling.textContent.replace(/\u200b/g,"").length?_atEnd(node.nextSibling):!(node.nextSibling&&(!node.previousSibling||"BR"!=node.nextSibling.tagName||node.nextSibling.nextSibling))&&_atEnd(node.parentNode)))}function _atStart(node){return!!node&&(!!editor.node.isBlock(node)||(node.previousSibling&&node.previousSibling.nodeType==Node.TEXT_NODE&&0===node.previousSibling.textContent.replace(/\u200b/g,"").length?_atStart(node.previousSibling):!node.previousSibling&&(!(node.previousSibling||!editor.node.hasClass(node.parentNode,"fr-inner"))||_atStart(node.parentNode))))}function _isAtStart(node,container){return!!node&&(node!=editor.$wp.get(0)&&(node.previousSibling&&node.previousSibling.nodeType==Node.TEXT_NODE&&0===node.previousSibling.textContent.replace(/\u200b/g,"").length?_isAtStart(node.previousSibling,container):!node.previousSibling&&(node.parentNode==container||_isAtStart(node.parentNode,container))))}function _isAtEnd(node,container){return!!node&&(node!=editor.$wp.get(0)&&(node.nextSibling&&node.nextSibling.nodeType==Node.TEXT_NODE&&0===node.nextSibling.textContent.replace(/\u200b/g,"").length?_isAtEnd(node.nextSibling,container):!(node.nextSibling&&(!node.previousSibling||"BR"!=node.nextSibling.tagName||node.nextSibling.nextSibling))&&(node.parentNode==container||_isAtEnd(node.parentNode,container))))}function _inLi(node){return $(node).parentsUntil(editor.$el,"LI").length>0&&0===$(node).parentsUntil("LI","TABLE").length}function _getExtremityCharacterLength(text,first){var special_chars_regex=new RegExp((first?"^":"")+"(([\\uD83C-\\uDBFF\\uDC00-\\uDFFF]+\\u200D)*[\\uD83C-\\uDBFF\\uDC00-\\uDFFF]{2})"+(first?"":"$"),"i"),matches=text.match(special_chars_regex);return matches?matches[0].length:1}function _middleBackspace(marker){for(var contents,prev_node=marker;!prev_node.previousSibling;)if(prev_node=prev_node.parentNode,editor.node.isElement(prev_node))return!1;if(prev_node=prev_node.previousSibling,!editor.node.isBlock(prev_node)&&editor.node.isEditable(prev_node)){for(contents=editor.node.contents(prev_node);prev_node.nodeType!=Node.TEXT_NODE&&!editor.node.isDeletable(prev_node)&&contents.length&&editor.node.isEditable(prev_node);)prev_node=contents[contents.length-1],contents=editor.node.contents(prev_node);if(prev_node.nodeType==Node.TEXT_NODE){var txt=prev_node.textContent,len=txt.length;if(txt.length&&"\n"===txt[txt.length-1])return prev_node.textContent=txt.substring(0,len-2),0===prev_node.textContent.length&&prev_node.parentNode.removeChild(prev_node),_middleBackspace(marker);if(editor.opts.tabSpaces&&txt.length>=editor.opts.tabSpaces)0===txt.substr(txt.length-editor.opts.tabSpaces,txt.length-1).replace(/ /g,"").replace(new RegExp($.FE.UNICODE_NBSP,"g"),"").length&&(len=txt.length-editor.opts.tabSpaces+1);prev_node.textContent=txt.substring(0,len-_getExtremityCharacterLength(txt)),editor.opts.htmlUntouched&&!marker.nextSibling&&prev_node.textContent.length&&" "===prev_node.textContent[prev_node.textContent.length-1]&&(prev_node.textContent=prev_node.textContent.substring(0,prev_node.textContent.length-1)+$.FE.UNICODE_NBSP);var deleted=txt.length!=prev_node.textContent.length;if(0===prev_node.textContent.length)if(deleted&&editor.opts.keepFormatOnDelete)$(prev_node).after($.FE.INVISIBLE_SPACE+$.FE.MARKERS);else if((2!=prev_node.parentNode.childNodes.length||prev_node.parentNode!=marker.parentNode)&&1!=prev_node.parentNode.childNodes.length||editor.node.isBlock(prev_node.parentNode)||editor.node.isElement(prev_node.parentNode)||!editor.node.isDeletable(prev_node.parentNode)){for(;!editor.node.isElement(prev_node.parentNode)&&editor.node.isEmpty(prev_node.parentNode)&&$.FE.NO_DELETE_TAGS.indexOf(prev_node.parentNode.tagName)<0;){var t_node=prev_node;prev_node=prev_node.parentNode,t_node.parentNode.removeChild(t_node)}$(prev_node).after($.FE.MARKERS),editor.node.isElement(prev_node.parentNode)&&!marker.nextSibling&&prev_node.previousSibling&&"BR"==prev_node.previousSibling.tagName&&$(marker).after("<br>"),prev_node.parentNode.removeChild(prev_node)}else $(prev_node.parentNode).after($.FE.MARKERS),$(prev_node.parentNode).remove();else $(prev_node).after($.FE.MARKERS)}else editor.node.isDeletable(prev_node)?($(prev_node).after($.FE.MARKERS),$(prev_node).remove()):marker.nextSibling&&"BR"==marker.nextSibling.tagName&&editor.node.isVoid(prev_node)&&"BR"!=prev_node.tagName?($(marker.nextSibling).remove(),$(marker).replaceWith($.FE.MARKERS)):!1!==editor.events.trigger("node.remove",[$(prev_node)])&&($(prev_node).after($.FE.MARKERS),$(prev_node).remove())}else if($.FE.NO_DELETE_TAGS.indexOf(prev_node.tagName)<0&&(editor.node.isEditable(prev_node)||editor.node.isDeletable(prev_node)))if(editor.node.isDeletable(prev_node))$(marker).replaceWith($.FE.MARKERS),$(prev_node).remove();else if(editor.node.isEmpty(prev_node)&&!editor.node.isList(prev_node))$(prev_node).remove(),$(marker).replaceWith($.FE.MARKERS);else{for(editor.node.isList(prev_node)&&(prev_node=$(prev_node).find("li:last").get(0)),(contents=editor.node.contents(prev_node))&&"BR"==contents[contents.length-1].tagName&&$(contents[contents.length-1]).remove(),contents=editor.node.contents(prev_node);contents&&editor.node.isBlock(contents[contents.length-1]);)prev_node=contents[contents.length-1],contents=editor.node.contents(prev_node);$(prev_node).append($.FE.MARKERS);for(var next_node=marker;!next_node.previousSibling;)next_node=next_node.parentNode;for(;next_node&&"BR"!==next_node.tagName&&!editor.node.isBlock(next_node);){var copy_node=next_node;next_node=next_node.nextSibling,$(prev_node).append(copy_node)}next_node&&"BR"==next_node.tagName&&$(next_node).remove(),$(marker).remove()}else marker.nextSibling&&"BR"==marker.nextSibling.tagName&&$(marker.nextSibling).remove()}function _endDel(marker){var quote=$(marker).parentsUntil(editor.$el,"BLOCKQUOTE").length>0,deep_parent=editor.node.deepestParent(marker,[],!quote);if(deep_parent&&"BLOCKQUOTE"==deep_parent.tagName){var m_parent=editor.node.deepestParent(marker,[$(marker).parentsUntil(editor.$el,"BLOCKQUOTE").get(0)]);m_parent&&m_parent.nextSibling&&(deep_parent=m_parent)}if(null!==deep_parent){var contents,next_node=deep_parent.nextSibling;if(editor.node.isBlock(deep_parent)&&(editor.node.isEditable(deep_parent)||editor.node.isDeletable(deep_parent))&&next_node&&$.FE.NO_DELETE_TAGS.indexOf(next_node.tagName)<0)if(editor.node.isDeletable(next_node))$(next_node).remove(),$(marker).replaceWith($.FE.MARKERS);else if(editor.node.isBlock(next_node)&&editor.node.isEditable(next_node))if(editor.node.isList(next_node))if(editor.node.isEmpty(deep_parent,!0))$(deep_parent).remove(),$(next_node).find("li:first").prepend($.FE.MARKERS);else{var $li=$(next_node).find("li:first");"BLOCKQUOTE"==deep_parent.tagName&&(contents=editor.node.contents(deep_parent)).length&&editor.node.isBlock(contents[contents.length-1])&&(deep_parent=contents[contents.length-1]),0===$li.find("ul, ol").length&&($(marker).replaceWith($.FE.MARKERS),$li.find(editor.html.blockTagsQuery()).not("ol, ul, table").each((function(){this.parentNode==$li.get(0)&&$(this).replaceWith($(this).html()+(editor.node.isEmpty(this)?"":"<br>"))})),$(deep_parent).append(editor.node.contents($li.get(0))),$li.remove(),0===$(next_node).find("li").length&&$(next_node).remove())}else{if((contents=editor.node.contents(next_node)).length&&"BR"==contents[0].tagName&&$(contents[0]).remove(),"BLOCKQUOTE"!=next_node.tagName&&"BLOCKQUOTE"==deep_parent.tagName)for(contents=editor.node.contents(deep_parent);contents.length&&editor.node.isBlock(contents[contents.length-1]);)deep_parent=contents[contents.length-1],contents=editor.node.contents(deep_parent);else if("BLOCKQUOTE"==next_node.tagName&&"BLOCKQUOTE"!=deep_parent.tagName)for(contents=editor.node.contents(next_node);contents.length&&editor.node.isBlock(contents[0]);)next_node=contents[0],contents=editor.node.contents(next_node);$(marker).replaceWith($.FE.MARKERS),$(deep_parent).append(next_node.innerHTML),$(next_node).remove()}else{for($(marker).replaceWith($.FE.MARKERS);next_node&&"BR"!==next_node.tagName&&!editor.node.isBlock(next_node)&&editor.node.isEditable(next_node);){var copy_node=next_node;next_node=next_node.nextSibling,$(deep_parent).append(copy_node)}next_node&&"BR"==next_node.tagName&&editor.node.isEditable(next_node)&&$(next_node).remove()}}}function _middleDel(marker){for(var contents,next_node=marker;!next_node.nextSibling;)if(next_node=next_node.parentNode,editor.node.isElement(next_node))return!1;if("BR"==(next_node=next_node.nextSibling).tagName&&editor.node.isEditable(next_node))if(next_node.nextSibling){if(editor.node.isBlock(next_node.nextSibling)&&editor.node.isEditable(next_node.nextSibling)){if(!($.FE.NO_DELETE_TAGS.indexOf(next_node.nextSibling.tagName)<0))return void $(next_node).remove();next_node=next_node.nextSibling,$(next_node.previousSibling).remove()}}else if(_atEnd(next_node)){if(_inLi(marker))editor.cursorLists._del(marker);else editor.node.deepestParent(next_node)&&((!editor.node.isEmpty(editor.node.blockParent(next_node))||(editor.node.blockParent(next_node).nextSibling&&$.FE.NO_DELETE_TAGS.indexOf(editor.node.blockParent(next_node).nextSibling.tagName))<0)&&$(next_node).remove(),_endDel(marker));return}if(!editor.node.isBlock(next_node)&&editor.node.isEditable(next_node)){for(contents=editor.node.contents(next_node);next_node.nodeType!=Node.TEXT_NODE&&contents.length&&!editor.node.isDeletable(next_node)&&editor.node.isEditable(next_node);)next_node=contents[0],contents=editor.node.contents(next_node);next_node.nodeType==Node.TEXT_NODE?($(next_node).before($.FE.MARKERS),next_node.textContent.length&&(next_node.textContent=next_node.textContent.substring(_getExtremityCharacterLength(next_node.textContent,!0),next_node.textContent.length))):(editor.node.isDeletable(next_node)||!1!==editor.events.trigger("node.remove",[$(next_node)]))&&($(next_node).before($.FE.MARKERS),$(next_node).remove()),$(marker).remove()}else if($.FE.NO_DELETE_TAGS.indexOf(next_node.tagName)<0&&(editor.node.isEditable(next_node)||editor.node.isDeletable(next_node)))if(editor.node.isDeletable(next_node))$(marker).replaceWith($.FE.MARKERS),$(next_node).remove();else if(editor.node.isList(next_node))marker.previousSibling?($(next_node).find("li:first").prepend(marker),editor.cursorLists._backspace(marker)):($(next_node).find("li:first").prepend($.FE.MARKERS),$(marker).remove());else if((contents=editor.node.contents(next_node))&&contents.length&&"BR"==contents[0].tagName&&$(contents[0]).remove(),contents&&"BLOCKQUOTE"==next_node.tagName){var node=contents[0];for($(marker).before($.FE.MARKERS);node&&"BR"!=node.tagName;){var tmp=node;node=node.nextSibling,$(marker).before(tmp)}node&&"BR"==node.tagName&&$(node).remove()}else $(marker).after($(next_node).html()).after($.FE.MARKERS),$(next_node).remove()}function _cleanEmptyBlockquotes(){for(var blks=editor.el.querySelectorAll("blockquote:empty"),i=0;i<blks.length;i++)blks[i].parentNode.removeChild(blks[i])}function _endEnter(marker,shift,quote){var default_tag,deep_parent=editor.node.deepestParent(marker,[],!quote);if(deep_parent&&"BLOCKQUOTE"==deep_parent.tagName)return _isAtEnd(marker,deep_parent)?(default_tag=editor.html.defaultTag(),shift?$(marker).replaceWith("<br>"+$.FE.MARKERS):default_tag?$(deep_parent).after("<"+default_tag+">"+$.FE.MARKERS+"<br></"+default_tag+">"):$(deep_parent).after($.FE.MARKERS+"<br>"),$(marker).remove(),!1):(_middleEnter(marker,shift,quote),!1);if(null==deep_parent)(default_tag=editor.html.defaultTag())&&editor.node.isElement(marker.parentNode)?$(marker).replaceWith("<"+default_tag+">"+$.FE.MARKERS+"<br></"+default_tag+">"):!marker.previousSibling||$(marker.previousSibling).is("br")||marker.nextSibling?$(marker).replaceWith("<br>"+$.FE.MARKERS):$(marker).replaceWith("<br>"+$.FE.MARKERS+"<br>");else{var c_node=marker,str="";"PRE"!=deep_parent.tagName||marker.nextSibling||(shift=!0),editor.node.isBlock(deep_parent)&&!shift||(str="<br/>");var html,c_str="",o_str="",open_default_tag="",close_default_tag="";(default_tag=editor.html.defaultTag())&&editor.node.isBlock(deep_parent)&&(open_default_tag="<"+default_tag+">",close_default_tag="</"+default_tag+">",deep_parent.tagName==default_tag.toUpperCase()&&(open_default_tag=editor.node.openTagString($(deep_parent).clone().removeAttr("id").get(0))));do{if(c_node=c_node.parentNode,!shift||c_node!=deep_parent||shift&&!editor.node.isBlock(deep_parent))if(c_str+=editor.node.closeTagString(c_node),c_node==deep_parent&&editor.node.isBlock(deep_parent))o_str=open_default_tag+o_str;else{var cls="A"==c_node.tagName&&_isAtEnd(marker,c_node)?"fr-to-remove":"";o_str=editor.node.openTagString($(c_node).clone().addClass(cls).get(0))+o_str}}while(c_node!=deep_parent);str=c_str+str+o_str+(marker.parentNode==deep_parent&&editor.node.isBlock(deep_parent)?"":$.FE.INVISIBLE_SPACE)+$.FE.MARKERS,editor.node.isBlock(deep_parent)&&!$(deep_parent).find("*:last").is("br")&&$(deep_parent).append("<br/>"),$(marker).after('<span id="fr-break"></span>'),$(marker).remove(),deep_parent.nextSibling&&!editor.node.isBlock(deep_parent.nextSibling)||editor.node.isBlock(deep_parent)||$(deep_parent).after("<br>"),html=(html=!shift&&editor.node.isBlock(deep_parent)?editor.node.openTagString(deep_parent)+$(deep_parent).html()+close_default_tag:editor.node.openTagString(deep_parent)+$(deep_parent).html()+editor.node.closeTagString(deep_parent)).replace(/<span id="fr-break"><\/span>/g,str),$(deep_parent).replaceWith(html)}}function _startEnter(marker,shift,quote){var default_tag,deep_parent=editor.node.deepestParent(marker,[],!quote);if(deep_parent&&"TABLE"==deep_parent.tagName)return $(deep_parent).find("td:first, th:first").prepend(marker),_startEnter(marker,shift,quote);if(deep_parent&&"BLOCKQUOTE"==deep_parent.tagName)if(_isAtStart(marker,deep_parent)){if(!shift)return(default_tag=editor.html.defaultTag())?$(deep_parent).before("<"+default_tag+">"+$.FE.MARKERS+"<br></"+default_tag+">"):$(deep_parent).before($.FE.MARKERS+"<br>"),$(marker).remove(),!1}else _isAtEnd(marker,deep_parent)?_endEnter(marker,shift,!0):_middleEnter(marker,shift,!0);if(null==deep_parent)(default_tag=editor.html.defaultTag())&&editor.node.isElement(marker.parentNode)?$(marker).replaceWith("<"+default_tag+">"+$.FE.MARKERS+"<br></"+default_tag+">"):$(marker).replaceWith("<br>"+$.FE.MARKERS);else{if(editor.node.isBlock(deep_parent))if("PRE"==deep_parent.tagName&&(shift=!0),shift)$(marker).remove(),$(deep_parent).prepend("<br>"+$.FE.MARKERS);else{if(editor.node.isEmpty(deep_parent,!0))return _endEnter(marker,shift,quote);if(editor.opts.keepFormatOnDelete){for(var tmp=marker,str=$.FE.INVISIBLE_SPACE;tmp!=deep_parent&&!editor.node.isElement(tmp);)tmp=tmp.parentNode,str=editor.node.openTagString(tmp)+str+editor.node.closeTagString(tmp);$(deep_parent).before(str)}else $(deep_parent).before(editor.node.openTagString($(deep_parent).clone().removeAttr("id").get(0))+"<br>"+editor.node.closeTagString(deep_parent))}else $(deep_parent).before("<br>");$(marker).remove()}}function _middleEnter(marker,shift,quote){var deep_parent=editor.node.deepestParent(marker,[],!quote);if(null==deep_parent)editor.html.defaultTag()&&marker.parentNode===editor.el?$(marker).replaceWith("<"+editor.html.defaultTag()+">"+$.FE.MARKERS+"<br></"+editor.html.defaultTag()+">"):(marker.nextSibling&&!editor.node.isBlock(marker.nextSibling)||$(marker).after("<br>"),$(marker).replaceWith("<br>"+$.FE.MARKERS));else{var c_node=marker,str="";"PRE"==deep_parent.tagName&&(shift=!0),editor.node.isBlock(deep_parent)&&!shift||(str="<br>");var c_str="",o_str="";do{var tmp=c_node;if(c_node=c_node.parentNode,"BLOCKQUOTE"==deep_parent.tagName&&editor.node.isEmpty(tmp)&&!editor.node.hasClass(tmp,"fr-marker")&&$(tmp).find(marker).length>0&&$(tmp).after(marker),"BLOCKQUOTE"!=deep_parent.tagName||!_isAtEnd(marker,c_node)&&!_isAtStart(marker,c_node))if(!shift||c_node!=deep_parent||shift&&!editor.node.isBlock(deep_parent)){c_str+=editor.node.closeTagString(c_node);var cls="A"==c_node.tagName&&_isAtEnd(marker,c_node)?"fr-to-remove":"";o_str=editor.node.openTagString($(c_node).clone().addClass(cls).removeAttr("id").get(0))+o_str}else"BLOCKQUOTE"==deep_parent.tagName&&shift&&(c_str="",o_str="")}while(c_node!=deep_parent);var add=deep_parent==marker.parentNode&&editor.node.isBlock(deep_parent)||marker.nextSibling;if("BLOCKQUOTE"==deep_parent.tagName)if(marker.previousSibling&&editor.node.isBlock(marker.previousSibling)&&marker.nextSibling&&"BR"==marker.nextSibling.tagName&&($(marker.nextSibling).after(marker),marker.nextSibling&&"BR"==marker.nextSibling.tagName&&$(marker.nextSibling).remove()),shift)str=c_str+str+$.FE.MARKERS+o_str;else{var default_tag=editor.html.defaultTag();str=c_str+str+(default_tag?"<"+default_tag+">":"")+$.FE.MARKERS+"<br>"+(default_tag?"</"+default_tag+">":"")+o_str}else str=c_str+str+o_str+(add?"":$.FE.INVISIBLE_SPACE)+$.FE.MARKERS;$(marker).replaceWith('<span id="fr-break"></span>');var html=editor.node.openTagString(deep_parent)+$(deep_parent).html()+editor.node.closeTagString(deep_parent);html=html.replace(/<span id="fr-break"><\/span>/g,str),$(deep_parent).replaceWith(html)}}return{enter:function(shift){var marker=editor.markers.insert();if(!marker)return!0;for(var p_node=marker.parentNode;p_node&&!editor.node.isElement(p_node);){if("false"===p_node.getAttribute("contenteditable"))return $(marker).replaceWith($.FE.MARKERS),editor.selection.restore(),!1;if("true"===p_node.getAttribute("contenteditable"))break;p_node=p_node.parentNode}editor.el.normalize();var quote=!1;$(marker).parentsUntil(editor.$el,"BLOCKQUOTE").length>0&&(quote=!0),$(marker).parentsUntil(editor.$el,"TD, TH").length&&(quote=!1),_atEnd(marker)?!_inLi(marker)||shift||quote?_endEnter(marker,shift,quote):editor.cursorLists._endEnter(marker):_atStart(marker)?!_inLi(marker)||shift||quote?_startEnter(marker,shift,quote):editor.cursorLists._startEnter(marker):!_inLi(marker)||shift||quote?_middleEnter(marker,shift,quote):editor.cursorLists._middleEnter(marker),editor.$el.find(".fr-to-remove").each((function(){for(var contents=editor.node.contents(this),i=0;i<contents.length;i++)contents[i].nodeType==Node.TEXT_NODE&&(contents[i].textContent=contents[i].textContent.replace(/\u200B/g,""));$(this).replaceWith(this.innerHTML)})),editor.html.fillEmptyBlocks(!0),editor.opts.htmlUntouched||(editor.html.cleanEmptyTags(),editor.clean.lists(),editor.spaces.normalizeAroundCursor()),editor.selection.restore()},backspace:function(){var do_default=!1,marker=editor.markers.insert();if(!marker)return!0;for(var p_node=marker.parentNode;p_node&&!editor.node.isElement(p_node);){if("false"===p_node.getAttribute("contenteditable"))return $(marker).replaceWith($.FE.MARKERS),editor.selection.restore(),!1;if("true"===p_node.getAttribute("contenteditable"))break;p_node=p_node.parentNode}editor.el.normalize();var prev_node=marker.previousSibling;if(prev_node){var txt=prev_node.textContent;txt&&txt.length&&8203==txt.charCodeAt(txt.length-1)&&(1==txt.length?$(prev_node).remove():prev_node.textContent=prev_node.textContent.substr(0,txt.length-_getExtremityCharacterLength(txt)))}return _inLi(marker)&&_isAtStart(marker,$(marker).parents("li:first").get(0))?editor.cursorLists._backspace(marker):do_default=_atEnd(marker)?_middleBackspace(marker):_atStart(marker)?function(marker){for(var quote=$(marker).parentsUntil(editor.$el,"BLOCKQUOTE").length>0,deep_parent=editor.node.deepestParent(marker,[],!quote),current_block=deep_parent;deep_parent&&!deep_parent.previousSibling&&"BLOCKQUOTE"!=deep_parent.tagName&&deep_parent.parentElement!=editor.el&&!editor.node.hasClass(deep_parent.parentElement,"fr-inner")&&$.FE.SIMPLE_ENTER_TAGS.indexOf(deep_parent.parentElement.tagName)<0;)deep_parent=deep_parent.parentElement;if(deep_parent&&"BLOCKQUOTE"==deep_parent.tagName){var m_parent=editor.node.deepestParent(marker,[$(marker).parentsUntil(editor.$el,"BLOCKQUOTE").get(0)]);m_parent&&m_parent.previousSibling&&(deep_parent=m_parent,current_block=m_parent)}if(null!==deep_parent){var contents,prev_node=deep_parent.previousSibling;if(editor.node.isBlock(deep_parent)&&editor.node.isEditable(deep_parent))if(prev_node&&$.FE.NO_DELETE_TAGS.indexOf(prev_node.tagName)<0){if(editor.node.isDeletable(prev_node))$(prev_node).remove(),$(marker).replaceWith($.FE.MARKERS);else if(editor.node.isEditable(prev_node))if(editor.node.isBlock(prev_node))if(editor.node.isEmpty(prev_node)&&!editor.node.isList(prev_node))$(prev_node).remove(),$(marker).after(editor.opts.keepFormatOnDelete?$.FE.INVISIBLE_SPACE:"");else{if(editor.node.isList(prev_node)&&(prev_node=$(prev_node).find("li:last").get(0)),(contents=editor.node.contents(prev_node)).length&&"BR"==contents[contents.length-1].tagName&&$(contents[contents.length-1]).remove(),"BLOCKQUOTE"==prev_node.tagName&&"BLOCKQUOTE"!=deep_parent.tagName)for(contents=editor.node.contents(prev_node);contents.length&&editor.node.isBlock(contents[contents.length-1]);)prev_node=contents[contents.length-1],contents=editor.node.contents(prev_node);else if("BLOCKQUOTE"!=prev_node.tagName&&"BLOCKQUOTE"==current_block.tagName)for(contents=editor.node.contents(current_block);contents.length&&editor.node.isBlock(contents[0]);)current_block=contents[0],contents=editor.node.contents(current_block);if(editor.node.isEmpty(deep_parent))$(marker).remove(),editor.selection.setAtEnd(prev_node,!0);else{$(marker).replaceWith($.FE.MARKERS);var prev_children=prev_node.childNodes;editor.node.isBlock(prev_children[prev_children.length-1])?$(prev_children[prev_children.length-1]).append(current_block.innerHTML):$(prev_node).append(current_block.innerHTML)}$(current_block).remove(),editor.node.isEmpty(deep_parent)&&$(deep_parent).remove()}else $(marker).replaceWith($.FE.MARKERS),"BLOCKQUOTE"==deep_parent.tagName&&prev_node.nodeType==Node.ELEMENT_NODE?$(prev_node).remove():($(prev_node).after(editor.node.isEmpty(deep_parent)?"":$(deep_parent).html()),$(deep_parent).remove(),"BR"==prev_node.tagName&&$(prev_node).remove())}else prev_node||deep_parent&&"BLOCKQUOTE"==deep_parent.tagName&&0==$(deep_parent).text().replace(/\u200B/g,"").length&&$(deep_parent).remove()}}(marker):_middleBackspace(marker),$(marker).remove(),_cleanEmptyBlockquotes(),editor.html.fillEmptyBlocks(!0),editor.opts.htmlUntouched||(editor.html.cleanEmptyTags(),editor.clean.lists(),editor.spaces.normalizeAroundCursor()),editor.selection.restore(),do_default},del:function(){var marker=editor.markers.insert();if(!marker)return!1;if(editor.el.normalize(),_atEnd(marker))if(_inLi(marker))if(0===$(marker).parents("li:first").find("ul, ol").length)editor.cursorLists._del(marker);else{var $li=$(marker).parents("li:first").find("ul:first, ol:first").find("li:first");($li=$li.find(editor.html.blockTagsQuery()).get(-1)||$li).prepend(marker),editor.cursorLists._backspace(marker)}else _endDel(marker);else _atStart(marker),_middleDel(marker);$(marker).remove(),_cleanEmptyBlockquotes(),editor.html.fillEmptyBlocks(!0),editor.opts.htmlUntouched||(editor.html.cleanEmptyTags(),editor.clean.lists()),editor.spaces.normalizeAroundCursor(),editor.selection.restore()},isAtEnd:_isAtEnd,isAtStart:_isAtStart}}}(jQuery),function($){$.FE.ENTER_P=0,$.FE.ENTER_DIV=1,$.FE.ENTER_BR=2,$.FE.KEYCODE={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,SPACE:32,ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40,DELETE:46,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,FF_SEMICOLON:59,FF_EQUALS:61,QUESTION_MARK:63,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,META:91,NUM_ZERO:96,NUM_ONE:97,NUM_TWO:98,NUM_THREE:99,NUM_FOUR:100,NUM_FIVE:101,NUM_SIX:102,NUM_SEVEN:103,NUM_EIGHT:104,NUM_NINE:105,NUM_MULTIPLY:106,NUM_PLUS:107,NUM_MINUS:109,NUM_PERIOD:110,NUM_DIVISION:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,FF_HYPHEN:173,SEMICOLON:186,DASH:189,EQUALS:187,COMMA:188,HYPHEN:189,PERIOD:190,SLASH:191,APOSTROPHE:192,TILDE:192,SINGLE_QUOTE:222,OPEN_SQUARE_BRACKET:219,BACKSLASH:220,CLOSE_SQUARE_BRACKET:221,IME:229},$.extend($.FE.DEFAULTS,{enter:$.FE.ENTER_P,multiLine:!0,tabSpaces:0}),$.FE.MODULES.keys=function(editor){var key_down_code,_typing_timeout,_temp_snapshot,IME=!1;function _input(){if(editor.browser.mozilla&&editor.selection.isCollapsed()&&!IME){var range=editor.selection.ranges(0),start_container=range.startContainer,start_offset=range.startOffset;start_container&&start_container.nodeType==Node.TEXT_NODE&&start_offset<=start_container.textContent.length&&start_offset>0&&32==start_container.textContent.charCodeAt(start_offset-1)&&(editor.selection.save(),editor.spaces.normalize(),editor.selection.restore())}}function _cut(){editor.selection.isFull()&&setTimeout((function(){var default_tag=editor.html.defaultTag();default_tag?editor.$el.html("<"+default_tag+">"+$.FE.MARKERS+"<br/></"+default_tag+">"):editor.$el.html($.FE.MARKERS+"<br/>"),editor.selection.restore(),editor.placeholder.refresh(),editor.button.bulkRefresh(),editor.undo.saveStep()}),0)}function _mapKeyPress(){IME=!1}function _clearIME(){IME=!1}function _empty(){var default_tag=editor.html.defaultTag();default_tag?editor.$el.html("<"+default_tag+">"+$.FE.MARKERS+"<br/></"+default_tag+">"):editor.$el.html($.FE.MARKERS+"<br/>"),editor.selection.restore()}function _mapKeyDown(e){var sel_el=editor.selection.element();if(sel_el&&["INPUT","TEXTAREA"].indexOf(sel_el.tagName)>=0)return!0;if(e&&isArrow(e.which))return _removeInvisible(),!0;editor.events.disableBlur(),null;var key_code=e.which;if(16===key_code)return!0;if(key_down_code=key_code,key_code===$.FE.KEYCODE.IME)return IME=!0,!0;IME=!1;var char_key=isCharacter(key_code)&&!ctrlKey(e)&&!e.altKey,del_key=key_code==$.FE.KEYCODE.BACKSPACE||key_code==$.FE.KEYCODE.DELETE;if((!(e.shiftKey&&(33===key_code||34===key_code||35===key_code||36===key_code))&&editor.selection.isFull()&&!editor.opts.keepFormatOnDelete&&!editor.placeholder.isVisible()||del_key&&editor.placeholder.isVisible()&&editor.opts.keepFormatOnDelete)&&(char_key||del_key)&&(_empty(),!isCharacter(key_code)))return e.preventDefault(),!0;key_code==$.FE.KEYCODE.ENTER?e.shiftKey?function(e){e.preventDefault(),e.stopPropagation(),editor.opts.multiLine&&(editor.selection.isCollapsed()||editor.selection.remove(),editor.cursor.enter(!0))}(e):function(e){editor.opts.multiLine?(editor.helpers.isIOS()||(e.preventDefault(),e.stopPropagation()),editor.selection.isCollapsed()||editor.selection.remove(),editor.cursor.enter()):(e.preventDefault(),e.stopPropagation())}(e):key_code===$.FE.KEYCODE.BACKSPACE&&(e.metaKey||e.ctrlKey)?setTimeout((function(){editor.events.disableBlur(),editor.events.focus()}),0):key_code!=$.FE.KEYCODE.BACKSPACE||ctrlKey(e)||e.altKey?key_code!=$.FE.KEYCODE.DELETE||ctrlKey(e)||e.altKey||e.shiftKey?key_code==$.FE.KEYCODE.SPACE?function(e){var el=editor.selection.element();if(!editor.helpers.isMobile()&&el&&"A"==el.tagName){e.preventDefault(),e.stopPropagation(),editor.selection.isCollapsed()||editor.selection.remove();var marker=editor.markers.insert();if(marker){var prev_node=marker.previousSibling;!marker.nextSibling&&marker.parentNode&&"A"==marker.parentNode.tagName?(marker.parentNode.insertAdjacentHTML("afterend","&nbsp;"+$.FE.MARKERS),marker.parentNode.removeChild(marker)):(prev_node&&prev_node.nodeType==Node.TEXT_NODE&&1==prev_node.textContent.length&&160==prev_node.textContent.charCodeAt(0)?prev_node.textContent=prev_node.textContent+" ":marker.insertAdjacentHTML("beforebegin","&nbsp;"),marker.outerHTML=$.FE.MARKERS),editor.selection.restore()}}}(e):key_code==$.FE.KEYCODE.TAB?function(e){if(editor.opts.tabSpaces>0)if(editor.selection.isCollapsed()){editor.undo.saveStep(),e.preventDefault(),e.stopPropagation();for(var str="",i=0;i<editor.opts.tabSpaces;i++)str+="&nbsp;";editor.html.insert(str),editor.placeholder.refresh(),editor.undo.saveStep()}else e.preventDefault(),e.stopPropagation(),e.shiftKey?editor.commands.outdent():editor.commands.indent()}(e):ctrlKey(e)||!isCharacter(e.which)||editor.selection.isCollapsed()||e.ctrlKey||e.altKey||editor.selection.remove():editor.placeholder.isVisible()?(editor.opts.keepFormatOnDelete||_empty(),e.preventDefault(),e.stopPropagation()):function(e){e.preventDefault(),e.stopPropagation(),""===editor.selection.text()?editor.cursor.del():editor.selection.remove(),editor.placeholder.refresh()}(e):editor.placeholder.isVisible()?(editor.opts.keepFormatOnDelete||_empty(),e.preventDefault(),e.stopPropagation()):function(e){if(editor.selection.isCollapsed())if(editor.cursor.backspace(),editor.helpers.isIOS()){var range=editor.selection.ranges(0);range.deleteContents(),range.insertNode(document.createTextNode("​")),editor.selection.get().modify("move","forward","character")}else e.preventDefault(),e.stopPropagation();else e.preventDefault(),e.stopPropagation(),editor.selection.remove();editor.placeholder.refresh()}(e),editor.events.enableBlur()}function positionCaret(){if(!editor.$wp)return!0;var info;editor.opts.height||editor.opts.heightMax?(info=editor.position.getBoundingRect().top,editor.opts.iframe&&(info+=editor.$iframe.offset().top),info>editor.$wp.offset().top-editor.helpers.scrollTop()+editor.$wp.height()-20&&editor.$wp.scrollTop(info+editor.$wp.scrollTop()-(editor.$wp.height()+editor.$wp.offset().top)+editor.helpers.scrollTop()+20)):(info=editor.position.getBoundingRect().top,editor.opts.toolbarBottom&&(info+=editor.opts.toolbarStickyOffset),editor.opts.iframe&&(info+=editor.$iframe.offset().top,info-=editor.helpers.scrollTop()),(info+=editor.opts.toolbarStickyOffset)>editor.o_win.innerHeight-20&&$(editor.o_win).scrollTop(info+editor.helpers.scrollTop()-editor.o_win.innerHeight+20),info=editor.position.getBoundingRect().top,editor.opts.toolbarBottom||(info-=editor.opts.toolbarStickyOffset),editor.opts.iframe&&(info+=editor.$iframe.offset().top,info-=editor.helpers.scrollTop()),info<editor.$tb.height()+20&&$(editor.o_win).scrollTop(info+editor.helpers.scrollTop()-editor.$tb.height()-20))}function _removeInvisible(){var el=editor.selection.element();(function(node){if(!node)return!1;var text=node.innerHTML;return!!((text=text.replace(/<span[^>]*? class\s*=\s*["']?fr-marker["']?[^>]+>\u200b<\/span>/gi,""))&&/\u200B/.test(text)&&text.replace(/\u200B/gi,"").length>0)})(el)&&!editor.node.hasClass(el,"fr-marker")&&"IFRAME"!=el.tagName&&function(el){return!editor.helpers.isIOS()||0===((el.textContent||"").match(/[\u3041-\u3096\u30A0-\u30FF\u4E00-\u9FFF\u3130-\u318F\uAC00-\uD7AF]/gi)||[]).length}(el)&&(editor.selection.save(),function(el){for(var walker=editor.doc.createTreeWalker(el,NodeFilter.SHOW_TEXT,editor.node.filter((function(node){return/\u200B/gi.test(node.textContent)})),!1);walker.nextNode();){var node=walker.currentNode;node.textContent=node.textContent.replace(/\u200B/gi,"")}}(el),editor.selection.restore())}function _mapKeyUp(e){var sel_el=editor.selection.element();if(sel_el&&["INPUT","TEXTAREA"].indexOf(sel_el.tagName)>=0)return!0;if(e&&0===e.which&&key_down_code&&(e.which=key_down_code),editor.helpers.isAndroid()&&editor.browser.mozilla)return!0;if(IME)return!1;if(e&&editor.helpers.isIOS()&&e.which==$.FE.KEYCODE.ENTER&&editor.doc.execCommand("undo"),!editor.selection.isCollapsed())return!0;if(e&&(e.which===$.FE.KEYCODE.META||e.which==$.FE.KEYCODE.CTRL))return!0;if(e&&isArrow(e.which))return!0;if(e&&!editor.helpers.isIOS()&&(e.which==$.FE.KEYCODE.ENTER||e.which==$.FE.KEYCODE.BACKSPACE||e.which>=37&&e.which<=40&&!editor.browser.msie))try{positionCaret()}catch(ex){}_removeInvisible()}function ctrlKey(e){if(-1!=navigator.userAgent.indexOf("Mac OS X")){if(e.metaKey&&!e.altKey)return!0}else if(e.ctrlKey&&!e.altKey)return!0;return!1}function isArrow(key_code){if(key_code>=$.FE.KEYCODE.ARROW_LEFT&&key_code<=$.FE.KEYCODE.ARROW_DOWN)return!0}function isCharacter(key_code){if(key_code>=$.FE.KEYCODE.ZERO&&key_code<=$.FE.KEYCODE.NINE)return!0;if(key_code>=$.FE.KEYCODE.NUM_ZERO&&key_code<=$.FE.KEYCODE.NUM_MULTIPLY)return!0;if(key_code>=$.FE.KEYCODE.A&&key_code<=$.FE.KEYCODE.Z)return!0;if(editor.browser.webkit&&0===key_code)return!0;switch(key_code){case $.FE.KEYCODE.SPACE:case $.FE.KEYCODE.QUESTION_MARK:case $.FE.KEYCODE.NUM_PLUS:case $.FE.KEYCODE.NUM_MINUS:case $.FE.KEYCODE.NUM_PERIOD:case $.FE.KEYCODE.NUM_DIVISION:case $.FE.KEYCODE.SEMICOLON:case $.FE.KEYCODE.FF_SEMICOLON:case $.FE.KEYCODE.DASH:case $.FE.KEYCODE.EQUALS:case $.FE.KEYCODE.FF_EQUALS:case $.FE.KEYCODE.COMMA:case $.FE.KEYCODE.PERIOD:case $.FE.KEYCODE.SLASH:case $.FE.KEYCODE.APOSTROPHE:case $.FE.KEYCODE.SINGLE_QUOTE:case $.FE.KEYCODE.OPEN_SQUARE_BRACKET:case $.FE.KEYCODE.BACKSLASH:case $.FE.KEYCODE.CLOSE_SQUARE_BRACKET:return!0;default:return!1}}function _typingKeyDown(e){var keycode=e.which;if(ctrlKey(e)||keycode>=37&&keycode<=40||!isCharacter(keycode)&&keycode!=$.FE.KEYCODE.DELETE&&keycode!=$.FE.KEYCODE.BACKSPACE&&keycode!=$.FE.KEYCODE.ENTER&&keycode!=$.FE.KEYCODE.IME)return!0;_typing_timeout||(_temp_snapshot=editor.snapshot.get(),editor.undo.canDo()||editor.undo.saveStep()),clearTimeout(_typing_timeout),_typing_timeout=setTimeout((function(){_typing_timeout=null,editor.undo.saveStep()}),Math.max(250,editor.opts.typingTimer))}function _typingKeyUp(e){var keycode=e.which;if(ctrlKey(e)||keycode>=37&&keycode<=40)return!0;_temp_snapshot&&_typing_timeout?(editor.undo.saveStep(_temp_snapshot),_temp_snapshot=null):void 0!==keycode&&0!==keycode||_temp_snapshot||_typing_timeout||editor.undo.saveStep()}function _isEmpty(node){if(node&&"BR"==node.tagName)return!1;try{return 0===(node.textContent||"").length&&node.querySelector&&!node.querySelector(":scope > br")||node.childNodes&&1==node.childNodes.length&&node.childNodes[0].getAttribute&&("false"==node.childNodes[0].getAttribute("contenteditable")||editor.node.hasClass(node.childNodes[0],"fr-img-caption"))}catch(ex){return!1}}function _allowTypingOnEdges(e){var childs=editor.el.childNodes,dt=editor.html.defaultTag();return!(!e.target||e.target===editor.el)||(0===childs.length||void(editor.$el.outerHeight()-e.offsetY<=10?_isEmpty(childs[childs.length-1])&&(dt?editor.$el.append("<"+dt+">"+$.FE.MARKERS+"<br></"+dt+">"):editor.$el.append($.FE.MARKERS+"<br>"),editor.selection.restore(),positionCaret()):e.offsetY<=10&&_isEmpty(childs[0])&&(dt?editor.$el.prepend("<"+dt+">"+$.FE.MARKERS+"<br></"+dt+">"):editor.$el.prepend($.FE.MARKERS+"<br>"),editor.selection.restore(),positionCaret())))}function _clearTypingTimer(){_typing_timeout&&clearTimeout(_typing_timeout)}return{_init:function(){editor.events.on("keydown",_typingKeyDown),editor.events.on("input",_input),editor.events.on("mousedown",_clearIME),editor.events.on("keyup input",_typingKeyUp),editor.events.on("keypress",_mapKeyPress),editor.events.on("keydown",_mapKeyDown),editor.events.on("keyup",_mapKeyUp),editor.events.on("destroy",_clearTypingTimer),editor.events.on("html.inserted",_mapKeyUp),editor.events.on("cut",_cut),editor.opts.multiLine&&editor.events.on("click",_allowTypingOnEdges)},ctrlKey:ctrlKey,isCharacter:isCharacter,isArrow:isArrow,forceUndo:function(){_typing_timeout&&(clearTimeout(_typing_timeout),editor.undo.saveStep(),_temp_snapshot=null)},isIME:function(){return IME},isBrowserAction:function(e){var keycode=e.which;return ctrlKey(e)||keycode==$.FE.KEYCODE.F5},positionCaret:positionCaret}}}(jQuery),function($){$.FE.MODULES.accessibility=function(editor){var can_blur=!0;function focusToolbarElement($el){$el&&$el.length&&!editor.$el.find('[contenteditable="true"]').is(":focus")&&($el.data("blur-event-set")||$el.parents(".fr-popup").length||(editor.events.$on($el,"blur",(function(){var inst=$el.parents(".fr-toolbar, .fr-popup").data("instance")||editor;inst.events.blurActive()&&!editor.core.hasFocus()&&inst.events.trigger("blur"),setTimeout((function(){inst.events.enableBlur()}),100)}),!0),$el.data("blur-event-set",!0)),($el.parents(".fr-toolbar, .fr-popup").data("instance")||editor).events.disableBlur(),$el.focus(),editor.shared.$f_el=$el)}function focusToolbar($tb,last){var position=last?"last":"first",$btn=$tb.find("button:visible:not(.fr-disabled), .fr-group span.fr-command:visible")[position]();if($btn.length)return focusToolbarElement($btn),!0}function focusContentElement($el){return $el.is("input, textarea, select")&&saveSelection(),editor.events.disableBlur(),$el.focus(),!0}function focusContent($content,backward){var $first_input=$content.find("input, textarea, button, select").filter(":visible").not(":disabled").filter(backward?":last":":first");if($first_input.length)return focusContentElement($first_input);if(editor.shared.with_kb){var $active_item=$content.find(".fr-active-item:visible:first");if($active_item.length)return focusContentElement($active_item);var $first_tab_index=$content.find("[tabIndex]:visible:first");if($first_tab_index.length)return focusContentElement($first_tab_index)}}function saveSelection(){0===editor.$el.find(".fr-marker").length&&editor.core.hasFocus()&&editor.selection.save()}function focusToolbars(){var $popup=editor.popups.areVisible();if($popup){var $tb=$popup.find(".fr-buttons");return $tb.find("button:focus, .fr-group span:focus").length?!focusToolbar($popup.data("instance").$tb):!focusToolbar($tb)}return!focusToolbar(editor.$tb)}function _getActiveFocusedDropdown(){var $activeDropdown=null;return editor.shared.$f_el.is(".fr-dropdown.fr-active")?$activeDropdown=editor.shared.$f_el:editor.shared.$f_el.closest(".fr-dropdown-menu").prev().is(".fr-dropdown.fr-active")&&($activeDropdown=editor.shared.$f_el.closest(".fr-dropdown-menu").prev()),$activeDropdown}function _moveHorizontally($tb,tab_key,forward){if(editor.shared.$f_el){var $activeDropdown=_getActiveFocusedDropdown();$activeDropdown&&(editor.button.click($activeDropdown),editor.shared.$f_el=$activeDropdown);var $buttons=$tb.find("button:visible:not(.fr-disabled), .fr-group span.fr-command:visible"),index=$buttons.index(editor.shared.$f_el);if(0===index&&!forward||index==$buttons.length-1&&forward){var status;if(tab_key){if($tb.parent().is(".fr-popup"))status=!focusContent($tb.parent().children().not(".fr-buttons"),!forward);!1===status&&(editor.shared.$f_el=null)}tab_key&&!1===status||focusToolbar($tb,!forward)}else focusToolbarElement($($buttons.get(index+(forward?1:-1))));return!1}}function moveForward($tb,tab_key){return _moveHorizontally($tb,tab_key,!0)}function moveBackward($tb,tab_key){return _moveHorizontally($tb,tab_key)}function _moveVertically(down){if(editor.shared.$f_el){var $destination;if(editor.shared.$f_el.is(".fr-dropdown.fr-active"))return focusToolbarElement($destination=down?editor.shared.$f_el.next().find(".fr-command:not(.fr-disabled)").first():editor.shared.$f_el.next().find(".fr-command:not(.fr-disabled)").last()),!1;if(editor.shared.$f_el.is("a.fr-command"))return($destination=down?editor.shared.$f_el.closest("li").nextAll(":visible:first").find(".fr-command:not(.fr-disabled)").first():editor.shared.$f_el.closest("li").prevAll(":visible:first").find(".fr-command:not(.fr-disabled)").first()).length||($destination=down?editor.shared.$f_el.closest(".fr-dropdown-menu").find(".fr-command:not(.fr-disabled)").first():editor.shared.$f_el.closest(".fr-dropdown-menu").find(".fr-command:not(.fr-disabled)").last()),focusToolbarElement($destination),!1}}function enter(){if(editor.shared.$f_el){if(editor.shared.$f_el.hasClass("fr-dropdown"))editor.button.click(editor.shared.$f_el);else if(editor.shared.$f_el.is("button.fr-back")){editor.opts.toolbarInline&&(editor.events.disableBlur(),editor.events.focus());var $popup=editor.popups.areVisible(editor);$popup&&(editor.shared.with_kb=!1),editor.button.click(editor.shared.$f_el),focusPopupButton($popup)}else{if(editor.events.disableBlur(),editor.button.click(editor.shared.$f_el),editor.shared.$f_el.attr("data-popup")){var $visible_popup=editor.popups.areVisible(editor);$visible_popup&&$visible_popup.data("popup-button",editor.shared.$f_el)}else if(editor.shared.$f_el.attr("data-modal")){var $visible_modal=editor.modals.areVisible(editor);$visible_modal&&$visible_modal.data("modal-button",editor.shared.$f_el)}editor.shared.$f_el=null}return!1}}function focusEditor(){editor.shared.$f_el&&(editor.events.disableBlur(),editor.shared.$f_el.blur(),editor.shared.$f_el=null),!1!==editor.events.trigger("toolbar.focusEditor")&&(editor.events.disableBlur(),editor.browser.msie||editor.$el.focus(),editor.events.focus())}function registerToolbar($tb){$tb&&$tb.length&&(editor.events.$on($tb,"keydown",(function(e){if(!$(e.target).is("a.fr-command, button.fr-command, .fr-group span.fr-command"))return!0;var inst=$tb.parents(".fr-popup").data("instance")||$tb.data("instance")||editor;editor.shared.with_kb=!0;var status=inst.accessibility.exec(e,$tb);return editor.shared.with_kb=!1,status}),!0),editor.browser.msie||editor.events.$on($tb,"mouseenter","[tabIndex]",(function(e){var inst=$tb.parents(".fr-popup").data("instance")||$tb.data("instance")||editor;if(!can_blur)return e.stopPropagation(),void e.preventDefault();var $hovered_el=$(e.currentTarget);inst.shared.$f_el&&inst.shared.$f_el.not($hovered_el)&&inst.accessibility.focusEditor()}),!0))}function focusPopupButton($popup){var $popup_button=$popup.data("popup-button");$popup_button&&setTimeout((function(){focusToolbarElement($popup_button),$popup.data("popup-button",null)}),0)}function _clearPopupButton(inst){var $visible_popup=editor.popups.areVisible(inst);$visible_popup&&$visible_popup.data("popup-button",null)}function _editorKeydownHandler(e){var ctrlKey=-1!=navigator.userAgent.indexOf("Mac OS X")?e.metaKey:e.ctrlKey;if(e.which==$.FE.KEYCODE.F10&&!ctrlKey&&!e.shiftKey&&e.altKey){editor.shared.with_kb=!0;var $visible_popup=editor.popups.areVisible(editor),focused_content=!1;return $visible_popup&&(focused_content=focusContent($visible_popup.children().not(".fr-buttons"))),focused_content||focusToolbars(),editor.shared.with_kb=!1,e.preventDefault(),e.stopPropagation(),!1}return!0}return{_init:function(){editor.$wp?editor.events.on("keydown",_editorKeydownHandler,!0):editor.events.$on(editor.$win,"keydown",_editorKeydownHandler,!0),editor.events.on("mousedown",(function(e){_clearPopupButton(editor),editor.shared.$f_el&&(editor.accessibility.restoreSelection(),e.stopPropagation(),editor.events.disableBlur(),editor.shared.$f_el=null)}),!0),editor.events.on("blur",(function(){editor.shared.$f_el=null,_clearPopupButton(editor)}),!0)},registerPopup:function(id){var $popup=editor.popups.get(id),ev=function(id){var $popup=editor.popups.get(id);return{_tiKeydown:function(e){var inst=$popup.data("instance")||editor;if(!1===inst.events.trigger("popup.tab",[e]))return!1;var key_code=e.which,$focused_item=$popup.find(":focus:first");if($.FE.KEYCODE.TAB==key_code){e.preventDefault();var $popup_content=$popup.children().not(".fr-buttons"),inputs=$popup_content.find("input, textarea, button, select").filter(":visible").not(".fr-no-touch input, .fr-no-touch textarea, .fr-no-touch button, .fr-no-touch select, :disabled").toArray(),idx=inputs.indexOf(this)+(e.shiftKey?-1:1);if(0<=idx&&idx<inputs.length)return inst.events.disableBlur(),$(inputs[idx]).focus(),e.stopPropagation(),!1;var $tb=$popup.find(".fr-buttons");if($tb.length&&focusToolbar($tb,!!e.shiftKey))return e.stopPropagation(),!1;if(focusContent($popup_content))return e.stopPropagation(),!1}else{if($.FE.KEYCODE.ENTER!=key_code||!e.target||"TEXTAREA"===e.target.tagName)return $.FE.KEYCODE.ESC==key_code?(e.preventDefault(),e.stopPropagation(),inst.accessibility.restoreSelection(),inst.popups.isVisible(id)&&$popup.find(".fr-back:visible").length?(inst.opts.toolbarInline&&(inst.events.disableBlur(),inst.events.focus()),inst.button.exec($popup.find(".fr-back:visible:first")),focusPopupButton($popup)):inst.popups.isVisible(id)&&$popup.find(".fr-dismiss:visible").length?inst.button.exec($popup.find(".fr-dismiss:visible:first")):(inst.popups.hide(id),inst.opts.toolbarInline&&inst.toolbar.showInline(null,!0),focusPopupButton($popup)),!1):$.FE.KEYCODE.SPACE==key_code&&($focused_item.is(".fr-submit")||$focused_item.is(".fr-dismiss"))?(e.preventDefault(),e.stopPropagation(),inst.events.disableBlur(),inst.button.exec($focused_item),!0):inst.keys.isBrowserAction(e)||$focused_item.is("input[type=text], textarea")||$.FE.KEYCODE.SPACE==key_code&&($focused_item.is(".fr-link-attr")||$focused_item.is("input[type=file]"))?void e.stopPropagation():(e.stopPropagation(),e.preventDefault(),!1);var $active_button=null;$popup.find(".fr-submit:visible").length>0?$active_button=$popup.find(".fr-submit:visible:first"):$popup.find(".fr-dismiss:visible").length&&($active_button=$popup.find(".fr-dismiss:visible:first")),$active_button&&(e.preventDefault(),e.stopPropagation(),inst.events.disableBlur(),inst.button.exec($active_button))}},_tiMouseenter:function(){_clearPopupButton($popup.data("instance")||editor)}}}(id);registerToolbar($popup.find(".fr-buttons")),editor.events.$on($popup,"mouseenter","tabIndex",ev._tiMouseenter,!0),editor.events.$on($popup.children().not(".fr-buttons"),"keydown","[tabIndex]",ev._tiKeydown,!0),editor.popups.onHide(id,(function(){($popup.data("instance")||editor).accessibility.restoreSelection()})),editor.popups.onShow(id,(function(){can_blur=!1,setTimeout((function(){can_blur=!0}),0)}))},registerToolbar:registerToolbar,focusToolbarElement:focusToolbarElement,focusToolbar:focusToolbar,focusContent:focusContent,focusPopup:function($popup){var $popup_content=$popup.children().not(".fr-buttons");$popup_content.data("mouseenter-event-set")||editor.browser.msie||(editor.events.$on($popup_content,"mouseenter","[tabIndex]",(function(e){var inst=$popup.data("instance")||editor;if(!can_blur)return e.stopPropagation(),void e.preventDefault();var $focused_item=$popup_content.find(":focus:first");$focused_item.length&&!$focused_item.is("input, button, textarea, select")&&(inst.events.disableBlur(),$focused_item.blur(),inst.events.disableBlur(),inst.events.focus())})),$popup_content.data("mouseenter-event-set",!0)),!focusContent($popup_content)&&editor.shared.with_kb&&focusToolbar($popup.find(".fr-buttons"))},focusModal:function($modal){editor.core.hasFocus()||(editor.events.disableBlur(),editor.events.focus()),editor.accessibility.saveSelection(),editor.events.disableBlur(),editor.$el.blur(),editor.selection.clear(),editor.events.disableBlur(),editor.shared.with_kb?$modal.find(".fr-command[tabIndex], [tabIndex]").first().focus():$modal.find("[tabIndex]:first").focus()},focusEditor:focusEditor,focusPopupButton:focusPopupButton,focusModalButton:function($modal){var $modal_button=$modal.data("modal-button");$modal_button&&setTimeout((function(){focusToolbarElement($modal_button),$modal.data("modal-button",null)}),0)},hasFocus:function(){return null!=editor.shared.$f_el},exec:function(e,$tb){var ctrlKey=-1!=navigator.userAgent.indexOf("Mac OS X")?e.metaKey:e.ctrlKey,keycode=e.which,status=!1;return keycode!=$.FE.KEYCODE.TAB||ctrlKey||e.shiftKey||e.altKey?keycode!=$.FE.KEYCODE.ARROW_RIGHT||ctrlKey||e.shiftKey||e.altKey?keycode!=$.FE.KEYCODE.TAB||ctrlKey||!e.shiftKey||e.altKey?keycode!=$.FE.KEYCODE.ARROW_LEFT||ctrlKey||e.shiftKey||e.altKey?keycode!=$.FE.KEYCODE.ARROW_UP||ctrlKey||e.shiftKey||e.altKey?keycode!=$.FE.KEYCODE.ARROW_DOWN||ctrlKey||e.shiftKey||e.altKey?keycode!=$.FE.KEYCODE.ENTER&&keycode!=$.FE.KEYCODE.SPACE||ctrlKey||e.shiftKey||e.altKey?keycode!=$.FE.KEYCODE.ESC||ctrlKey||e.shiftKey||e.altKey?keycode!=$.FE.KEYCODE.F10||ctrlKey||e.shiftKey||!e.altKey||(status=focusToolbars()):status=function($tb){if(editor.shared.$f_el){var $activeDropdown=_getActiveFocusedDropdown();return $activeDropdown?(editor.button.click($activeDropdown),focusToolbarElement($activeDropdown)):$tb.parent().find(".fr-back:visible").length?(editor.shared.with_kb=!1,editor.opts.toolbarInline&&(editor.events.disableBlur(),editor.events.focus()),editor.button.exec($tb.parent().find(".fr-back:visible:first")),focusPopupButton($tb.parent())):editor.shared.$f_el.is("button, .fr-group span")&&($tb.parent().is(".fr-popup")?(editor.accessibility.restoreSelection(),editor.shared.$f_el=null,!1!==editor.events.trigger("toolbar.esc")&&(editor.popups.hide($tb.parent()),editor.opts.toolbarInline&&editor.toolbar.showInline(null,!0),focusPopupButton($tb.parent()))):focusEditor()),!1}}($tb):status=enter():status=editor.shared.$f_el&&editor.shared.$f_el.is(".fr-dropdown:not(.fr-active)")?enter():_moveVertically(!0):status=_moveVertically():status=moveBackward($tb):status=moveBackward($tb,!0):status=moveForward($tb):status=moveForward($tb,!0),editor.shared.$f_el||void 0!==status||(status=!0),!status&&editor.keys.isBrowserAction(e)&&(status=!0),!!status||(e.preventDefault(),e.stopPropagation(),!1)},saveSelection:saveSelection,restoreSelection:function(){editor.$el.find(".fr-marker").length&&(editor.events.disableBlur(),editor.selection.restore(),editor.events.enableBlur())}}}}(jQuery),function($){$.FE.MODULES.format=function(editor){function _openTag(tag,attrs){var str="<"+tag;for(var key in attrs)attrs.hasOwnProperty(key)&&(str+=" "+key+'="'+attrs[key]+'"');return str+=">"}function _query(tag,attrs){var selector=tag;for(var key in attrs)attrs.hasOwnProperty(key)&&(selector+="id"==key?"#"+attrs[key]:"class"==key?"."+attrs[key]:"["+key+'="'+attrs[key]+'"]');return selector}function _matches(el,selector){return!(!el||el.nodeType!=Node.ELEMENT_NODE)&&(el.matches||el.matchesSelector||el.msMatchesSelector||el.mozMatchesSelector||el.webkitMatchesSelector||el.oMatchesSelector).call(el,selector)}function _processNodeFormat(start_node,tag,attrs){if(start_node){for(;start_node.nodeType===Node.COMMENT_NODE;)start_node=start_node.nextSibling;if(start_node){if(editor.node.isBlock(start_node)&&"HR"!==start_node.tagName)return _processNodeFormat(start_node.firstChild,tag,attrs),!1;for(var $span=$(_openTag(tag,attrs)).insertBefore(start_node),node=start_node;node&&!$(node).is(".fr-marker")&&0===$(node).find(".fr-marker").length&&"UL"!=node.tagName&&"OL"!=node.tagName;){var tmp=node;if(editor.node.isBlock(node)&&"HR"!==start_node.tagName)return _processNodeFormat(node.firstChild,tag,attrs),!1;node=node.nextSibling,$span.append(tmp)}if(node)($(node).find(".fr-marker").length||"UL"==node.tagName||"OL"==node.tagName)&&_processNodeFormat(node.firstChild,tag,attrs);else{for(var p_node=$span.get(0).parentNode;p_node&&!p_node.nextSibling&&!editor.node.isElement(p_node);)p_node=p_node.parentNode;if(p_node){var sibling=p_node.nextSibling;sibling&&(editor.node.isBlock(sibling)?"HR"===sibling.tagName?_processNodeFormat(sibling.nextSibling,tag,attrs):_processNodeFormat(sibling.firstChild,tag,attrs):_processNodeFormat(sibling,tag,attrs))}}$span.is(":empty")&&$span.remove()}}}function apply(tag,attrs){var i;if(void 0===attrs&&(attrs={}),attrs.style&&delete attrs.style,editor.selection.isCollapsed()){editor.markers.insert(),editor.$el.find(".fr-marker").replaceWith(_openTag(tag,attrs)+$.FE.INVISIBLE_SPACE+$.FE.MARKERS+function(tag){return"</"+tag+">"}(tag)),editor.selection.restore()}else{var inner_spans;editor.selection.save(),_processNodeFormat(editor.$el.find('.fr-marker[data-type="true"]').get(0).nextSibling,tag,attrs);do{for(inner_spans=editor.$el.find(_query(tag,attrs)+" > "+_query(tag,attrs)),i=0;i<inner_spans.length;i++)inner_spans[i].outerHTML=inner_spans[i].innerHTML}while(inner_spans.length);editor.el.normalize();var markers=editor.el.querySelectorAll(".fr-marker");for(i=0;i<markers.length;i++){var $mk=$(markers[i]);!0===$mk.data("type")?_matches($mk.get(0).nextSibling,_query(tag,attrs))&&$mk.next().prepend($mk):_matches($mk.get(0).previousSibling,_query(tag,attrs))&&$mk.prev().append($mk)}editor.selection.restore()}}function _split($node,tag,attrs,collapsed){if(!collapsed){var changed=!1;if(!0===$node.data("type"))for(;editor.node.isFirstSibling($node.get(0))&&!$node.parent().is(editor.$el)&&!$node.parent().is("ol")&&!$node.parent().is("ul");)$node.parent().before($node),changed=!0;else if(!1===$node.data("type"))for(;editor.node.isLastSibling($node.get(0))&&!$node.parent().is(editor.$el)&&!$node.parent().is("ol")&&!$node.parent().is("ul");)$node.parent().after($node),changed=!0;if(changed)return!0}if($node.parents(tag).length||void 0===tag){var close_str="",open_str="",$p_node=$node.parent();if($p_node.is(editor.$el)||editor.node.isBlock($p_node.get(0)))return!1;for(;!editor.node.isBlock($p_node.parent().get(0))&&(void 0===tag||void 0!==tag&&!_matches($p_node.get(0),_query(tag,attrs)));)close_str+=editor.node.closeTagString($p_node.get(0)),open_str=editor.node.openTagString($p_node.get(0))+open_str,$p_node=$p_node.parent();var node_str=$node.get(0).outerHTML;$node.replaceWith('<span id="mark"></span>');var p_html=$p_node.html().replace(/<span id="mark"><\/span>/,close_str+editor.node.closeTagString($p_node.get(0))+open_str+node_str+close_str+editor.node.openTagString($p_node.get(0))+open_str);return $p_node.replaceWith(editor.node.openTagString($p_node.get(0))+p_html+editor.node.closeTagString($p_node.get(0))),!0}return!1}function _processNodeRemove($node,should_remove,tag,attrs){for(var contents=editor.node.contents($node.get(0)),i=0;i<contents.length;i++){var node=contents[i];if(editor.node.hasClass(node,"fr-marker"))should_remove=(should_remove+1)%2;else if(should_remove)if($(node).find(".fr-marker").length>0)should_remove=_processNodeRemove($(node),should_remove,tag,attrs);else{for(var nodes=$(node).find(tag||"*:not(br)"),j=nodes.length-1;j>=0;j--){var nd=nodes[j];editor.node.isBlock(nd)||editor.node.isVoid(nd)||void 0!==tag&&!_matches(nd,_query(tag,attrs))?editor.node.isBlock(nd)&&void 0===tag&&"TABLE"!=node.tagName&&editor.node.clearAttributes(nd):editor.node.hasClass(nd,"fr-clone")||(nd.outerHTML=nd.innerHTML)}void 0===tag&&node.nodeType==Node.ELEMENT_NODE&&!editor.node.isVoid(node)||_matches(node,_query(tag,attrs))?editor.node.isBlock(node)?void 0===tag&&node.nodeType==Node.ELEMENT_NODE&&editor.node.isBlock(node)&&"TABLE"!=node.tagName&&editor.node.clearAttributes(node):editor.node.hasClass(node,"fr-clone")||(node.outerHTML=node.innerHTML):void 0===tag&&node.nodeType==Node.ELEMENT_NODE&&editor.node.isBlock(node)&&"TABLE"!=node.tagName&&editor.node.clearAttributes(node)}else $(node).find(".fr-marker").length>0&&(should_remove=_processNodeRemove($(node),should_remove,tag,attrs))}return should_remove}function remove(tag,attrs){void 0===attrs&&(attrs={}),attrs.style&&delete attrs.style;var collapsed=editor.selection.isCollapsed();editor.selection.save();for(var reassess=!0;reassess;){reassess=!1;for(var markers=editor.$el.find(".fr-marker"),i=0;i<markers.length;i++){var $marker=$(markers[i]),$clone=null;if($marker.attr("data-cloned")||collapsed||($clone=$marker.clone().removeClass("fr-marker").addClass("fr-clone"),!0===$marker.data("type")?$marker.attr("data-cloned",!0).after($clone):$marker.attr("data-cloned",!0).before($clone)),_split($marker,tag,attrs,collapsed)){reassess=!0;break}}}_processNodeRemove(editor.$el,0,tag,attrs),collapsed||(editor.$el.find(".fr-marker").remove(),editor.$el.find(".fr-clone").removeClass("fr-clone").addClass("fr-marker")),collapsed&&editor.$el.find(".fr-marker").before($.FE.INVISIBLE_SPACE).after($.FE.INVISIBLE_SPACE),editor.html.cleanEmptyTags(),editor.el.normalize(),editor.selection.restore()}function _cleanFormat(elem,prop){var $elem=$(elem);$elem.css(prop,""),""===$elem.attr("style")&&$elem.replaceWith($elem.html())}function _filterSpans(elem,prop){return 0===$(elem).attr("style").indexOf(prop+":")||$(elem).attr("style").indexOf(";"+prop+":")>=0||$(elem).attr("style").indexOf("; "+prop+":")>=0}function applyStyle(prop,val){var i,$marker,$span=null;if(editor.selection.isCollapsed()){editor.markers.insert();var $parent=($marker=editor.$el.find(".fr-marker")).parent();if(editor.node.openTagString($parent.get(0))=='<span style="'+prop+": "+$parent.css(prop)+';">'){if(editor.node.isEmpty($parent.get(0)))$span=$('<span style="'+prop+": "+val+';">'+$.FE.INVISIBLE_SPACE+$.FE.MARKERS+"</span>"),$parent.replaceWith($span);else{var x={};x["style*"]=prop+":",_split($marker,"span",x,!0),$marker=editor.$el.find(".fr-marker"),val?($span=$('<span style="'+prop+": "+val+';">'+$.FE.INVISIBLE_SPACE+$.FE.MARKERS+"</span>"),$marker.replaceWith($span)):$marker.replaceWith($.FE.INVISIBLE_SPACE+$.FE.MARKERS)}editor.html.cleanEmptyTags()}else editor.node.isEmpty($parent.get(0))&&$parent.is("span")?($marker.replaceWith($.FE.MARKERS),$parent.css(prop,val)):($span=$('<span style="'+prop+": "+val+';">'+$.FE.INVISIBLE_SPACE+$.FE.MARKERS+"</span>"),$marker.replaceWith($span));$span&&_splitParents($span,prop,val)}else{if(editor.selection.save(),null==val||"color"==prop&&editor.$el.find(".fr-marker").parents("u, a").length>0){var markers=editor.$el.find(".fr-marker");for(i=0;i<markers.length;i++)if(!0===($marker=$(markers[i])).data("type"))for(;editor.node.isFirstSibling($marker.get(0))&&!$marker.parent().is(editor.$el)&&!editor.node.isElement($marker.parent().get(0))&&!editor.node.isBlock($marker.parent().get(0));)$marker.parent().before($marker);else for(;editor.node.isLastSibling($marker.get(0))&&!$marker.parent().is(editor.$el)&&!editor.node.isElement($marker.parent().get(0))&&!editor.node.isBlock($marker.parent().get(0));)$marker.parent().after($marker)}var start_marker=editor.$el.find('.fr-marker[data-type="true"]').get(0).nextSibling,attrs={class:"fr-unprocessed"};for(val&&(attrs.style=prop+": "+val+";"),_processNodeFormat(start_marker,"span",attrs),editor.$el.find(".fr-marker + .fr-unprocessed").each((function(){$(this).prepend($(this).prev())})),editor.$el.find(".fr-unprocessed + .fr-marker").each((function(){$(this).prev().append(this)})),(val||"").match(/\dem$/)&&editor.$el.find("span.fr-unprocessed").removeClass("fr-unprocessed");editor.$el.find("span.fr-unprocessed").length>0;){if(($span=editor.$el.find("span.fr-unprocessed:first").removeClass("fr-unprocessed")).parent().get(0).normalize(),$span.parent().is("span")&&1==$span.parent().get(0).childNodes.length){$span.parent().css(prop,val);var $child=$span;$span=$span.parent(),$child.replaceWith($child.html())}var inner_spans=$span.find("span");for(i=inner_spans.length-1;i>=0;i--)_cleanFormat(inner_spans[i],prop);_splitParents($span,prop,val)}}!function(){var i;for(;editor.$el.find(".fr-split:empty").length>0;)editor.$el.find(".fr-split:empty").remove();editor.$el.find(".fr-split").removeClass("fr-split"),editor.$el.find('[style=""]').removeAttr("style"),editor.$el.find('[class=""]').removeAttr("class"),editor.html.cleanEmptyTags(),$(editor.$el.find("span").get().reverse()).each((function(){this.attributes&&0!==this.attributes.length||$(this).replaceWith(this.innerHTML)})),editor.el.normalize();var just_spans=editor.$el.find("span[style] + span[style]");for(i=0;i<just_spans.length;i++){var $x=$(just_spans[i]),$p=$(just_spans[i]).prev();$x.get(0).previousSibling==$p.get(0)&&editor.node.openTagString($x.get(0))==editor.node.openTagString($p.get(0))&&($x.prepend($p.html()),$p.remove())}editor.$el.find("span[style] span[style]").each((function(){if($(this).attr("style").indexOf("font-size")>=0){var $parent=$(this).parents("span[style]");$parent.attr("style").indexOf("background-color")>=0&&($(this).attr("style",$(this).attr("style")+";"+$parent.attr("style")),_split($(this),"span[style]",{},!1))}})),editor.el.normalize(),editor.selection.restore()}()}function _splitParents($span,prop,val){var i,$outer_span=$span.parentsUntil(editor.$el,"span[style]"),to_remove=[];for(i=$outer_span.length-1;i>=0;i--)_filterSpans($outer_span[i],prop)||to_remove.push($outer_span[i]);if(($outer_span=$outer_span.not(to_remove)).length){var c_str="",o_str="",ic_str="",io_str="",c_node=$span.get(0);do{c_node=c_node.parentNode,$(c_node).addClass("fr-split"),c_str+=editor.node.closeTagString(c_node),o_str=editor.node.openTagString($(c_node).clone().addClass("fr-split").get(0))+o_str,$outer_span.get(0)!=c_node&&(ic_str+=editor.node.closeTagString(c_node),io_str=editor.node.openTagString($(c_node).clone().addClass("fr-split").get(0))+io_str)}while($outer_span.get(0)!=c_node);var str=c_str+editor.node.openTagString($($outer_span.get(0)).clone().css(prop,val||"").get(0))+io_str+$span.css(prop,"").get(0).outerHTML+ic_str+"</span>"+o_str;$span.replaceWith('<span id="fr-break"></span>');var html=$outer_span.get(0).outerHTML;$($outer_span.get(0)).replaceWith(html.replace(/<span id="fr-break"><\/span>/g,str))}}function is(tag,attrs){void 0===attrs&&(attrs={}),attrs.style&&delete attrs.style;var range=editor.selection.ranges(0),el=range.startContainer;if(el.nodeType==Node.ELEMENT_NODE&&el.childNodes.length>0&&el.childNodes[range.startOffset]&&(el=el.childNodes[range.startOffset]),!range.collapsed&&el.nodeType==Node.TEXT_NODE&&range.startOffset==(el.textContent||"").length){for(;!editor.node.isBlock(el.parentNode)&&!el.nextSibling;)el=el.parentNode;el.nextSibling&&(el=el.nextSibling)}for(var f_child=el;f_child&&f_child.nodeType==Node.ELEMENT_NODE&&!_matches(f_child,_query(tag,attrs));)f_child=f_child.firstChild;if(f_child&&f_child.nodeType==Node.ELEMENT_NODE&&_matches(f_child,_query(tag,attrs)))return!0;var p_node=el;for(p_node&&p_node.nodeType!=Node.ELEMENT_NODE&&(p_node=p_node.parentNode);p_node&&p_node.nodeType==Node.ELEMENT_NODE&&p_node!=editor.el&&!_matches(p_node,_query(tag,attrs));)p_node=p_node.parentNode;return!(!p_node||p_node.nodeType!=Node.ELEMENT_NODE||p_node==editor.el||!_matches(p_node,_query(tag,attrs)))}return{is:is,toggle:function(tag,attrs){is(tag,attrs)?remove(tag,attrs):apply(tag,attrs)},apply:apply,remove:remove,applyStyle:applyStyle,removeStyle:function(prop){applyStyle(prop,null)}}}}(jQuery),function($){$.extend($.FE.DEFAULTS,{indentMargin:20}),$.FE.COMMANDS={bold:{title:"Bold",toggle:!0,refresh:function($btn){var format=this.format.is("strong");$btn.toggleClass("fr-active",format).attr("aria-pressed",format)}},italic:{title:"Italic",toggle:!0,refresh:function($btn){var format=this.format.is("em");$btn.toggleClass("fr-active",format).attr("aria-pressed",format)}},underline:{title:"Underline",toggle:!0,refresh:function($btn){var format=this.format.is("u");$btn.toggleClass("fr-active",format).attr("aria-pressed",format)}},strikeThrough:{title:"Strikethrough",toggle:!0,refresh:function($btn){var format=this.format.is("s");$btn.toggleClass("fr-active",format).attr("aria-pressed",format)}},subscript:{title:"Subscript",toggle:!0,refresh:function($btn){var format=this.format.is("sub");$btn.toggleClass("fr-active",format).attr("aria-pressed",format)}},superscript:{title:"Superscript",toggle:!0,refresh:function($btn){var format=this.format.is("sup");$btn.toggleClass("fr-active",format).attr("aria-pressed",format)}},outdent:{title:"Decrease Indent"},indent:{title:"Increase Indent"},undo:{title:"Undo",undo:!1,forcedRefresh:!0,disabled:!0},redo:{title:"Redo",undo:!1,forcedRefresh:!0,disabled:!0},insertHR:{title:"Insert Horizontal Line"},clearFormatting:{title:"Clear Formatting"},selectAll:{title:"Select All",undo:!1}},$.FE.RegisterCommand=function(name,info){$.FE.COMMANDS[name]=info},$.FE.MODULES.commands=function(editor){function _createDefaultTag(empty){return editor.html.defaultTag()&&(empty="<"+editor.html.defaultTag()+">"+empty+"</"+editor.html.defaultTag()+">"),empty}var mapping={bold:function(){_execCommand("bold","strong")},subscript:function(){editor.format.is("sup")&&editor.format.remove("sup"),_execCommand("subscript","sub")},superscript:function(){editor.format.is("sub")&&editor.format.remove("sub"),_execCommand("superscript","sup")},italic:function(){_execCommand("italic","em")},strikeThrough:function(){_execCommand("strikeThrough","s")},underline:function(){_execCommand("underline","u")},undo:function(){editor.undo.run()},redo:function(){editor.undo.redo()},indent:function(){_processIndent(1)},outdent:function(){_processIndent(-1)},show:function(){editor.opts.toolbarInline&&editor.toolbar.showInline(null,!0)},insertHR:function(){editor.selection.remove();var empty="";editor.core.isEmpty()&&(empty=_createDefaultTag(empty="<br>")),editor.html.insert('<hr id="fr-just">'+empty);var check,$hr=editor.$el.find("hr#fr-just");if($hr.removeAttr("id"),0===$hr.next().length){var default_tag=editor.html.defaultTag();default_tag?$hr.after($("<"+default_tag+">").append("<br>")):$hr.after("<br>")}$hr.prev().is("hr")?check=editor.selection.setAfter($hr.get(0),!1):$hr.next().is("hr")?check=editor.selection.setBefore($hr.get(0),!1):editor.selection.setAfter($hr.get(0),!1)||editor.selection.setBefore($hr.get(0),!1),check||void 0===check||(empty=_createDefaultTag(empty=$.FE.MARKERS+"<br>"),$hr.after(empty)),editor.selection.restore()},clearFormatting:function(){editor.format.remove()},selectAll:function(){editor.doc.execCommand("selectAll",!1,!1)}};function exec(cmd,params){if(!1!==editor.events.trigger("commands.before",$.merge([cmd],params||[]))){var callback=$.FE.COMMANDS[cmd]&&$.FE.COMMANDS[cmd].callback||mapping[cmd],focus=!0,accessibilityFocus=!1;$.FE.COMMANDS[cmd]&&(void 0!==$.FE.COMMANDS[cmd].focus&&(focus=$.FE.COMMANDS[cmd].focus),void 0!==$.FE.COMMANDS[cmd].accessibilityFocus&&(accessibilityFocus=$.FE.COMMANDS[cmd].accessibilityFocus)),(!editor.core.hasFocus()&&focus&&!editor.popups.areVisible()||!editor.core.hasFocus()&&accessibilityFocus&&editor.accessibility.hasFocus())&&editor.events.focus(!0),$.FE.COMMANDS[cmd]&&!1!==$.FE.COMMANDS[cmd].undo&&(editor.$el.find(".fr-marker").length&&(editor.events.disableBlur(),editor.selection.restore()),editor.undo.saveStep()),callback&&callback.apply(editor,$.merge([cmd],params||[])),editor.events.trigger("commands.after",$.merge([cmd],params||[])),$.FE.COMMANDS[cmd]&&!1!==$.FE.COMMANDS[cmd].undo&&editor.undo.saveStep()}}function _execCommand(cmd,tag){editor.format.toggle(tag)}function _processIndent(indent){editor.selection.save(),editor.html.wrap(!0,!0,!0,!0),editor.selection.restore();for(var blocks=editor.selection.blocks(),i=0;i<blocks.length;i++)if("LI"!=blocks[i].tagName&&"LI"!=blocks[i].parentNode.tagName){var $block=$(blocks[i]),prop="rtl"==editor.opts.direction||"rtl"==$block.css("direction")?"margin-right":"margin-left",margin_left=editor.helpers.getPX($block.css(prop));if($block.width()<2*editor.opts.indentMargin&&indent>0)continue;$block.css(prop,Math.max(margin_left+indent*editor.opts.indentMargin,0)||""),$block.removeClass("fr-temp-div")}editor.selection.save(),editor.html.unwrap(),editor.selection.restore()}function callExec(k){return function(){exec(k)}}var resp={};for(var k in mapping)mapping.hasOwnProperty(k)&&(resp[k]=callExec(k));return $.extend(resp,{exec:exec,_init:function(){editor.events.on("keydown",(function(e){var el=editor.selection.element();if(el&&"HR"==el.tagName&&!editor.keys.isArrow(e.which))return e.preventDefault(),!1})),editor.events.on("keyup",(function(e){var el=editor.selection.element();if(el&&"HR"==el.tagName)if(e.which==$.FE.KEYCODE.ARROW_LEFT||e.which==$.FE.KEYCODE.ARROW_UP){if(el.previousSibling)return editor.node.isBlock(el.previousSibling)?editor.selection.setAtEnd(el.previousSibling):$(el).before($.FE.MARKERS),editor.selection.restore(),!1}else if((e.which==$.FE.KEYCODE.ARROW_RIGHT||e.which==$.FE.KEYCODE.ARROW_DOWN)&&el.nextSibling)return editor.node.isBlock(el.nextSibling)?editor.selection.setAtStart(el.nextSibling):$(el).after($.FE.MARKERS),editor.selection.restore(),!1})),editor.events.on("mousedown",(function(e){if(e.target&&"HR"==e.target.tagName)return e.preventDefault(),e.stopPropagation(),!1})),editor.events.on("mouseup",(function(){var s_el=editor.selection.element();s_el==editor.selection.endElement()&&s_el&&"HR"==s_el.tagName&&(s_el.nextSibling&&(editor.node.isBlock(s_el.nextSibling)?editor.selection.setAtStart(s_el.nextSibling):$(s_el).after($.FE.MARKERS)),editor.selection.restore())}))}})}}(jQuery),function($){$.extend($.FE.DEFAULTS,{pastePlain:!1,pasteDeniedTags:["colgroup","col","meta"],pasteDeniedAttrs:["class","id","style"],pasteAllowedStyleProps:[".*"],pasteAllowLocalImages:!1}),$.FE.MODULES.paste=function(editor){var clipboard_html,clipboard_rtf,$paste_div,snapshot;function saveCopiedText(html,plain){try{editor.win.localStorage.setItem("fr-copied-html",html),editor.win.localStorage.setItem("fr-copied-text",plain)}catch(ex){}}function _handleCopy(e){var copied_html=editor.html.getSelected();saveCopiedText(copied_html,$("<div>").html(copied_html).text()),"cut"==e.type&&(editor.undo.saveStep(),setTimeout((function(){editor.selection.save(),editor.html.wrap(),editor.selection.restore(),editor.events.focus(),editor.undo.saveStep()}),0))}var stop_paste=!1;function _handlePaste(e){if(editor.edit.isDisabled())return!1;if(stop_paste)return!1;if(e.originalEvent&&(e=e.originalEvent),!1===editor.events.trigger("paste.before",[e]))return e.preventDefault(),!1;if(editor.$win.scrollTop(),e&&e.clipboardData&&e.clipboardData.getData){var types="",clipboard_types=e.clipboardData.types;if(editor.helpers.isArray(clipboard_types))for(var i=0;i<clipboard_types.length;i++)types+=clipboard_types[i]+";";else types=clipboard_types;if(clipboard_html="",/text\/rtf/.test(types)&&(clipboard_rtf=e.clipboardData.getData("text/rtf")),/text\/html/.test(types)&&!editor.browser.safari?clipboard_html=e.clipboardData.getData("text/html"):/text\/rtf/.test(types)&&editor.browser.safari?clipboard_html=clipboard_rtf:/public.rtf/.test(types)&&editor.browser.safari&&(clipboard_html=e.clipboardData.getData("text/rtf")),""!==clipboard_html)return _processPaste(),e.preventDefault&&(e.stopPropagation(),e.preventDefault()),!1;clipboard_html=null}return function(){editor.selection.save(),editor.events.disableBlur(),clipboard_html=null,$paste_div?($paste_div.html(""),editor.browser.edge&&editor.opts.iframe&&editor.$el.append($paste_div)):($paste_div=$('<div contenteditable="true" style="position: fixed; top: 0; left: -9999px; height: 100%; width: 0; word-break: break-all; overflow:hidden; z-index: 2147483647; line-height: 140%; -moz-user-select: text; -webkit-user-select: text; -ms-user-select: text; user-select: text;" tabIndex="-1"></div>'),editor.browser.webkit?($paste_div.css("top",editor.$sc.scrollTop()),editor.$el.after($paste_div)):editor.browser.edge&&editor.opts.iframe?editor.$el.append($paste_div):editor.$box.after($paste_div),editor.events.on("destroy",(function(){$paste_div.remove()})));editor.helpers.isIOS()&&editor.$sc&&editor.$sc.overflow("hidden");$paste_div.focus(),editor.helpers.isIOS()&&editor.$sc&&editor.$sc.overflow("hidden","");editor.win.setTimeout(_processPaste,1)}(),!1}function _dropPaste(e){if(e.originalEvent&&(e=e.originalEvent),e&&e.dataTransfer&&e.dataTransfer.getData){var types="",clipboard_types=e.dataTransfer.types;if(editor.helpers.isArray(clipboard_types))for(var i=0;i<clipboard_types.length;i++)types+=clipboard_types[i]+";";else types=clipboard_types;if(clipboard_html="",/text\/rtf/.test(types)&&(clipboard_rtf=e.dataTransfer.getData("text/rtf")),/text\/html/.test(types)?clipboard_html=e.dataTransfer.getData("text/html"):/text\/rtf/.test(types)&&editor.browser.safari?clipboard_html=clipboard_rtf:/text\/plain/.test(types)&&!this.browser.mozilla&&(clipboard_html=editor.html.escapeEntities(e.dataTransfer.getData("text/plain")).replace(/\n/g,"<br>")),""!==clipboard_html){editor.keys.forceUndo(),snapshot=editor.snapshot.get(),editor.selection.save(),editor.$el.find(".fr-marker").removeClass("fr-marker").addClass("fr-marker-helper");var ok=editor.markers.insertAtPoint(e);if(editor.$el.find(".fr-marker").removeClass("fr-marker").addClass("fr-marker-placeholder"),editor.$el.find(".fr-marker-helper").addClass("fr-marker").removeClass("fr-marker-helper"),editor.selection.restore(),editor.selection.remove(),editor.$el.find(".fr-marker-placeholder").addClass("fr-marker").removeClass("fr-marker-placeholder"),!1!==ok){var marker=editor.el.querySelector(".fr-marker");return $(marker).replaceWith($.FE.MARKERS),editor.selection.restore(),_processPaste(),e.preventDefault&&(e.stopPropagation(),e.preventDefault()),!1}}else clipboard_html=null}}function _processPaste(){editor.browser.edge&&editor.opts.iframe&&editor.$box.after($paste_div),snapshot||(editor.keys.forceUndo(),snapshot=editor.snapshot.get()),clipboard_html||(clipboard_html=$paste_div.get(0).innerHTML,editor.selection.restore(),editor.events.enableBlur());var is_word=clipboard_html.match(/(class=\"?Mso|class=\'?Mso|class="?Xl|class='?Xl|class=Xl|style=\"[^\"]*\bmso\-|style=\'[^\']*\bmso\-|w:WordDocument)/gi),response=editor.events.chainTrigger("paste.beforeCleanup",clipboard_html);response&&"string"==typeof response&&(clipboard_html=response),(!is_word||is_word&&!1!==editor.events.trigger("paste.wordPaste",[clipboard_html]))&&clean(clipboard_html,is_word)}function _isDraggedFromEditor(){var possible_text=null;try{possible_text=editor.win.localStorage.getItem("fr-dragged-content-text")}catch(ex){}return!(!possible_text||$("<div>").html(clipboard_html).text().replace(/\u00A0/gi," ").replace(/\r|\n/gi,"")!=possible_text.replace(/\u00A0/gi," ").replace(/\r|\n/gi,""))}function _buildTabs(len){for(var tabs="",i=0;i++<len;)tabs+="&nbsp;";return tabs}function clean(clipboard_html,is_word,keep_formatting){var i,els=null,el=null;if(clipboard_html.toLowerCase().indexOf("<body")>=0){var style="";clipboard_html.indexOf("<style")>=0&&(style=clipboard_html.replace(/[.\s\S\w\W<>]*(<style[^>]*>[\s]*[.\s\S\w\W<>]*[\s]*<\/style>)[.\s\S\w\W<>]*/gi,"$1")),clipboard_html=style+clipboard_html.replace(/[.\s\S\w\W<>]*<body[^>]*>[\s]*([.\s\S\w\W<>]*)[\s]*<\/body>[.\s\S\w\W<>]*/gi,"$1");var lastIndex=0,result="";clipboard_html.replace(/<pre.*?>([\s\S]*?)<\/pre>/gi,(function(match,p1,offset){offset>lastIndex&&(result+=clipboard_html.substring(lastIndex,offset).replace(/ \n/g," ").replace(/\n /g," ").replace(/([^>])\n([^<])/g,"$1 $2")),result+=match,lastIndex=offset+match.length})),clipboard_html.length>lastIndex+1&&(result+=clipboard_html.substring(lastIndex,clipboard_html.length).replace(/ \n/g," ").replace(/\n /g," ").replace(/([^>])\n([^<])/g,"$1 $2")),clipboard_html=result}var is_gdocs=!1;clipboard_html.indexOf('id="docs-internal-guid')>=0&&(clipboard_html=clipboard_html.replace(/^[\w\W\s\S]* id="docs-internal-guid[^>]*>([\w\W\s\S]*)<\/b>[\w\W\s\S]*$/g,"$1"),is_gdocs=!0),clipboard_html.indexOf('content="Sheets"')>=0&&(clipboard_html=clipboard_html.replace(/width:0px;/g,""));var is_editor_content=!1,is_dragged_from_editor=!1;if(!is_word&&(is_editor_content=function(clipboard_html){var possible_text=null;try{possible_text=editor.win.localStorage.getItem("fr-copied-text")}catch(ex){}return!(!possible_text||$("<div>").html(clipboard_html).text().replace(/\u00A0/gi," ").replace(/\r|\n/gi,"")!=possible_text.replace(/\u00A0/gi," ").replace(/\r|\n/gi,""))}(clipboard_html),is_dragged_from_editor=_isDraggedFromEditor(),is_editor_content&&(clipboard_html=editor.win.localStorage.getItem("fr-copied-html")),is_dragged_from_editor&&(is_editor_content=!0,clipboard_html=editor.win.localStorage.getItem("fr-dragged-content-html")),!is_editor_content)){var htmlAllowedStylePropsCopy=editor.opts.htmlAllowedStyleProps;editor.opts.htmlAllowedStyleProps=editor.opts.pasteAllowedStyleProps,editor.opts.htmlAllowComments=!1,clipboard_html=(clipboard_html=(clipboard_html=clipboard_html.replace(/<span class="Apple-tab-span">\s*<\/span>/g,_buildTabs(editor.opts.tabSpaces||4))).replace(/<span class="Apple-tab-span" style="white-space:pre">(\t*)<\/span>/g,(function(str,x){return _buildTabs(x.length*(editor.opts.tabSpaces||4))}))).replace(/\t/g,_buildTabs(editor.opts.tabSpaces||4)),clipboard_html=editor.clean.html(clipboard_html,editor.opts.pasteDeniedTags,editor.opts.pasteDeniedAttrs),editor.opts.htmlAllowedStyleProps=htmlAllowedStylePropsCopy,editor.opts.htmlAllowComments=!0,clipboard_html=(clipboard_html=(clipboard_html=cleanEmptyTagsAndDivs(clipboard_html)).replace(/\r/g,"")).replace(/^ */g,"").replace(/ *$/g,"")}!is_word||editor.wordPaste&&keep_formatting||(0===(clipboard_html=clipboard_html.replace(/^\n*/g,"").replace(/^ /g,"")).indexOf("<colgroup>")&&(clipboard_html="<table>"+clipboard_html+"</table>"),clipboard_html=function(html){var i;html=(html=(html=(html=(html=(html=(html=(html=(html=(html=(html=(html=(html=(html=(html=html.replace(/<p(.*?)class="?'?MsoListParagraph"?'? ([\s\S]*?)>([\s\S]*?)<\/p>/gi,"<ul><li>$3</li></ul>")).replace(/<p(.*?)class="?'?NumberedText"?'? ([\s\S]*?)>([\s\S]*?)<\/p>/gi,"<ol><li>$3</li></ol>")).replace(/<p(.*?)class="?'?MsoListParagraphCxSpFirst"?'?([\s\S]*?)(level\d)?([\s\S]*?)>([\s\S]*?)<\/p>/gi,"<ul><li$3>$5</li>")).replace(/<p(.*?)class="?'?NumberedTextCxSpFirst"?'?([\s\S]*?)(level\d)?([\s\S]*?)>([\s\S]*?)<\/p>/gi,"<ol><li$3>$5</li>")).replace(/<p(.*?)class="?'?MsoListParagraphCxSpMiddle"?'?([\s\S]*?)(level\d)?([\s\S]*?)>([\s\S]*?)<\/p>/gi,"<li$3>$5</li>")).replace(/<p(.*?)class="?'?NumberedTextCxSpMiddle"?'?([\s\S]*?)(level\d)?([\s\S]*?)>([\s\S]*?)<\/p>/gi,"<li$3>$5</li>")).replace(/<p(.*?)class="?'?MsoListBullet"?'?([\s\S]*?)(level\d)?([\s\S]*?)>([\s\S]*?)<\/p>/gi,"<li$3>$5</li>")).replace(/<p(.*?)class="?'?MsoListParagraphCxSpLast"?'?([\s\S]*?)(level\d)?([\s\S]*?)>([\s\S]*?)<\/p>/gi,"<li$3>$5</li></ul>")).replace(/<p(.*?)class="?'?NumberedTextCxSpLast"?'?([\s\S]*?)(level\d)?([\s\S]*?)>([\s\S]*?)<\/p>/gi,"<li$3>$5</li></ol>")).replace(/<span([^<]*?)style="?'?mso-list:Ignore"?'?([\s\S]*?)>([\s\S]*?)<span/gi,"<span><span")).replace(/<!--\[if \!supportLists\]-->([\s\S]*?)<!--\[endif\]-->/gi,"")).replace(/<!\[if \!supportLists\]>([\s\S]*?)<!\[endif\]>/gi,"")).replace(/(\n|\r| class=(")?Mso[a-zA-Z0-9]+(")?)/gi," ")).replace(/<!--[\s\S]*?-->/gi,"")).replace(/<(\/)*(meta|link|span|\\?xml:|st1:|o:|font)(.*?)>/gi,"");var oldHTML,word_tags=["style","script","applet","embed","noframes","noscript"];for(i=0;i<word_tags.length;i++){var regex=new RegExp("<"+word_tags[i]+".*?"+word_tags[i]+"(.*?)>","gi");html=html.replace(regex,"")}html=(html=(html=html.replace(/&nbsp;/gi," ")).replace(/<td([^>]*)><\/td>/g,"<td$1><br></td>")).replace(/<th([^>]*)><\/th>/g,"<th$1><br></th>");do{oldHTML=html,html=html.replace(/<[^\/>][^>]*><\/[^>]+>/gi,"")}while(html!=oldHTML);html=(html=html.replace(/<lilevel([^1])([^>]*)>/gi,'<li data-indent="true"$2>')).replace(/<lilevel1([^>]*)>/gi,"<li$1>"),html=(html=(html=editor.clean.html(html,editor.opts.pasteDeniedTags,editor.opts.pasteDeniedAttrs)).replace(/<a>(.[^<]+)<\/a>/gi,"$1")).replace(/<br> */g,"<br>");var div=editor.o_doc.createElement("div");div.innerHTML=html;var lis=div.querySelectorAll("li[data-indent]");for(i=0;i<lis.length;i++){var li=lis[i],p_li=li.previousElementSibling;if(p_li&&"LI"==p_li.tagName){var list=p_li.querySelector(":scope > ul, :scope > ol");list||(list=document.createElement("ul"),p_li.appendChild(list)),list.appendChild(li)}else li.removeAttribute("data-indent")}return editor.html.cleanBlankSpaces(div),div.innerHTML}(clipboard_html),clipboard_html=cleanEmptyTagsAndDivs(clipboard_html)),editor.opts.pastePlain&&!is_editor_content&&(clipboard_html=function(html){var i,el=null,div=editor.doc.createElement("div");div.innerHTML=html;var els=div.querySelectorAll("p, div, h1, h2, h3, h4, h5, h6, pre, blockquote");for(i=0;i<els.length;i++)(el=els[i]).outerHTML="<"+(editor.html.defaultTag()||"DIV")+">"+el.innerHTML+"</"+(editor.html.defaultTag()||"DIV")+">";for(i=(els=div.querySelectorAll("*:not("+"p, div, h1, h2, h3, h4, h5, h6, pre, blockquote, ul, ol, li, table, tbody, thead, tr, td, br, img".split(",").join("):not(")+")")).length-1;i>=0;i--)(el=els[i]).outerHTML=el.innerHTML;var cleanComments=function(node){for(var contents=editor.node.contents(node),i=0;i<contents.length;i++)contents[i].nodeType!=Node.TEXT_NODE&&contents[i].nodeType!=Node.ELEMENT_NODE?contents[i].parentNode.removeChild(contents[i]):cleanComments(contents[i])};return cleanComments(div),div.innerHTML}(clipboard_html));var response=editor.events.chainTrigger("paste.afterCleanup",clipboard_html);if("string"==typeof response&&(clipboard_html=response),""!==clipboard_html){var tmp=editor.o_doc.createElement("div");tmp.innerHTML=clipboard_html,clipboard_html.indexOf("<body>")>=0?(editor.html.cleanBlankSpaces(tmp),editor.spaces.normalize(tmp,!0)):editor.spaces.normalize(tmp);var spans=tmp.getElementsByTagName("span");for(i=spans.length-1;i>=0;i--){var span=spans[i];0===span.attributes.length&&(span.outerHTML=span.innerHTML)}var selection_el=editor.selection.element(),in_list=!1;if(selection_el&&$(selection_el).parentsUntil(editor.el,"ul, ol").length&&(in_list=!0),in_list){var list=tmp.children;1==list.length&&["OL","UL"].indexOf(list[0].tagName)>=0&&(list[0].outerHTML=list[0].innerHTML)}if(!is_gdocs){var brs=tmp.getElementsByTagName("br");for(i=brs.length-1;i>=0;i--){var br=brs[i];editor.node.isBlock(br.previousSibling)&&br.parentNode.removeChild(br)}}if(editor.opts.enter==$.FE.ENTER_BR)for(i=(els=tmp.querySelectorAll("p, div")).length-1;i>=0;i--)0===(el=els[i]).attributes.length&&(el.outerHTML=el.innerHTML+(el.nextSibling&&!editor.node.isEmpty(el)?"<br>":""));else if(editor.opts.enter==$.FE.ENTER_DIV)for(i=(els=tmp.getElementsByTagName("p")).length-1;i>=0;i--)0===(el=els[i]).attributes.length&&(el.outerHTML="<div>"+el.innerHTML+"</div>");else editor.opts.enter==$.FE.ENTER_P&&1==tmp.childNodes.length&&"P"==tmp.childNodes[0].tagName&&0===tmp.childNodes[0].attributes.length&&(tmp.childNodes[0].outerHTML=tmp.childNodes[0].innerHTML);clipboard_html=tmp.innerHTML,is_editor_content&&(clipboard_html=function(html){var i,div=editor.o_doc.createElement("div");div.innerHTML=html;var empty_tags=div.querySelectorAll("*:empty:not(td):not(th):not(tr):not(iframe):not(svg):not("+$.FE.VOID_ELEMENTS.join("):not(")+"):not("+editor.opts.htmlAllowedEmptyTags.join("):not(")+")");for(;empty_tags.length;){for(i=0;i<empty_tags.length;i++)empty_tags[i].parentNode.removeChild(empty_tags[i]);empty_tags=div.querySelectorAll("*:empty:not(td):not(th):not(tr):not(iframe):not(svg):not("+$.FE.VOID_ELEMENTS.join("):not(")+"):not("+editor.opts.htmlAllowedEmptyTags.join("):not(")+")")}return div.innerHTML}(clipboard_html)),editor.html.insert(clipboard_html,!0)}editor.events.trigger("paste.after"),editor.undo.saveStep(snapshot),snapshot=null,editor.undo.saveStep()}function _filterNoAttrs(arry){for(var t=arry.length-1;t>=0;t--)arry[t].attributes&&arry[t].attributes.length&&arry.splice(t,1);return arry}function cleanEmptyTagsAndDivs(html){var i,div=editor.o_doc.createElement("div");div.innerHTML=html;for(var divs=_filterNoAttrs(Array.prototype.slice.call(div.querySelectorAll(":scope > div:not([style]), td > div:not([style]), th > div:not([style]), li > div:not([style])")));divs.length;){var dv=divs[divs.length-1];if(editor.html.defaultTag()&&"div"!=editor.html.defaultTag())dv.querySelector(editor.html.blockTagsQuery())?dv.outerHTML=dv.innerHTML:dv.outerHTML="<"+editor.html.defaultTag()+">"+dv.innerHTML+"</"+editor.html.defaultTag()+">";else{var els=dv.querySelectorAll("*");!els.length||"BR"!==els[els.length-1].tagName&&0===dv.innerText.length||!els.length||"BR"!==els[els.length-1].tagName||els[els.length-1].nextSibling?dv.outerHTML=dv.innerHTML+(dv.nextSibling?"<br>":""):dv.outerHTML=dv.innerHTML}divs=_filterNoAttrs(Array.prototype.slice.call(div.querySelectorAll(":scope > div:not([style]), td > div:not([style]), th > div:not([style]), li > div:not([style])")))}for(divs=_filterNoAttrs(Array.prototype.slice.call(div.querySelectorAll("div:not([style])")));divs.length;){for(i=0;i<divs.length;i++){var el=divs[i],text=el.innerHTML.replace(/\u0009/gi,"").trim();try{el.outerHTML=text}catch(ex){}}divs=_filterNoAttrs(Array.prototype.slice.call(div.querySelectorAll("div:not([style])")))}return div.innerHTML}function _dragStart(e){if(e.originalEvent&&e.originalEvent.target&&e.originalEvent.target.nodeType==Node.TEXT_NODE)try{editor.win.localStorage.setItem("fr-dragged-content-html",e.originalEvent.dataTransfer.getData("text/html")),editor.win.localStorage.setItem("fr-dragged-content-text",e.originalEvent.dataTransfer.getData("text/plain"))}catch(ex){}}function _destroy(){editor.el.removeEventListener("copy",_handleCopy),editor.el.removeEventListener("cut",_handleCopy),editor.el.removeEventListener("paste",_handlePaste)}return{_init:function(){editor.el.addEventListener("copy",_handleCopy),editor.el.addEventListener("cut",_handleCopy),editor.el.addEventListener("paste",_handlePaste,{capture:!0}),editor.events.on("drop",_dropPaste),editor.browser.msie&&editor.browser.version<11&&(editor.events.on("mouseup",(function(e){2==e.button&&(setTimeout((function(){stop_paste=!1}),50),stop_paste=!0)}),!0),editor.events.on("beforepaste",_handlePaste)),editor.events.on("dragstart",_dragStart,!0),editor.events.on("destroy",_destroy)},cleanEmptyTagsAndDivs:cleanEmptyTagsAndDivs,getRtfClipboard:function(){return clipboard_rtf},saveCopiedText:saveCopiedText,clean:clean}}}(jQuery),function($){$.extend($.FE.DEFAULTS,{shortcutsEnabled:[],shortcutsHint:!0}),$.FE.SHORTCUTS_MAP={},$.FE.RegisterShortcut=function(key,cmd,val,letter,shift,option){$.FE.SHORTCUTS_MAP[(shift?"^":"")+(option?"@":"")+key]={cmd:cmd,val:val,letter:letter,shift:shift,option:option},$.FE.DEFAULTS.shortcutsEnabled.push(cmd)},$.FE.RegisterShortcut($.FE.KEYCODE.E,"show",null,"E",!1,!1),$.FE.RegisterShortcut($.FE.KEYCODE.B,"bold",null,"B",!1,!1),$.FE.RegisterShortcut($.FE.KEYCODE.I,"italic",null,"I",!1,!1),$.FE.RegisterShortcut($.FE.KEYCODE.U,"underline",null,"U",!1,!1),$.FE.RegisterShortcut($.FE.KEYCODE.S,"strikeThrough",null,"S",!1,!1),$.FE.RegisterShortcut($.FE.KEYCODE.CLOSE_SQUARE_BRACKET,"indent",null,"]",!1,!1),$.FE.RegisterShortcut($.FE.KEYCODE.OPEN_SQUARE_BRACKET,"outdent",null,"[",!1,!1),$.FE.RegisterShortcut($.FE.KEYCODE.Z,"undo",null,"Z",!1,!1),$.FE.RegisterShortcut($.FE.KEYCODE.Z,"redo",null,"Z",!0,!1),$.FE.RegisterShortcut($.FE.KEYCODE.Y,"redo",null,"Y",!1,!1),$.FE.MODULES.shortcuts=function(editor){var inverse_map=null;var active=!1;function exec(e){if(!editor.core.hasFocus())return!0;var keycode=e.which,ctrlKey=-1!=navigator.userAgent.indexOf("Mac OS X")?e.metaKey:e.ctrlKey;if("keyup"==e.type&&active&&keycode!=$.FE.KEYCODE.META)return active=!1,!1;"keydown"==e.type&&(active=!1);var map_key=(e.shiftKey?"^":"")+(e.altKey?"@":"")+keycode;if(ctrlKey&&$.FE.SHORTCUTS_MAP[map_key]){var cmd=$.FE.SHORTCUTS_MAP[map_key].cmd;if(cmd&&editor.opts.shortcutsEnabled.indexOf(cmd)>=0){var $btn,val=$.FE.SHORTCUTS_MAP[map_key].val;if(cmd&&!val?$btn=editor.$tb.find('.fr-command[data-cmd="'+cmd+'"]'):cmd&&val&&($btn=editor.$tb.find('.fr-command[data-cmd="'+cmd+'"][data-param1="'+val+'"]')),$btn.length)return e.preventDefault(),e.stopPropagation(),$btn.parents(".fr-toolbar").data("instance",editor),"keydown"==e.type&&(editor.button.exec($btn),active=!0),!1;if(cmd&&(editor.commands[cmd]||$.FE.COMMANDS[cmd]&&$.FE.COMMANDS[cmd].callback))return e.preventDefault(),e.stopPropagation(),"keydown"==e.type&&((editor.commands[cmd]||$.FE.COMMANDS[cmd].callback)(),active=!0),!1}}}return{_init:function(){editor.events.on("keydown",exec,!0),editor.events.on("keyup",exec,!0)},get:function(cmd){if(!editor.opts.shortcutsHint)return null;if(!inverse_map)for(var key in inverse_map={},$.FE.SHORTCUTS_MAP)$.FE.SHORTCUTS_MAP.hasOwnProperty(key)&&editor.opts.shortcutsEnabled.indexOf($.FE.SHORTCUTS_MAP[key].cmd)>=0&&(inverse_map[$.FE.SHORTCUTS_MAP[key].cmd+"."+($.FE.SHORTCUTS_MAP[key].val||"")]={shift:$.FE.SHORTCUTS_MAP[key].shift,option:$.FE.SHORTCUTS_MAP[key].option,letter:$.FE.SHORTCUTS_MAP[key].letter});var srct=inverse_map[cmd];return srct?(editor.helpers.isMac()?String.fromCharCode(8984):editor.language.translate("Ctrl")+"+")+(srct.shift?editor.helpers.isMac()?String.fromCharCode(8679):editor.language.translate("Shift")+"+":"")+(srct.option?editor.helpers.isMac()?String.fromCharCode(8997):editor.language.translate("Alt")+"+":"")+srct.letter:null}}}}(jQuery),jQuery.FE.MODULES.snapshot=function(editor){function _getNodeIndex(node){for(var childNodes=node.parentNode.childNodes,idx=0,prevNode=null,i=0;i<childNodes.length;i++){if(prevNode){var isEmptyText=childNodes[i].nodeType===Node.TEXT_NODE&&""===childNodes[i].textContent,twoTexts=prevNode.nodeType===Node.TEXT_NODE&&childNodes[i].nodeType===Node.TEXT_NODE,emptyPrevNode=prevNode.nodeType===Node.TEXT_NODE&&""===prevNode.textContent;isEmptyText||twoTexts||emptyPrevNode||idx++}if(childNodes[i]==node)return idx;prevNode=childNodes[i]}}function _getNodeLocation(node){var loc=[];if(!node.parentNode)return[];for(;!editor.node.isElement(node);)loc.push(_getNodeIndex(node)),node=node.parentNode;return loc.reverse()}function _getRealNodeOffset(node,offset){for(;node&&node.nodeType===Node.TEXT_NODE;){var prevNode=node.previousSibling;prevNode&&prevNode.nodeType==Node.TEXT_NODE&&(offset+=prevNode.textContent.length),node=prevNode}return offset}function _getNodeByLocation(loc){for(var node=editor.el,i=0;i<loc.length;i++)node=node.childNodes[loc[i]];return node}function _restoreRange(sel,range_snapshot){try{var startNode=_getNodeByLocation(range_snapshot.scLoc),startOffset=range_snapshot.scOffset,endNode=_getNodeByLocation(range_snapshot.ecLoc),endOffset=range_snapshot.ecOffset,range=editor.doc.createRange();range.setStart(startNode,startOffset),range.setEnd(endNode,endOffset),sel.addRange(range)}catch(ex){console.warn(ex)}}return{get:function(){var range,snapshot={};if(editor.events.trigger("snapshot.before"),snapshot.html=(editor.$wp?editor.$el.html():editor.$oel.get(0).outerHTML).replace(/ style=""/g,""),snapshot.ranges=[],editor.$wp&&editor.selection.inEditor()&&editor.core.hasFocus())for(var ranges=editor.selection.ranges(),i=0;i<ranges.length;i++)snapshot.ranges.push({scLoc:_getNodeLocation((range=ranges[i]).startContainer),scOffset:_getRealNodeOffset(range.startContainer,range.startOffset),ecLoc:_getNodeLocation(range.endContainer),ecOffset:_getRealNodeOffset(range.endContainer,range.endOffset)});return editor.events.trigger("snapshot.after",[snapshot]),snapshot},restore:function(snapshot){editor.$el.html()!=snapshot.html&&(editor.opts.htmlExecuteScripts?editor.$el.html(snapshot.html):editor.el.innerHTML=snapshot.html);var sel=editor.selection.get();editor.selection.clear(),editor.events.focus(!0);for(var i=0;i<snapshot.ranges.length;i++)_restoreRange(sel,snapshot.ranges[i])},equal:function(s1,s2){return s1.html==s2.html&&(!editor.core.hasFocus()||JSON.stringify(s1.ranges)==JSON.stringify(s2.ranges))}}},jQuery.FE.MODULES.undo=function(editor){function _disableBrowserUndo(e){var keyCode=e.which;editor.keys.ctrlKey(e)&&(90==keyCode&&e.shiftKey&&e.preventDefault(),90==keyCode&&e.preventDefault())}var last_html=null;function dropRedo(){if(!editor.undo_stack||editor.undoing)return!1;for(;editor.undo_stack.length>editor.undo_index;)editor.undo_stack.pop()}function reset(){last_html=(editor.$wp?editor.$el.html():editor.$oel.get(0).outerHTML).replace(/ style=""/g,""),editor.undo_index=0,editor.undo_stack=[]}function _destroy(){editor.undo_stack=[]}return{_init:function(){reset(),editor.events.on("initialized",(function(){last_html=(editor.$wp?editor.$el.html():editor.$oel.get(0).outerHTML).replace(/ style=""/g,"")})),editor.events.on("blur",(function(){editor.el.querySelector(".fr-dragging")||editor.undo.saveStep()})),editor.events.on("keydown",_disableBrowserUndo),editor.events.on("destroy",_destroy)},run:function(){if(editor.undo_index>1){editor.undoing=!0;var snapshot=editor.undo_stack[--editor.undo_index-1];clearTimeout(editor._content_changed_timer),editor.snapshot.restore(snapshot),last_html=snapshot.html,editor.popups.hideAll(),editor.toolbar.enable(),editor.events.trigger("contentChanged"),editor.events.trigger("commands.undo"),editor.undoing=!1}},redo:function(){if(editor.undo_index<editor.undo_stack.length){editor.undoing=!0;var snapshot=editor.undo_stack[editor.undo_index++];clearTimeout(editor._content_changed_timer),editor.snapshot.restore(snapshot),last_html=snapshot.html,editor.popups.hideAll(),editor.toolbar.enable(),editor.events.trigger("contentChanged"),editor.events.trigger("commands.redo"),editor.undoing=!1}},canDo:function(){return!(0===editor.undo_stack.length||editor.undo_index<=1)},canRedo:function(){return editor.undo_index!=editor.undo_stack.length},dropRedo:dropRedo,reset:reset,saveStep:function(snapshot){if(!editor.undo_stack||editor.undoing||editor.el.querySelector(".fr-marker"))return!1;void 0===snapshot?(snapshot=editor.snapshot.get(),editor.undo_stack[editor.undo_index-1]&&editor.snapshot.equal(editor.undo_stack[editor.undo_index-1],snapshot)||(dropRedo(),editor.undo_stack.push(snapshot),editor.undo_index++,snapshot.html!=last_html&&(editor.events.trigger("contentChanged"),last_html=snapshot.html))):(dropRedo(),editor.undo_index>0?editor.undo_stack[editor.undo_index-1]=snapshot:(editor.undo_stack.push(snapshot),editor.undo_index++))}}},function($){$.FE.ICON_TEMPLATES={octobercms:'<i class="icon-[NAME]" aria-hidden="true"></i>',font_awesome:'<i class="fa fa-[NAME]" aria-hidden="true"></i>',text:'<span style="text-align:center">[NAME]</span>',image:"<img src=[SRC] alt=[ALT] />",svg:'<svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">[PATH]</svg>',empty:" "},$.FE.ICONS={bold:{NAME:"bold"},italic:{NAME:"italic"},underline:{NAME:"underline"},strikeThrough:{NAME:"strikethrough"},subscript:{NAME:"subscript"},superscript:{NAME:"superscript"},color:{NAME:"tint"},outdent:{NAME:"outdent"},indent:{NAME:"indent"},undo:{NAME:"rotate-left",FA5NAME:"undo"},redo:{NAME:"rotate-right",FA5NAME:"redo"},insertHR:{NAME:"minus"},clearFormatting:{NAME:"eraser"},selectAll:{NAME:"mouse-pointer"}},$.FE.DefineIconTemplate=function(name,options){$.FE.ICON_TEMPLATES[name]=options},$.FE.DefineIcon=function(name,options){$.FE.ICONS[name]=options},$.extend($.FE.DEFAULTS,{iconsTemplate:"octobercms"}),$.FE.MODULES.icon=function(editor){return{create:function(command){var icon=null,info=$.FE.ICONS[command];if(void 0!==info){var template=info.template||$.FE.ICON_DEFAULT_TEMPLATE||editor.opts.iconsTemplate;template&&template.apply&&(template=template.apply(editor)),info.FA5NAME||(info.FA5NAME=info.NAME),template&&(template=$.FE.ICON_TEMPLATES[template])&&(icon=template.replace(/\[([a-zA-Z0-9]*)\]/g,(function(str,a1){return"NAME"==a1?info[a1]||command:info[a1]})))}return icon||command},getTemplate:function(command){var info=$.FE.ICONS[command],template=editor.opts.iconsTemplate;return void 0!==info?template=info.template||$.FE.ICON_DEFAULT_TEMPLATE||editor.opts.iconsTemplate:template}}}}(jQuery),function($){$.extend($.FE.DEFAULTS,{tooltips:!0}),$.FE.MODULES.tooltip=function(editor){function hide(){if(editor.helpers.isMobile())return!1;editor.$tooltip&&editor.$tooltip.removeClass("fr-visible").css("left","-3000px").css("position","fixed")}function to($el,above){if(editor.helpers.isMobile())return!1;if($el.data("title")||$el.data("title",$el.attr("title")),!$el.data("title"))return!1;editor.$tooltip||editor.opts.tooltips&&!editor.helpers.isMobile()&&(editor.shared.$tooltip?editor.$tooltip=editor.shared.$tooltip:(editor.shared.$tooltip=$('<div class="fr-tooltip"></div>'),editor.$tooltip=editor.shared.$tooltip,editor.opts.theme&&editor.$tooltip.addClass(editor.opts.theme+"-theme"),$(editor.o_doc).find("body:first").append(editor.$tooltip)),editor.events.on("shared.destroy",(function(){editor.$tooltip.html("").removeData().remove(),editor.$tooltip=null}),!0)),$el.removeAttr("title"),editor.$tooltip.text(editor.language.translate($el.data("title"))),editor.$tooltip.addClass("fr-visible");var left=$el.offset().left+($el.outerWidth()-editor.$tooltip.outerWidth())/2;left<0&&(left=0),left+editor.$tooltip.outerWidth()>$(editor.o_win).width()&&(left=$(editor.o_win).width()-editor.$tooltip.outerWidth()),void 0===above&&(above=editor.opts.toolbarBottom);var top=above?$el.offset().top-editor.$tooltip.height():$el.offset().top+$el.outerHeight();editor.$tooltip.css("position",""),editor.$tooltip.css("left",left),editor.$tooltip.css("top",Math.ceil(top)),"static"!=$(editor.o_doc).find("body:first").css("position")?(editor.$tooltip.css("margin-left",-$(editor.o_doc).find("body:first").offset().left),editor.$tooltip.css("margin-top",-$(editor.o_doc).find("body:first").offset().top)):(editor.$tooltip.css("margin-left",""),editor.$tooltip.css("margin-top",""))}return{hide:hide,to:to,bind:function($el,selector,above){editor.opts.tooltips&&!editor.helpers.isMobile()&&(editor.events.$on($el,"mouseenter",selector,(function(e){editor.node.hasClass(e.currentTarget,"fr-disabled")||editor.edit.isDisabled()||to($(e.currentTarget),above)}),!0),editor.events.$on($el,"mouseleave "+editor._mousedown+" "+editor._mouseup,selector,(function(){hide()}),!0))}}}}(jQuery),function($){$.FE.MODULES.button=function(editor){var buttons=[];(editor.opts.toolbarInline||editor.opts.toolbarContainer)&&(editor.shared.buttons||(editor.shared.buttons=[]),buttons=editor.shared.buttons);var popup_buttons=[];function _filterButtons(butons_list,selector,search_dropdowns){for(var $filtered_buttons=$(),i=0;i<butons_list.length;i++){var $button=$(butons_list[i]);if($button.is(selector)&&($filtered_buttons=$filtered_buttons.add($button)),search_dropdowns&&$button.is(".fr-dropdown")){var $dropdown_menu_items=$button.next().find(selector);$filtered_buttons=$filtered_buttons.add($dropdown_menu_items)}}return $filtered_buttons}function getButtons(selector,search_dropdowns){var id,$buttons=$();if(!selector)return $buttons;for(id in $buttons=($buttons=$buttons.add(_filterButtons(buttons,selector,search_dropdowns))).add(_filterButtons(popup_buttons,selector,search_dropdowns)),editor.shared.popups)if(editor.shared.popups.hasOwnProperty(id)){var $popup_buttons=editor.shared.popups[id].children().find(selector);$buttons=$buttons.add($popup_buttons)}for(id in editor.shared.modals)if(editor.shared.modals.hasOwnProperty(id)){var $modal_buttons=editor.shared.modals[id].$modal.find(selector);$buttons=$buttons.add($modal_buttons)}return $buttons}function exec($btn){$btn.addClass("fr-blink"),setTimeout((function(){$btn.removeClass("fr-blink")}),500);for(var cmd=$btn.data("cmd"),params=[];void 0!==$btn.data("param"+(params.length+1));)params.push($btn.data("param"+(params.length+1)));var $active_dropdowns=getButtons(".fr-dropdown.fr-active");$active_dropdowns.length&&($active_dropdowns.removeClass("fr-active").attr("aria-expanded",!1).next().attr("aria-hidden",!0),$active_dropdowns.prev(".fr-expanded").removeClass("fr-expanded"),$active_dropdowns.parent(".fr-toolbar:not(.fr-inline)").css("zIndex","")),$btn.parents(".fr-popup, .fr-toolbar").data("instance").commands.exec(cmd,params)}function click($btn){var inst=$btn.parents(".fr-popup, .fr-toolbar").data("instance");if(0!==$btn.parents(".fr-popup").length||$btn.data("popup")||inst.popups.hideAll(),inst.popups.areVisible()&&!inst.popups.areVisible(inst)){for(var i=0;i<$.FE.INSTANCES.length;i++)$.FE.INSTANCES[i]!=inst&&$.FE.INSTANCES[i].popups&&$.FE.INSTANCES[i].popups.areVisible()&&$.FE.INSTANCES[i].$el.find(".fr-marker").remove();inst.popups.hideAll()}editor.node.hasClass($btn.get(0),"fr-dropdown")?function($btn){var $dropdown=$btn.next(),active=editor.node.hasClass($btn.get(0),"fr-active"),$active_dropdowns=getButtons(".fr-dropdown.fr-active").not($btn),inst=$btn.parents(".fr-toolbar, .fr-popup").data("instance")||editor;if(inst.helpers.isIOS()&&!inst.el.querySelector(".fr-marker")&&(inst.selection.save(),inst.selection.clear(),inst.selection.restore()),!active){var cmd=$btn.data("cmd");$dropdown.find(".fr-command").removeClass("fr-active").attr("aria-selected",!1),$.FE.COMMANDS[cmd]&&$.FE.COMMANDS[cmd].refreshOnShow&&$.FE.COMMANDS[cmd].refreshOnShow.apply(inst,[$btn,$dropdown]),$dropdown.css("left",$btn.offset().left-$btn.parent().offset().left-("rtl"==editor.opts.direction?$dropdown.width()-$btn.outerWidth():0)),$dropdown.addClass("test-height");var ht=$dropdown.outerHeight();$dropdown.removeClass("test-height"),$dropdown.css("top","").css("bottom",""),!editor.opts.toolbarBottom&&$dropdown.offset().top+$btn.outerHeight()+ht<$(editor.o_doc).height()?$dropdown.css("top",$btn.position().top+$btn.outerHeight()):$dropdown.css("bottom",$btn.parents(".fr-popup, .fr-toolbar").first().height()-$btn.position().top)}$btn.addClass("fr-blink").toggleClass("fr-active"),$btn.hasClass("fr-options")&&$btn.prev().toggleClass("fr-expanded"),$btn.hasClass("fr-active")?($dropdown.attr("aria-hidden",!1),$btn.attr("aria-expanded",!0)):($dropdown.attr("aria-hidden",!0),$btn.attr("aria-expanded",!1)),setTimeout((function(){$btn.removeClass("fr-blink")}),300),$dropdown.css("margin-left",""),$dropdown.offset().left+$dropdown.outerWidth()>editor.$sc.offset().left+editor.$sc.width()&&$dropdown.css("margin-left",-($dropdown.offset().left+$dropdown.outerWidth()-editor.$sc.offset().left-editor.$sc.width())),$dropdown.offset().left<editor.$sc.offset().left&&"rtl"==editor.opts.direction&&$dropdown.css("margin-left",editor.$sc.offset().left),$active_dropdowns.removeClass("fr-active").attr("aria-expanded",!1).next().attr("aria-hidden",!0),$active_dropdowns.prev(".fr-expanded").removeClass("fr-expanded"),$active_dropdowns.parent(".fr-toolbar:not(.fr-inline)").css("zIndex",""),0!==$btn.parents(".fr-popup").length||editor.opts.toolbarInline||(editor.node.hasClass($btn.get(0),"fr-active")?editor.$tb.css("zIndex",(editor.opts.zIndex||1)+4):editor.$tb.css("zIndex",""));var $active_element=$dropdown.find("a.fr-command.fr-active:first");editor.helpers.isMobile()||($active_element.length?editor.accessibility.focusToolbarElement($active_element):editor.accessibility.focusToolbarElement($btn))}($btn):(!function($btn){exec($btn)}($btn),$.FE.COMMANDS[$btn.data("cmd")]&&!1!==$.FE.COMMANDS[$btn.data("cmd")].refreshAfterCallback&&inst.button.bulkRefresh())}function _click(e){click($(e.currentTarget))}function hideActiveDropdowns($el){var $active_dropdowns=$el.find(".fr-dropdown.fr-active");$active_dropdowns.length&&($active_dropdowns.removeClass("fr-active").attr("aria-expanded",!1).next().attr("aria-hidden",!0),$active_dropdowns.parent(".fr-toolbar:not(.fr-inline)").css("zIndex",""),$active_dropdowns.prev().removeClass("fr-expanded"))}function _dropdownMenuClick(e){e.preventDefault(),e.stopPropagation()}function _dropdownWrapperClick(e){if(e.stopPropagation(),!editor.helpers.isMobile())return!1}function _build(command,info,visible){if(info=$.extend(!0,{},info),editor.helpers.isMobile()&&!1===info.showOnMobile)return"";var display_selection=info.displaySelection;"function"==typeof display_selection&&(display_selection=display_selection(editor));var icon="";if("options"!==info.type)if(display_selection){var default_selection="function"==typeof info.defaultSelection?info.defaultSelection(editor):info.defaultSelection;icon='<span style="width:'+(info.displaySelectionWidth||100)+'px">'+editor.language.translate(default_selection||info.title)+"</span>"}else icon=editor.icon.create(info.icon||command),icon+='<span class="fr-sr-only">'+(editor.language.translate(info.title)||"")+"</span>";var popup=info.popup?' data-popup="true"':"",modal=info.modal?' data-modal="true"':"",shortcut=editor.shortcuts.get(command+".");shortcut=shortcut?" ("+shortcut+")":"";var button_id=command+"-"+editor.id,dropdown_id="dropdown-menu-"+button_id,btn='<button id="'+button_id+'"type="button" tabIndex="-1" role="button"'+(info.toggle?' aria-pressed="false"':"")+("dropdown"==info.type||"options"==info.type?' aria-controls="'+dropdown_id+'" aria-expanded="false" aria-haspopup="true"':"")+(info.disabled?' aria-disabled="true"':"")+' title="'+(editor.language.translate(info.title)||"")+shortcut+'" class="fr-command fr-btn'+("dropdown"==info.type||"options"==info.type?" fr-dropdown":"")+("options"==info.type?" fr-options":"")+" fr-btn-"+editor.icon.getTemplate(info.icon)+(info.displaySelection?" fr-selection":"")+(info.back?" fr-back":"")+(info.disabled?" fr-disabled":"")+(visible?"":" fr-hidden")+'" data-cmd="'+command+'"'+popup+modal+">"+icon+"</button>";if("dropdown"==info.type||"options"==info.type){var dropdown='<div id="'+dropdown_id+'" class="fr-dropdown-menu" role="listbox" aria-labelledby="'+button_id+'" aria-hidden="true"><div class="fr-dropdown-wrapper" role="presentation"><div class="fr-dropdown-content" role="presentation">';dropdown+=function(command,info){var c="";if(info.html)"function"==typeof info.html?c+=info.html.call(editor):c+=info.html;else{var options=info.options;for(var val in"function"==typeof options&&(options=options()),c+='<ul class="fr-dropdown-list" role="presentation">',options)if(options.hasOwnProperty(val)){var shortcut=editor.shortcuts.get(command+"."+val);shortcut=shortcut?'<span class="fr-shortcut">'+shortcut+"</span>":"",c+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="'+("options"===info.type?command.replace(/Options/g,""):command)+'" data-param1="'+val+'" title="'+options[val]+'">'+editor.language.translate(options[val])+"</a></li>"}c+="</ul>"}return c}(command,info),btn+=dropdown+="</div></div></div>"}return info.hasOptions&&info.hasOptions.apply(editor)&&(info.type="options",info.hasOptions=!1,btn='<div class="fr-btn-wrap">'+btn+_build(command+"Options",info,visible)+"</div>"),btn}function _bulkRefresh(btns){var inst=editor.$tb&&editor.$tb.data("instance")||editor;if(!1===editor.events.trigger("buttons.refresh"))return!0;setTimeout((function(){for(var focused=inst.selection.inEditor()&&inst.core.hasFocus(),i=0;i<btns.length;i++){var $btn=$(btns[i]),cmd=$btn.data("cmd");0===$btn.parents(".fr-popup").length?focused||$.FE.COMMANDS[cmd]&&$.FE.COMMANDS[cmd].forcedRefresh?inst.button.refresh($btn):editor.node.hasClass($btn.get(0),"fr-dropdown")||($btn.removeClass("fr-active"),$btn.attr("aria-pressed")&&$btn.attr("aria-pressed",!1)):$btn.parents(".fr-popup").is(":visible")&&inst.button.refresh($btn)}}),0)}function bulkRefresh(){_bulkRefresh(buttons),_bulkRefresh(popup_buttons)}function _destroy(){buttons=[],popup_buttons=[]}editor.shared.popup_buttons||(editor.shared.popup_buttons=[]),popup_buttons=editor.shared.popup_buttons;var refresh_timeout=null;function delayedBulkRefresh(){clearTimeout(refresh_timeout),refresh_timeout=setTimeout(bulkRefresh,50)}return{_init:function(){editor.opts.toolbarInline?editor.events.on("toolbar.show",bulkRefresh):(editor.events.on("mouseup",delayedBulkRefresh),editor.events.on("keyup",delayedBulkRefresh),editor.events.on("blur",delayedBulkRefresh),editor.events.on("focus",delayedBulkRefresh),editor.events.on("contentChanged",delayedBulkRefresh),editor.helpers.isMobile()&&editor.events.$on(editor.$doc,"selectionchange",bulkRefresh)),editor.events.on("shared.destroy",_destroy)},buildList:function(buttons,visible_buttons){for(var str="",i=0;i<buttons.length;i++){var cmd_name=buttons[i],cmd_info=$.FE.COMMANDS[cmd_name];if(!(cmd_info&&void 0!==cmd_info.plugin&&editor.opts.pluginsEnabled.indexOf(cmd_info.plugin)<0))if(cmd_info)str+=_build(cmd_name,cmd_info,void 0===visible_buttons||visible_buttons.indexOf(cmd_name)>=0);else"|"==cmd_name?str+='<div class="fr-separator fr-vs" role="separator" aria-orientation="vertical"></div>':"-"==cmd_name&&(str+='<div class="fr-separator fr-hs" role="separator" aria-orientation="horizontal"></div>')}return str},bindCommands:function($el,tooltipAbove){editor.events.bindClick($el,".fr-command:not(.fr-disabled)",_click),editor.events.$on($el,editor._mousedown+" "+editor._mouseup+" "+editor._move,".fr-dropdown-menu",_dropdownMenuClick,!0),editor.events.$on($el,editor._mousedown+" "+editor._mouseup+" "+editor._move,".fr-dropdown-menu .fr-dropdown-wrapper",_dropdownWrapperClick,!0);var _document=$el.get(0).ownerDocument,_window="defaultView"in _document?_document.defaultView:_document.parentWindow,hideDropdowns=function(e){(!e||e.type==editor._mouseup&&e.target!=$("html").get(0)||"keydown"==e.type&&(editor.keys.isCharacter(e.which)&&!editor.keys.ctrlKey(e)||e.which==$.FE.KEYCODE.ESC))&&hideActiveDropdowns($el)};editor.events.$on($(_window),editor._mouseup+" resize keydown",hideDropdowns,!0),editor.opts.iframe&&editor.events.$on(editor.$win,editor._mouseup,hideDropdowns,!0),editor.node.hasClass($el.get(0),"fr-popup")?$.merge(popup_buttons,$el.find(".fr-btn").toArray()):$.merge(buttons,$el.find(".fr-btn").toArray()),editor.tooltip.bind($el,".fr-btn, .fr-title",tooltipAbove)},refresh:function($btn){var $dropdown,inst=$btn.parents(".fr-popup, .fr-toolbar").data("instance")||editor,cmd=$btn.data("cmd");editor.node.hasClass($btn.get(0),"fr-dropdown")?$dropdown=$btn.next():($btn.removeClass("fr-active"),$btn.attr("aria-pressed")&&$btn.attr("aria-pressed",!1)),$.FE.COMMANDS[cmd]&&$.FE.COMMANDS[cmd].refresh?$.FE.COMMANDS[cmd].refresh.apply(inst,[$btn,$dropdown]):editor.refresh[cmd]&&inst.refresh[cmd]($btn,$dropdown)},bulkRefresh:bulkRefresh,exec:exec,click:click,hideActiveDropdowns:hideActiveDropdowns,getButtons:getButtons}}}(jQuery),function($){$.FE.MODULES.modals=function(editor){editor.shared.modals||(editor.shared.modals={});var $overlay,modals=editor.shared.modals;function destroy(){for(var i in modals){var modalHash=modals[i];modalHash&&modalHash.$modal&&modalHash.$modal.removeData().remove()}$overlay&&$overlay.removeData().remove(),modals={}}function hide(id,init){if(modals[id]){var $modal=modals[id].$modal,inst=$modal.data("instance")||editor;inst.events.enableBlur(),$modal.hide(),$overlay.hide(),$(inst.o_doc).find("body:first").removeClass("prevent-scroll fr-mobile"),$modal.removeClass("fr-active"),init||(inst.accessibility.restoreSelection(),inst.events.trigger("modals.hide"))}}function isVisible(id){var $modal;if("string"==typeof id){if(!modals[id])return;$modal=modals[id].$modal}else $modal=id;return $modal&&editor.node.hasClass($modal,"fr-active")&&editor.core.sameInstance($modal)||!1}return{_init:function(){editor.events.on("shared.destroy",destroy,!0)},get:function(id){return modals[id]},create:function(id,head,body){if(editor.shared.$overlay||(editor.shared.$overlay=$('<div class="fr-overlay">').appendTo("body:first")),$overlay=editor.shared.$overlay,editor.opts.theme&&$overlay.addClass(editor.opts.theme+"-theme"),!modals[id]){var $modal=function(head,body){var html='<div tabIndex="-1" class="fr-modal'+(editor.opts.theme?" "+editor.opts.theme+"-theme":"")+'"><div class="fr-modal-wrapper">';return html+='<div class="fr-modal-head">'+head+'<span title="'+editor.language.translate("Cancel")+'" class="fr-modal-close">&times;</span></div>',html+='<div tabIndex="-1" class="fr-modal-body">'+body+"</div>",$(html+="</div></div>")}(head,body);modals[id]={$modal:$modal,$head:$modal.find(".fr-modal-head"),$body:$modal.find(".fr-modal-body")},editor.helpers.isMobile()||$modal.addClass("fr-desktop"),$modal.appendTo("body:first"),editor.events.$on($modal,"click",".fr-modal-close",(function(){hide(id)}),!0),modals[id].$body.css("margin-top",modals[id].$head.outerHeight()),editor.events.$on($modal,"keydown",(function(e){var keycode=e.which;return keycode==$.FE.KEYCODE.ESC?(hide(id),editor.accessibility.focusModalButton($modal),!1):!(!$(e.target).is("input[type=text], textarea")&&keycode!=$.FE.KEYCODE.ARROW_UP&&keycode!=$.FE.KEYCODE.ARROW_DOWN&&!editor.keys.isBrowserAction(e))||(e.preventDefault(),e.stopPropagation(),!1)}),!0),hide(id,!0)}return modals[id]},show:function(id){if(modals[id]){var $modal=modals[id].$modal;$modal.data("instance",editor),$modal.show(),$overlay.show(),$(editor.o_doc).find("body:first").addClass("prevent-scroll"),editor.helpers.isMobile()&&$(editor.o_doc).find("body:first").addClass("fr-mobile"),$modal.addClass("fr-active"),editor.accessibility.focusModal($modal)}},hide:hide,resize:function(id){if(modals[id]){var modalHash=modals[id],$modal=modalHash.$modal,$body=modalHash.$body,height=$(editor.o_win).height(),$wrapper=$modal.find(".fr-modal-wrapper"),maxHeight=height-$wrapper.outerHeight(!0)+($wrapper.height()-($body.outerHeight(!0)-$body.height())),newHeight="auto";$body.get(0).scrollHeight>maxHeight&&(newHeight=maxHeight),$body.height(newHeight)}},isVisible:isVisible,areVisible:function(new_instance){for(var id in modals)if(modals.hasOwnProperty(id)&&isVisible(id)&&(void 0===new_instance||modals[id].$modal.data("instance")==new_instance))return modals[id].$modal;return!1}}}}(jQuery),function($){$.FE.POPUP_TEMPLATES={"text.edit":"[_EDIT_]"},$.FE.RegisterTemplate=function(name,template){$.FE.POPUP_TEMPLATES[name]=template},$.FE.MODULES.popups=function(editor){editor.shared.popups||(editor.shared.popups={});var popups=editor.shared.popups;function setContainer(id,$container){$container.is(":visible")||($container=editor.$sc),$container.is(popups[id].data("container"))||(popups[id].data("container",$container),$container.append(popups[id]))}function isVisible(id){return popups[id]&&editor.node.hasClass(popups[id],"fr-active")&&editor.core.sameInstance(popups[id])||!1}function areVisible(new_instance){for(var id in popups)if(popups.hasOwnProperty(id)&&isVisible(id)&&(void 0===new_instance||popups[id].data("instance")==new_instance))return popups[id];return!1}function hide(id){var $popup=null;($popup="string"!=typeof id?id:popups[id])&&editor.node.hasClass($popup,"fr-active")&&($popup.removeClass("fr-active fr-above"),editor.events.trigger("popups.hide."+id),editor.$tb&&(editor.opts.zIndex>1?editor.$tb.css("zIndex",editor.opts.zIndex+1):editor.$tb.css("zIndex","")),editor.events.disableBlur(),$popup.find("input, textarea, button").filter(":focus").blur(),$popup.find("input, textarea").attr("disabled","disabled"))}function hideAll(except){for(var id in void 0===except&&(except=[]),popups)popups.hasOwnProperty(id)&&except.indexOf(id)<0&&hide(id)}function _markExit(){editor.shared.exit_flag=!0}function _unmarkExit(){editor.shared.exit_flag=!1}function _canExit(){return editor.shared.exit_flag}function _build(id,template){var $popup,$container,html=function(id,template){var html=$.FE.POPUP_TEMPLATES[id];if(!html)return null;for(var nm in"function"==typeof html&&(html=html.apply(editor)),template)template.hasOwnProperty(nm)&&(html=html.replace("[_"+nm.toUpperCase()+"_]",template[nm]));return html}(id,template);return html?($popup=$('<div class="fr-popup'+(editor.helpers.isMobile()?" fr-mobile":" fr-desktop")+(editor.opts.toolbarInline?" fr-inline":"")+'"><span class="fr-arrow"></span>'+html+"</div>"),$(".fr-action-buttons button",$popup).addClass("btn btn-sm btn-secondary"),$(".fr-action-buttons button.fr-submit",$popup).removeClass("btn-secondary").addClass("btn-primary"),editor.opts.theme&&$popup.addClass(editor.opts.theme+"-theme"),editor.opts.zIndex>1&&(editor.opts.editInPopup?$popup.css("z-index",editor.opts.zIndex+2):editor.$tb.css("z-index",editor.opts.zIndex+2)),"auto"!=editor.opts.direction&&$popup.removeClass("fr-ltr fr-rtl").addClass("fr-"+editor.opts.direction),$popup.find("input, textarea").attr("dir",editor.opts.direction).attr("disabled","disabled"),($container=$("body:first")).append($popup),$popup.data("container",$container),popups[id]=$popup,editor.button.bindCommands($popup,!1),$popup):($popup=$('<div class="fr-popup fr-empty"></div>'),($container=$("body:first")).append($popup),$popup.data("container",$container),popups[id]=$popup,$popup)}function _events(id){var $popup=popups[id];return{_windowResize:function(){var inst=$popup.data("instance")||editor;!inst.helpers.isMobile()&&$popup.is(":visible")&&(inst.events.disableBlur(),inst.popups.hide(id),inst.events.enableBlur())},_inputFocus:function(e){var inst=$popup.data("instance")||editor,$target=$(e.currentTarget);if($target.is("input:file")&&$target.closest(".fr-layer").addClass("fr-input-focus"),e.preventDefault(),e.stopPropagation(),setTimeout((function(){inst.events.enableBlur()}),editor.browser.msie?100:0),inst.helpers.isMobile()){var t=$(inst.o_win).scrollTop();setTimeout((function(){$(inst.o_win).scrollTop(t)}),0)}},_inputBlur:function(e){var inst=$popup.data("instance")||editor,$target=$(e.currentTarget);$target.is("input:file")&&$target.closest(".fr-layer").removeClass("fr-input-focus"),document.activeElement!=this&&$(this).is(":visible")&&(inst.events.blurActive()&&inst.events.trigger("blur"),inst.events.enableBlur())},_editorKeydown:function(e){var inst=$popup.data("instance")||editor;inst.keys.ctrlKey(e)||e.which==$.FE.KEYCODE.ALT||e.which==$.FE.KEYCODE.ESC||(isVisible(id)&&$popup.find(".fr-back:visible").length?inst.button.exec($popup.find(".fr-back:visible:first")):e.which!=$.FE.KEYCODE.ALT&&inst.popups.hide(id))},_preventFocus:function(e){var inst=$popup.data("instance")||editor,originalTarget=e.originalEvent?e.originalEvent.target||e.originalEvent.originalTarget:null;"mouseup"==e.type||$(originalTarget).is(":focus")||inst.events.disableBlur(),"mouseup"!=e.type||$(originalTarget).hasClass("fr-command")||$(originalTarget).parents(".fr-command").length>0||$(originalTarget).hasClass("fr-dropdown-content")||editor.button.hideActiveDropdowns($popup),(editor.browser.safari||editor.browser.mozilla)&&"mousedown"==e.type&&$(originalTarget).is("input[type=file]")&&inst.events.disableBlur();var input_selector="input, textarea, button, select, label, .fr-command";if(originalTarget&&!$(originalTarget).is(input_selector)&&0===$(originalTarget).parents(input_selector).length)return e.stopPropagation(),!1;originalTarget&&$(originalTarget).is(input_selector)&&e.stopPropagation(),_unmarkExit()},_editorMouseup:function(){$popup.is(":visible")&&_canExit()&&$popup.find("input:focus, textarea:focus, button:focus, select:focus").filter(":visible").length>0&&editor.events.disableBlur()},_windowMouseup:function(e){if(!editor.core.sameInstance($popup))return!0;var inst=$popup.data("instance")||editor;$popup.is(":visible")&&_canExit()&&(e.stopPropagation(),inst.markers.remove(),inst.popups.hide(id),_unmarkExit())},_windowKeydown:function(e){if(!editor.core.sameInstance($popup))return!0;var inst=$popup.data("instance")||editor,key_code=e.which;if($.FE.KEYCODE.ESC==key_code){if(inst.popups.isVisible(id)&&inst.opts.toolbarInline)return e.stopPropagation(),inst.popups.isVisible(id)&&($popup.find(".fr-back:visible").length?(inst.button.exec($popup.find(".fr-back:visible:first")),inst.accessibility.focusPopupButton($popup)):$popup.find(".fr-dismiss:visible").length?inst.button.exec($popup.find(".fr-dismiss:visible:first")):(inst.popups.hide(id),inst.toolbar.showInline(null,!0),inst.accessibility.focusPopupButton($popup))),!1;if(inst.popups.isVisible(id))return $popup.find(".fr-back:visible").length?(inst.button.exec($popup.find(".fr-back:visible:first")),inst.accessibility.focusPopupButton($popup)):$popup.find(".fr-dismiss:visible").length?inst.button.exec($popup.find(".fr-dismiss:visible:first")):(inst.popups.hide(id),inst.accessibility.focusPopupButton($popup)),!1}},_doPlaceholder:function(){0===$(this).next().length&&$(this).attr("placeholder")&&$(this).after('<label for="'+$(this).attr("id")+'">'+$(this).attr("placeholder")+"</label>"),$(this).toggleClass("fr-not-empty",""!==$(this).val())},_repositionPopup:function(){if(!editor.opts.height&&!editor.opts.heightMax||editor.opts.toolbarInline)return!0;if(editor.$wp&&isVisible(id)&&$popup.parent().get(0)==editor.$sc.get(0)){var p_top=$popup.offset().top-editor.$wp.offset().top,w_height=editor.$wp.outerHeight();editor.node.hasClass($popup.get(0),"fr-above")&&(p_top+=$popup.outerHeight()),p_top>w_height||p_top<0?$popup.addClass("fr-hidden"):$popup.removeClass("fr-hidden")}}}}function _bindInstanceEvents(ev,id){editor.events.on("mouseup",ev._editorMouseup,!0),editor.$wp&&editor.events.on("keydown",ev._editorKeydown),editor.events.on("blur",(function(){areVisible()&&editor.markers.remove(),hideAll()})),editor.$wp&&!editor.helpers.isMobile()&&editor.events.$on(editor.$wp,"scroll.popup"+id,ev._repositionPopup),editor.events.on("window.mouseup",ev._windowMouseup,!0),editor.events.on("window.keydown",ev._windowKeydown,!0),popups[id].data("inst"+editor.id,!0),editor.events.on("destroy",(function(){editor.core.sameInstance(popups[id])&&popups[id].removeClass("fr-active").appendTo("body:first")}),!0)}function _destroy(){for(var id in popups)if(popups.hasOwnProperty(id)){var $popup=popups[id];$popup&&($popup.html("").removeData().remove(),popups[id]=null)}popups=[]}return editor.shared.exit_flag=!1,{_init:function(){editor.events.on("shared.destroy",_destroy,!0),editor.events.on("window.mousedown",_markExit),editor.events.on("window.touchmove",_unmarkExit),editor.events.$on($(editor.o_win),"scroll",_unmarkExit),editor.events.on("mousedown",(function(e){areVisible()&&(e.stopPropagation(),editor.$el.find(".fr-marker").remove(),_markExit(),editor.events.disableBlur())}))},create:function(id,template){var $popup=_build(id,template),ev=_events(id);return _bindInstanceEvents(ev,id),editor.events.$on($popup,"mousedown mouseup touchstart touchend touch","*",ev._preventFocus,!0),editor.events.$on($popup,"focus","input, textarea, button, select",ev._inputFocus,!0),editor.events.$on($popup,"blur","input, textarea, button, select",ev._inputBlur,!0),editor.accessibility.registerPopup(id),editor.events.$on($popup,"keydown keyup change input","input, textarea",ev._doPlaceholder,!0),editor.helpers.isIOS()&&editor.events.$on($popup,"touchend","label",(function(){$("#"+$(this).attr("for")).prop("checked",(function(i,val){return!val}))}),!0),editor.events.$on($(editor.o_win),"resize",ev._windowResize,!0),$popup},get:function(id){var $popup=popups[id];return $popup&&!$popup.data("inst"+editor.id)&&_bindInstanceEvents(_events(id),id),$popup},show:function(id,left,top,obj_height){if(isVisible(id)||(areVisible()&&editor.$el.find(".fr-marker").length>0?(editor.events.disableBlur(),editor.selection.restore()):areVisible()||(editor.events.disableBlur(),editor.events.focus(),editor.events.enableBlur())),hideAll([id]),!popups[id])return!1;var $active_dropdowns=editor.button.getButtons(".fr-dropdown.fr-active");$active_dropdowns.removeClass("fr-active").attr("aria-expanded",!1).parent(".fr-toolbar").css("zIndex",""),$active_dropdowns.next().attr("aria-hidden",!0),popups[id].data("instance",editor),editor.$tb&&editor.$tb.data("instance",editor);var width=popups[id].outerWidth(),is_visible=isVisible(id);popups[id].addClass("fr-active").removeClass("fr-hidden").find("input, textarea").removeAttr("disabled");var $container=popups[id].data("container");!function(id,$container){$container.is(":visible")||($container=editor.$sc),0===$container.find([popups[id]]).length&&$container.append(popups[id])}(id,$container),editor.opts.toolbarInline&&$container&&editor.$tb&&$container.get(0)==editor.$tb.get(0)&&(setContainer(id,editor.$sc),top=editor.$tb.offset().top-editor.helpers.getPX(editor.$tb.css("margin-top")),left=editor.$tb.offset().left+editor.$tb.outerWidth()/2+(parseFloat(editor.$tb.find(".fr-arrow").css("margin-left"))||0)+editor.$tb.find(".fr-arrow").outerWidth()/2,editor.node.hasClass(editor.$tb.get(0),"fr-above")&&top&&(top+=editor.$tb.outerHeight()),obj_height=0),$container=popups[id].data("container"),!editor.opts.iframe||obj_height||is_visible||(left&&(left-=editor.$iframe.offset().left),top&&(top-=editor.$iframe.offset().top)),$container.is(editor.$tb)?editor.$tb.css("zIndex",(editor.opts.zIndex||1)+4):popups[id].css("zIndex",(editor.opts.zIndex||1)+4),left&&(left-=width/2),editor.opts.toolbarBottom&&$container&&editor.$tb&&$container.get(0)==editor.$tb.get(0)&&(popups[id].addClass("fr-above"),top&&(top-=popups[id].outerHeight())),popups[id].removeClass("fr-active"),editor.position.at(left,top,popups[id],obj_height||0),popups[id].addClass("fr-active"),is_visible||editor.accessibility.focusPopup(popups[id]),editor.opts.toolbarInline&&editor.toolbar.hide(),editor.events.trigger("popups.show."+id),_events(id)._repositionPopup(),_unmarkExit()},hide:hide,onHide:function(id,callback){editor.events.on("popups.hide."+id,callback)},hideAll:hideAll,setContainer:setContainer,refresh:function(id){popups[id].data("instance",editor),editor.events.trigger("popups.refresh."+id);for(var btns=popups[id].find(".fr-command"),i=0;i<btns.length;i++){var $btn=$(btns[i]);0===$btn.parents(".fr-dropdown-menu").length&&editor.button.refresh($btn)}},onRefresh:function(id,callback){editor.events.on("popups.refresh."+id,callback)},onShow:function(id,callback){editor.events.on("popups.show."+id,callback)},isVisible:isVisible,areVisible:areVisible}}}(jQuery),function($){$.FE.MODULES.position=function(editor){function getBoundingRect(){var boundingRect=editor.selection.ranges(0).getBoundingClientRect();if(0===boundingRect.top&&0===boundingRect.left&&0===boundingRect.width||0===boundingRect.height){var remove=!1;0===editor.$el.find(".fr-marker").length&&(editor.selection.save(),remove=!0);var $marker=editor.$el.find(".fr-marker:first");$marker.css("display","inline"),$marker.css("line-height","");var offset=$marker.offset(),height=$marker.outerHeight();$marker.css("display","none"),$marker.css("line-height",0),(boundingRect={}).left=offset.left,boundingRect.width=0,boundingRect.height=height,boundingRect.top=offset.top-(editor.opts.iframe?0:editor.helpers.scrollTop()),boundingRect.right=1,boundingRect.bottom=1,boundingRect.ok=!0,remove&&editor.selection.restore()}return boundingRect}function at(left,top,$el,obj_height){var $container=$el.data("container");!$container||"BODY"===$container.get(0).tagName&&"static"==$container.css("position")||(left&&(left-=$container.offset().left),top&&(top-=$container.offset().top),"BODY"!=$container.get(0).tagName?(left&&(left+=$container.get(0).scrollLeft),top&&(top+=$container.get(0).scrollTop)):"absolute"==$container.css("position")&&(left&&(left+=$container.position().left),top&&(top+=$container.position().top))),editor.opts.iframe&&$container&&editor.$tb&&$container.get(0)!=editor.$tb.get(0)&&(left&&(left+=editor.$iframe.offset().left),top&&(top+=editor.$iframe.offset().top));var new_left=function($el,left){var width=$el.outerWidth(!0),p_offset=$el.parent().offset().left;return $el.parent().get(0)==editor.$sc.get(0)&&(p_offset-=$el.parent().position().left),p_offset+left+width>editor.$sc.get(0).clientWidth-10&&(left=editor.$sc.get(0).clientWidth-width-p_offset-10),left<0&&(left=10),left}($el,left);if(left){$el.css("left",new_left);var $arrow=$el.data("fr-arrow");$arrow||($arrow=$el.find(".fr-arrow"),$el.data("fr-arrow",$arrow)),$arrow.data("margin-left")||$arrow.data("margin-left",editor.helpers.getPX($arrow.css("margin-left"))),$arrow.css("margin-left",left-new_left+$arrow.data("margin-left"))}top&&$el.css("top",function($el,top,obj_height){var height=$el.outerHeight(!0);if(!editor.helpers.isMobile()&&editor.$tb&&$el.parent().get(0)!=editor.$tb.get(0)){var p_offset=$el.parent().offset().top,new_top=top-height-(obj_height||0);$el.parent().get(0)==editor.$sc.get(0)&&(p_offset-=$el.parent().position().top);var s_height=editor.$sc.get(0).clientHeight;p_offset+top+height>editor.$sc.offset().top+s_height&&$el.parent().offset().top+new_top>0&&new_top>0?new_top>editor.$wp.scrollTop()&&(top=new_top,$el.addClass("fr-above")):$el.removeClass("fr-above")}return top}($el,top,obj_height))}function _updateIOSSticky(el){var $el=$(el),is_on=$el.is(".fr-sticky-on"),prev_top=$el.data("sticky-top"),scheduled_top=$el.data("sticky-scheduled");if(void 0===prev_top){$el.data("sticky-top",0);var $dummy=$('<div class="fr-sticky-dummy" style="height: '+$el.outerHeight()+'px;"></div>');editor.$box.prepend($dummy)}else editor.$box.find(".fr-sticky-dummy").css("height",$el.outerHeight());if(editor.core.hasFocus()||editor.$tb.find("input:visible:focus").length>0){var x_scroll=editor.helpers.scrollTop(),x_top=Math.min(Math.max(x_scroll-editor.$tb.parent().offset().top,0),editor.$tb.parent().outerHeight()-$el.outerHeight());x_top!=prev_top&&x_top!=scheduled_top&&(clearTimeout($el.data("sticky-timeout")),$el.data("sticky-scheduled",x_top),$el.outerHeight()<x_scroll-editor.$tb.parent().offset().top&&$el.addClass("fr-opacity-0"),$el.data("sticky-timeout",setTimeout((function(){var c_scroll=editor.helpers.scrollTop(),c_top=Math.min(Math.max(c_scroll-editor.$tb.parent().offset().top,0),editor.$tb.parent().outerHeight()-$el.outerHeight());c_top>0&&"BODY"==editor.$tb.parent().get(0).tagName&&(c_top+=editor.$tb.parent().position().top),c_top!=prev_top&&($el.css("top",Math.max(c_top,0)),$el.data("sticky-top",c_top),$el.data("sticky-scheduled",c_top)),$el.removeClass("fr-opacity-0")}),100))),is_on||($el.css("top","0"),$el.width(editor.$tb.parent().width()),$el.addClass("fr-sticky-on"),editor.$box.addClass("fr-sticky-box"))}else clearTimeout($(el).css("sticky-timeout")),$el.css("top","0"),$el.css("position",""),$el.width(""),$el.data("sticky-top",0),$el.removeClass("fr-sticky-on"),editor.$box.removeClass("fr-sticky-box")}function _updateSticky(el){if(el.offsetWidth){var el_top,el_bottom,$el=$(el),height=$el.outerHeight(),prev_top=$el.data("sticky-top"),position=$el.data("sticky-position"),viewport_height=$("body"==editor.opts.scrollableContainer?editor.o_win:editor.opts.scrollableContainer).outerHeight(),scrollable_top=0,scrollable_bottom=0;"body"!==editor.opts.scrollableContainer&&(scrollable_top=editor.$sc.offset().top,scrollable_bottom=$(editor.o_win).outerHeight()-scrollable_top-viewport_height);var offset_top="body"==editor.opts.scrollableContainer?editor.helpers.scrollTop():scrollable_top,is_on=$el.is(".fr-sticky-on");$el.data("sticky-parent")||$el.data("sticky-parent",$el.parent());var $parent=$el.data("sticky-parent"),parent_top=$parent.offset().top,parent_height=$parent.outerHeight();if($el.data("sticky-offset")||void 0!==prev_top?editor.$box.find(".fr-sticky-dummy").css("height",height+"px"):($el.data("sticky-offset",!0),$el.after('<div class="fr-sticky-dummy" style="height: '+height+'px;"></div>')),!position){var skip_setting_fixed="auto"!==$el.css("top")||"auto"!==$el.css("bottom");skip_setting_fixed||$el.css("position","fixed"),position={top:editor.node.hasClass($el.get(0),"fr-top"),bottom:editor.node.hasClass($el.get(0),"fr-bottom")},skip_setting_fixed||$el.css("position",""),$el.data("sticky-position",position),$el.data("top",editor.node.hasClass($el.get(0),"fr-top")?$el.css("top"):"auto"),$el.data("bottom",editor.node.hasClass($el.get(0),"fr-bottom")?$el.css("bottom"):"auto")}el_top=editor.helpers.getPX($el.data("top")),el_bottom=editor.helpers.getPX($el.data("bottom"));var at_top=position.top&&parent_top<offset_top+el_top&&parent_top+parent_height-height>=offset_top+el_top&&(editor.helpers.isInViewPort(editor.$sc.get(0))||"body"==editor.opts.scrollableContainer),at_bottom=position.bottom&&parent_top+height<offset_top+viewport_height-el_bottom&&parent_top+parent_height>offset_top+viewport_height-el_bottom;at_top||at_bottom?($el.css("width",$parent.get(0).getBoundingClientRect().width+"px"),is_on||($el.addClass("fr-sticky-on"),$el.removeClass("fr-sticky-off"),$el.css("top")&&("auto"!=$el.data("top")?$el.css("top",editor.helpers.getPX($el.data("top"))+scrollable_top):$el.data("top","auto")),$el.css("bottom")&&("auto"!=$el.data("bottom")?$el.css("bottom",editor.helpers.getPX($el.data("bottom"))+scrollable_bottom):$el.css("bottom","auto")))):editor.node.hasClass($el.get(0),"fr-sticky-off")||($el.width(""),$el.removeClass("fr-sticky-on"),$el.addClass("fr-sticky-off"),$el.css("top")&&"auto"!=$el.data("top")&&position.top&&$el.css("top",0),$el.css("bottom")&&"auto"!=$el.data("bottom")&&position.bottom&&$el.css("bottom",0))}}function refresh(){if(editor._stickyElements)for(var i=0;i<editor._stickyElements.length;i++)_updateSticky(editor._stickyElements[i])}return{_init:function(){!function(){if(editor._stickyElements=[],editor.helpers.isIOS()){var animate=function(){if(editor.helpers.requestAnimationFrame()(animate),!1!==editor.events.trigger("position.refresh"))for(var i=0;i<editor._stickyElements.length;i++)_updateIOSSticky(editor._stickyElements[i])};animate(),editor.events.$on($(editor.o_win),"scroll",(function(){if(editor.core.hasFocus())for(var i=0;i<editor._stickyElements.length;i++){var $el=$(editor._stickyElements[i]),$parent=$el.parent(),c_scroll=editor.helpers.scrollTop();$el.outerHeight()<c_scroll-$parent.offset().top&&($el.addClass("fr-opacity-0"),$el.data("sticky-top",-1),$el.data("sticky-scheduled",-1))}}),!0)}else"body"!==editor.opts.scrollableContainer&&editor.events.$on($(editor.opts.scrollableContainer),"scroll",refresh,!0),editor.events.$on($(editor.o_win),"scroll",refresh,!0),editor.events.$on($(editor.o_win),"resize",refresh,!0),editor.events.on("initialized",refresh),editor.events.on("focus",refresh),editor.events.$on($(editor.o_win),"resize","textarea",refresh,!0);editor.events.on("destroy",(function(){editor._stickyElements=[]}))}()},forSelection:function($el){var selection_rect=getBoundingRect();$el.css({top:0,left:0});var top=selection_rect.top+selection_rect.height,left=selection_rect.left+selection_rect.width/2-$el.get(0).offsetWidth/2+editor.helpers.scrollLeft();editor.opts.iframe||(top+=editor.helpers.scrollTop()),at(left,top,$el,selection_rect.height)},addSticky:function($el){$el.addClass("fr-sticky"),editor.helpers.isIOS()&&$el.addClass("fr-sticky-ios"),$el.removeClass("fr-sticky"),editor._stickyElements.push($el.get(0))},refresh:refresh,at:at,getBoundingRect:getBoundingRect}}}(jQuery),function($){$.FE.MODULES.refresh=function(editor){function _setDisabled($btn,disabled){$btn.toggleClass("fr-disabled",disabled).attr("aria-disabled",disabled)}return{undo:function($btn){_setDisabled($btn,!editor.undo.canDo())},redo:function($btn){_setDisabled($btn,!editor.undo.canRedo())},outdent:function($btn){if(editor.node.hasClass($btn.get(0),"fr-no-refresh"))return!1;for(var blocks=editor.selection.blocks(),i=0;i<blocks.length;i++){var prop="rtl"==editor.opts.direction||"rtl"==$(blocks[i]).css("direction")?"margin-right":"margin-left";if("LI"==blocks[i].tagName||"LI"==blocks[i].parentNode.tagName)return _setDisabled($btn,!1),!0;if(editor.helpers.getPX($(blocks[i]).css(prop))>0)return _setDisabled($btn,!1),!0}_setDisabled($btn,!0)},indent:function($btn){if(editor.node.hasClass($btn.get(0),"fr-no-refresh"))return!1;for(var blocks=editor.selection.blocks(),i=0;i<blocks.length;i++){for(var p_node=blocks[i].previousSibling;p_node&&p_node.nodeType==Node.TEXT_NODE&&0===p_node.textContent.length;)p_node=p_node.previousSibling;if("LI"!=blocks[i].tagName||p_node)return _setDisabled($btn,!1),!0;_setDisabled($btn,!0)}}}}}(jQuery),function($){$.extend($.FE.DEFAULTS,{editInPopup:!1}),$.FE.MODULES.textEdit=function(editor){function _initEvents(){editor.events.$on(editor.$el,editor._mouseup,(function(){setTimeout((function(){var text,$popup;$popup=editor.popups.get("text.edit"),text="INPUT"===editor.$el.prop("tagName")?editor.$el.attr("placeholder"):editor.$el.text(),$popup.find("input").val(text).trigger("change"),editor.popups.setContainer("text.edit",editor.$sc),editor.popups.show("text.edit",editor.$el.offset().left+editor.$el.outerWidth()/2,editor.$el.offset().top+editor.$el.outerHeight(),editor.$el.outerHeight())}),10)}))}return{_init:function(){var template;editor.opts.editInPopup&&(template={edit:`\n                <div id="fr-text-edit-${editor.id}" class="fr-layer fr-text-edit-layer">\n                    <div class="fr-input-line">\n                        <input type="text" placeholder="${editor.language.translate("Text")}" tabIndex="1">\n                    </div>\n                    <div class="fr-action-buttons">\n                        <button type="button" class="fr-command fr-submit" data-cmd="updateText" tabIndex="2">\n                        ${editor.language.translate("Update")}\n                        </button>\n                    </div>\n                </div>\n            `},editor.popups.create("text.edit",template),_initEvents())},update:function(){var new_text=editor.popups.get("text.edit").find("input").val();0===new_text.length&&(new_text=editor.opts.placeholderText),"INPUT"===editor.$el.prop("tagName")?editor.$el.attr("placeholder",new_text):editor.$el.text(new_text),editor.events.trigger("contentChanged"),editor.popups.hide("text.edit")}}},$.FE.RegisterCommand("updateText",{focus:!1,undo:!1,callback:function(){this.textEdit.update()}})}(jQuery),function($){$.extend($.FE.DEFAULTS,{toolbarBottom:!1,toolbarButtons:null,toolbarButtonsXS:null,toolbarButtonsSM:null,toolbarButtonsMD:null,toolbarContainer:null,toolbarInline:!1,toolbarSticky:!0,toolbarStickyOffset:0,toolbarVisibleWithoutSelection:!1}),$.FE.TOOLBAR_BUTTONS=["fullscreen","bold","italic","underline","strikeThrough","subscript","superscript","|","fontFamily","fontSize","color","inlineClass","inlineStyle","paragraphStyle","lineHeight","|","paragraphFormat","align","formatOL","formatUL","outdent","indent","quote","-","insertLink","insertImage","insertVideo","embedly","insertFile","insertTable","|","emoticons","fontAwesome","specialCharacters","insertHR","selectAll","clearFormatting","|","print","getPDF","spellChecker","help","html","|","undo","redo"],$.FE.TOOLBAR_BUTTONS_MD=null,$.FE.TOOLBAR_BUTTONS_SM=["bold","italic","underline","|","fontFamily","fontSize","insertLink","insertImage","table","|","undo","redo"],$.FE.TOOLBAR_BUTTONS_XS=["bold","italic","fontFamily","fontSize","|","undo","redo"],$.FE.MODULES.toolbar=function(editor){var _buttons_map=[];function _addOtherButtons(buttons,toolbarButtons){for(var i=0;i<toolbarButtons.length;i++)"-"!=toolbarButtons[i]&&"|"!=toolbarButtons[i]&&buttons.indexOf(toolbarButtons[i])<0&&buttons.push(toolbarButtons[i])}function _screenButtons(){var screen_size=editor.helpers.screenSize();return _buttons_map[screen_size]}function _showScreenButtons(){var c_buttons=_screenButtons();editor.$tb.find(".fr-separator").remove(),editor.$tb.find("> .fr-command, > div.fr-btn-wrap").addClass("fr-hidden");for(var i=0;i<c_buttons.length;i++)if("|"==c_buttons[i]||"-"==c_buttons[i])editor.$tb.append(editor.button.buildList([c_buttons[i]]));else{var $btn=editor.$tb.find('> .fr-command[data-cmd="'+c_buttons[i]+'"], > div.fr-btn-wrap > .fr-command[data-cmd="'+c_buttons[i]+'"]'),$dropdown=null;editor.node.hasClass($btn.next().get(0),"fr-dropdown-menu")&&($dropdown=$btn.next()),editor.node.hasClass($btn.next().get(0),"fr-options")&&($btn=$btn.parent()),$btn.removeClass("fr-hidden").appendTo(editor.$tb),$dropdown&&$dropdown.appendTo(editor.$tb)}}function showInline(e,force){setTimeout((function(){if((!e||e.which!=$.FE.KEYCODE.ESC)&&editor.selection.inEditor()&&editor.core.hasFocus()&&!editor.popups.areVisible()&&(editor.opts.toolbarVisibleWithoutSelection||!editor.selection.isCollapsed()&&!editor.keys.isIME()||force)){if(editor.$tb.data("instance",editor),!1===editor.events.trigger("toolbar.show",[e]))return!1;editor.$tb.show(),editor.opts.toolbarContainer||editor.position.forSelection(editor.$tb),editor.opts.zIndex>1?editor.$tb.css("z-index",editor.opts.zIndex+1):editor.$tb.css("z-index",null)}}),0)}function hide(e){return(!e||"blur"!==e.type||document.activeElement!==editor.el)&&(!(!e||"keydown"!==e.type||!editor.keys.ctrlKey(e))||(!!editor.button.getButtons(".fr-dropdown.fr-active").next().find(editor.o_doc.activeElement).length||void(!1!==editor.events.trigger("toolbar.hide")&&editor.$tb.hide())))}_buttons_map[$.FE.XS]=editor.opts.toolbarButtonsXS||editor.opts.toolbarButtons||$.FE.TOOLBAR_BUTTONS_XS||$.FE.TOOLBAR_BUTTONS||[],_buttons_map[$.FE.SM]=editor.opts.toolbarButtonsSM||editor.opts.toolbarButtons||$.FE.TOOLBAR_BUTTONS_SM||$.FE.TOOLBAR_BUTTONS||[],_buttons_map[$.FE.MD]=editor.opts.toolbarButtonsMD||editor.opts.toolbarButtons||$.FE.TOOLBAR_BUTTONS_MD||$.FE.TOOLBAR_BUTTONS||[],_buttons_map[$.FE.LG]=editor.opts.toolbarButtons||$.FE.TOOLBAR_BUTTONS||[];var tm=null;function _showInlineWithTimeout(e){clearTimeout(tm),e&&e.which==$.FE.KEYCODE.ESC||(tm=setTimeout(showInline,editor.opts.typingTimer))}function _initInlineBehavior(){editor.events.on("window.mousedown",hide),editor.events.on("keydown",hide),editor.events.on("blur",hide),editor.helpers.isMobile()||editor.events.on("window.mouseup",showInline),editor.helpers.isMobile()?editor.helpers.isIOS()||(editor.events.on("window.touchend",showInline),editor.browser.mozilla&&setInterval(showInline,200)):editor.events.on("window.keyup",_showInlineWithTimeout),editor.events.on("keydown",(function(e){e&&e.which==$.FE.KEYCODE.ESC&&hide()})),editor.events.on("keydown",(function(e){if(e.which==$.FE.KEYCODE.ALT)return e.stopPropagation(),!1}),!0),editor.events.$on(editor.$wp,"scroll.toolbar",showInline),editor.events.$on(editor.$sc,"scroll.toolbar",showInline),editor.events.on("commands.after",showInline),editor.helpers.isMobile()&&(editor.events.$on(editor.$doc,"selectionchange",_showInlineWithTimeout),editor.events.$on(editor.$doc,"orientationchange",showInline))}function _sharedDestroy(){editor.$tb.html("").removeData().remove(),editor.$tb=null}function _destroy(){editor.$box.removeClass("fr-top fr-bottom fr-inline fr-basic"),editor.$box.find(".fr-sticky-dummy").remove()}function _setDefaults(){editor.opts.theme&&editor.$tb.addClass(editor.opts.theme+"-theme"),editor.opts.zIndex>1&&editor.$tb.css("z-index",editor.opts.zIndex+1),"auto"!=editor.opts.direction&&editor.$tb.removeClass("fr-ltr fr-rtl").addClass("fr-"+editor.opts.direction),editor.helpers.isMobile()?editor.$tb.addClass("fr-mobile"):editor.$tb.addClass("fr-desktop"),editor.opts.toolbarContainer?(editor.opts.toolbarInline&&(_initInlineBehavior(),hide()),editor.opts.toolbarBottom?editor.$tb.addClass("fr-bottom"):editor.$tb.addClass("fr-top")):editor.opts.toolbarInline?(editor.$sc.append(editor.$tb),editor.$tb.data("container",editor.$sc),editor.$tb.addClass("fr-inline"),editor.$tb.prepend('<span class="fr-arrow"></span>'),_initInlineBehavior(),editor.opts.toolbarBottom=!1):(editor.opts.toolbarBottom&&!editor.helpers.isIOS()?(editor.$box.append(editor.$tb),editor.$tb.addClass("fr-bottom"),editor.$box.addClass("fr-bottom")):(editor.opts.toolbarBottom=!1,editor.$box.prepend(editor.$tb),editor.$tb.addClass("fr-top"),editor.$box.addClass("fr-top")),editor.$tb.addClass("fr-basic"),editor.opts.toolbarSticky&&(editor.opts.toolbarStickyOffset&&(editor.opts.toolbarBottom?editor.$tb.css("bottom",editor.opts.toolbarStickyOffset):editor.$tb.css("top",editor.opts.toolbarStickyOffset)),editor.position.addSticky(editor.$tb))),function(){var _buttons=$.merge([],_screenButtons());_addOtherButtons(_buttons,_buttons_map[$.FE.XS]),_addOtherButtons(_buttons,_buttons_map[$.FE.SM]),_addOtherButtons(_buttons,_buttons_map[$.FE.MD]),_addOtherButtons(_buttons,_buttons_map[$.FE.LG]);for(var i=_buttons.length-1;i>=0;i--)"-"!=_buttons[i]&&"|"!=_buttons[i]&&_buttons.indexOf(_buttons[i])<i&&_buttons.splice(i,1);var buttons_list=editor.button.buildList(_buttons,_screenButtons());editor.$tb.append(buttons_list),editor.button.bindCommands(editor.$tb)}(),editor.events.$on($(editor.o_win),"resize",_showScreenButtons),editor.events.$on($(editor.o_win),"orientationchange",_showScreenButtons),editor.accessibility.registerToolbar(editor.$tb),editor.events.$on(editor.$tb,editor._mousedown+" "+editor._mouseup,(function(e){var originalTarget=e.originalEvent?e.originalEvent.target||e.originalEvent.originalTarget:null;if(originalTarget&&"INPUT"!=originalTarget.tagName&&!editor.edit.isDisabled())return e.stopPropagation(),e.preventDefault(),!1}),!0)}var disabled=!1;return{_init:function(){if(editor.$sc=$(editor.opts.scrollableContainer).first(),!editor.$wp)return!1;editor.opts.toolbarContainer?(editor.shared.$tb?(editor.$tb=editor.shared.$tb,editor.opts.toolbarInline&&_initInlineBehavior()):(editor.shared.$tb=$('<div class="fr-toolbar"></div>'),editor.$tb=editor.shared.$tb,$(editor.opts.toolbarContainer).append(editor.$tb),_setDefaults(),editor.$tb.data("instance",editor)),editor.opts.toolbarInline?editor.$box.addClass("fr-inline"):editor.$box.addClass("fr-basic"),editor.events.on("focus",(function(){editor.$tb.data("instance",editor)}),!0),editor.opts.toolbarInline=!1):editor.opts.toolbarInline?(editor.$box.addClass("fr-inline"),editor.shared.$tb?(editor.$tb=editor.shared.$tb,_initInlineBehavior()):(editor.shared.$tb=$('<div class="fr-toolbar"></div>'),editor.$tb=editor.shared.$tb,_setDefaults())):(editor.$box.addClass("fr-basic"),editor.$tb=$('<div class="fr-toolbar"></div>'),_setDefaults(),editor.$tb.data("instance",editor)),editor.events.on("destroy",_destroy,!0),editor.events.on(editor.opts.toolbarInline||editor.opts.toolbarContainer?"shared.destroy":"destroy",_sharedDestroy,!0)},hide:hide,show:function(){if(!1===editor.events.trigger("toolbar.show"))return!1;editor.$tb.show()},hasButton:function(name){return _screenButtons().includes(name)},showInline:showInline,disable:function(){!disabled&&editor.$tb&&(editor.$tb.find("> .fr-command, .fr-btn-wrap > .fr-command").addClass("fr-disabled fr-no-refresh").attr("aria-disabled",!0),disabled=!0)},enable:function(){disabled&&editor.$tb&&(editor.$tb.find("> .fr-command, .fr-btn-wrap > .fr-command").removeClass("fr-disabled fr-no-refresh").attr("aria-disabled",!1),disabled=!1),editor.button.bulkRefresh()}}}}(jQuery),function($){$.extend($.FE.DEFAULTS,{paragraphStyles:{"fr-text-gray":"Gray","fr-text-bordered":"Bordered","fr-text-spaced":"Spaced","fr-text-uppercase":"Uppercase"},paragraphMultipleStyles:!0}),$.FE.PLUGINS.paragraphStyle=function(editor){return{_init:function(){},apply:function(val,paragraphStyles,paragraphMultipleStyles){void 0===paragraphStyles&&(paragraphStyles=editor.opts.paragraphStyles),void 0===paragraphMultipleStyles&&(paragraphMultipleStyles=editor.opts.paragraphMultipleStyles);var styles="";paragraphMultipleStyles||((styles=Object.keys(paragraphStyles)).splice(styles.indexOf(val),1),styles=styles.join(" ")),editor.selection.save(),editor.html.wrap(!0,!0,!0,!0),editor.selection.restore();var blocks=editor.selection.blocks();editor.selection.save();for(var hasClass=$(blocks[0]).hasClass(val),i=0;i<blocks.length;i++)$(blocks[i]).removeClass(styles).toggleClass(val,!hasClass),$(blocks[i]).hasClass("fr-temp-div")&&$(blocks[i]).removeClass("fr-temp-div"),""===$(blocks[i]).attr("class")&&$(blocks[i]).removeAttr("class");editor.html.unwrap(),editor.selection.restore()},refreshOnShow:function($btn,$dropdown){var blocks=editor.selection.blocks();if(blocks.length){var $blk=$(blocks[0]);$dropdown.find(".fr-command").each((function(){var cls=$(this).data("param1"),active=$blk.hasClass(cls);$(this).toggleClass("fr-active",active).attr("aria-selected",active)}))}}}},$.FE.RegisterCommand("paragraphStyle",{type:"dropdown",html:function(){var c='<ul class="fr-dropdown-list" role="presentation">',options=this.opts.paragraphStyles;for(var val in options)options.hasOwnProperty(val)&&(c+='<li role="presentation"><a class="fr-command '+val+'" tabIndex="-1" role="option" data-cmd="paragraphStyle" data-param1="'+val+'" title="'+this.language.translate(options[val])+'">'+this.language.translate(options[val])+"</a></li>");return c+="</ul>"},title:"Paragraph Style",callback:function(cmd,val){this.paragraphStyle.apply(val)},refreshOnShow:function($btn,$dropdown){this.paragraphStyle.refreshOnShow($btn,$dropdown)},plugin:"paragraphStyle"}),$.FE.DefineIcon("paragraphStyle",{NAME:"magic"})}(jQuery),function($){$.FE.PLUGINS.fullscreen=function(editor){var old_scroll,$placeholder,height,max_height,z_index;function isActive(){return editor.$box.hasClass("fr-fullscreen")}function _on(){if(editor.helpers.isIOS()&&editor.core.hasFocus())return editor.$el.blur(),setTimeout(toggle,250),!1;old_scroll=editor.helpers.scrollTop(),editor.$box.toggleClass("fr-fullscreen"),$("body:first").toggleClass("fr-fullscreen"),$placeholder=$('<div style="display: none;"></div>'),editor.$box.after($placeholder),editor.helpers.isMobile()&&(editor.$tb.data("parent",editor.$tb.parent()),editor.$tb.prependTo(editor.$box),editor.$tb.data("sticky-dummy")&&editor.$tb.after(editor.$tb.data("sticky-dummy"))),height=editor.opts.height,max_height=editor.opts.heightMax,z_index=editor.opts.zIndex,editor.position.refresh(),editor.opts.height=editor.o_win.innerHeight-(editor.opts.toolbarInline?0:editor.$tb.outerHeight()),editor.opts.zIndex=9990,editor.opts.heightMax=null,editor.size.refresh(),editor.opts.toolbarInline&&editor.toolbar.showInline(),editor.events.trigger("charCounter.update"),editor.events.trigger("codeView.update"),editor.$win.trigger("scroll")}function _off(){if(editor.helpers.isIOS()&&editor.core.hasFocus())return editor.$el.blur(),setTimeout(toggle,250),!1;editor.$box.toggleClass("fr-fullscreen"),$("body:first").toggleClass("fr-fullscreen"),editor.$tb.prependTo(editor.$tb.data("parent")),editor.$tb.data("sticky-dummy")&&editor.$tb.after(editor.$tb.data("sticky-dummy")),editor.opts.height=height,editor.opts.heightMax=max_height,editor.opts.zIndex=z_index,editor.size.refresh(),$(editor.o_win).scrollTop(old_scroll),editor.opts.toolbarInline&&editor.toolbar.showInline(),editor.events.trigger("charCounter.update"),editor.opts.toolbarSticky&&editor.opts.toolbarStickyOffset&&(editor.opts.toolbarBottom?editor.$tb.css("bottom",editor.opts.toolbarStickyOffset).data("bottom",editor.opts.toolbarStickyOffset):editor.$tb.css("top",editor.opts.toolbarStickyOffset).data("top",editor.opts.toolbarStickyOffset)),editor.$win.trigger("scroll")}function toggle(){isActive()?_off():_on(),refresh(editor.$tb.find('.fr-command[data-cmd="fullscreen"]')),$(window).trigger("oc.updateUi")}function refresh($btn){var active=isActive();$btn.toggleClass("fr-active",active).attr("aria-pressed",active),$btn.find("> *:not(.fr-sr-only)").replaceWith(active?editor.icon.create("fullscreenCompress"):editor.icon.create("fullscreen"))}return{_init:function(){if(!editor.$wp)return!1;editor.events.$on($(editor.o_win),"resize",(function(){isActive()&&(_off(),_on())})),editor.events.on("toolbar.hide",(function(){if(isActive()&&editor.helpers.isMobile())return!1})),editor.events.on("position.refresh",(function(){if(editor.helpers.isIOS())return!isActive()})),editor.events.on("destroy",(function(){isActive()&&_off()}),!0)},toggle:toggle,refresh:refresh,isActive:isActive}},$.FE.RegisterCommand("fullscreen",{title:"Fullscreen",undo:!1,focus:!1,accessibilityFocus:!0,forcedRefresh:!0,toggle:!0,callback:function(){this.fullscreen.toggle()},refresh:function($btn){this.fullscreen.refresh($btn)},plugin:"fullscreen"}),$.FE.DefineIcon("fullscreen",{NAME:"expand"}),$.FE.DefineIcon("fullscreenCompress",{NAME:"compress"})}(jQuery),function($){$.extend($.FE.DEFAULTS,{aceEditor:!0,aceEditorVendorPath:"/",aceEditorOptions:{showLineNumbers:!0,useSoftTabs:!1,wrap:!0,mode:"ace/mode/html",tabSize:2},codeBeautifierOptions:{end_with_newline:!0,indent_inner_html:!0,extra_liners:["p","h1","h2","h3","h4","h5","h6","blockquote","pre","ul","ol","table","dl"],brace_style:"expand",indent_char:"\t",indent_size:1,wrap_line_length:0},codeViewKeepActiveButtons:["fullscreen"]}),$.FE.PLUGINS.codeView=function(editor){var $html_area,ace_editor;function isActive(){return editor.$box.hasClass("fr-code-view")}function get(){return ace_editor?ace_editor.getValue():$html_area.val()}function refresh(){isActive()&&ace_editor&&ace_editor.resize()}var $back_button,_can_focus=!1;function _blur(){isActive()&&editor.events.trigger("blur")}function _focus(){isActive()&&_can_focus&&editor.events.trigger("focus")}function _showHTML($btn){$html_area||(!function(){$html_area=$('<textarea class="fr-code" tabIndex="-1">'),editor.$wp.append($html_area),$html_area.attr("dir",editor.opts.direction),editor.$box.hasClass("fr-basic")||($back_button=$('<a data-cmd="html" title="Code View" class="fr-command fr-btn html-switch'+(editor.helpers.isMobile()?"":" fr-desktop")+'" role="button" tabIndex="-1"><i class="fa fa-code"></i></button>'),editor.$box.append($back_button),editor.events.bindClick(editor.$box,"a.html-switch",(function(){editor.events.trigger("commands.before",["html"]),toggle(!1),editor.events.trigger("commands.after",["html"])})));var cancel=function(){return!isActive()};editor.events.on("buttons.refresh",cancel),editor.events.on("copy",cancel,!0),editor.events.on("cut",cancel,!0),editor.events.on("paste",cancel,!0),editor.events.on("destroy",_destroy,!0),editor.events.on("html.set",(function(){isActive()&&toggle(!0)})),editor.events.on("codeView.update",refresh),editor.events.on("form.submit",(function(){isActive()&&(editor.html.set(get()),editor.events.trigger("contentChanged",[],!0))}),!0)}(),!ace_editor&&editor.opts.aceEditor&&"undefined"!=typeof ace?(ace_editor=ace.edit($html_area.get(0)),ace.require("ace/config").set("basePath",editor.opts.aceEditorVendorPath),ace_editor.setOptions(editor.opts.aceEditorOptions),ace_editor.on("blur",_blur),ace_editor.on("focus",_focus)):(editor.events.$on($html_area,"keydown keyup change input",(function(){editor.opts.height?this.removeAttribute("rows"):(this.rows=1,0===this.value.length?this.style.height="auto":this.style.height=this.scrollHeight+"px")})),editor.events.$on($html_area,"blur",_blur),editor.events.$on($html_area,"focus",_focus))),editor.undo.saveStep(),editor.html.cleanEmptyTags(),editor.html.cleanWhiteTags(!0),editor.core.hasFocus()&&(editor.core.isEmpty()||(editor.selection.save(),editor.$el.find('.fr-marker[data-type="true"]:first').replaceWith('<span class="fr-tmp fr-sm">F</span>'),editor.$el.find('.fr-marker[data-type="false"]:last').replaceWith('<span class="fr-tmp fr-em">F</span>')));var html=editor.html.get(!1,!0);editor.$el.find("span.fr-tmp").remove(),editor.$box.toggleClass("fr-code-view",!0);var s_index,e_index,was_focused=!1;if(editor.core.hasFocus()&&(was_focused=!0,editor.events.disableBlur(),editor.$el.blur()),html=(html=html.replace(/<span class="fr-tmp fr-sm">F<\/span>/,"FROALA-SM")).replace(/<span class="fr-tmp fr-em">F<\/span>/,"FROALA-EM"),editor.codeBeautifier&&(html=editor.codeBeautifier.run(html,editor.opts.codeBeautifierOptions)),ace_editor){(s_index=html.indexOf("FROALA-SM"))>(e_index=html.indexOf("FROALA-EM"))?s_index=e_index:e_index-=9;var s_line=(html=html.replace(/FROALA-SM/g,"").replace(/FROALA-EM/g,"")).substring(0,s_index).length-html.substring(0,s_index).replace(/\n/g,"").length,e_line=html.substring(0,e_index).length-html.substring(0,e_index).replace(/\n/g,"").length;s_index=html.substring(0,s_index).length-html.substring(0,html.substring(0,s_index).lastIndexOf("\n")+1).length,e_index=html.substring(0,e_index).length-html.substring(0,html.substring(0,e_index).lastIndexOf("\n")+1).length,ace_editor.$blockScrolling=1/0,ace_editor.getSession().setValue(html),_can_focus=!was_focused,ace_editor.focus(),_can_focus=!0,ace_editor.selection.moveCursorToPosition({row:s_line,column:s_index}),ace_editor.selection.selectToPosition({row:e_line,column:e_index}),ace_editor.resize(),ace_editor.session.getUndoManager().reset()}else{s_index=html.indexOf("FROALA-SM"),e_index=html.indexOf("FROALA-EM")-9,editor.opts.heightMin&&$html_area.css("min-height",editor.opts.heightMin),editor.opts.height&&$html_area.css("height",editor.opts.height),editor.opts.heightMax&&$html_area.css("max-height",editor.opts.height||editor.opts.heightMax),$html_area.val(html.replace(/FROALA-SM/g,"").replace(/FROALA-EM/g,"")).trigger("change");var scroll_top=$(editor.o_doc).scrollTop();_can_focus=!was_focused,$html_area.focus(),_can_focus=!0,$html_area.get(0).setSelectionRange(s_index,e_index),$(editor.o_doc).scrollTop(scroll_top)}editor.$tb.find(" > .fr-command, > .fr-btn-wrap > .fr-command").not($btn).filter((function(){return editor.opts.codeViewKeepActiveButtons.indexOf($(this).data("cmd"))<0})).addClass("fr-disabled").attr("aria-disabled",!0),$btn.addClass("fr-active").attr("aria-pressed",!0),!editor.helpers.isMobile()&&editor.opts.toolbarInline&&editor.toolbar.hide()}function toggle(val){void 0===val&&(val=!isActive());var $btn=editor.$tb.find('.fr-command[data-cmd="html"]');val?(editor.popups.hideAll(),_showHTML($btn)):(editor.$box.toggleClass("fr-code-view",!1),function($btn){var html=get();editor.html.set(html),editor.$el.blur(),editor.$tb.find(" > .fr-command, > .fr-btn-wrap > .fr-command").not($btn).removeClass("fr-disabled").attr("aria-disabled",!1),$btn.removeClass("fr-active").attr("aria-pressed",!1),editor.events.focus(!0),editor.placeholder.refresh(),editor.undo.saveStep()}($btn))}function _destroy(){isActive()&&toggle(!1),$html_area.val("").removeData().remove(),$html_area=null,$back_button&&($back_button.remove(),$back_button=null)}return{_init:function(){if(editor.events.on("focus",(function(){var $btn;editor.opts.toolbarContainer&&($btn=editor.$tb.find('.fr-command[data-cmd="html"]'),isActive()?(editor.$tb.find(" > .fr-command").not($btn).filter((function(){return editor.opts.codeViewKeepActiveButtons.indexOf($(this).data("cmd"))<0})).addClass("fr-disabled").attr("aria-disabled",!1),$btn.addClass("fr-active").attr("aria-pressed",!1)):(editor.$tb.find(" > .fr-command").not($btn).removeClass("fr-disabled").attr("aria-disabled",!1),$btn.removeClass("fr-active").attr("aria-pressed",!1)))})),!editor.$wp)return!1},toggle:toggle,isActive:isActive,get:get}},$.FE.RegisterCommand("html",{title:"Code View",undo:!1,focus:!1,forcedRefresh:!0,toggle:!0,callback:function(){this.codeView.toggle()},plugin:"codeView"}),$.FE.DefineIcon("html",{NAME:"code"})}(jQuery),function($){$.extend($.FE.DEFAULTS,{paragraphFormat:{N:"Normal",H1:"Heading 1",H2:"Heading 2",H3:"Heading 3",H4:"Heading 4",PRE:"Code"},paragraphFormatSelection:!1,paragraphDefaultSelection:"Paragraph Format"}),$.FE.PLUGINS.paragraphFormat=function(editor){function _styleLiWithoutBlocks($li,val){var defaultTag=editor.html.defaultTag();if(val&&val.toLowerCase()!=defaultTag)if($li.find("ul, ol").length>0){var $el=$("<"+val+">");$li.prepend($el);for(var node=editor.node.contents($li.get(0))[0];node&&["UL","OL"].indexOf(node.tagName)<0;){var next_node=node.nextSibling;$el.append(node),node=next_node}}else $li.html("<"+val+">"+$li.html()+"</"+val+">")}function _styleLiWithBlocks($blk,val){var defaultTag=editor.html.defaultTag();val&&val.toLowerCase()!=defaultTag||(val='div class="fr-temp-div"'),$blk.replaceWith($("<"+val+">").html($blk.html()))}function _styleTdWithBlocks($blk,val){var defaultTag=editor.html.defaultTag();val||(val='div class="fr-temp-div"'+(editor.node.isEmpty($blk.get(0),!0)?' data-empty="true"':"")),val.toLowerCase()==defaultTag?(editor.node.isEmpty($blk.get(0),!0)||$blk.append("<br/>"),$blk.replaceWith($blk.html())):$blk.replaceWith($("<"+val+">").html($blk.html()))}function _style($blk,val){val||(val='div class="fr-temp-div"'+(editor.node.isEmpty($blk.get(0),!0)?' data-empty="true"':"")),$blk.replaceWith($("<"+val+" "+editor.node.attributes($blk.get(0))+">").html($blk.html()).removeAttr("data-empty"))}return{apply:function(val){"N"==val&&(val=editor.html.defaultTag()),editor.selection.save(),editor.html.wrap(!0,!0,!editor.opts.paragraphFormat.BLOCKQUOTE,!0,!0),editor.selection.restore();var blocks=editor.selection.blocks();editor.selection.save(),editor.$el.find("pre").attr("skip",!0);for(var i=0;i<blocks.length;i++)if(blocks[i].tagName!=val&&!editor.node.isList(blocks[i])){var $blk=$(blocks[i]);"LI"==blocks[i].tagName?_styleLiWithoutBlocks($blk,val):"LI"==blocks[i].parentNode.tagName&&blocks[i]?_styleLiWithBlocks($blk,val):["TD","TH"].indexOf(blocks[i].parentNode.tagName)>=0?_styleTdWithBlocks($blk,val):_style($blk,val)}editor.$el.find('pre:not([skip="true"]) + pre:not([skip="true"])').each((function(){$(this).prev().append("<br>"+$(this).html()),$(this).remove()})),editor.$el.find("pre").removeAttr("skip"),editor.html.unwrap(),editor.selection.restore()},refreshOnShow:function($btn,$dropdown){var blocks=editor.selection.blocks();if(blocks.length){var blk=blocks[0],tag="N",default_tag=editor.html.defaultTag();blk.tagName.toLowerCase()!=default_tag&&blk!=editor.el&&(tag=blk.tagName),$dropdown.find('.fr-command[data-param1="'+tag+'"]').addClass("fr-active").attr("aria-selected",!0)}else $dropdown.find('.fr-command[data-param1="N"]').addClass("fr-active").attr("aria-selected",!0)},refresh:function($btn){if(editor.opts.paragraphFormatSelection){var blocks=editor.selection.blocks();if(blocks.length){var blk=blocks[0],tag="N",default_tag=editor.html.defaultTag();blk.tagName.toLowerCase()!=default_tag&&blk!=editor.el&&(tag=blk.tagName),["LI","TD","TH"].indexOf(tag)>=0&&(tag="N"),$btn.find("> span").text(editor.language.translate(editor.opts.paragraphFormat[tag]))}else $btn.find("> span").text(editor.language.translate(editor.opts.paragraphFormat.N))}}}},$.FE.RegisterCommand("paragraphFormat",{type:"dropdown",displaySelection:function(editor){return editor.opts.paragraphFormatSelection},defaultSelection:function(editor){return editor.language.translate(editor.opts.paragraphDefaultSelection)},displaySelectionWidth:125,html:function(){var c='<ul class="fr-dropdown-list" role="presentation">',options=this.opts.paragraphFormat;for(var val in options)if(options.hasOwnProperty(val)){var shortcut=this.shortcuts.get("paragraphFormat."+val);shortcut=shortcut?'<span class="fr-shortcut">'+shortcut+"</span>":"",c+='<li role="presentation"><'+("N"==val?this.html.defaultTag()||"DIV":val)+' style="padding: 0 !important; margin: 0 !important;" role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="paragraphFormat" data-param1="'+val+'" title="'+this.language.translate(options[val])+'">'+this.language.translate(options[val])+"</a></"+("N"==val?this.html.defaultTag()||"DIV":val)+"></li>"}return c+="</ul>"},title:"Paragraph Format",callback:function(cmd,val){this.paragraphFormat.apply(val)},refresh:function($btn){this.paragraphFormat.refresh($btn)},refreshOnShow:function($btn,$dropdown){this.paragraphFormat.refreshOnShow($btn,$dropdown)},plugin:"paragraphFormat"}),$.FE.DefineIcon("paragraphFormat",{NAME:"paragraph"})}(jQuery),function($){$.FE.PLUGINS.align=function(editor){return{apply:function(val){var el=editor.selection.element();if($(el).parents(".fr-img-caption").length)$(el).css("text-align",val);else{editor.selection.save(),editor.html.wrap(!0,!0,!0,!0),editor.selection.restore();for(var blocks=editor.selection.blocks(),i=0;i<blocks.length;i++)$(blocks[i]).css("text-align",val).removeClass("fr-temp-div"),""===$(blocks[i]).attr("class")&&$(blocks[i]).removeAttr("class"),""===$(blocks[i]).attr("style")&&$(blocks[i]).removeAttr("style");editor.selection.save(),editor.html.unwrap(),editor.selection.restore()}},refresh:function($btn){var blocks=editor.selection.blocks();if(blocks.length){var alignment=editor.helpers.getAlignment($(blocks[0]));$btn.find("> *:first").replaceWith(editor.icon.create("align-"+alignment))}},refreshOnShow:function($btn,$dropdown){var blocks=editor.selection.blocks();if(blocks.length){var alignment=editor.helpers.getAlignment($(blocks[0]));$dropdown.find('a.fr-command[data-param1="'+alignment+'"]').addClass("fr-active").attr("aria-selected",!0)}},refreshForToolbar:function($btn){var blocks=editor.selection.blocks();if(blocks.length){var alignment=editor.helpers.getAlignment($(blocks[0]));"align"+(alignment=alignment.charAt(0).toUpperCase()+alignment.slice(1))==$btn.attr("data-cmd")&&$btn.addClass("fr-active")}}}},$.FE.DefineIcon("align",{NAME:"align-left"}),$.FE.DefineIcon("align-left",{NAME:"align-left"}),$.FE.DefineIcon("align-right",{NAME:"align-right"}),$.FE.DefineIcon("align-center",{NAME:"align-center"}),$.FE.DefineIcon("align-justify",{NAME:"align-justify"}),$.FE.RegisterCommand("align",{type:"dropdown",title:"Align",options:{left:"Align Left",center:"Align Center",right:"Align Right",justify:"Align Justify"},html:function(){var c='<ul class="fr-dropdown-list" role="presentation">',options=$.FE.COMMANDS.align.options;for(var val in options)options.hasOwnProperty(val)&&(c+='<li role="presentation"><a class="fr-command fr-title" tabIndex="-1" role="option" data-cmd="align" data-param1="'+val+'" title="'+this.language.translate(options[val])+'">'+this.icon.create("align-"+val)+'<span class="fr-sr-only">'+this.language.translate(options[val])+"</span></a></li>");return c+="</ul>"},callback:function(cmd,val){this.align.apply(val)},refresh:function($btn){this.align.refresh($btn)},refreshOnShow:function($btn,$dropdown){this.align.refreshOnShow($btn,$dropdown)},plugin:"align"}),$.FE.RegisterCommand("alignLeft",{type:"button",icon:"align-left",callback:function(){this.align.apply("left")},refresh:function($btn){this.align.refreshForToolbar($btn)}}),$.FE.RegisterCommand("alignRight",{type:"button",icon:"align-right",callback:function(){this.align.apply("right")},refresh:function($btn){this.align.refreshForToolbar($btn)}}),$.FE.RegisterCommand("alignCenter",{type:"button",icon:"align-center",callback:function(){this.align.apply("center")},refresh:function($btn){this.align.refreshForToolbar($btn)}}),$.FE.RegisterCommand("alignJustify",{type:"button",icon:"align-justify",callback:function(){this.align.apply("justify")},refresh:function($btn){this.align.refreshForToolbar($btn)}})}(jQuery),function($){$.extend($.FE.DEFAULTS,{listAdvancedTypes:!0}),$.FE.PLUGINS.lists=function(editor){function _openFlag(tag_name){return'<span class="fr-open-'+tag_name.toLowerCase()+'"></span>'}function _closeFlag(tag_name){return'<span class="fr-close-'+tag_name.toLowerCase()+'"></span>'}function _format(blocks,tag_name){!function(blocks,tag_name){for(var lists=[],i=0;i<blocks.length;i++){var parent_node=blocks[i].parentNode;"LI"==blocks[i].tagName&&parent_node.tagName!=tag_name&&lists.indexOf(parent_node)<0&&lists.push(parent_node)}for(i=lists.length-1;i>=0;i--){var $l=$(lists[i]);$l.replaceWith("<"+tag_name.toLowerCase()+" "+editor.node.attributes($l.get(0))+">"+$l.html()+"</"+tag_name.toLowerCase()+">")}}(blocks,tag_name);var prop,default_tag=editor.html.defaultTag(),start_margin=null;blocks.length&&(prop="rtl"==editor.opts.direction||"rtl"==$(blocks[0]).css("direction")?"margin-right":"margin-left");for(var i=0;i<blocks.length;i++)if("TD"!=blocks[i].tagName&&"TH"!=blocks[i].tagName&&"LI"!=blocks[i].tagName){var margin_left=editor.helpers.getPX($(blocks[i]).css(prop))||0;blocks[i].style.marginLeft=null,null===start_margin&&(start_margin=margin_left);var open_tag=start_margin>0?"<"+tag_name+' style="'+prop+": "+start_margin+'px;">':"<"+tag_name+">",end_tag="</"+tag_name+">";for(margin_left-=start_margin;margin_left/editor.opts.indentMargin>0;)open_tag+="<"+tag_name+">",end_tag+=end_tag,margin_left-=editor.opts.indentMargin;default_tag&&blocks[i].tagName.toLowerCase()==default_tag?$(blocks[i]).replaceWith(open_tag+"<li"+editor.node.attributes(blocks[i])+">"+$(blocks[i]).html()+"</li>"+end_tag):$(blocks[i]).wrap(open_tag+"<li></li>"+end_tag)}editor.clean.lists()}function _unformat(blocks){var i,j;for(i=blocks.length-1;i>=0;i--)for(j=i-1;j>=0;j--)if($(blocks[j]).find(blocks[i]).length||blocks[j]==blocks[i]){blocks.splice(i,1);break}var lists=[];for(i=0;i<blocks.length;i++){var $li=$(blocks[i]),parent_node=blocks[i].parentNode,li_class=$li.attr("class");if($li.before(_closeFlag(parent_node.tagName)),"LI"==parent_node.parentNode.tagName)$li.before(_closeFlag("LI")),$li.after(_openFlag("LI"));else{var li_attrs="";li_class&&(li_attrs+=' class="'+li_class+'"');var prop="rtl"==editor.opts.direction||"rtl"==$li.css("direction")?"margin-right":"margin-left";editor.helpers.getPX($(parent_node).css(prop))&&($(parent_node).attr("style")||"").indexOf(prop+":")>=0&&(li_attrs+=' style="'+prop+":"+editor.helpers.getPX($(parent_node).css(prop))+'px;"'),editor.html.defaultTag()&&0===$li.find(editor.html.blockTagsQuery()).length&&$li.wrapInner("<"+editor.html.defaultTag()+li_attrs+"></"+editor.html.defaultTag()+">"),editor.node.isEmpty($li.get(0),!0)||0!==$li.find(editor.html.blockTagsQuery()).length||$li.append("<br>"),$li.append(_openFlag("LI")),$li.prepend(_closeFlag("LI"))}$li.after(_openFlag(parent_node.tagName)),"LI"==parent_node.parentNode.tagName&&(parent_node=parent_node.parentNode.parentNode),lists.indexOf(parent_node)<0&&lists.push(parent_node)}for(i=0;i<lists.length;i++){var $l=$(lists[i]),html=$l.html();html=(html=html.replace(/<span class="fr-close-([a-z]*)"><\/span>/g,"</$1>")).replace(/<span class="fr-open-([a-z]*)"><\/span>/g,"<$1>"),$l.replaceWith(editor.node.openTagString($l.get(0))+html+editor.node.closeTagString($l.get(0)))}editor.$el.find("li:empty").remove(),editor.$el.find("ul:empty, ol:empty").remove(),editor.clean.lists(),editor.html.wrap()}function _indent(blocks){editor.selection.save();for(var i=0;i<blocks.length;i++){var prev_li=blocks[i].previousSibling;if(prev_li){var nl=$(blocks[i]).find("> ul, > ol").last().get(0);if(nl){for(var $li=$("<li>").prependTo($(nl)),node=editor.node.contents(blocks[i])[0];node&&!editor.node.isList(node);){var tmp=node.nextSibling;$li.append(node),node=tmp}$(prev_li).append($(nl)),$(blocks[i]).remove()}else{var prev_nl=$(prev_li).find("> ul, > ol").last().get(0);if(prev_nl)$(prev_nl).append($(blocks[i]));else{var $new_nl=$("<"+blocks[i].parentNode.tagName+">");$(prev_li).append($new_nl),$new_nl.append($(blocks[i]))}}}}editor.clean.lists(),editor.selection.restore()}function _outdent(blocks){editor.selection.save(),_unformat(blocks),editor.selection.restore()}function _afterCommand(cmd){if("indent"==cmd||"outdent"==cmd){for(var do_indent=!1,blocks=editor.selection.blocks(),blks=[],i=0;i<blocks.length;i++)"LI"==blocks[i].tagName?(do_indent=!0,blks.push(blocks[i])):"LI"==blocks[i].parentNode.tagName&&(do_indent=!0,blks.push(blocks[i].parentNode));do_indent&&("indent"==cmd?_indent(blks):_outdent(blks))}}return{_init:function(){editor.events.on("commands.after",_afterCommand),editor.events.on("keydown",(function(e){if(e.which==$.FE.KEYCODE.TAB){for(var blocks=editor.selection.blocks(),blks=[],i=0;i<blocks.length;i++)"LI"==blocks[i].tagName?blks.push(blocks[i]):"LI"==blocks[i].parentNode.tagName&&blks.push(blocks[i].parentNode);if(blks.length>1||blks.length&&(editor.selection.info(blks[0]).atStart||editor.node.isEmpty(blks[0])))return e.preventDefault(),e.stopPropagation(),e.shiftKey?_outdent(blks):_indent(blks),!1}}),!0)},format:function(tag_name,list_type){var i,blocks;for(editor.selection.save(),editor.html.wrap(!0,!0,!0,!0),editor.selection.restore(),blocks=editor.selection.blocks(),i=0;i<blocks.length;i++)"LI"!=blocks[i].tagName&&"LI"==blocks[i].parentNode.tagName&&(blocks[i]=blocks[i].parentNode);if(editor.selection.save(),!function(blocks,tag_name){for(var do_unformat=!0,i=0;i<blocks.length;i++){if("LI"!=blocks[i].tagName)return!1;blocks[i].parentNode.tagName!=tag_name&&(do_unformat=!1)}return do_unformat}(blocks,tag_name)?_format(blocks,tag_name):list_type||_unformat(blocks),editor.html.unwrap(),editor.selection.restore(),list_type=list_type||"default"){for(blocks=editor.selection.blocks(),i=0;i<blocks.length;i++)"LI"!=blocks[i].tagName&&"LI"==blocks[i].parentNode.tagName&&(blocks[i]=blocks[i].parentNode);for(i=0;i<blocks.length;i++)"LI"==blocks[i].tagName&&($(blocks[i].parentNode).css("list-style-type","default"===list_type?"":list_type),0===($(blocks[i].parentNode).attr("style")||"").length&&$(blocks[i].parentNode).removeAttr("style"))}},refresh:function($btn,tag_name){var $el=$(editor.selection.element());if($el.get(0)!=editor.el){var li=$el.get(0);(li="LI"!=li.tagName&&li.firstElementChild&&"LI"!=li.firstElementChild.tagName?$el.parents("li").get(0):"LI"==li.tagName||li.firstElementChild?li.firstElementChild&&"LI"==li.firstElementChild.tagName?$el.get(0).firstChild:$el.get(0):$el.parents("li").get(0))&&li.parentNode.tagName==tag_name&&editor.el.contains(li.parentNode)&&$btn.addClass("fr-active")}}}},$.FE.RegisterCommand("formatUL",{title:"Unordered List",type:"button",hasOptions:function(){return this.opts.listAdvancedTypes},options:{default:"Default",circle:"Circle",disc:"Disc",square:"Square"},refresh:function($btn){this.lists.refresh($btn,"UL")},callback:function(cmd,param){this.lists.format("UL",param)},plugin:"lists"}),$.FE.RegisterCommand("formatOL",{title:"Ordered List",hasOptions:function(){return this.opts.listAdvancedTypes},options:{default:"Default","lower-alpha":"Lower Alpha","lower-greek":"Lower Greek","lower-roman":"Lower Roman","upper-alpha":"Upper Alpha","upper-roman":"Upper Roman"},refresh:function($btn){this.lists.refresh($btn,"OL")},callback:function(cmd,param){this.lists.format("OL",param)},plugin:"lists"}),$.FE.DefineIcon("formatUL",{NAME:"list-ul"}),$.FE.DefineIcon("formatOL",{NAME:"list-ol"})}(jQuery),function($){$.extend($.FE.POPUP_TEMPLATES,{"file.insert":"[_BUTTONS_][_UPLOAD_LAYER_][_BY_URL_LAYER_][_PROGRESS_BAR_]"}),$.extend($.FE.DEFAULTS,{fileUploadURL:"http://i.froala.com/upload",fileUploadParam:"file",fileUploadParams:{},fileUploadToS3:!1,fileUploadMethod:"POST",fileMaxSize:10485760,fileAllowedTypes:["*"],fileInsertButtons:["fileBack","|","fileUpload","fileByURL"],fileUseSelectedText:!1}),$.FE.PLUGINS.file=function(editor){var files,error_messages={};function showProgressBar(){var $popup=editor.popups.get("file.insert");$popup||($popup=_initInsertPopup()),$popup.find(".fr-layer.fr-active").removeClass("fr-active").addClass("fr-pactive"),$popup.find(".fr-file-progress-bar-layer").addClass("fr-active"),$popup.find(".fr-buttons").hide(),_setProgressMessage("Uploading",0)}function hideProgressBar(dismiss){var $popup=editor.popups.get("file.insert");$popup&&($popup.find(".fr-layer.fr-pactive").addClass("fr-active").removeClass("fr-pactive"),$popup.find(".fr-file-progress-bar-layer").removeClass("fr-active"),$popup.find(".fr-buttons").show(),dismiss&&(editor.events.focus(),editor.popups.hide("file.insert")))}function _setProgressMessage(message,progress){var $popup=editor.popups.get("file.insert");if($popup){var $layer=$popup.find(".fr-file-progress-bar-layer");$layer.find("h3").text(message+(progress?" "+progress+"%":"")),$layer.removeClass("fr-error"),progress?($layer.find("div").removeClass("fr-indeterminate"),$layer.find("div > span").css("width",progress+"%")):$layer.find("div").addClass("fr-indeterminate")}}function insert(link,text,response){editor.edit.on(),editor.events.focus(!0),editor.selection.restore(),editor.opts.fileUseSelectedText&&editor.selection.text().length&&(text=editor.selection.text()),editor.html.insert('<a href="'+link+'" id="fr-inserted-file" class="fr-file">'+text+"</a>");var $file=editor.$el.find("#fr-inserted-file");$file.removeAttr("id"),editor.popups.hide("file.insert"),editor.undo.saveStep(),_syncFiles(),editor.events.trigger("file.inserted",[$file,response])}function _fileUploaded(text){var status=this.status,response=this.response,responseXML=this.responseXML,responseText=this.responseText;try{if(editor.opts.fileUploadToS3)if(201==status){var link=function(response){try{var link=$(response).find("Location").text(),key=$(response).find("Key").text();return!1===editor.events.trigger("file.uploadedToS3",[link,key,response],!0)?(editor.edit.on(),!1):link}catch(ex){return _throwError(4,response),!1}}(responseXML);link&&insert(link,text,response||responseXML)}else _throwError(4,response||responseXML);else if(status>=200&&status<300){var resp=function(response){try{if(!1===editor.events.trigger("file.uploaded",[response],!0))return editor.edit.on(),!1;var resp=$.parseJSON(response);return resp.link?resp:(_throwError(2,response),!1)}catch(ex){return _throwError(4,response),!1}}(responseText);resp&&insert(resp.link,text,response||responseText)}else _throwError(3,response||responseText)}catch(ex){_throwError(4,response||responseText)}}function _fileUploadError(){_throwError(4,this.response||this.responseText||this.responseXML)}function _fileUploadProgress(e){e.lengthComputable&&_setProgressMessage("Uploading",e.loaded/e.total*100|0)}function _throwError(code,response){editor.edit.on(),function(message){showProgressBar();var $layer=editor.popups.get("file.insert").find(".fr-file-progress-bar-layer");$layer.addClass("fr-error");var $message_header=$layer.find("h3");$message_header.text(message),editor.events.disableBlur(),$message_header.focus()}(editor.language.translate("Something went wrong. Please try again.")),editor.events.trigger("file.error",[{code:code,message:error_messages[code]},response])}function _fileUploadAborted(){editor.edit.on(),hideProgressBar(!0)}function upload(files){if(void 0!==files&&files.length>0){if(!1===editor.events.trigger("file.beforeUpload",[files]))return!1;var form_data,file=files[0];if(file.size>editor.opts.fileMaxSize)return _throwError(5),!1;if(editor.opts.fileAllowedTypes.indexOf("*")<0&&editor.opts.fileAllowedTypes.indexOf(file.type.replace(/file\//g,""))<0)return _throwError(6),!1;if(editor.drag_support.formdata&&(form_data=editor.drag_support.formdata?new FormData:null),form_data){var key;if(!1!==editor.opts.fileUploadToS3)for(key in form_data.append("key",editor.opts.fileUploadToS3.keyStart+(new Date).getTime()+"-"+(file.name||"untitled")),form_data.append("success_action_status","201"),form_data.append("X-Requested-With","xhr"),form_data.append("Content-Type",file.type),editor.opts.fileUploadToS3.params)editor.opts.fileUploadToS3.params.hasOwnProperty(key)&&form_data.append(key,editor.opts.fileUploadToS3.params[key]);for(key in editor.opts.fileUploadParams)editor.opts.fileUploadParams.hasOwnProperty(key)&&form_data.append(key,editor.opts.fileUploadParams[key]);form_data.append(editor.opts.fileUploadParam,file);var url=editor.opts.fileUploadURL;editor.opts.fileUploadToS3&&(url=editor.opts.fileUploadToS3.uploadURL?editor.opts.fileUploadToS3.uploadURL:"https://"+editor.opts.fileUploadToS3.region+".amazonaws.com/"+editor.opts.fileUploadToS3.bucket);var xhr=editor.core.getXHR(url,editor.opts.fileUploadMethod);xhr.onload=function(){_fileUploaded.call(xhr,file.name)},xhr.onerror=_fileUploadError,xhr.upload.onprogress=_fileUploadProgress,xhr.onabort=_fileUploadAborted,showProgressBar(),editor.edit.off();var $popup=editor.popups.get("file.insert");$popup&&$popup.off("abortUpload").on("abortUpload",(function(){4!=xhr.readyState&&xhr.abort()})),xhr.send(form_data)}}}function _hideInsertPopup(){hideProgressBar()}function _initInsertPopup(delayed){if(delayed)return editor.popups.onHide("file.insert",_hideInsertPopup),!0;var active,file_buttons="";editor.opts.fileInsertButtons.length>1&&(file_buttons='<div class="fr-buttons">'+editor.button.buildList(editor.opts.fileInsertButtons)+"</div>");var uploadIndex=editor.opts.fileInsertButtons.indexOf("fileUpload"),urlIndex=editor.opts.fileInsertButtons.indexOf("fileByURL"),upload_layer="";uploadIndex>=0&&(active=" fr-active",urlIndex>=0&&uploadIndex>urlIndex&&(active=""),upload_layer='<div class="fr-file-upload-layer'+active+' fr-layer fr-active" id="fr-file-upload-layer-'+editor.id+'"><strong>'+editor.language.translate("Drop file")+"</strong><br>("+editor.language.translate("or click")+')<div class="fr-form"><input type="file" name="'+editor.opts.fileUploadParam+'" accept="/*" tabIndex="-1" aria-labelledby="fr-file-upload-layer-'+editor.id+'" role="button"></div></div>');var by_url_layer="";urlIndex>=0&&(active=" fr-active",uploadIndex>=0&&urlIndex>uploadIndex&&(active=""),by_url_layer='<div class="fr-file-by-url-layer'+active+' fr-layer" id="fr-file-by-url-layer-'+editor.id+'"><div class="fr-input-line"><input type="text" placeholder="http://" tabIndex="1"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="fileInsertByURL" tabIndex="2">'+editor.language.translate("Insert")+"</button></div></div>");var template={buttons:file_buttons,upload_layer:upload_layer,by_url_layer:by_url_layer,progress_bar:'<div class="fr-file-progress-bar-layer fr-layer"><h3 tabIndex="-1" class="fr-message">Uploading</h3><div class="fr-loader"><span class="fr-progress"></span></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-dismiss" data-cmd="fileDismissError" tabIndex="2" role="button">OK</button></div></div>'},$popup=editor.popups.create("file.insert",template);return function($popup){editor.events.$on($popup,"dragover dragenter",".fr-file-upload-layer",(function(){return $(this).addClass("fr-drop"),!1}),!0),editor.events.$on($popup,"dragleave dragend",".fr-file-upload-layer",(function(){return $(this).removeClass("fr-drop"),!1}),!0),editor.events.$on($popup,"drop",".fr-file-upload-layer",(function(e){e.preventDefault(),e.stopPropagation(),$(this).removeClass("fr-drop");var dt=e.originalEvent.dataTransfer;dt&&dt.files&&($popup.data("instance")||editor).file.upload(dt.files)}),!0),editor.events.$on($popup,"change",'.fr-file-upload-layer input[type="file"]',(function(){this.files&&($popup.data("instance")||editor).file.upload(this.files),$(this).val("")}),!0)}($popup),$popup}function _onRemove(link){if(editor.node.hasClass(link,"fr-file"))return editor.events.trigger("file.unlink",[link])}function _drop(e){var dt=e.originalEvent.dataTransfer;if(dt&&dt.files&&dt.files.length){var file=dt.files[0];if(file&&void 0!==file.type&&file.type.indexOf("image")<0&&(editor.opts.fileAllowedTypes.indexOf(file.type)>=0||editor.opts.fileAllowedTypes.indexOf("*")>=0)){editor.markers.remove(),editor.markers.insertAtPoint(e.originalEvent),editor.$el.find(".fr-marker").replaceWith($.FE.MARKERS),editor.popups.hideAll();var $popup=editor.popups.get("file.insert");return $popup||($popup=_initInsertPopup()),editor.popups.setContainer("file.insert",editor.$sc),editor.popups.show("file.insert",e.originalEvent.pageX,e.originalEvent.pageY),showProgressBar(),upload(dt.files),e.preventDefault(),e.stopPropagation(),!1}}}function _syncFiles(){var i,c_files=Array.prototype.slice.call(editor.el.querySelectorAll("a.fr-file")),file_srcs=[];for(i=0;i<c_files.length;i++)file_srcs.push(c_files[i].getAttribute("href"));if(files)for(i=0;i<files.length;i++)file_srcs.indexOf(files[i].getAttribute("href"))<0&&editor.events.trigger("file.unlink",[files[i]]);files=c_files}return error_messages[1]="File cannot be loaded from the passed link.",error_messages[2]="No link in upload response.",error_messages[3]="Error during file upload.",error_messages[4]="Parsing response failed.",error_messages[5]="File is too large.",error_messages[6]="File file type is invalid.",error_messages[7]="Files can be uploaded only to same domain in IE 8 and IE 9.",{_init:function(){editor.events.on("drop",_drop),editor.events.$on(editor.$win,"keydown",(function(e){var key_code=e.which,$popup=editor.popups.get("file.insert");$popup&&key_code==$.FE.KEYCODE.ESC&&$popup.trigger("abortUpload")})),editor.events.on("destroy",(function(){var $popup=editor.popups.get("file.insert");$popup&&$popup.trigger("abortUpload")})),editor.events.on("link.beforeRemove",_onRemove),editor.$wp&&(_syncFiles(),editor.events.on("contentChanged",_syncFiles)),_initInsertPopup(!0)},showInsertPopup:function(){var $btn=editor.$tb.find('.fr-command[data-cmd="insertFile"]'),$popup=editor.popups.get("file.insert");if($popup||($popup=_initInsertPopup()),hideProgressBar(),!$popup.hasClass("fr-active")){editor.popups.refresh("file.insert"),editor.popups.setContainer("file.insert",editor.$tb);var left=$btn.offset().left+$btn.outerWidth()/2,top=$btn.offset().top+(editor.opts.toolbarBottom?10:$btn.outerHeight()-10);editor.popups.show("file.insert",left,top,$btn.outerHeight())}},showLayer:function(name){var left,top,$popup=editor.popups.get("file.insert");if(editor.opts.toolbarInline)top=$popup.offset().top-editor.helpers.getPX($popup.css("margin-top")),$popup.hasClass("fr-above")&&(top+=$popup.outerHeight());else{var $btn=editor.$tb.find('.fr-command[data-cmd="insertFile"]');left=$btn.offset().left+$btn.outerWidth()/2,top=$btn.offset().top+(editor.opts.toolbarBottom?10:$btn.outerHeight()-10)}$popup.find(".fr-layer").removeClass("fr-active"),$popup.find(".fr-"+name+"-layer").addClass("fr-active"),editor.popups.show("file.insert",left,top,0)},refreshUploadButton:function($btn){editor.popups.get("file.insert").find(".fr-file-upload-layer").hasClass("fr-active")&&$btn.addClass("fr-active")},refreshByURLButton:function($btn){editor.popups.get("file.insert").find(".fr-file-by-url-layer").hasClass("fr-active")&&$btn.addClass("fr-active")},insertByURL:function(){var $input=editor.popups.get("file.insert").find(".fr-file-by-url-layer input"),url=$input.val();if(url.length>0){var filename=url.substring(url.lastIndexOf("/")+1);insert(editor.helpers.sanitizeURL($input.val()),filename,[]),$input.val(""),$input.blur()}},upload:upload,insert:insert,back:function(){editor.events.disableBlur(),editor.selection.restore(),editor.events.enableBlur(),editor.popups.hide("file.insert"),editor.toolbar.showInline()},hideProgressBar:hideProgressBar}},$.FE.DefineIcon("insertFile",{NAME:"file-o"}),$.FE.RegisterCommand("insertFile",{title:"Insert File",undo:!1,focus:!0,refreshAfterCallback:!1,popup:!0,callback:function(){this.popups.isVisible("file.insert")?(this.$el.find(".fr-marker").length&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("file.insert")):this.file.showInsertPopup()},plugin:"file"}),$.FE.DefineIcon("fileUpload",{NAME:"upload"}),$.FE.RegisterCommand("fileUpload",{title:"Upload File",undo:!1,focus:!1,callback:function(){this.file.showLayer("file-upload")},refresh:function($btn){this.file.refreshUploadButton($btn)}}),$.FE.DefineIcon("fileByURL",{NAME:"link"}),$.FE.RegisterCommand("fileByURL",{title:"By URL",undo:!1,focus:!1,callback:function(){this.file.showLayer("file-by-url")},refresh:function($btn){this.file.refreshByURLButton($btn)}}),$.FE.RegisterCommand("fileInsertByURL",{title:"Insert File",undo:!0,refreshAfterCallback:!1,callback:function(){this.file.insertByURL()},refresh:function($btn){$btn.text(this.language.translate("Insert"))}}),$.FE.DefineIcon("fileBack",{NAME:"arrow-left"}),$.FE.RegisterCommand("fileBack",{title:"Back",undo:!1,focus:!1,back:!0,refreshAfterCallback:!1,callback:function(){this.file.back()},refresh:function($btn){this.opts.toolbarInline?($btn.removeClass("fr-hidden"),$btn.next(".fr-separator").removeClass("fr-hidden")):($btn.addClass("fr-hidden"),$btn.next(".fr-separator").addClass("fr-hidden"))}}),$.FE.RegisterCommand("fileDismissError",{title:"OK",callback:function(){this.file.hideProgressBar(!0)}})}(jQuery),function($){$.extend($.FE.POPUP_TEMPLATES,{"image.insert":"[_BUTTONS_][_UPLOAD_LAYER_][_BY_URL_LAYER_][_PROGRESS_BAR_]","image.edit":"[_BUTTONS_]","image.alt":"[_BUTTONS_][_ALT_LAYER_]","image.size":"[_BUTTONS_][_SIZE_LAYER_]"}),$.extend($.FE.DEFAULTS,{imageInsertButtons:["imageBack","|","imageUpload","imageByURL"],imageEditButtons:["imageReplace","imageAlign","imageCaption","imageRemove","|","imageLink","linkOpen","linkEdit","linkRemove","-","imageDisplay","imageStyle","imageAlt","imageSize"],imageAltButtons:["imageBack","|"],imageSizeButtons:["imageBack","|"],imageUpload:!0,imageUploadURL:null,imageCORSProxy:"https://cors-anywhere.froala.com",imageUploadRemoteUrls:!0,imageUploadParam:"file",imageUploadParams:{},imageUploadToS3:!1,imageUploadMethod:"POST",imageMaxSize:10485760,imageAllowedTypes:["jpeg","jpg","png","gif","webp"],imageResize:!0,imageResizeWithPercent:!1,imageRoundPercent:!1,imageDefaultWidth:300,imageDefaultAlign:"center",imageDefaultDisplay:"block",imageSplitHTML:!1,imageStyles:{"fr-rounded":"Rounded","fr-bordered":"Bordered","fr-shadow":"Shadow"},imageMove:!0,imageMultipleStyles:!0,imageTextNear:!0,imagePaste:!0,imagePasteProcess:!1,imageMinWidth:16,imageOutputSize:!1,imageDefaultMargin:5,imageAddNewLine:!1}),$.FE.PLUGINS.image=function(editor){var $current_image,$image_resizer,$handler,$overlay,images,touchScroll,mousedown=!1,error_messages={};function _refreshInsertPopup(){var $url_input=editor.popups.get("image.insert").find(".fr-image-by-url-layer input");$url_input.val(""),$current_image&&$url_input.val($current_image.attr("src")),$url_input.trigger("change")}function _showEditPopup(){var $popup=editor.popups.get("image.edit");if($popup||($popup=_initEditPopup()),$popup){var $el=getEl();hasCaption()&&($el=$el.find(".fr-img-wrap")),editor.popups.setContainer("image.edit",editor.$sc),editor.popups.refresh("image.edit");var left=$el.offset().left+$el.outerWidth()/2,top=$el.offset().top+$el.outerHeight();$current_image.hasClass("fr-uploading")?showProgressBar():editor.popups.show("image.edit",left,top,$el.outerHeight())}}function _hideInsertPopup(){hideProgressBar()}function _convertStyleToClasses($img){$img.parents(".fr-img-caption").length>0&&($img=$img.parents(".fr-img-caption:first")),$img.hasClass("fr-dii")||$img.hasClass("fr-dib")||($img.addClass("fr-fi"+getAlign($img)[0]),$img.addClass("fr-di"+getDisplay($img)[0]),$img.css("margin",""),$img.css("float",""),$img.css("display",""),$img.css("z-index",""),$img.css("position",""),$img.css("overflow",""),$img.css("vertical-align",""))}function _convertClassesToStyle($img){$img.parents(".fr-img-caption").length>0&&($img=$img.parents(".fr-img-caption:first"));var d=$img.hasClass("fr-dib")?"block":$img.hasClass("fr-dii")?"inline":null,a=$img.hasClass("fr-fil")?"left":$img.hasClass("fr-fir")?"right":getAlign($img);_setStyle($img,d,a),$img.removeClass("fr-dib fr-dii fr-fir fr-fil")}function _refreshImageList(){for(var images="IMG"==editor.el.tagName?[editor.el]:editor.el.querySelectorAll("img"),i=0;i<images.length;i++){var $img=$(images[i]);!editor.opts.htmlUntouched&&editor.opts.useClasses?((editor.opts.imageDefaultAlign||editor.opts.imageDefaultDisplay)&&_convertStyleToClasses($img),editor.opts.imageTextNear||($img.parents(".fr-img-caption").length>0?$img.parents(".fr-img-caption:first").removeClass("fr-dii").addClass("fr-dib"):$img.removeClass("fr-dii").addClass("fr-dib"))):editor.opts.htmlUntouched||editor.opts.useClasses||(editor.opts.imageDefaultAlign||editor.opts.imageDefaultDisplay)&&_convertClassesToStyle($img),editor.opts.iframe&&$img.on("load",editor.size.syncIframe)}}function _syncImages(loaded){void 0===loaded&&(loaded=!0);var i,c_images=Array.prototype.slice.call(editor.el.querySelectorAll("img")),image_srcs=[];for(i=0;i<c_images.length;i++)if(image_srcs.push(c_images[i].getAttribute("src")),$(c_images[i]).toggleClass("fr-draggable",editor.opts.imageMove),""===c_images[i].getAttribute("class")&&c_images[i].removeAttribute("class"),""===c_images[i].getAttribute("style")&&c_images[i].removeAttribute("style"),c_images[i].parentNode&&c_images[i].parentNode.parentNode&&editor.node.hasClass(c_images[i].parentNode.parentNode,"fr-img-caption")){var p_node=c_images[i].parentNode.parentNode;editor.browser.mozilla||p_node.setAttribute("contenteditable",!1),p_node.setAttribute("draggable",!1),p_node.classList.add("fr-draggable");var n_node=c_images[i].nextSibling;n_node&&!editor.browser.mozilla&&n_node.setAttribute("contenteditable",!0)}if(images)for(i=0;i<images.length;i++)image_srcs.indexOf(images[i].getAttribute("src"))<0&&editor.events.trigger("image.removed",[$(images[i])]);if(images&&loaded){var old_images_srcs=[];for(i=0;i<images.length;i++)old_images_srcs.push(images[i].getAttribute("src"));for(i=0;i<c_images.length;i++)old_images_srcs.indexOf(c_images[i].getAttribute("src"))<0&&editor.events.trigger("image.loaded",[$(c_images[i])])}images=c_images}function _repositionResizer(){if($image_resizer||function(){var doc;editor.shared.$image_resizer?($image_resizer=editor.shared.$image_resizer,$overlay=editor.shared.$img_overlay,editor.events.on("destroy",(function(){$image_resizer.removeClass("fr-active").appendTo($("body:first"))}),!0)):(editor.shared.$image_resizer=$('<div class="fr-image-resizer"></div>'),$image_resizer=editor.shared.$image_resizer,editor.events.$on($image_resizer,"mousedown",(function(e){e.stopPropagation()}),!0),editor.opts.imageResize&&($image_resizer.append(_getHandler("nw")+_getHandler("ne")+_getHandler("sw")+_getHandler("se")),editor.shared.$img_overlay=$('<div class="fr-image-overlay"></div>'),$overlay=editor.shared.$img_overlay,doc=$image_resizer.get(0).ownerDocument,$(doc).find("body:first").append($overlay)));editor.events.on("shared.destroy",(function(){$image_resizer.html("").removeData().remove(),$image_resizer=null,editor.opts.imageResize&&($overlay.remove(),$overlay=null)}),!0),editor.helpers.isMobile()||editor.events.$on($(editor.o_win),"resize",(function(){$current_image&&!$current_image.hasClass("fr-uploading")?_exitEdit(!0):$current_image&&(_repositionResizer(),replace(),showProgressBar(!1))}));if(editor.opts.imageResize){doc=$image_resizer.get(0).ownerDocument,editor.events.$on($image_resizer,editor._mousedown,".fr-handler",_handlerMousedown),editor.events.$on($(doc),editor._mousemove,_handlerMousemove),editor.events.$on($(doc.defaultView||doc.parentWindow),editor._mouseup,_handlerMouseup),editor.events.$on($overlay,"mouseleave",_handlerMouseup);var step=1,prevKey=null,prevTimestamp=0;editor.events.on("keydown",(function(e){if($current_image){var ctrlKey=-1!=navigator.userAgent.indexOf("Mac OS X")?e.metaKey:e.ctrlKey,keycode=e.which;(keycode!==prevKey||e.timeStamp-prevTimestamp>200)&&(step=1),(keycode==$.FE.KEYCODE.EQUALS||editor.browser.mozilla&&keycode==$.FE.KEYCODE.FF_EQUALS)&&ctrlKey&&!e.altKey?step=_resizeImage.call(this,e,1,1,step):(keycode==$.FE.KEYCODE.HYPHEN||editor.browser.mozilla&&keycode==$.FE.KEYCODE.FF_HYPHEN)&&ctrlKey&&!e.altKey?step=_resizeImage.call(this,e,2,-1,step):editor.keys.ctrlKey(e)||keycode!=$.FE.KEYCODE.ENTER||($current_image.before("<br>"),_editImg($current_image)),prevKey=keycode,prevTimestamp=e.timeStamp}}),!0),editor.events.on("keyup",(function(){step=1}))}}(),!$current_image)return!1;var $container=editor.$wp||editor.$sc;$container.append($image_resizer),$image_resizer.data("instance",editor);var wrap_correction_top=$container.scrollTop()-("static"!=$container.css("position")?$container.offset().top:0),wrap_correction_left=$container.scrollLeft()-("static"!=$container.css("position")?$container.offset().left:0);wrap_correction_left-=editor.helpers.getPX($container.css("border-left-width")),wrap_correction_top-=editor.helpers.getPX($container.css("border-top-width")),editor.$el.is("img")&&editor.$sc.is("body")&&(wrap_correction_top=0,wrap_correction_left=0);var $el=getEl();hasCaption()&&($el=$el.find(".fr-img-wrap")),$image_resizer.css("top",(editor.opts.iframe?$el.offset().top:$el.offset().top+wrap_correction_top)-1).css("left",(editor.opts.iframe?$el.offset().left:$el.offset().left+wrap_correction_left)-1).css("width",$el.get(0).getBoundingClientRect().width).css("height",$el.get(0).getBoundingClientRect().height).addClass("fr-active")}function _getHandler(pos){return'<div class="fr-handler fr-h'+pos+'"></div>'}function _setWidth(width){hasCaption()?$current_image.parents(".fr-img-caption").css("width",width):$current_image.css("width",width)}function _handlerMousedown(e){if(!editor.core.sameInstance($image_resizer))return!0;if(e.preventDefault(),e.stopPropagation(),editor.$el.find("img.fr-error").left)return!1;editor.undo.canDo()||editor.undo.saveStep();var start_x=e.pageX||e.originalEvent.touches[0].pageX;if("mousedown"==e.type){var doc=editor.$oel.get(0).ownerDocument,win=doc.defaultView||doc.parentWindow,editor_inside_iframe=!1;try{editor_inside_iframe=win.location!=win.parent.location&&!(win.$&&win.$.FE)}catch(ex){}editor_inside_iframe&&win.frameElement&&(start_x+=editor.helpers.getPX($(win.frameElement).offset().left)+win.frameElement.clientLeft)}($handler=$(this)).data("start-x",start_x),$handler.data("start-width",$current_image.width()),$handler.data("start-height",$current_image.height());var width=$current_image.width();if(editor.opts.imageResizeWithPercent){var p_node=$current_image.parentsUntil(editor.$el,editor.html.blockTagsQuery()).get(0)||editor.el;width=(width/$(p_node).outerWidth()*100).toFixed(2)+"%"}_setWidth(width),$overlay.show(),editor.popups.hideAll(),_unmarkExit()}function _handlerMousemove(e){if(!editor.core.sameInstance($image_resizer))return!0;var real_image_size;if($handler&&$current_image){if(e.preventDefault(),editor.$el.find("img.fr-error").left)return!1;var c_x=e.pageX||(e.originalEvent.touches?e.originalEvent.touches[0].pageX:null);if(!c_x)return!1;var diff_x=c_x-$handler.data("start-x"),width=$handler.data("start-width");if(($handler.hasClass("fr-hnw")||$handler.hasClass("fr-hsw"))&&(diff_x=0-diff_x),editor.opts.imageResizeWithPercent){var p_node=$current_image.parentsUntil(editor.$el,editor.html.blockTagsQuery()).get(0)||editor.el;width=((width+diff_x)/$(p_node).outerWidth()*100).toFixed(2),editor.opts.imageRoundPercent&&(width=Math.round(width)),_setWidth(width+"%"),(real_image_size=hasCaption()?(editor.helpers.getPX($current_image.parents(".fr-img-caption").css("width"))/$(p_node).outerWidth()*100).toFixed(2):(editor.helpers.getPX($current_image.css("width"))/$(p_node).outerWidth()*100).toFixed(2))===width||editor.opts.imageRoundPercent||_setWidth(real_image_size+"%"),$current_image.css("height","").removeAttr("height")}else width+diff_x>=editor.opts.imageMinWidth&&(_setWidth(width+diff_x),real_image_size=hasCaption()?editor.helpers.getPX($current_image.parents(".fr-img-caption").css("width")):editor.helpers.getPX($current_image.css("width"))),real_image_size!==width+diff_x&&_setWidth(real_image_size),(($current_image.attr("style")||"").match(/(^height:)|(; *height:)/)||$current_image.attr("height"))&&($current_image.css("height",$handler.data("start-height")*$current_image.width()/$handler.data("start-width")),$current_image.removeAttr("height"));_repositionResizer(),editor.events.trigger("image.resize",[get()])}}function _handlerMouseup(e){if(!editor.core.sameInstance($image_resizer))return!0;if($handler&&$current_image){if(e&&e.stopPropagation(),editor.$el.find("img.fr-error").left)return!1;$handler=null,$overlay.hide(),_repositionResizer(),_showEditPopup(),editor.undo.saveStep(),editor.events.trigger("image.resizeEnd",[get()])}}function _throwError(code,response,$img){editor.edit.on(),$current_image&&$current_image.addClass("fr-error"),function(message){showProgressBar();var $layer=editor.popups.get("image.insert").find(".fr-image-progress-bar-layer");$layer.addClass("fr-error");var $message_header=$layer.find("h3");$message_header.text(message),editor.events.disableBlur(),$message_header.focus()}(editor.language.translate("Something went wrong. Please try again.")),!$current_image&&$img&&remove($img),editor.events.trigger("image.error",[{code:code,message:error_messages[code]},response,$img])}function _initEditPopup(delayed){if(delayed)return editor.$wp&&editor.events.$on(editor.$wp,"scroll.image-edit",(function(){$current_image&&editor.popups.isVisible("image.edit")&&(editor.events.disableBlur(),_showEditPopup())})),!0;var image_buttons="";if(editor.opts.imageEditButtons.length>0){image_buttons+='<div class="fr-buttons">',image_buttons+=editor.button.buildList(editor.opts.imageEditButtons);var template={buttons:image_buttons+="</div>"};return editor.popups.create("image.edit",template)}return!1}function showProgressBar(no_message){var $popup=editor.popups.get("image.insert");if($popup||($popup=_initInsertPopup()),$popup.find(".fr-layer.fr-active").removeClass("fr-active").addClass("fr-pactive"),$popup.find(".fr-image-progress-bar-layer").addClass("fr-active"),$popup.find(".fr-buttons").hide(),$current_image){var $el=getEl();editor.popups.setContainer("image.insert",editor.$sc);var left=$el.offset().left+$el.width()/2,top=$el.offset().top+$el.height();editor.popups.show("image.insert",left,top,$el.outerHeight())}void 0===no_message&&_setProgressMessage(editor.language.translate("Uploading"),0)}function hideProgressBar(dismiss){var $popup=editor.popups.get("image.insert");if($popup&&($popup.find(".fr-layer.fr-pactive").addClass("fr-active").removeClass("fr-pactive"),$popup.find(".fr-image-progress-bar-layer").removeClass("fr-active"),$popup.find(".fr-buttons").show(),dismiss||editor.$el.find("img.fr-error").length)){if(editor.events.focus(),editor.$el.find("img.fr-error").length&&(editor.$el.find("img.fr-error").remove(),editor.undo.saveStep(),editor.undo.run(),editor.undo.dropRedo()),!editor.$wp&&$current_image){var $img=$current_image;_exitEdit(!0),editor.selection.setAfter($img.get(0)),editor.selection.restore()}editor.popups.hide("image.insert")}}function _setProgressMessage(message,progress){var $popup=editor.popups.get("image.insert");if($popup){var $layer=$popup.find(".fr-image-progress-bar-layer");$layer.find("h3").text(message+(progress?" "+progress+"%":"")),$layer.removeClass("fr-error"),progress?($layer.find("div").removeClass("fr-indeterminate"),$layer.find("div > span").css("width",progress+"%")):$layer.find("div").addClass("fr-indeterminate")}}function _editImg($img){_edit.call($img.get(0))}function _loadedCallback(){var $img=$(this);editor.popups.hide("image.insert"),$img.removeClass("fr-uploading"),$img.next().is("br")&&$img.next().remove(),_editImg($img),editor.events.trigger("image.loaded",[$img])}function insert(link,sanitize,data,$existing_img,response){editor.edit.off(),_setProgressMessage(editor.language.translate("Loading image")),sanitize&&(link=editor.helpers.sanitizeURL(link));var image=new Image;image.onload=function(){var $img,attr;if($existing_img){editor.undo.canDo()||$existing_img.hasClass("fr-uploading")||editor.undo.saveStep();var old_src=$existing_img.data("fr-old-src");$existing_img.data("fr-image-pasted")&&(old_src=null),editor.$wp?(($img=$existing_img.clone().removeData("fr-old-src").removeClass("fr-uploading").removeAttr("data-fr-image-pasted")).off("load"),old_src&&$existing_img.attr("src",old_src),$existing_img.replaceWith($img)):$img=$existing_img;for(var atts=$img.get(0).attributes,i=0;i<atts.length;i++){var att=atts[i];0===att.nodeName.indexOf("data-")&&$img.removeAttr(att.nodeName)}if(void 0!==data)for(attr in data)data.hasOwnProperty(attr)&&"link"!=attr&&$img.attr("data-"+attr,data[attr]);$img.on("load",_loadedCallback),$img.attr("src",link),editor.edit.on(),_syncImages(!1),editor.undo.saveStep(),editor.events.disableBlur(),editor.$el.blur(),editor.events.trigger(old_src?"image.replaced":"image.inserted",[$img,response])}else $img=_addImage(link,data,_loadedCallback),_syncImages(!1),editor.undo.saveStep(),editor.events.disableBlur(),editor.$el.blur(),editor.events.trigger("image.inserted",[$img,response])},image.onerror=function(){_throwError(1)},showProgressBar(editor.language.translate("Loading image")),image.src=link}function _imageUploaded($img){_setProgressMessage(editor.language.translate("Loading image"));var status=this.status,response=this.response,responseXML=this.responseXML,responseText=this.responseText;try{if(editor.opts.imageUploadToS3)if(201==status){var link=function(response){try{var link=$(response).find("Location").text(),key=$(response).find("Key").text();return!1===editor.events.trigger("image.uploadedToS3",[link,key,response],!0)?(editor.edit.on(),!1):link}catch(ex){return _throwError(4,response),!1}}(responseXML);link&&insert(link,!1,[],$img,response||responseXML)}else _throwError(4,response||responseXML,$img);else if(status>=200&&status<300){var resp=function(response){try{if(!1===editor.events.trigger("image.uploaded",[response],!0))return editor.edit.on(),!1;var resp=JSON.parse(response);return resp.link?resp:(_throwError(2,response),!1)}catch(ex){return _throwError(4,response),!1}}(responseText);resp&&insert(resp.link,!1,resp,$img,response||responseText)}else _throwError(3,response||responseText,$img)}catch(ex){_throwError(4,response||responseText,$img)}}function _imageUploadError(){_throwError(4,this.response||this.responseText||this.responseXML)}function _imageUploadProgress(e){if(e.lengthComputable){var complete=e.loaded/e.total*100|0;_setProgressMessage(editor.language.translate("Uploading"),complete)}}function _addImage(link,data,loadCallback){var attr,data_str="";if(data&&void 0!==data)for(attr in data)data.hasOwnProperty(attr)&&"link"!=attr&&(data_str+=" data-"+attr+'="'+data[attr]+'"');var width=editor.opts.imageDefaultWidth;width&&"auto"!=width&&(width+=editor.opts.imageResizeWithPercent?"%":"px");var $img=$('<img src="'+link+'"'+data_str+(width?' style="width: '+width+';"':"")+">");_setStyle($img,editor.opts.imageDefaultDisplay,editor.opts.imageDefaultAlign),$img.on("load",loadCallback),$img.on("error",loadCallback),editor.edit.on(),editor.events.focus(!0),editor.selection.restore(),editor.undo.saveStep(),editor.opts.imageSplitHTML?editor.markers.split():editor.markers.insert(),editor.html.wrap();var $marker=editor.$el.find(".fr-marker");return $marker.length?($marker.parent().is("hr")&&$marker.parent().after($marker),editor.node.isLastSibling($marker)&&$marker.parent().hasClass("fr-deletable")&&$marker.insertAfter($marker.parent()),$marker.replaceWith($img)):editor.$el.append($img),editor.selection.clear(),$img}function _imageUploadAborted(){editor.edit.on(),hideProgressBar(!0)}function upload(images,$image_placeholder){if(void 0!==images&&images.length>0){if(!1===editor.events.trigger("image.beforeUpload",[images,$image_placeholder]))return!1;var form_data,image=images[0];if((null===editor.opts.imageUploadURL||"https://i.froala.com/upload"==editor.opts.imageUploadURL)&&!editor.opts.imageUploadToS3)return function(image,$image_placeholder){var reader=new FileReader;reader.onload=function(){var link=reader.result;if(reader.result.indexOf("svg+xml")<0){for(var binary=atob(reader.result.split(",")[1]),array=[],i=0;i<binary.length;i++)array.push(binary.charCodeAt(i));link=window.URL.createObjectURL(new Blob([new Uint8Array(array)],{type:image.type})),editor.image.insert(link,!1,null,$image_placeholder)}},showProgressBar(),reader.readAsDataURL(image)}(image,$image_placeholder||$current_image),!1;if(image.name||(image.name=(new Date).getTime()+"."+(image.type||"image/jpeg").replace(/image\//g,"")),image.size>editor.opts.imageMaxSize)return _throwError(5),!1;if(editor.opts.imageAllowedTypes.indexOf(image.type.replace(/image\//g,""))<0)return _throwError(6),!1;if(editor.drag_support.formdata&&(form_data=editor.drag_support.formdata?new FormData:null),form_data){var key;if(!1!==editor.opts.imageUploadToS3)for(key in form_data.append("key",editor.opts.imageUploadToS3.keyStart+(new Date).getTime()+"-"+(image.name||"untitled")),form_data.append("success_action_status","201"),form_data.append("X-Requested-With","xhr"),form_data.append("Content-Type",image.type),editor.opts.imageUploadToS3.params)editor.opts.imageUploadToS3.params.hasOwnProperty(key)&&form_data.append(key,editor.opts.imageUploadToS3.params[key]);for(key in editor.opts.imageUploadParams)editor.opts.imageUploadParams.hasOwnProperty(key)&&form_data.append(key,editor.opts.imageUploadParams[key]);form_data.append(editor.opts.imageUploadParam,image,image.name);var url=editor.opts.imageUploadURL;editor.opts.imageUploadToS3&&(url=editor.opts.imageUploadToS3.uploadURL?editor.opts.imageUploadToS3.uploadURL:"https://"+editor.opts.imageUploadToS3.region+".amazonaws.com/"+editor.opts.imageUploadToS3.bucket),function(xhr,form_data,image,$image_placeholder){function _sendRequest(){var $img=$(this);$img.off("load"),$img.addClass("fr-uploading"),$img.next().is("br")&&$img.next().remove(),editor.placeholder.refresh(),_editImg($img),_repositionResizer(),showProgressBar(),editor.edit.off(),xhr.onload=function(){_imageUploaded.call(xhr,$img)},xhr.onerror=_imageUploadError,xhr.upload.onprogress=_imageUploadProgress,xhr.onabort=_imageUploadAborted,$img.off("abortUpload").on("abortUpload",(function(){4!=xhr.readyState&&xhr.abort()})),xhr.send(form_data)}var reader=new FileReader;reader.onload=function(){var link=reader.result;if(reader.result.indexOf("svg+xml")<0){for(var binary=atob(reader.result.split(",")[1]),array=[],i=0;i<binary.length;i++)array.push(binary.charCodeAt(i));link=window.URL.createObjectURL(new Blob([new Uint8Array(array)],{type:"image/jpeg"}))}$image_placeholder?($image_placeholder.on("load",_sendRequest),$image_placeholder.one("error",_sendRequest),editor.edit.on(),editor.undo.saveStep(),$image_placeholder.data("fr-old-src",$image_placeholder.attr("src")),$image_placeholder.attr("src",link)):_addImage(link,null,_sendRequest)},reader.readAsDataURL(image)}(editor.core.getXHR(url,editor.opts.imageUploadMethod),form_data,image,$image_placeholder||$current_image)}}}function _beforeElementDrop($el){if($el.is("img")&&$el.parents(".fr-img-caption").length>0)return $el.parents(".fr-img-caption")}function _drop(e){var dt=e.originalEvent.dataTransfer;if(dt&&dt.files&&dt.files.length){var img=dt.files[0];if(img&&img.type&&-1!==img.type.indexOf("image")&&editor.opts.imageAllowedTypes.indexOf(img.type.replace(/image\//g,""))>=0){if(!editor.opts.imageUpload)return e.preventDefault(),e.stopPropagation(),!1;editor.markers.remove(),editor.markers.insertAtPoint(e.originalEvent),editor.$el.find(".fr-marker").replaceWith($.FE.MARKERS),0===editor.$el.find(".fr-marker").length&&editor.selection.setAtEnd(editor.el),editor.popups.hideAll();var $popup=editor.popups.get("image.insert");$popup||($popup=_initInsertPopup()),editor.popups.setContainer("image.insert",editor.$sc);var left=e.originalEvent.pageX,top=e.originalEvent.pageY;return editor.opts.iframe&&(top+=editor.$iframe.offset().top,left+=editor.$iframe.offset().left),editor.popups.show("image.insert",left,top),showProgressBar(),editor.opts.imageAllowedTypes.indexOf(img.type.replace(/image\//g,""))>=0?(_exitEdit(!0),upload(dt.files)):_throwError(6),e.preventDefault(),e.stopPropagation(),!1}}}function _initInsertPopup(delayed){if(delayed)return editor.popups.onRefresh("image.insert",_refreshInsertPopup),editor.popups.onHide("image.insert",_hideInsertPopup),!0;var active,$popup,image_buttons="";editor.opts.imageUpload||-1===editor.opts.imageInsertButtons.indexOf("imageUpload")||editor.opts.imageInsertButtons.splice(editor.opts.imageInsertButtons.indexOf("imageUpload"),1);var buttonList=editor.button.buildList(editor.opts.imageInsertButtons);""!==buttonList&&(image_buttons='<div class="fr-buttons">'+buttonList+"</div>");var uploadIndex=editor.opts.imageInsertButtons.indexOf("imageUpload"),urlIndex=editor.opts.imageInsertButtons.indexOf("imageByURL"),upload_layer="";uploadIndex>=0&&(active=" fr-active",urlIndex>=0&&uploadIndex>urlIndex&&(active=""),upload_layer='<div class="fr-image-upload-layer'+active+' fr-layer" id="fr-image-upload-layer-'+editor.id+'"><strong>'+editor.language.translate("Drop image")+"</strong><br>("+editor.language.translate("or click")+')<div class="fr-form"><input type="file" accept="image/'+editor.opts.imageAllowedTypes.join(", image/").toLowerCase()+'" tabIndex="-1" aria-labelledby="fr-image-upload-layer-'+editor.id+'" role="button"></div></div>');var by_url_layer="";urlIndex>=0&&(active=" fr-active",uploadIndex>=0&&urlIndex>uploadIndex&&(active=""),by_url_layer='<div class="fr-image-by-url-layer'+active+' fr-layer" id="fr-image-by-url-layer-'+editor.id+'"><div class="fr-input-line"><input id="fr-image-by-url-layer-text-'+editor.id+'" type="text" placeholder="http://" tabIndex="1" aria-required="true"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageInsertByURL" tabIndex="2" role="button">'+editor.language.translate("Insert")+"</button></div></div>");var template={buttons:image_buttons,upload_layer:upload_layer,by_url_layer:by_url_layer,progress_bar:'<div class="fr-image-progress-bar-layer fr-layer"><h3 tabIndex="-1" class="fr-message">Uploading</h3><div class="fr-loader"><span class="fr-progress"></span></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-dismiss" data-cmd="imageDismissError" tabIndex="2" role="button">OK</button></div></div>'};return editor.opts.imageInsertButtons.length>=1&&($popup=editor.popups.create("image.insert",template)),editor.$wp&&editor.events.$on(editor.$wp,"scroll",(function(){$current_image&&editor.popups.isVisible("image.insert")&&replace()})),function($popup){editor.events.$on($popup,"dragover dragenter",".fr-image-upload-layer",(function(){return $(this).addClass("fr-drop"),!1}),!0),editor.events.$on($popup,"dragleave dragend",".fr-image-upload-layer",(function(){return $(this).removeClass("fr-drop"),!1}),!0),editor.events.$on($popup,"drop",".fr-image-upload-layer",(function(e){e.preventDefault(),e.stopPropagation(),$(this).removeClass("fr-drop");var dt=e.originalEvent.dataTransfer;if(dt&&dt.files){var inst=$popup.data("instance")||editor;inst.events.disableBlur(),inst.image.upload(dt.files),inst.events.enableBlur()}}),!0),editor.helpers.isIOS()&&editor.events.$on($popup,"touchstart",'.fr-image-upload-layer input[type="file"]',(function(){$(this).trigger("click")}),!0),editor.events.$on($popup,"change",'.fr-image-upload-layer input[type="file"]',(function(){if(this.files){var inst=$popup.data("instance")||editor;inst.events.disableBlur(),$popup.find("input:focus").blur(),inst.events.enableBlur(),inst.image.upload(this.files,$current_image)}$(this).val("")}),!0)}($popup),$popup}function _refreshAltPopup(){$current_image&&editor.popups.get("image.alt").find("input").val($current_image.attr("alt")||"").trigger("change")}function showAltPopup(){var $popup=editor.popups.get("image.alt");$popup||($popup=_initAltPopup()),hideProgressBar(),editor.popups.refresh("image.alt"),editor.popups.setContainer("image.alt",editor.$sc);var $el=getEl();hasCaption()&&($el=$el.find(".fr-img-wrap"));var left=$el.offset().left+$el.outerWidth()/2,top=$el.offset().top+$el.outerHeight();editor.popups.show("image.alt",left,top,$el.outerHeight())}function _initAltPopup(delayed){if(delayed)return editor.popups.onRefresh("image.alt",_refreshAltPopup),!0;var template={buttons:'<div class="fr-buttons">'+editor.button.buildList(editor.opts.imageAltButtons)+"</div>",alt_layer:'<div class="fr-image-alt-layer fr-layer fr-active" id="fr-image-alt-layer-'+editor.id+'"><div class="fr-input-line"><input id="fr-image-alt-layer-text-'+editor.id+'" type="text" placeholder="'+editor.language.translate("Alternative Text")+'" tabIndex="1"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageSetAlt" tabIndex="2" role="button">'+editor.language.translate("Update")+"</button></div></div>"},$popup=editor.popups.create("image.alt",template);return editor.$wp&&editor.events.$on(editor.$wp,"scroll.image-alt",(function(){$current_image&&editor.popups.isVisible("image.alt")&&showAltPopup()})),$popup}function _refreshSizePopup(){var $popup=editor.popups.get("image.size");if($current_image)if(hasCaption()){var $el=$current_image.parent();$el.get(0).style.width||($el=$current_image.parent().parent()),$popup.find('input[name="width"]').val($el.get(0).style.width).trigger("change"),$popup.find('input[name="height"]').val($el.get(0).style.height).trigger("change")}else $popup.find('input[name="width"]').val($current_image.get(0).style.width).trigger("change"),$popup.find('input[name="height"]').val($current_image.get(0).style.height).trigger("change")}function showSizePopup(){var $popup=editor.popups.get("image.size");$popup||($popup=_initSizePopup()),hideProgressBar(),editor.popups.refresh("image.size"),editor.popups.setContainer("image.size",editor.$sc);var $el=getEl();hasCaption()&&($el=$el.find(".fr-img-wrap"));var left=$el.offset().left+$el.outerWidth()/2,top=$el.offset().top+$el.outerHeight();editor.popups.show("image.size",left,top,$el.outerHeight())}function _initSizePopup(delayed){if(delayed)return editor.popups.onRefresh("image.size",_refreshSizePopup),!0;var template={buttons:'<div class="fr-buttons">'+editor.button.buildList(editor.opts.imageSizeButtons)+"</div>",size_layer:'<div class="fr-image-size-layer fr-layer fr-active" id="fr-image-size-layer-'+editor.id+'"><div class="fr-image-group"><div class="fr-input-line"><input id="fr-image-size-layer-width-'+editor.id+'" type="text" name="width" placeholder="'+editor.language.translate("Width")+'" tabIndex="1"></div><div class="fr-input-line"><input id="fr-image-size-layer-height'+editor.id+'" type="text" name="height" placeholder="'+editor.language.translate("Height")+'" tabIndex="1"></div></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageSetSize" tabIndex="2" role="button">'+editor.language.translate("Update")+"</button></div></div>"},$popup=editor.popups.create("image.size",template);return editor.$wp&&editor.events.$on(editor.$wp,"scroll.image-size",(function(){$current_image&&editor.popups.isVisible("image.size")&&showSizePopup()})),$popup}function _resizeImage(e,initPageX,direction,step){return e.pageX=initPageX,_handlerMousedown.call(this,e),e.pageX=e.pageX+direction*Math.floor(Math.pow(1.1,step)),_handlerMousemove.call(this,e),_handlerMouseup.call(this,e),++step}function remove($img){($img=$img||getEl())&&!1!==editor.events.trigger("image.beforeRemove",[$img])&&(editor.popups.hideAll(),_selectImage(),_exitEdit(!0),editor.undo.canDo()||editor.undo.saveStep(),$img.get(0)==editor.el?$img.removeAttr("src"):($img.get(0).parentNode&&"A"==$img.get(0).parentNode.tagName?(editor.selection.setBefore($img.get(0).parentNode)||editor.selection.setAfter($img.get(0).parentNode)||$img.parent().after($.FE.MARKERS),$($img.get(0).parentNode).remove()):(editor.selection.setBefore($img.get(0))||editor.selection.setAfter($img.get(0))||$img.after($.FE.MARKERS),$img.remove()),editor.html.fillEmptyBlocks(),editor.selection.restore()),editor.undo.saveStep())}function _editorKeydownHandler(e){var key_code=e.which;if($current_image&&(key_code==$.FE.KEYCODE.BACKSPACE||key_code==$.FE.KEYCODE.DELETE))return e.preventDefault(),e.stopPropagation(),remove(),!1;if($current_image&&key_code==$.FE.KEYCODE.ESC){var $img=$current_image;return _exitEdit(!0),editor.selection.setAfter($img.get(0)),editor.selection.restore(),e.preventDefault(),!1}if($current_image&&(key_code==$.FE.KEYCODE.ARROW_LEFT||key_code==$.FE.KEYCODE.ARROW_RIGHT)){var img=$current_image.get(0);return _exitEdit(!0),key_code==$.FE.KEYCODE.ARROW_LEFT?editor.selection.setBefore(img):editor.selection.setAfter(img),editor.selection.restore(),e.preventDefault(),!1}return $current_image&&key_code!=$.FE.KEYCODE.F10&&!editor.keys.isBrowserAction(e)?(e.preventDefault(),e.stopPropagation(),!1):void 0}function _cleanOnGet(el){if(el&&"IMG"==el.tagName){if(editor.node.hasClass(el,"fr-uploading")||editor.node.hasClass(el,"fr-error")?el.parentNode.removeChild(el):editor.node.hasClass(el,"fr-draggable")&&el.classList.remove("fr-draggable"),el.parentNode&&el.parentNode.parentNode&&editor.node.hasClass(el.parentNode.parentNode,"fr-img-caption")){var p_node=el.parentNode.parentNode;p_node.removeAttribute("contenteditable"),p_node.removeAttribute("draggable"),p_node.classList.remove("fr-draggable");var n_node=el.nextSibling;n_node&&n_node.removeAttribute("contenteditable")}}else if(el&&el.nodeType==Node.ELEMENT_NODE)for(var imgs=el.querySelectorAll("img.fr-uploading, img.fr-error, img.fr-draggable"),i=0;i<imgs.length;i++)_cleanOnGet(imgs[i])}function _processPastedImage(img){if(!1===editor.events.trigger("image.beforePasteUpload",[img]))return!1;$current_image=$(img),_repositionResizer(),_showEditPopup(),replace(),showProgressBar(),$current_image.one("load",(function(){_repositionResizer(),showProgressBar()}));for(var splitSrc=$(img).attr("src").split(","),binary=atob(splitSrc[1]),array=[],i=0;i<binary.length;i++)array.push(binary.charCodeAt(i));upload([new Blob([new Uint8Array(array)],{type:splitSrc[0].replace(/data\:/g,"").replace(/;base64/g,"")})],$current_image)}function _uploadPastedImages(){editor.opts.imagePaste?editor.$el.find("img[data-fr-image-pasted]").each((function(index,img){if(editor.opts.imagePasteProcess){var width=editor.opts.imageDefaultWidth;width&&"auto"!=width&&(width+=editor.opts.imageResizeWithPercent?"%":"px"),$(img).css("width",width).removeClass("fr-dii fr-dib fr-fir fr-fil"),_setStyle($(img),editor.opts.imageDefaultDisplay,editor.opts.imageDefaultAlign)}if(0===img.src.indexOf("data:"))_processPastedImage(img);else if(0===img.src.indexOf("blob:")||0===img.src.indexOf("http")&&editor.opts.imageUploadRemoteUrls&&editor.opts.imageCORSProxy){var _img=new Image;_img.crossOrigin="Anonymous",_img.onload=function(){var canvas=editor.o_doc.createElement("CANVAS"),context=canvas.getContext("2d");canvas.height=this.naturalHeight,canvas.width=this.naturalWidth,context.drawImage(this,0,0),setTimeout((function(){_processPastedImage(img)}),0),img.src=canvas.toDataURL("image/jpeg")},_img.src=(0===img.src.indexOf("blob:")?"":editor.opts.imageCORSProxy+"/")+img.src}else 0!==img.src.indexOf("http")||0===img.src.indexOf("https://mail.google.com/mail")?(editor.selection.save(),$(img).remove(),editor.selection.restore()):$(img).removeAttr("data-fr-image-pasted")})):editor.$el.find("img[data-fr-image-pasted]").remove()}function _clipboardImageLoaded(e){var result=e.target.result,width=editor.opts.imageDefaultWidth;width&&"auto"!=width&&(width+=editor.opts.imageResizeWithPercent?"%":"px"),editor.undo.saveStep(),editor.html.insert('<img data-fr-image-pasted="true" src="'+result+'"'+(width?' style="width: '+width+';"':"")+">");var $img=editor.$el.find('img[data-fr-image-pasted="true"]');$img&&_setStyle($img,editor.opts.imageDefaultDisplay,editor.opts.imageDefaultAlign),editor.events.trigger("paste.after")}function _clipboardPaste(e){if(e&&e.clipboardData&&e.clipboardData.items){var file=null;if(e.clipboardData.types&&-1!=e.clipboardData.types.indexOf("text/rtf")||e.clipboardData.getData("text/rtf"))file=e.clipboardData.items[0].getAsFile();else for(var i=0;i<e.clipboardData.items.length&&!(file=e.clipboardData.items[i].getAsFile());i++);if(file)return function(file){var reader=new FileReader;reader.onload=_clipboardImageLoaded,reader.readAsDataURL(file)}(file),!1}}function _clipboardPasteCleanup(clipboard_html){return clipboard_html=clipboard_html.replace(/<img /gi,'<img data-fr-image-pasted="true" ')}function _edit(e){if("false"==$(this).parents("[contenteditable]:not(.fr-element):not(.fr-img-caption):not(body):first").attr("contenteditable"))return!0;if(e&&"touchend"==e.type&&touchScroll)return!0;if(e&&editor.edit.isDisabled())return e.stopPropagation(),e.preventDefault(),!1;for(var i=0;i<$.FE.INSTANCES.length;i++)$.FE.INSTANCES[i]!=editor&&$.FE.INSTANCES[i].events.trigger("image.hideResizer");editor.toolbar.disable(),e&&(e.stopPropagation(),e.preventDefault()),editor.helpers.isMobile()&&(editor.events.disableBlur(),editor.$el.blur(),editor.events.enableBlur()),editor.opts.iframe&&editor.size.syncIframe(),$current_image=$(this),_selectImage(),_repositionResizer(),_showEditPopup(),editor.browser.msie?(editor.popups.areVisible()&&editor.events.disableBlur(),editor.win.getSelection&&(editor.win.getSelection().removeAllRanges(),editor.win.getSelection().addRange(editor.doc.createRange()))):editor.selection.clear(),editor.helpers.isIOS()&&(editor.events.disableBlur(),editor.$el.blur()),editor.button.bulkRefresh(),editor.events.trigger("video.hideResizer")}function _exitEdit(force_exit){$current_image&&(img_exit_flag||!0===force_exit)&&(editor.toolbar.enable(),$image_resizer.removeClass("fr-active"),editor.popups.hide("image.edit"),$current_image=null,_unmarkExit(),$handler=null,$overlay&&$overlay.hide())}error_messages[1]="Image cannot be loaded from the passed link.",error_messages[2]="No link in upload response.",error_messages[3]="Error during file upload.",error_messages[4]="Parsing response failed.",error_messages[5]="File is too large.",error_messages[6]="Image file type is invalid.",error_messages[7]="Files can be uploaded only to same domain in IE 8 and IE 9.",error_messages[8]="Image file is corrupted.";var img_exit_flag=!1;function _markExit(){img_exit_flag=!0}function _unmarkExit(){img_exit_flag=!1}function _setStyle($img,_display,_align){!editor.opts.htmlUntouched&&editor.opts.useClasses?($img.removeClass("fr-fil fr-fir fr-dib fr-dii"),_align&&$img.addClass("fr-fi"+_align[0]),_display&&$img.addClass("fr-di"+_display[0])):"inline"==_display?($img.css({display:"inline-block",verticalAlign:"bottom",margin:editor.opts.imageDefaultMargin}),"center"==_align?$img.css({float:"none",marginBottom:"",marginTop:"",maxWidth:"calc(100% - "+2*editor.opts.imageDefaultMargin+"px)",textAlign:"center"}):"left"==_align?$img.css({float:"left",marginLeft:0,maxWidth:"calc(100% - "+editor.opts.imageDefaultMargin+"px)",textAlign:"left"}):$img.css({float:"right",marginRight:0,maxWidth:"calc(100% - "+editor.opts.imageDefaultMargin+"px)",textAlign:"right"})):"block"==_display&&($img.css({display:"block",float:"none",verticalAlign:"top",margin:editor.opts.imageDefaultMargin+"px auto",textAlign:"center"}),"left"==_align?$img.css({marginLeft:0,textAlign:"left"}):"right"==_align&&$img.css({marginRight:0,textAlign:"right"}))}function getAlign($img){if(void 0===$img&&($img=getEl()),$img){if($img.hasClass("fr-fil"))return"left";if($img.hasClass("fr-fir"))return"right";if($img.hasClass("fr-dib")||$img.hasClass("fr-dii"))return"center";var flt=$img.css("float");if($img.css("float","none"),"block"==$img.css("display")){if($img.css("float",""),$img.css("float")!=flt&&$img.css("float",flt),0===parseInt($img.css("margin-left"),10))return"left";if(0===parseInt($img.css("margin-right"),10))return"right"}else{if($img.css("float",""),$img.css("float")!=flt&&$img.css("float",flt),"left"==$img.css("float"))return"left";if("right"==$img.css("float"))return"right"}}return"center"}function getDisplay($img){void 0===$img&&($img=getEl());var flt=$img.css("float");return $img.css("float","none"),"block"==$img.css("display")?($img.css("float",""),$img.css("float")!=flt&&$img.css("float",flt),"block"):($img.css("float",""),$img.css("float")!=flt&&$img.css("float",flt),"inline")}function replace(){var $popup=editor.popups.get("image.insert");$popup||($popup=_initInsertPopup()),editor.popups.isVisible("image.insert")||(hideProgressBar(),editor.popups.refresh("image.insert"),editor.popups.setContainer("image.insert",editor.$sc));var $el=getEl();hasCaption()&&($el=$el.find(".fr-img-wrap"));var left=$el.offset().left+$el.outerWidth()/2,top=$el.offset().top+$el.outerHeight();editor.popups.show("image.insert",left,top,$el.outerHeight(!0))}function _selectImage(){if($current_image){editor.events.disableBlur(),editor.selection.clear();var range=editor.doc.createRange();range.selectNode($current_image.get(0)),editor.browser.msie&&range.collapse(!0),editor.selection.get().addRange(range),editor.events.enableBlur()}}function get(){return $current_image}function getEl(){return hasCaption()?$current_image.parents(".fr-img-caption:first"):$current_image}function hasCaption(){return!!$current_image&&$current_image.parents(".fr-img-caption").length>0}return{_init:function(){var imgs;editor.events.$on(editor.$el,editor._mousedown,"IMG"==editor.el.tagName?null:'img:not([contenteditable="false"])',(function(e){if("false"==$(this).parents("[contenteditable]:not(.fr-element):not(.fr-img-caption):not(body):first").attr("contenteditable"))return!0;editor.helpers.isMobile()||editor.selection.clear(),mousedown=!0,editor.popups.areVisible()&&editor.events.disableBlur(),editor.browser.msie&&(editor.events.disableBlur(),editor.$el.attr("contenteditable",!1)),editor.draggable||"touchstart"==e.type||e.preventDefault(),e.stopPropagation()})),editor.events.$on(editor.$el,editor._mouseup,"IMG"==editor.el.tagName?null:'img:not([contenteditable="false"])',(function(e){if("false"==$(this).parents("[contenteditable]:not(.fr-element):not(.fr-img-caption):not(body):first").attr("contenteditable"))return!0;mousedown&&(mousedown=!1,e.stopPropagation(),editor.browser.msie&&(editor.$el.attr("contenteditable",!0),editor.events.enableBlur()))})),editor.events.on("keyup",(function(e){if(e.shiftKey&&""===editor.selection.text().replace(/\n/g,"")&&editor.keys.isArrow(e.which)){var s_el=editor.selection.element(),e_el=editor.selection.endElement();s_el&&"IMG"==s_el.tagName?_editImg($(s_el)):e_el&&"IMG"==e_el.tagName&&_editImg($(e_el))}}),!0),editor.events.on("drop",_drop),editor.events.on("element.beforeDrop",_beforeElementDrop),editor.events.on("mousedown window.mousedown",_markExit),editor.events.on("window.touchmove",_unmarkExit),editor.events.on("mouseup window.mouseup",(function(){if($current_image)return _exitEdit(),!1;_unmarkExit()})),editor.events.on("commands.mousedown",(function($btn){$btn.parents(".fr-toolbar").length>0&&_exitEdit()})),editor.events.on("image.resizeEnd",(function(){editor.opts.iframe&&editor.size.syncIframe()})),editor.events.on("blur image.hideResizer commands.undo commands.redo element.dropped",(function(){mousedown=!1,_exitEdit(!0)})),editor.events.on("modals.hide",(function(){$current_image&&(_selectImage(),editor.selection.clear())})),editor.events.on("image.resizeEnd",(function(){editor.win.getSelection&&_editImg($current_image)})),editor.opts.imageAddNewLine&&editor.events.on("image.inserted",(function($img){var lastNode=$img.get(0);for(lastNode.nextSibling&&"BR"===lastNode.nextSibling.tagName&&(lastNode=lastNode.nextSibling);lastNode&&!editor.node.isElement(lastNode);)lastNode=editor.node.isLastSibling(lastNode)?lastNode.parentNode:null;editor.node.isElement(lastNode)&&(editor.opts.enter===$.FE.ENTER_BR?$img.after("<br>"):$(editor.node.blockParent($img.get(0))).after("<"+editor.html.defaultTag()+"><br></"+editor.html.defaultTag()+">"))})),"IMG"==editor.el.tagName&&editor.$el.addClass("fr-view"),editor.events.$on(editor.$el,editor.helpers.isMobile()&&!editor.helpers.isWindowsPhone()?"touchend":"click","IMG"==editor.el.tagName?null:'img:not([contenteditable="false"])',_edit),editor.helpers.isMobile()&&(editor.events.$on(editor.$el,"touchstart","IMG"==editor.el.tagName?null:'img:not([contenteditable="false"])',(function(){touchScroll=!1})),editor.events.$on(editor.$el,"touchmove",(function(){touchScroll=!0}))),editor.$wp?(editor.events.on("window.keydown keydown",_editorKeydownHandler,!0),editor.events.on("keyup",(function(e){if($current_image&&e.which==$.FE.KEYCODE.ENTER)return!1}),!0),editor.events.$on(editor.$el,"keydown",(function(){var el=editor.selection.element();el.nodeType===Node.TEXT_NODE&&(el=el.parentNode),editor.node.hasClass(el,"fr-inner")||(editor.node.hasClass(el,"fr-img-caption")||(el=$(el).parents(".fr-img-caption").get(0)),editor.node.hasClass(el,"fr-img-caption")&&($(el).after($.FE.INVISIBLE_SPACE+$.FE.MARKERS),editor.selection.restore()))}))):editor.events.$on(editor.$win,"keydown",_editorKeydownHandler),editor.events.on("toolbar.esc",(function(){if($current_image){if(editor.$wp)editor.events.disableBlur(),editor.events.focus();else{var $img=$current_image;_exitEdit(!0),editor.selection.setAfter($img.get(0)),editor.selection.restore()}return!1}}),!0),editor.events.on("toolbar.focusEditor",(function(){if($current_image)return!1}),!0),editor.events.on("window.cut window.copy",(function(e){if($current_image&&editor.popups.isVisible("image.edit")&&!editor.popups.get("image.edit").find(":focus").length){var $el=getEl();hasCaption()?($el.before($.FE.START_MARKER),$el.after($.FE.END_MARKER),editor.selection.restore(),editor.paste.saveCopiedText($el.get(0).outerHTML,$el.text())):(_selectImage(),editor.paste.saveCopiedText($current_image.get(0).outerHTML,$current_image.attr("alt"))),"copy"==e.type?setTimeout((function(){_editImg($current_image)})):(_exitEdit(!0),editor.undo.saveStep(),setTimeout((function(){editor.undo.saveStep()}),0))}}),!0),editor.browser.msie&&editor.events.on("keydown",(function(e){if(!editor.selection.isCollapsed()||!$current_image)return!0;var key_code=e.which;key_code==$.FE.KEYCODE.C&&editor.keys.ctrlKey(e)?editor.events.trigger("window.copy"):key_code==$.FE.KEYCODE.X&&editor.keys.ctrlKey(e)&&editor.events.trigger("window.cut")})),editor.events.$on($(editor.o_win),"keydown",(function(e){var key_code=e.which;if($current_image&&key_code==$.FE.KEYCODE.BACKSPACE)return e.preventDefault(),!1})),editor.events.$on(editor.$win,"keydown",(function(e){var key_code=e.which;$current_image&&$current_image.hasClass("fr-uploading")&&key_code==$.FE.KEYCODE.ESC&&$current_image.trigger("abortUpload")})),editor.events.on("destroy",(function(){$current_image&&$current_image.hasClass("fr-uploading")&&$current_image.trigger("abortUpload")})),editor.events.on("paste.before",_clipboardPaste),editor.events.on("paste.beforeCleanup",_clipboardPasteCleanup),editor.events.on("paste.after",_uploadPastedImages),editor.events.on("html.set",_refreshImageList),editor.events.on("html.inserted",_refreshImageList),_refreshImageList(),editor.events.on("destroy",(function(){images=[]})),editor.events.on("html.processGet",_cleanOnGet),editor.opts.imageOutputSize&&editor.events.on("html.beforeGet",(function(){imgs=editor.el.querySelectorAll("img");for(var i=0;i<imgs.length;i++){var width=imgs[i].style.width||$(imgs[i]).width(),height=imgs[i].style.height||$(imgs[i]).height();width&&imgs[i].setAttribute("width",(""+width).replace(/px/,"")),height&&imgs[i].setAttribute("height",(""+height).replace(/px/,""))}})),editor.opts.iframe&&editor.events.on("image.loaded",editor.size.syncIframe),editor.$wp&&(_syncImages(),editor.events.on("contentChanged",_syncImages)),editor.events.$on($(editor.o_win),"orientationchange.image",(function(){setTimeout((function(){$current_image&&_editImg($current_image)}),100)})),_initEditPopup(!0),_initInsertPopup(!0),_initSizePopup(!0),_initAltPopup(!0),editor.events.on("node.remove",(function($node){if("IMG"==$node.get(0).tagName)return remove($node),!1}))},showInsertPopup:function(){var $btn=editor.$tb.find('.fr-command[data-cmd="insertImage"]'),$popup=editor.popups.get("image.insert");if($popup||($popup=_initInsertPopup()),hideProgressBar(),!$popup.hasClass("fr-active"))if(editor.popups.refresh("image.insert"),editor.popups.setContainer("image.insert",editor.$tb),$btn.is(":visible")){var left=$btn.offset().left+$btn.outerWidth()/2,top=$btn.offset().top+(editor.opts.toolbarBottom?10:$btn.outerHeight()-10);editor.popups.show("image.insert",left,top,$btn.outerHeight())}else editor.position.forSelection($popup),editor.popups.show("image.insert")},showLayer:function(name){var left,top,$popup=editor.popups.get("image.insert");if($current_image||editor.opts.toolbarInline){if($current_image){var $el=getEl();hasCaption()&&($el=$el.find(".fr-img-wrap")),top=$el.offset().top+$el.outerHeight(),left=$el.offset().left+$el.outerWidth()/2}}else{var $btn=editor.$tb.find('.fr-command[data-cmd="insertImage"]');left=$btn.offset().left+$btn.outerWidth()/2,top=$btn.offset().top+(editor.opts.toolbarBottom?10:$btn.outerHeight()-10)}!$current_image&&editor.opts.toolbarInline&&(top=$popup.offset().top-editor.helpers.getPX($popup.css("margin-top")),$popup.hasClass("fr-above")&&(top+=$popup.outerHeight())),$popup.find(".fr-layer").removeClass("fr-active"),$popup.find(".fr-"+name+"-layer").addClass("fr-active"),editor.popups.show("image.insert",left,top,$current_image?$current_image.outerHeight():0),editor.accessibility.focusPopup($popup)},refreshUploadButton:function($btn){editor.popups.get("image.insert").find(".fr-image-upload-layer").hasClass("fr-active")&&$btn.addClass("fr-active").attr("aria-pressed",!0)},refreshByURLButton:function($btn){editor.popups.get("image.insert").find(".fr-image-by-url-layer").hasClass("fr-active")&&$btn.addClass("fr-active").attr("aria-pressed",!0)},upload:upload,insertByURL:function(){var $input=editor.popups.get("image.insert").find(".fr-image-by-url-layer input");if($input.val().length>0){showProgressBar(),_setProgressMessage(editor.language.translate("Loading image"));var img_url=$input.val().trim();if(editor.opts.imageUploadRemoteUrls&&editor.opts.imageCORSProxy&&editor.opts.imageUpload){var xhr=new XMLHttpRequest;xhr.onload=function(){200==this.status?upload([new Blob([this.response],{type:this.response.type||"image/png"})],$current_image):_throwError(1)},xhr.onerror=function(){insert(img_url,!0,[],$current_image)},xhr.open("GET",editor.opts.imageCORSProxy+"/"+img_url,!0),xhr.responseType="blob",xhr.send()}else insert(img_url,!0,[],$current_image);$input.val(""),$input.blur()}},align:function(val){var $el=getEl();$el.removeClass("fr-fir fr-fil"),!editor.opts.htmlUntouched&&editor.opts.useClasses?"left"==val?$el.addClass("fr-fil"):"right"==val&&$el.addClass("fr-fir"):_setStyle($el,getDisplay(),val),_selectImage(),_repositionResizer(),_showEditPopup(),editor.selection.clear()},refreshAlign:function($btn){$current_image&&$btn.find("> *:first").replaceWith(editor.icon.create("image-align-"+getAlign()))},refreshAlignOnShow:function($btn,$dropdown){$current_image&&$dropdown.find('.fr-command[data-param1="'+getAlign()+'"]').addClass("fr-active").attr("aria-selected",!0)},display:function(val){var $el=getEl();$el.removeClass("fr-dii fr-dib"),!editor.opts.htmlUntouched&&editor.opts.useClasses?"inline"==val?$el.addClass("fr-dii"):"block"==val&&$el.addClass("fr-dib"):_setStyle($el,val,getAlign()),_selectImage(),_repositionResizer(),_showEditPopup(),editor.selection.clear()},refreshDisplayOnShow:function($btn,$dropdown){$current_image&&$dropdown.find('.fr-command[data-param1="'+getDisplay()+'"]').addClass("fr-active").attr("aria-selected",!0)},replace:replace,back:function(){$current_image?(editor.events.disableBlur(),$(".fr-popup input:focus").blur(),_editImg($current_image)):(editor.events.disableBlur(),editor.selection.restore(),editor.events.enableBlur(),editor.popups.hide("image.insert"),editor.toolbar.showInline())},get:get,getEl:getEl,insert:insert,showProgressBar:showProgressBar,remove:remove,hideProgressBar:hideProgressBar,applyStyle:function(val,imageStyles,multipleStyles){if(void 0===imageStyles&&(imageStyles=editor.opts.imageStyles),void 0===multipleStyles&&(multipleStyles=editor.opts.imageMultipleStyles),!$current_image)return!1;var $img=getEl();if(!multipleStyles){var styles=Object.keys(imageStyles);styles.splice(styles.indexOf(val),1),$img.removeClass(styles.join(" "))}"object"==typeof imageStyles[val]?($img.removeAttr("style"),$img.css(imageStyles[val].style)):$img.toggleClass(val),_editImg($current_image)},showAltPopup:showAltPopup,showSizePopup:showSizePopup,setAlt:function(alt){if($current_image){var $popup=editor.popups.get("image.alt");$current_image.attr("alt",alt||$popup.find("input").val()||""),$popup.find("input:focus").blur(),_editImg($current_image)}},setSize:function(width,height){if($current_image){var $popup=editor.popups.get("image.size");width=width||$popup.find('input[name="width"]').val()||"",height=height||$popup.find('input[name="height"]').val()||"";var regex=/^[\d]+((px)|%)*$/g;$current_image.removeAttr("width").removeAttr("height"),width.match(regex)?$current_image.css("width",width):$current_image.css("width",""),height.match(regex)?$current_image.css("height",height):$current_image.css("height",""),hasCaption()&&($current_image.parents(".fr-img-caption").removeAttr("width").removeAttr("height"),width.match(regex)?$current_image.parents(".fr-img-caption").css("width",width):$current_image.parents(".fr-img-caption").css("width",""),height.match(regex)?$current_image.parents(".fr-img-caption").css("height",height):$current_image.parents(".fr-img-caption").css("height","")),$popup&&$popup.find("input:focus").blur(),_editImg($current_image)}},toggleCaption:function(){var $el;if($current_image&&!hasCaption()){$el=$current_image,$current_image.parent().is("a")&&($el=$current_image.parent());var current_width=$el.width();$el.wrap("<span "+(editor.browser.mozilla?"":'contenteditable="false"')+'class="fr-img-caption '+$current_image.attr("class")+'" style="'+(editor.opts.useClasses?"":$el.attr("style"))+'" draggable="false"></span>'),$el.wrap('<span class="fr-img-wrap"></span>'),$el.after('<span class="fr-inner"'+(editor.browser.mozilla?"":' contenteditable="true"')+">"+$.FE.START_MARKER+"Image caption"+$.FE.END_MARKER+"</span>"),$current_image.removeAttr("class").removeAttr("style").removeAttr("width"),$current_image.parents(".fr-img-caption").css("width",current_width+"px"),_exitEdit(!0),editor.selection.restore()}else $el=getEl(),$current_image.insertAfter($el),$current_image.attr("class",$el.attr("class").replace("fr-img-caption","")).attr("style",$el.attr("style")),$el.remove(),_editImg($current_image)},hasCaption:hasCaption,exitEdit:_exitEdit,edit:_editImg}},$.FE.DefineIcon("insertImage",{NAME:"image"}),$.FE.RegisterShortcut($.FE.KEYCODE.P,"insertImage",null,"P"),$.FE.RegisterCommand("insertImage",{title:"Insert Image",undo:!1,focus:!0,refreshAfterCallback:!1,popup:!0,callback:function(){this.popups.isVisible("image.insert")?(this.$el.find(".fr-marker").length&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("image.insert")):this.image.showInsertPopup()},plugin:"image"}),$.FE.DefineIcon("imageUpload",{NAME:"upload"}),$.FE.RegisterCommand("imageUpload",{title:"Upload Image",undo:!1,focus:!1,toggle:!0,callback:function(){this.image.showLayer("image-upload")},refresh:function($btn){this.image.refreshUploadButton($btn)}}),$.FE.DefineIcon("imageByURL",{NAME:"link"}),$.FE.RegisterCommand("imageByURL",{title:"By URL",undo:!1,focus:!1,toggle:!0,callback:function(){this.image.showLayer("image-by-url")},refresh:function($btn){this.image.refreshByURLButton($btn)}}),$.FE.RegisterCommand("imageInsertByURL",{title:"Insert Image",undo:!0,refreshAfterCallback:!1,callback:function(){this.image.insertByURL()},refresh:function($btn){this.image.get()?$btn.text(this.language.translate("Replace")):$btn.text(this.language.translate("Insert"))}}),$.FE.DefineIcon("imageDisplay",{NAME:"star-o"}),$.FE.RegisterCommand("imageDisplay",{title:"Display",type:"dropdown",options:{inline:"Inline",block:"Break Text"},callback:function(cmd,val){this.image.display(val)},refresh:function($btn){this.opts.imageTextNear||$btn.addClass("fr-hidden")},refreshOnShow:function($btn,$dropdown){this.image.refreshDisplayOnShow($btn,$dropdown)}}),$.FE.DefineIcon("image-align",{NAME:"align-left"}),$.FE.DefineIcon("image-align-left",{NAME:"align-left"}),$.FE.DefineIcon("image-align-right",{NAME:"align-right"}),$.FE.DefineIcon("image-align-center",{NAME:"align-justify"}),$.FE.DefineIcon("imageAlign",{NAME:"align-justify"}),$.FE.RegisterCommand("imageAlign",{type:"dropdown",title:"Align",options:{left:"Align Left",center:"None",right:"Align Right"},html:function(){var c='<ul class="fr-dropdown-list" role="presentation">',options=$.FE.COMMANDS.imageAlign.options;for(var val in options)options.hasOwnProperty(val)&&(c+='<li role="presentation"><a class="fr-command fr-title" tabIndex="-1" role="option" data-cmd="imageAlign" data-param1="'+val+'" title="'+this.language.translate(options[val])+'">'+this.icon.create("image-align-"+val)+'<span class="fr-sr-only">'+this.language.translate(options[val])+"</span></a></li>");return c+="</ul>"},callback:function(cmd,val){this.image.align(val)},refresh:function($btn){this.image.refreshAlign($btn)},refreshOnShow:function($btn,$dropdown){this.image.refreshAlignOnShow($btn,$dropdown)}}),$.FE.DefineIcon("imageReplace",{NAME:"exchange",FA5NAME:"exchange-alt"}),$.FE.RegisterCommand("imageReplace",{title:"Replace",undo:!1,focus:!1,popup:!0,refreshAfterCallback:!1,callback:function(){this.image.replace()}}),$.FE.DefineIcon("imageRemove",{NAME:"trash"}),$.FE.RegisterCommand("imageRemove",{title:"Remove",callback:function(){this.image.remove()}}),$.FE.DefineIcon("imageBack",{NAME:"arrow-left"}),$.FE.RegisterCommand("imageBack",{title:"Back",undo:!1,focus:!1,back:!0,callback:function(){this.image.back()},refresh:function($btn){this.image.get()||this.opts.toolbarInline?($btn.removeClass("fr-hidden"),$btn.next(".fr-separator").removeClass("fr-hidden")):($btn.addClass("fr-hidden"),$btn.next(".fr-separator").addClass("fr-hidden"))}}),$.FE.RegisterCommand("imageDismissError",{title:"OK",undo:!1,callback:function(){this.image.hideProgressBar(!0)}}),$.FE.DefineIcon("imageStyle",{NAME:"magic"}),$.FE.RegisterCommand("imageStyle",{title:"Style",type:"dropdown",html:function(){var c='<ul class="fr-dropdown-list" role="presentation">',options=this.opts.imageStyles;for(var cls in options)if(options.hasOwnProperty(cls)){var val=options[cls];"object"==typeof val&&(val=val.title),c+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="imageStyle" data-param1="'+cls+'">'+this.language.translate(val)+"</a></li>"}return c+="</ul>"},callback:function(cmd,val){this.image.applyStyle(val)},refreshOnShow:function($btn,$dropdown){var $current_image=this.image.getEl();$current_image&&$dropdown.find(".fr-command").each((function(){var cls=$(this).data("param1"),active=$current_image.hasClass(cls);$(this).toggleClass("fr-active",active).attr("aria-selected",active)}))}}),$.FE.DefineIcon("imageAlt",{NAME:"info"}),$.FE.RegisterCommand("imageAlt",{undo:!1,focus:!1,popup:!0,title:"Alternative Text",callback:function(){this.image.showAltPopup()}}),$.FE.RegisterCommand("imageSetAlt",{undo:!0,focus:!1,title:"Update",refreshAfterCallback:!1,callback:function(){this.image.setAlt()}}),$.FE.DefineIcon("imageSize",{NAME:"arrows-alt"}),$.FE.RegisterCommand("imageSize",{undo:!1,focus:!1,popup:!0,title:"Change Size",callback:function(){this.image.showSizePopup()}}),$.FE.RegisterCommand("imageSetSize",{undo:!0,focus:!1,title:"Update",refreshAfterCallback:!1,callback:function(){this.image.setSize()}}),$.FE.DefineIcon("imageCaption",{NAME:"commenting-o",FA5NAME:"comment-alt"}),$.FE.RegisterCommand("imageCaption",{undo:!0,focus:!1,title:"Image Caption",refreshAfterCallback:!0,callback:function(){this.image.toggleCaption()},refresh:function($btn){this.image.get()&&$btn.toggleClass("fr-active",this.image.hasCaption())}})}(jQuery),function($){$.extend($.FE.DEFAULTS,{inlineStyles:{"Big Red":"font-size: 20px; color: red;","Small Blue":"font-size: 14px; color: blue;"}}),$.FE.PLUGINS.inlineStyle=function(editor){return{apply:function(val){if(""!==editor.selection.text())for(var splits=val.split(";"),i=0;i<splits.length;i++){var new_split=splits[i].split(":");splits[i].length&&2==new_split.length&&editor.format.applyStyle(new_split[0].trim(),new_split[1].trim())}else editor.html.insert('<span style="'+val+'">'+$.FE.INVISIBLE_SPACE+$.FE.MARKERS+"</span>")}}},$.FE.RegisterCommand("inlineStyle",{type:"dropdown",html:function(){var c='<ul class="fr-dropdown-list" role="presentation">',options=this.opts.inlineStyles;for(var val in options){if(options.hasOwnProperty(val))c+='<li role="presentation"><span style="'+(options[val]+(-1===options[val].indexOf("display:block;")?" display:block;":""))+'" role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="inlineStyle" data-param1="'+options[val]+'" title="'+this.language.translate(val)+'">'+this.language.translate(val)+"</a></span></li>"}return c+="</ul>"},title:"Inline Style",callback:function(cmd,val){this.inlineStyle.apply(val)},plugin:"inlineStyle"}),$.FE.DefineIcon("inlineStyle",{NAME:"paint-brush"})}(jQuery),function($){$.extend($.FE.DEFAULTS,{inlineClasses:{"fr-class-code":"Code","fr-class-highlighted":"Highlighted","fr-class-transparency":"Transparent"}}),$.FE.PLUGINS.inlineClass=function(editor){return{apply:function(val){editor.format.toggle("span",{class:val})},refreshOnShow:function($btn,$dropdown){$dropdown.find(".fr-command").each((function(){var val=$(this).data("param1"),active=editor.format.is("span",{class:val});$(this).toggleClass("fr-active",active).attr("aria-selected",active)}))}}},$.FE.RegisterCommand("inlineClass",{type:"dropdown",title:"Inline Class",html:function(){var c='<ul class="fr-dropdown-list" role="presentation">',options=this.opts.inlineClasses;for(var val in options)options.hasOwnProperty(val)&&(c+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="inlineClass" data-param1="'+val+'" title="'+options[val]+'">'+options[val]+"</a></li>");return c+="</ul>"},callback:function(cmd,val){this.inlineClass.apply(val)},refreshOnShow:function($btn,$dropdown){this.inlineClass.refreshOnShow($btn,$dropdown)},plugin:"inlineClass"}),$.FE.DefineIcon("inlineClass",{NAME:"tag"})}(jQuery),function($){$.extend($.FE.POPUP_TEMPLATES,{"link.edit":"[_BUTTONS_]","link.insert":"[_BUTTONS_][_INPUT_LAYER_]"}),$.extend($.FE.DEFAULTS,{linkEditButtons:["linkOpen","linkStyle","linkEdit","linkRemove"],linkInsertButtons:[],linkAttributes:{},linkAutoPrefix:"http://",linkStyles:{"fr-green":"Green","fr-strong":"Thick"},linkMultipleStyles:!0,linkConvertEmailAddress:!0,linkAlwaysBlank:!1,linkAlwaysNoFollow:!1,linkNoOpener:!0,linkNoReferrer:!0,linkList:[{text:"Google",href:"https://google.com",target:"_blank"},{displayText:"Facebook",href:"https://facebook.com"}],linkText:!0}),$.FE.PLUGINS.link=function(editor){function get(){var $current_image=editor.image?editor.image.get():null;if(!$current_image&&editor.$wp){var c_el=editor.selection.ranges(0).commonAncestorContainer;try{c_el&&(c_el.contains&&c_el.contains(editor.el)||!editor.el.contains(c_el)||editor.el==c_el)&&(c_el=null)}catch(ex){c_el=null}if(c_el&&"A"===c_el.tagName)return c_el;var s_el=editor.selection.element(),e_el=editor.selection.endElement();"A"==s_el.tagName||editor.node.isElement(s_el)||(s_el=$(s_el).parentsUntil(editor.$el,"a:first").get(0)),"A"==e_el.tagName||editor.node.isElement(e_el)||(e_el=$(e_el).parentsUntil(editor.$el,"a:first").get(0));try{e_el&&(e_el.contains&&e_el.contains(editor.el)||!editor.el.contains(e_el)||editor.el==e_el)&&(e_el=null)}catch(ex){e_el=null}try{s_el&&(s_el.contains&&s_el.contains(editor.el)||!editor.el.contains(s_el)||editor.el==s_el)&&(s_el=null)}catch(ex){s_el=null}return e_el&&e_el==s_el&&"A"==e_el.tagName?(editor.browser.msie||editor.helpers.isMobile())&&(editor.selection.info(s_el).atEnd||editor.selection.info(s_el).atStart)?null:s_el:null}return"A"==editor.el.tagName?editor.el:$current_image&&$current_image.get(0).parentNode&&"A"==$current_image.get(0).parentNode.tagName?$current_image.get(0).parentNode:void 0}function allSelected(){var range,containerEl,links,linkRange,$current_image=editor.image?editor.image.get():null,selectedLinks=[];if($current_image)"A"==$current_image.get(0).parentNode.tagName&&selectedLinks.push($current_image.get(0).parentNode);else if(editor.win.getSelection){var sel=editor.win.getSelection();if(sel.getRangeAt&&sel.rangeCount){linkRange=editor.doc.createRange();for(var r=0;r<sel.rangeCount;++r)if((containerEl=(range=sel.getRangeAt(r)).commonAncestorContainer)&&1!=containerEl.nodeType&&(containerEl=containerEl.parentNode),containerEl&&"a"==containerEl.nodeName.toLowerCase())selectedLinks.push(containerEl);else{links=containerEl.getElementsByTagName("a");for(var i=0;i<links.length;++i)linkRange.selectNodeContents(links[i]),linkRange.compareBoundaryPoints(range.END_TO_START,range)<1&&linkRange.compareBoundaryPoints(range.START_TO_END,range)>-1&&selectedLinks.push(links[i])}}}else if(editor.doc.selection&&"Control"!=editor.doc.selection.type)if("a"==(containerEl=(range=editor.doc.selection.createRange()).parentElement()).nodeName.toLowerCase())selectedLinks.push(containerEl);else{links=containerEl.getElementsByTagName("a"),linkRange=editor.doc.body.createTextRange();for(var j=0;j<links.length;++j)linkRange.moveToElementText(links[j]),linkRange.compareEndPoints("StartToEnd",range)>-1&&linkRange.compareEndPoints("EndToStart",range)<1&&selectedLinks.push(links[j])}return selectedLinks}function _edit(e){if(editor.core.hasFocus()){if(_hideEditPopup(),e&&"keyup"===e.type&&(e.altKey||e.which==$.FE.KEYCODE.ALT))return!0;setTimeout((function(){if(!e||e&&(1==e.which||"mouseup"!=e.type)){var link=get(),$current_image=editor.image?editor.image.get():null;if(link&&!$current_image){if(editor.image){var contents=editor.node.contents(link);if(1==contents.length&&"IMG"==contents[0].tagName){var range=editor.selection.ranges(0);return 0===range.startOffset&&0===range.endOffset?$(link).before($.FE.MARKERS):$(link).after($.FE.MARKERS),editor.selection.restore(),!1}}e&&e.stopPropagation(),_showEditPopup(link)}}}),editor.helpers.isIOS()?100:0)}}function _showEditPopup(link){var $popup=editor.popups.get("link.edit");$popup||($popup=function(){var link_buttons="";editor.opts.linkEditButtons.length>=1&&("A"==editor.el.tagName&&editor.opts.linkEditButtons.indexOf("linkRemove")>=0&&editor.opts.linkEditButtons.splice(editor.opts.linkEditButtons.indexOf("linkRemove"),1),link_buttons='<div class="fr-buttons">'+editor.button.buildList(editor.opts.linkEditButtons)+"</div>");var template={buttons:link_buttons},$popup=editor.popups.create("link.edit",template);editor.$wp&&editor.events.$on(editor.$wp,"scroll.link-edit",(function(){get()&&editor.popups.isVisible("link.edit")&&_showEditPopup(get())}));return $popup}());var $link=$(link);editor.popups.isVisible("link.edit")||editor.popups.refresh("link.edit"),editor.popups.setContainer("link.edit",editor.$sc);var left=$link.offset().left+$(link).outerWidth()/2,top=$link.offset().top+$link.outerHeight();editor.popups.show("link.edit",left,top,$link.outerHeight())}function _hideEditPopup(){editor.popups.hide("link.edit")}function _hideInsertPopup(){}function _refreshInsertPopup(){var $popup=editor.popups.get("link.insert"),link=get();if(link){var i,$input,$link=$(link),text_inputs=$popup.find('input.fr-link-attr[type="text"]'),check_inputs=$popup.find('input.fr-link-attr[type="checkbox"]');for(i=0;i<text_inputs.length;i++)($input=$(text_inputs[i])).val($link.attr($input.attr("name")||""));for(check_inputs.prop("checked",!1),i=0;i<check_inputs.length;i++)$input=$(check_inputs[i]),$link.attr($input.attr("name"))==$input.data("checked")&&$input.prop("checked",!0);$popup.find('input.fr-link-attr[type="text"][name="text"]').val($link.text())}else $popup.find('input.fr-link-attr[type="text"]').val(""),$popup.find('input.fr-link-attr[type="checkbox"]').prop("checked",!1),$popup.find('input.fr-link-attr[type="text"][name="text"]').val(editor.selection.text());$popup.find("input.fr-link-attr").trigger("change"),(editor.image?editor.image.get():null)?$popup.find('.fr-link-attr[name="text"]').parent().hide():$popup.find('.fr-link-attr[name="text"]').parent().show()}function _initInsertPopup(delayed){if(delayed)return editor.popups.onRefresh("link.insert",_refreshInsertPopup),editor.popups.onHide("link.insert",_hideInsertPopup),!0;var link_buttons="";editor.toolbar.hasButton("insertPageLink")&&editor.opts.linkInsertButtons.length>=1&&(link_buttons='<div class="fr-buttons">'+editor.button.buildList(editor.opts.linkInsertButtons)+"</div>");var input_layer="",tab_idx=0;for(var attr in input_layer=`<div class="fr-link-insert-layer fr-layer fr-active" id="fr-link-insert-layer-${editor.id}">`,input_layer+=`\n                <div class="fr-input-line">\n                    <input id="fr-link-insert-layer-url-${editor.id}" name="href" type="text" class="fr-link-attr" placeholder="${editor.language.translate("URL")}" tabIndex="${++tab_idx}">\n                </div>`,editor.opts.linkText&&(input_layer+=`\n                    <div class="fr-input-line">\n                        <input id="fr-link-insert-layer-text-${editor.id}" name="text" type="text" class="fr-link-attr" placeholder="${editor.language.translate("Text")}" tabIndex="${++tab_idx}">\n                    </div>`),editor.opts.linkAttributes)if(editor.opts.linkAttributes.hasOwnProperty(attr)){var placeholder=editor.opts.linkAttributes[attr];input_layer+=`\n                        <div class="fr-input-line">\n                            <input name="${attr}" type="text" class="fr-link-attr" placeholder="${editor.language.translate(placeholder)}" tabIndex="${++tab_idx}">\n                        </div>`}editor.opts.linkAlwaysBlank||(input_layer+=`\n                    <div class="fr-checkbox-line">\n                        <span class="fr-checkbox">\n                            <input name="target" class="fr-link-attr" data-checked="_blank" type="checkbox" id="fr-link-target-${editor.id}" tabIndex="${++tab_idx}">\n                            <span><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="10" height="10" viewBox="0 0 32 32"><path d="M27 4l-15 15-7-7-5 5 12 12 20-20z" fill="#FFF"></path></svg></span>\n                        </span>\n                        <label for="fr-link-target-${editor.id}">${editor.language.translate("Open in new tab")}</label>\n                    </div>`);var template={buttons:link_buttons,input_layer:input_layer+=`\n                <div class="fr-action-buttons">\n                    <button class="fr-command fr-submit" role="button" data-cmd="linkInsert" href="#" tabIndex="${++tab_idx}" type="button">\n                        ${editor.language.translate("Insert")}\n                    </button>\n                </div>\n            </div>`},$popup=editor.popups.create("link.insert",template);return editor.$wp&&editor.events.$on(editor.$wp,"scroll.link-insert",(function(){(editor.image?editor.image.get():null)&&editor.popups.isVisible("link.insert")&&imageLink(),get&&editor.popups.isVisible("link.insert")&&update()})),$popup}function insert(href,text,attrs){if(void 0===attrs&&(attrs={}),!1===editor.events.trigger("link.beforeInsert",[href,text,attrs]))return!1;var $current_image=editor.image?editor.image.get():null;$current_image||"A"==editor.el.tagName?"A"==editor.el.tagName&&editor.$el.focus():(editor.selection.restore(),editor.popups.hide("link.insert"));var original_href=href;editor.opts.linkConvertEmailAddress&&editor.helpers.isEmail(href)&&!/^mailto:.*/i.test(href)&&(href="mailto:"+href);if(""===editor.opts.linkAutoPrefix||new RegExp("^("+$.FE.LinkProtocols.join("|")+"):.","i").test(href)||/^data:image.*/i.test(href)||/^(https?:|ftps?:|file:|)\/\//i.test(href)||/^([A-Za-z]:(\\){1,2}|[A-Za-z]:((\\){1,2}[^\\]+)+)(\\)?$/i.test(href)||["/","{","[","#","(","."].indexOf((href||"")[0])<0&&(href=editor.opts.linkAutoPrefix+editor.helpers.sanitizeURL(href)),href=editor.helpers.sanitizeURL(href),editor.opts.linkAlwaysBlank&&(attrs.target="_blank"),editor.opts.linkAlwaysNoFollow&&(attrs.rel="nofollow"),editor.helpers.isEmail(original_href)&&(attrs.target=null,attrs.rel=null),"_blank"==attrs.target?(editor.opts.linkNoOpener&&(attrs.rel?attrs.rel+=" noopener":attrs.rel="noopener"),editor.opts.linkNoReferrer&&(attrs.rel?attrs.rel+=" noreferrer":attrs.rel="noreferrer")):null==attrs.target&&(attrs.rel?attrs.rel=attrs.rel.replace(/noopener/,"").replace(/noreferrer/,""):attrs.rel=null),text=text||"",href===editor.opts.linkAutoPrefix)return editor.popups.get("link.insert").find('input[name="href"]').addClass("fr-error"),editor.events.trigger("link.bad",[original_href]),!1;var $link,link=get();if(link){if(($link=$(link)).attr("href",href),text.length>0&&$link.text()!=text&&!$current_image){for(var child=$link.get(0);1===child.childNodes.length&&child.childNodes[0].nodeType==Node.ELEMENT_NODE;)child=child.childNodes[0];$(child).text(text)}$current_image||$link.prepend($.FE.START_MARKER).append($.FE.END_MARKER),$link.attr(attrs),$current_image||editor.selection.restore()}else{$current_image?$current_image.wrap('<a href="'+href+'"></a>'):(editor.format.remove("a"),editor.selection.isCollapsed()?(text=0===text.length?original_href:text,editor.html.insert('<a href="'+href+'">'+$.FE.START_MARKER+text.replace(/&/g,"&amp;").replace(/</,"&lt;",">","&gt;")+$.FE.END_MARKER+"</a>"),editor.selection.restore()):text.length>0&&text!=editor.selection.text().replace(/\n/g,"")?(editor.selection.remove(),editor.html.insert('<a href="'+href+'">'+$.FE.START_MARKER+text.replace(/&/g,"&amp;")+$.FE.END_MARKER+"</a>"),editor.selection.restore()):(!function(){if(!editor.selection.isCollapsed()){editor.selection.save();for(var markers=editor.$el.find(".fr-marker").addClass("fr-unprocessed").toArray();markers.length;){var $marker=$(markers.pop());$marker.removeClass("fr-unprocessed");var deep_parent=editor.node.deepestParent($marker.get(0));if(deep_parent){var node=$marker.get(0),close_str="",open_str="";do{node=node.parentNode,editor.node.isBlock(node)||(close_str+=editor.node.closeTagString(node),open_str=editor.node.openTagString(node)+open_str)}while(node!=deep_parent);var marker_str=editor.node.openTagString($marker.get(0))+$marker.html()+editor.node.closeTagString($marker.get(0));$marker.replaceWith('<span id="fr-break"></span>');var h=deep_parent.outerHTML;h=(h=h.replace(/<span id="fr-break"><\/span>/g,close_str+marker_str+open_str)).replace(open_str+close_str,""),deep_parent.outerHTML=h}markers=editor.$el.find(".fr-marker.fr-unprocessed").toArray()}editor.html.cleanEmptyTags(),editor.selection.restore()}}(),editor.format.apply("a",{href:href})));for(var links=allSelected(),i=0;i<links.length;i++)($link=$(links[i])).attr(attrs),$link.removeAttr("_moz_dirty");1==links.length&&editor.$wp&&!$current_image&&($(links[0]).prepend($.FE.START_MARKER).append($.FE.END_MARKER),editor.selection.restore())}if($current_image){var $pop=editor.popups.get("link.insert");$pop&&$pop.find("input:focus").blur(),editor.image.edit($current_image)}else _edit()}function update(){_hideEditPopup();var link=get();if(link){var $popup=editor.popups.get("link.insert");$popup||($popup=_initInsertPopup()),editor.popups.isVisible("link.insert")||(editor.popups.refresh("link.insert"),editor.selection.save(),editor.helpers.isMobile()&&(editor.events.disableBlur(),editor.$el.blur(),editor.events.enableBlur())),editor.popups.setContainer("link.insert",editor.$sc);var $ref=(editor.image?editor.image.get():null)||$(link),left=$ref.offset().left+$ref.outerWidth()/2,top=$ref.offset().top+$ref.outerHeight();editor.popups.show("link.insert",left,top,$ref.outerHeight())}}function imageLink(){var $el=editor.image?editor.image.getEl():null;if($el){var $popup=editor.popups.get("link.insert");editor.image.hasCaption()&&($el=$el.find(".fr-img-wrap")),$popup||($popup=_initInsertPopup()),_refreshInsertPopup(),editor.popups.setContainer("link.insert",editor.$sc);var left=$el.offset().left+$el.outerWidth()/2,top=$el.offset().top+$el.outerHeight();editor.popups.show("link.insert",left,top,$el.outerHeight())}}return{_init:function(){editor.events.on("keyup",(function(e){e.which!=$.FE.KEYCODE.ESC&&_edit(e)})),editor.events.on("window.mouseup",_edit),editor.events.$on(editor.$el,"click","a",(function(e){editor.edit.isDisabled()&&e.preventDefault()})),editor.helpers.isMobile()&&editor.events.$on(editor.$doc,"selectionchange",_edit),_initInsertPopup(!0),"A"==editor.el.tagName&&editor.$el.addClass("fr-view"),editor.events.on("toolbar.esc",(function(){if(editor.popups.isVisible("link.edit"))return editor.events.disableBlur(),editor.events.focus(),!1}),!0)},remove:function(){var link=get(),$current_image=editor.image?editor.image.get():null;if(!1===editor.events.trigger("link.beforeRemove",[link]))return!1;$current_image&&link?($current_image.unwrap(),editor.image.edit($current_image)):link&&(editor.selection.save(),$(link).replaceWith($(link).html()),editor.selection.restore(),_hideEditPopup())},showInsertPopup:function(){var $btn=editor.$tb.find('.fr-command[data-cmd="insertLink"]'),$popup=editor.popups.get("link.insert");if($popup||($popup=_initInsertPopup()),!$popup.hasClass("fr-active"))if(editor.popups.refresh("link.insert"),editor.popups.setContainer("link.insert",editor.$tb||editor.$sc),$btn.is(":visible")){var left=$btn.offset().left+$btn.outerWidth()/2,top=$btn.offset().top+(editor.opts.toolbarBottom?10:$btn.outerHeight()-10);editor.popups.show("link.insert",left,top,$btn.outerHeight())}else editor.position.forSelection($popup),editor.popups.show("link.insert")},usePredefined:function(val){var $input,i,link=editor.opts.linkList[val],$popup=editor.popups.get("link.insert"),text_inputs=$popup.find('input.fr-link-attr[type="text"]'),check_inputs=$popup.find('input.fr-link-attr[type="checkbox"]');for(i=0;i<text_inputs.length;i++)link[($input=$(text_inputs[i])).attr("name")]?$input.val(link[$input.attr("name")]):"text"!=$input.attr("name")&&$input.val("");for(i=0;i<check_inputs.length;i++)($input=$(check_inputs[i])).prop("checked",$input.data("checked")==link[$input.attr("name")]);editor.accessibility.focusPopup($popup)},insertCallback:function(){var $input,i,$popup=editor.popups.get("link.insert"),text_inputs=$popup.find('input.fr-link-attr[type="text"]'),check_inputs=$popup.find('input.fr-link-attr[type="checkbox"]'),href=(text_inputs.filter('[name="href"]').val()||"").trim(),text=text_inputs.filter('[name="text"]').val(),attrs={};for(i=0;i<text_inputs.length;i++)$input=$(text_inputs[i]),["href","text"].indexOf($input.attr("name"))<0&&(attrs[$input.attr("name")]=$input.val());for(i=0;i<check_inputs.length;i++)($input=$(check_inputs[i])).is(":checked")?attrs[$input.attr("name")]=$input.data("checked"):attrs[$input.attr("name")]=$input.data("unchecked")||null;var t=editor.helpers.scrollTop();insert(href,text,attrs),$(editor.o_win).scrollTop(t)},insert:insert,update:update,get:get,allSelected:allSelected,back:function(){(editor.image?editor.image.get():null)?editor.image.back():(editor.events.disableBlur(),editor.selection.restore(),editor.events.enableBlur(),get()&&editor.$wp?(editor.selection.restore(),_hideEditPopup(),_edit()):"A"==editor.el.tagName?(editor.$el.focus(),_edit()):(editor.popups.hide("link.insert"),editor.toolbar.showInline()))},imageLink:imageLink,applyStyle:function(val,linkStyles,multipleStyles){void 0===multipleStyles&&(multipleStyles=editor.opts.linkMultipleStyles),void 0===linkStyles&&(linkStyles=editor.opts.linkStyles);var link=get();if(!link)return!1;if(!multipleStyles){var styles=Object.keys(linkStyles);styles.splice(styles.indexOf(val),1),$(link).removeClass(styles.join(" "))}$(link).toggleClass(val),_edit()}}},$.FE.DefineIcon("insertLink",{NAME:"link"}),$.FE.RegisterShortcut($.FE.KEYCODE.K,"insertLink",null,"K"),$.FE.RegisterCommand("insertLink",{title:"Insert Link",undo:!1,focus:!0,refreshOnCallback:!1,popup:!0,callback:function(){this.popups.isVisible("link.insert")?(this.$el.find(".fr-marker").length&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("link.insert")):this.link.showInsertPopup()},plugin:"link"}),$.FE.DefineIcon("linkOpen",{NAME:"external-link",FA5NAME:"external-link-alt"}),$.FE.RegisterCommand("linkOpen",{title:"Open Link",undo:!1,refresh:function($btn){this.link.get()?$btn.removeClass("fr-hidden"):$btn.addClass("fr-hidden")},callback:function(){var link=this.link.get();link&&(-1!==link.href.indexOf("mailto:")?this.o_win.open(link.href).close():oc.pageLookup&&-1!==link.href.indexOf("october://")?this.o_win.open(oc.pageLookup.processLink(link.href),"_blank","noopener"):this.o_win.open(link.href,"_blank","noopener"),this.popups.hide("link.edit"))},plugin:"link"}),$.FE.DefineIcon("linkEdit",{NAME:"edit"}),$.FE.RegisterCommand("linkEdit",{title:"Edit Link",undo:!1,refreshAfterCallback:!1,popup:!0,callback:function(){this.link.update()},refresh:function($btn){this.link.get()?$btn.removeClass("fr-hidden"):$btn.addClass("fr-hidden")},plugin:"link"}),$.FE.DefineIcon("linkRemove",{NAME:"unlink"}),$.FE.RegisterCommand("linkRemove",{title:"Unlink",callback:function(){this.link.remove()},refresh:function($btn){this.link.get()?$btn.removeClass("fr-hidden"):$btn.addClass("fr-hidden")},plugin:"link"}),$.FE.DefineIcon("linkBack",{NAME:"arrow-left"}),$.FE.RegisterCommand("linkBack",{title:"Back",undo:!1,focus:!1,back:!0,refreshAfterCallback:!1,callback:function(){this.link.back()},refresh:function($btn){var link=this.link.get()&&this.doc.hasFocus();(this.image?this.image.get():null)||link||this.opts.toolbarInline?($btn.removeClass("fr-hidden"),$btn.next(".fr-separator").removeClass("fr-hidden")):($btn.addClass("fr-hidden"),$btn.next(".fr-separator").addClass("fr-hidden"))},plugin:"link"}),$.FE.DefineIcon("linkList",{NAME:"search"}),$.FE.RegisterCommand("linkList",{title:"Choose Link",type:"dropdown",focus:!1,undo:!1,refreshAfterCallback:!1,html:function(){for(var c='<ul class="fr-dropdown-list" role="presentation">',options=this.opts.linkList,i=0;i<options.length;i++)c+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="linkList" data-param1="'+i+'">'+(options[i].displayText||options[i].text)+"</a></li>";return c+="</ul>"},callback:function(cmd,val){this.link.usePredefined(val)},plugin:"link"}),$.FE.RegisterCommand("linkInsert",{focus:!1,refreshAfterCallback:!1,callback:function(){this.link.insertCallback()},refresh:function($btn){this.link.get()?$btn.text(this.language.translate("Update")):$btn.text(this.language.translate("Insert"))},plugin:"link"}),$.FE.DefineIcon("imageLink",{NAME:"link"}),$.FE.RegisterCommand("imageLink",{title:"Insert Link",undo:!1,focus:!1,popup:!0,callback:function(){this.link.imageLink()},refresh:function($btn){var $prev;this.link.get()?(($prev=$btn.prev()).hasClass("fr-separator")&&$prev.removeClass("fr-hidden"),$btn.addClass("fr-hidden")):(($prev=$btn.prev()).hasClass("fr-separator")&&$prev.addClass("fr-hidden"),$btn.removeClass("fr-hidden"))},plugin:"link"}),$.FE.DefineIcon("linkStyle",{NAME:"magic"}),$.FE.RegisterCommand("linkStyle",{title:"Style",type:"dropdown",html:function(){var c='<ul class="fr-dropdown-list" role="presentation">',options=this.opts.linkStyles;for(var cls in options)options.hasOwnProperty(cls)&&(c+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="linkStyle" data-param1="'+cls+'">'+this.language.translate(options[cls])+"</a></li>");return c+="</ul>"},callback:function(cmd,val){this.link.applyStyle(val)},refreshOnShow:function($btn,$dropdown){var link=this.link.get();if(link){var $link=$(link);$dropdown.find(".fr-command").each((function(){var cls=$(this).data("param1"),active=$link.hasClass(cls);$(this).toggleClass("fr-active",active).attr("aria-selected",active)}))}},refresh:function($btn){this.link.get()?$btn.removeClass("fr-hidden"):$btn.addClass("fr-hidden")},plugin:"link"})}(jQuery),function($){$.extend($.FE.POPUP_TEMPLATES,{"table.insert":"[_BUTTONS_][_ROWS_COLUMNS_]","table.edit":"[_BUTTONS_]","table.colors":"[_BUTTONS_][_COLORS_][_CUSTOM_COLOR_]"}),$.extend($.FE.DEFAULTS,{tableInsertMaxSize:10,tableEditButtons:["tableHeader","tableRemove","|","tableRows","tableColumns","tableStyle","-","tableCells","tableCellBackground","tableCellVerticalAlign","tableCellHorizontalAlign","tableCellStyle"],tableInsertButtons:["tableBack","|"],tableResizer:!0,tableDefaultWidth:"100%",tableResizerOffset:5,tableResizingLimit:30,tableColorsButtons:["tableBack","|"],tableColors:["#61BD6D","#1ABC9C","#54ACD2","#2C82C9","#9365B8","#475577","#CCCCCC","#41A85F","#00A885","#3D8EB9","#2969B0","#553982","#28324E","#000000","#F7DA64","#FBA026","#EB6B56","#E25041","#A38F84","#EFEFEF","#FFFFFF","#FAC51C","#F37934","#D14841","#B8312F","#7C706B","#D1D5D8","REMOVE"],tableColorsStep:7,tableCellStyles:{"fr-highlighted":"Highlighted","fr-thick":"Thick"},tableStyles:{"fr-dashed-borders":"Dashed Borders","fr-alternate-rows":"Alternate Rows"},tableCellMultipleStyles:!0,tableMultipleStyles:!0,tableInsertHelper:!0,tableInsertHelperOffset:15}),$.FE.PLUGINS.table=function(editor){var $resizer,$insert_helper,mouseDownCellFlag,mouseDownFlag,mouseDownCell,mouseMoveTimer,resizingFlag;function _showEditPopup(){var map=_tableMap();if(map){var $popup=editor.popups.get("table.edit");if($popup||($popup=_initEditPopup()),$popup){editor.popups.setContainer("table.edit",editor.$sc);var offset=_selectionOffset(map),left=(offset.left+offset.right)/2,top=offset.bottom;editor.popups.show("table.edit",left,top,offset.bottom-offset.top),editor.edit.isDisabled()&&(selectedCells().length>1&&editor.toolbar.disable(),editor.$el.removeClass("fr-no-selection"),editor.edit.on(),editor.button.bulkRefresh(),editor.selection.setAtEnd(editor.$el.find(".fr-selected-cell:last").get(0)),editor.selection.restore())}}}function _showColorsPopup(){var map=_tableMap();if(map){var $popup=editor.popups.get("table.colors");$popup||($popup=function(){var table_buttons="";editor.opts.tableColorsButtons.length>0&&(table_buttons='<div class="fr-buttons fr-table-colors-buttons">'+editor.button.buildList(editor.opts.tableColorsButtons)+"</div>");var custom_color="";editor.opts.colorsHEXInput&&(custom_color='<div class="fr-table-colors-hex-layer fr-active fr-layer" id="fr-table-colors-hex-layer-'+editor.id+'"><div class="fr-input-line"><input maxlength="7" id="fr-table-colors-hex-layer-text-'+editor.id+'" type="text" placeholder="'+editor.language.translate("HEX Color")+'" tabIndex="1" aria-required="true"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="tableCellBackgroundCustomColor" tabIndex="2" role="button">'+editor.language.translate("OK")+"</button></div></div>");var template={buttons:table_buttons,colors:_colorsHTML(),custom_color:custom_color},$popup=editor.popups.create("table.colors",template);return editor.events.$on(editor.$wp,"scroll.table-colors",(function(){editor.popups.isVisible("table.colors")&&_showColorsPopup()})),function($popup){editor.events.on("popup.tab",(function(e){var $focused_item=$(e.currentTarget);if(!editor.popups.isVisible("table.colors")||!$focused_item.is("span"))return!0;var key_code=e.which,status=!0;if($.FE.KEYCODE.TAB==key_code){var $tb=$popup.find(".fr-buttons");status=!editor.accessibility.focusToolbar($tb,!!e.shiftKey)}else if($.FE.KEYCODE.ARROW_UP==key_code||$.FE.KEYCODE.ARROW_DOWN==key_code||$.FE.KEYCODE.ARROW_LEFT==key_code||$.FE.KEYCODE.ARROW_RIGHT==key_code){var $colors=$focused_item.parent().find("span.fr-command"),index=$colors.index($focused_item),columns=editor.opts.colorsStep,lines=Math.floor($colors.length/columns),column=index%columns,nextIndex=Math.floor(index/columns)*columns+column,dimension=lines*columns;$.FE.KEYCODE.ARROW_UP==key_code?nextIndex=((nextIndex-columns)%dimension+dimension)%dimension:$.FE.KEYCODE.ARROW_DOWN==key_code?nextIndex=(nextIndex+columns)%dimension:$.FE.KEYCODE.ARROW_LEFT==key_code?nextIndex=((nextIndex-1)%dimension+dimension)%dimension:$.FE.KEYCODE.ARROW_RIGHT==key_code&&(nextIndex=(nextIndex+1)%dimension);var $el=$($colors.get(nextIndex));editor.events.disableBlur(),$el.focus(),status=!1}else $.FE.KEYCODE.ENTER==key_code&&(editor.button.exec($focused_item),status=!1);return!1===status&&(e.preventDefault(),e.stopPropagation()),status}),!0)}($popup),$popup}()),editor.popups.setContainer("table.colors",editor.$sc);var offset=_selectionOffset(map),left=(offset.left+offset.right)/2,top=offset.bottom;!function(){var $popup=editor.popups.get("table.colors"),$cell=editor.$el.find(".fr-selected-cell:first"),color=editor.helpers.RGBToHex($cell.css("background-color")),$input=$popup.find(".fr-table-colors-hex-layer input");$popup.find(".fr-selected-color").removeClass("fr-selected-color fr-active-item"),$popup.find('span[data-param1="'+color+'"]').addClass("fr-selected-color fr-active-item"),$input.val(color).trigger("change")}(),editor.popups.show("table.colors",left,top,offset.bottom-offset.top)}}function _hideEditPopup(){0===selectedCells().length&&editor.toolbar.enable()}function _initInsertPopup(delayed){if(delayed)return editor.popups.onHide("table.insert",(function(){editor.popups.get("table.insert").find('.fr-table-size .fr-select-table-size > span[data-row="1"][data-col="1"]').trigger("mouseenter")})),!0;var table_buttons="";editor.opts.tableInsertButtons.length>0&&(table_buttons='<div class="fr-buttons">'+editor.button.buildList(editor.opts.tableInsertButtons)+"</div>");var template={buttons:table_buttons,rows_columns:_insertTableHtml()},$popup=editor.popups.create("table.insert",template);return editor.events.$on($popup,"mouseenter",".fr-table-size .fr-select-table-size .fr-table-cell",(function(e){_hoverCell($(e.currentTarget))}),!0),function($popup){editor.events.$on($popup,"focus","[tabIndex]",(function(e){_hoverCell($(e.currentTarget))})),editor.events.on("popup.tab",(function(e){var $focused_item=$(e.currentTarget);if(!editor.popups.isVisible("table.insert")||!$focused_item.is("span, a"))return!0;var status,key_code=e.which;if($.FE.KEYCODE.ARROW_UP==key_code||$.FE.KEYCODE.ARROW_DOWN==key_code||$.FE.KEYCODE.ARROW_LEFT==key_code||$.FE.KEYCODE.ARROW_RIGHT==key_code){if($focused_item.is("span.fr-table-cell")){var $cells=$focused_item.parent().find("span.fr-table-cell"),index=$cells.index($focused_item),columns=editor.opts.tableInsertMaxSize,column=index%columns,line=Math.floor(index/columns);$.FE.KEYCODE.ARROW_UP==key_code?line=Math.max(0,line-1):$.FE.KEYCODE.ARROW_DOWN==key_code?line=Math.min(editor.opts.tableInsertMaxSize-1,line+1):$.FE.KEYCODE.ARROW_LEFT==key_code?column=Math.max(0,column-1):$.FE.KEYCODE.ARROW_RIGHT==key_code&&(column=Math.min(editor.opts.tableInsertMaxSize-1,column+1));var nextIndex=line*columns+column,$el=$($cells.get(nextIndex));_hoverCell($el),editor.events.disableBlur(),$el.focus(),status=!1}}else $.FE.KEYCODE.ENTER==key_code&&(editor.button.exec($focused_item),status=!1);return!1===status&&(e.preventDefault(),e.stopPropagation()),status}),!0)}($popup),$popup}function _hoverCell($table_cell){var row=$table_cell.data("row"),col=$table_cell.data("col"),$select_size=$table_cell.parent();$select_size.siblings(".fr-table-size-info").html(row+" &times; "+col),$select_size.find("> span").removeClass("hover fr-active-item");for(var i=1;i<=editor.opts.tableInsertMaxSize;i++)for(var j=0;j<=editor.opts.tableInsertMaxSize;j++){var $cell=$select_size.find('> span[data-row="'+i+'"][data-col="'+j+'"]');i<=row&&j<=col?$cell.addClass("hover"):i<=row+1||i<=2&&!editor.helpers.isMobile()?$cell.css("display","inline-block"):i>2&&!editor.helpers.isMobile()&&$cell.css("display","none")}$table_cell.addClass("fr-active-item")}function _insertTableHtml(){for(var rows_columns='<div class="fr-table-size"><div class="fr-table-size-info">1 &times; 1</div><div class="fr-select-table-size">',i=1;i<=editor.opts.tableInsertMaxSize;i++){for(var j=1;j<=editor.opts.tableInsertMaxSize;j++){var display="inline-block";i>2&&!editor.helpers.isMobile()&&(display="none");var cls="fr-table-cell ";1==i&&1==j&&(cls+=" hover"),rows_columns+='<span class="fr-command '+cls+'" tabIndex="-1" data-cmd="tableInsert" data-row="'+i+'" data-col="'+j+'" data-param1="'+i+'" data-param2="'+j+'" style="display: '+display+';" role="button"><span></span><span class="fr-sr-only">'+i+" &times; "+j+"&nbsp;&nbsp;&nbsp;</span></span>"}rows_columns+='<div class="new-line"></div>'}return rows_columns+="</div></div>"}function _initEditPopup(delayed){if(delayed)return editor.popups.onHide("table.edit",_hideEditPopup),!0;if(editor.opts.tableEditButtons.length>0){var template={buttons:'<div class="fr-buttons">'+editor.button.buildList(editor.opts.tableEditButtons)+"</div>"},$popup=editor.popups.create("table.edit",template);return editor.events.$on(editor.$wp,"scroll.table-edit",(function(){editor.popups.isVisible("table.edit")&&_showEditPopup()})),$popup}return!1}function _colorsHTML(){for(var colors_html='<div class="fr-table-colors">',i=0;i<editor.opts.tableColors.length;i++)0!==i&&i%editor.opts.tableColorsStep==0&&(colors_html+="<br>"),"REMOVE"!=editor.opts.tableColors[i]?colors_html+='<span class="fr-command" style="background: '+editor.opts.tableColors[i]+';" tabIndex="-1" role="button" data-cmd="tableCellBackgroundColor" data-param1="'+editor.opts.tableColors[i]+'"><span class="fr-sr-only">'+editor.language.translate("Color")+" "+editor.opts.tableColors[i]+"&nbsp;&nbsp;&nbsp;</span></span>":colors_html+='<span class="fr-command" data-cmd="tableCellBackgroundColor" tabIndex="-1" role="button" data-param1="REMOVE" title="'+editor.language.translate("Clear Formatting")+'">'+editor.icon.create("tableColorRemove")+'<span class="fr-sr-only">'+editor.language.translate("Clear Formatting")+"</span></span>";return colors_html+="</div>"}function remove(){if(selectedCells().length>0){var $current_table=selectedTable();editor.selection.setBefore($current_table.get(0))||editor.selection.setAfter($current_table.get(0)),editor.selection.restore(),editor.popups.hide("table.edit"),$current_table.remove(),editor.toolbar.enable()}}function insertRow(position){var $table=selectedTable();if($table.length>0){if(editor.$el.find("th.fr-selected-cell").length>0&&"above"==position)return;var i,ref_row,$ref_row,map=_tableMap(),selection=_currentSelection(map);ref_row="above"==position?selection.min_i:selection.max_i;var tr="<tr>";for(i=0;i<map[ref_row].length;i++)if("below"==position&&ref_row<map.length-1&&map[ref_row][i]==map[ref_row+1][i]||"above"==position&&ref_row>0&&map[ref_row][i]==map[ref_row-1][i]){if(0===i||i>0&&map[ref_row][i]!=map[ref_row][i-1]){var $cell=$(map[ref_row][i]);$cell.attr("rowspan",parseInt($cell.attr("rowspan"),10)+1)}}else tr+="<td><br></td>";tr+="</tr>",$ref_row=editor.$el.find("th.fr-selected-cell").length>0&&"below"==position?$($table.find("tbody").not($table.find("table tbody"))):$($table.find("tr").not($table.find("table tr")).get(ref_row)),"below"==position?"TBODY"==$ref_row.prop("tagName")?$ref_row.prepend(tr):$ref_row.after(tr):"above"==position&&($ref_row.before(tr),editor.popups.isVisible("table.edit")&&_showEditPopup())}}function _updateColspan(min_j,max_j,$table){var i,j,k,first_span,span,decrease=0,map=_tableMap($table);if((max_j=Math.min(max_j,map[0].length-1))>min_j)for(j=min_j;j<=max_j;j++)if(!(j>min_j&&map[0][j]==map[0][j-1])&&(first_span=Math.min(parseInt(map[0][j].getAttribute("colspan"),10)||1,max_j-min_j+1))>1&&map[0][j]==map[0][j+1])for(decrease=first_span-1,i=1;i<map.length;i++)if(map[i][j]!=map[i-1][j]){for(k=j;k<j+first_span;k++)if((span=parseInt(map[i][k].getAttribute("colspan"),10)||1)>1&&map[i][k]==map[i][k+1])k+=decrease=Math.min(decrease,span-1);else if(!(decrease=Math.max(0,decrease-1)))break;if(!decrease)break}decrease&&_decreaseCellSpan(map,decrease,"colspan",0,map.length-1,min_j,max_j)}function _updateRowspan(min_i,max_i,$table){var i,j,k,first_span,span,decrease=0,map=_tableMap($table);if((max_i=Math.min(max_i,map.length-1))>min_i)for(i=min_i;i<=max_i;i++)if(!(i>min_i&&map[i][0]==map[i-1][0])&&(first_span=Math.min(parseInt(map[i][0].getAttribute("rowspan"),10)||1,max_i-min_i+1))>1&&map[i][0]==map[i+1][0])for(decrease=first_span-1,j=1;j<map[0].length;j++)if(map[i][j]!=map[i][j-1]){for(k=i;k<i+first_span;k++)if((span=parseInt(map[k][j].getAttribute("rowspan"),10)||1)>1&&map[k][j]==map[k+1][j])k+=decrease=Math.min(decrease,span-1);else if(!(decrease=Math.max(0,decrease-1)))break;if(!decrease)break}decrease&&_decreaseCellSpan(map,decrease,"rowspan",min_i,max_i,0,map[0].length-1)}function _decreaseCellSpan(map,decrease,span_type,min_i,max_i,min_j,max_j){var i,j,span;for(i=min_i;i<=max_i;i++)for(j=min_j;j<=max_j;j++)i>min_i&&map[i][j]==map[i-1][j]||j>min_j&&map[i][j]==map[i][j-1]||(span=parseInt(map[i][j].getAttribute(span_type),10)||1)>1&&(span-decrease>1?map[i][j].setAttribute(span_type,span-decrease):map[i][j].removeAttribute(span_type))}function _updateCellSpan(min_i,max_i,min_j,max_j,$table){_updateRowspan(min_i,max_i,$table),_updateColspan(min_j,max_j,$table)}function setBackground(color){var $selected_cells=editor.$el.find(".fr-selected-cell");"REMOVE"!=color?$selected_cells.css("background-color",editor.helpers.HEXtoRGB(color)):$selected_cells.css("background-color",""),_showEditPopup()}function _tableMap($table){var map=[];return null==($table=$table||null)&&selectedCells().length>0&&($table=selectedTable()),$table&&$table.find("tr:visible").not($table.find("table tr")).each((function(row,tr){var $tr=$(tr),c_index=0;$tr.find("> th, > td").each((function(col,td){for(var $td=$(td),cspan=parseInt($td.attr("colspan"),10)||1,rspan=parseInt($td.attr("rowspan"),10)||1,i=row;i<row+rspan;i++)for(var j=c_index;j<c_index+cspan;j++)map[i]||(map[i]=[]),map[i][j]?c_index++:map[i][j]=td;c_index+=cspan}))})),map}function _cellOrigin(td,map){for(var i=0;i<map.length;i++)for(var j=0;j<map[i].length;j++)if(map[i][j]==td)return{row:i,col:j}}function _cellEnds(origin_i,origin_j,map){for(var max_i=origin_i+1,max_j=origin_j+1;max_i<map.length;){if(map[max_i][origin_j]!=map[origin_i][origin_j]){max_i--;break}max_i++}for(max_i==map.length&&max_i--;max_j<map[origin_i].length;){if(map[origin_i][max_j]!=map[origin_i][origin_j]){max_j--;break}max_j++}return max_j==map[origin_i].length&&max_j--,{row:max_i,col:max_j}}function _removeKeyboardSelectionHandlers(){editor.el.querySelector(".fr-cell-fixed")&&editor.el.querySelector(".fr-cell-fixed").classList.remove("fr-cell-fixed"),editor.el.querySelector(".fr-cell-handler")&&editor.el.querySelector(".fr-cell-handler").classList.remove("fr-cell-handler")}function _removeSelection(){var cells=editor.$el.find(".fr-selected-cell");cells.length>0&&cells.each((function(){var $cell=$(this);$cell.removeClass("fr-selected-cell"),""===$cell.attr("class")&&$cell.removeAttr("class")})),_removeKeyboardSelectionHandlers()}function _clearSelection(){editor.events.disableBlur(),editor.selection.clear(),editor.$el.addClass("fr-no-selection"),editor.$el.blur(),editor.events.enableBlur()}function _currentSelection(map){var cells=editor.$el.find(".fr-selected-cell");if(cells.length>0){var i,min_i=map.length,max_i=0,min_j=map[0].length,max_j=0;for(i=0;i<cells.length;i++){var cellOrigin=_cellOrigin(cells[i],map),cellEnd=_cellEnds(cellOrigin.row,cellOrigin.col,map);min_i=Math.min(cellOrigin.row,min_i),max_i=Math.max(cellEnd.row,max_i),min_j=Math.min(cellOrigin.col,min_j),max_j=Math.max(cellEnd.col,max_j)}return{min_i:min_i,max_i:max_i,min_j:min_j,max_j:max_j}}return null}function _selectionLimits(min_i,max_i,min_j,max_j,map){var i,j,cellOrigin,cellEnd,first_i=min_i,last_i=max_i,first_j=min_j,last_j=max_j;for(i=first_i;i<=last_i;i++)((parseInt($(map[i][first_j]).attr("rowspan"),10)||1)>1||(parseInt($(map[i][first_j]).attr("colspan"),10)||1)>1)&&(cellEnd=_cellEnds((cellOrigin=_cellOrigin(map[i][first_j],map)).row,cellOrigin.col,map),first_i=Math.min(cellOrigin.row,first_i),last_i=Math.max(cellEnd.row,last_i),first_j=Math.min(cellOrigin.col,first_j),last_j=Math.max(cellEnd.col,last_j)),((parseInt($(map[i][last_j]).attr("rowspan"),10)||1)>1||(parseInt($(map[i][last_j]).attr("colspan"),10)||1)>1)&&(cellEnd=_cellEnds((cellOrigin=_cellOrigin(map[i][last_j],map)).row,cellOrigin.col,map),first_i=Math.min(cellOrigin.row,first_i),last_i=Math.max(cellEnd.row,last_i),first_j=Math.min(cellOrigin.col,first_j),last_j=Math.max(cellEnd.col,last_j));for(j=first_j;j<=last_j;j++)((parseInt($(map[first_i][j]).attr("rowspan"),10)||1)>1||(parseInt($(map[first_i][j]).attr("colspan"),10)||1)>1)&&(cellEnd=_cellEnds((cellOrigin=_cellOrigin(map[first_i][j],map)).row,cellOrigin.col,map),first_i=Math.min(cellOrigin.row,first_i),last_i=Math.max(cellEnd.row,last_i),first_j=Math.min(cellOrigin.col,first_j),last_j=Math.max(cellEnd.col,last_j)),((parseInt($(map[last_i][j]).attr("rowspan"),10)||1)>1||(parseInt($(map[last_i][j]).attr("colspan"),10)||1)>1)&&(cellEnd=_cellEnds((cellOrigin=_cellOrigin(map[last_i][j],map)).row,cellOrigin.col,map),first_i=Math.min(cellOrigin.row,first_i),last_i=Math.max(cellEnd.row,last_i),first_j=Math.min(cellOrigin.col,first_j),last_j=Math.max(cellEnd.col,last_j));return first_i==min_i&&last_i==max_i&&first_j==min_j&&last_j==max_j?{min_i:min_i,max_i:max_i,min_j:min_j,max_j:max_j}:_selectionLimits(first_i,last_i,first_j,last_j,map)}function _selectionOffset(map){var selection=_currentSelection(map),$tl=$(map[selection.min_i][selection.min_j]),$tr=$(map[selection.min_i][selection.max_j]),$bl=$(map[selection.max_i][selection.min_j]);return{left:$tl.offset().left,right:$tr.offset().left+$tr.outerWidth(),top:$tl.offset().top,bottom:$bl.offset().top+$bl.outerHeight()}}function selectCells(firstCell,lastCell){if($(firstCell).is(lastCell))_removeSelection(),$(firstCell).addClass("fr-selected-cell");else{_clearSelection(),editor.edit.off();var map=_tableMap(),firstCellOrigin=_cellOrigin(firstCell,map),lastCellOrigin=_cellOrigin(lastCell,map),limits=_selectionLimits(Math.min(firstCellOrigin.row,lastCellOrigin.row),Math.max(firstCellOrigin.row,lastCellOrigin.row),Math.min(firstCellOrigin.col,lastCellOrigin.col),Math.max(firstCellOrigin.col,lastCellOrigin.col),map);_removeSelection(),firstCell.classList.add("fr-cell-fixed"),lastCell.classList.add("fr-cell-handler");for(var i=limits.min_i;i<=limits.max_i;i++)for(var j=limits.min_j;j<=limits.max_j;j++)$(map[i][j]).addClass("fr-selected-cell")}}function _getCellUnder(e){var cell=null,$target=$(e.target);return"TD"==e.target.tagName||"TH"==e.target.tagName?cell=e.target:$target.closest("td").length>0?cell=$target.closest("td").get(0):$target.closest("th").length>0&&(cell=$target.closest("th").get(0)),0===editor.$el.find(cell).length?null:cell}function _stopEdit(){_removeSelection(),editor.popups.hide("table.edit")}function _mouseDown(e){var cell=_getCellUnder(e);if("false"==$(cell).parents("[contenteditable]:not(.fr-element):not(.fr-img-caption):not(body):first").attr("contenteditable"))return!0;if(selectedCells().length>0&&!cell&&_stopEdit(),!editor.edit.isDisabled()||editor.popups.isVisible("table.edit"))if(1!=e.which||1==e.which&&editor.helpers.isMac()&&e.ctrlKey)(3==e.which||1==e.which&&editor.helpers.isMac()&&e.ctrlKey)&&cell&&_stopEdit();else if(mouseDownFlag=!0,cell){selectedCells().length>0&&!e.shiftKey&&_stopEdit(),e.stopPropagation(),editor.events.trigger("image.hideResizer"),editor.events.trigger("video.hideResizer"),mouseDownCellFlag=!0;var tag_name=cell.tagName.toLowerCase();e.shiftKey&&editor.$el.find(tag_name+".fr-selected-cell").length>0?$(editor.$el.find(tag_name+".fr-selected-cell").closest("table")).is($(cell).closest("table"))?selectCells(mouseDownCell,cell):_clearSelection():((editor.keys.ctrlKey(e)||e.shiftKey)&&(selectedCells().length>1||0===$(cell).find(editor.selection.element()).length&&!$(cell).is(editor.selection.element()))&&_clearSelection(),mouseDownCell=cell,editor.opts.tableEditButtons.length>0&&selectCells(mouseDownCell,mouseDownCell))}}function _mouseUp(e){if(editor.popups.areVisible())return!0;if(mouseDownCellFlag||editor.$tb.is(e.target)||editor.$tb.is($(e.target).closest(editor.$tb.get(0)))||(selectedCells().length>0&&editor.toolbar.enable(),_removeSelection()),!(1!=e.which||1==e.which&&editor.helpers.isMac()&&e.ctrlKey)){if(mouseDownFlag=!1,mouseDownCellFlag)mouseDownCellFlag=!1,_getCellUnder(e)||1!=selectedCells().length?selectedCells().length>0&&(editor.selection.isCollapsed()?_showEditPopup():_removeSelection()):_removeSelection();if(resizingFlag){resizingFlag=!1,$resizer.removeClass("fr-moving"),editor.$el.removeClass("fr-no-selection"),editor.edit.on();var left=parseFloat($resizer.css("left"))+editor.opts.tableResizerOffset+editor.$wp.offset().left;editor.opts.iframe&&(left-=editor.$iframe.offset().left),$resizer.data("release-position",left),$resizer.removeData("max-left"),$resizer.removeData("max-right"),function(){var initial_positon=$resizer.data("origin"),release_position=$resizer.data("release-position");if(initial_positon!==release_position){var first=$resizer.data("first"),second=$resizer.data("second"),$table=$resizer.data("table"),table_width=$table.outerWidth();if(editor.undo.canDo()||editor.undo.saveStep(),null!==first&&null!==second){var i,$first_cell,$second_cell,map=_tableMap($table),first_widths=[],first_percentages=[],second_widths=[],second_percentages=[];for(i=0;i<map.length;i++)$first_cell=$(map[i][first]),$second_cell=$(map[i][second]),first_widths[i]=$first_cell.outerWidth(),second_widths[i]=$second_cell.outerWidth(),first_percentages[i]=first_widths[i]/table_width*100,second_percentages[i]=second_widths[i]/table_width*100;for(i=0;i<map.length;i++)if($first_cell=$(map[i][first]),$second_cell=$(map[i][second]),map[i][first]!=map[i][second]){var first_cell_percentage=(first_percentages[i]*(first_widths[i]+release_position-initial_positon)/first_widths[i]).toFixed(4);$first_cell.css("width",first_cell_percentage+"%"),$second_cell.css("width",(first_percentages[i]+second_percentages[i]-first_cell_percentage).toFixed(4)+"%")}}else{var width,$table_parent=$table.parent(),table_percentage=table_width/$table_parent.width()*100,left_margin=(parseInt($table.css("margin-left"),10)||0)/$table_parent.width()*100,right_margin=(parseInt($table.css("margin-right"),10)||0)/$table_parent.width()*100;"rtl"==editor.opts.direction&&0===second||"rtl"!=editor.opts.direction&&0!==second?(width=(table_width+release_position-initial_positon)/table_width*table_percentage,$table.css("margin-right","calc(100% - "+Math.round(width).toFixed(4)+"% - "+Math.round(left_margin).toFixed(4)+"%)")):("rtl"==editor.opts.direction&&0!==second||"rtl"!=editor.opts.direction&&0===second)&&(width=(table_width-release_position+initial_positon)/table_width*table_percentage,$table.css("margin-left","calc(100% - "+Math.round(width).toFixed(4)+"% - "+Math.round(right_margin).toFixed(4)+"%)")),$table.css("width",Math.round(width).toFixed(4)+"%")}editor.selection.restore(),editor.undo.saveStep(),editor.events.trigger("table.resized",[$table.get(0)])}$resizer.removeData("origin"),$resizer.removeData("release-position"),$resizer.removeData("first"),$resizer.removeData("second"),$resizer.removeData("table")}(),_hideResizer()}}}function _mouseEnter(e){if(!0===mouseDownCellFlag&&editor.opts.tableEditButtons.length>0){if($(e.currentTarget).closest("table").is(selectedTable())){if("TD"==e.currentTarget.tagName&&0===editor.$el.find("th.fr-selected-cell").length)return void selectCells(mouseDownCell,e.currentTarget);if("TH"==e.currentTarget.tagName&&0===editor.$el.find("td.fr-selected-cell").length)return void selectCells(mouseDownCell,e.currentTarget)}_clearSelection()}}function _moveWithArrows(origin,table,map,direction){for(var sibling,up=table;up!=editor.el&&"TD"!=up.tagName&&"TH"!=up.tagName&&("up"==direction?sibling=up.previousElementSibling:"down"==direction&&(sibling=up.nextElementSibling),!sibling);)up=up.parentNode;"TD"==up.tagName||"TH"==up.tagName?function(cell,direction){for(var table=cell;table&&"TABLE"!=table.tagName&&table.parentNode!=editor.el;)table=table.parentNode;if(table&&"TABLE"==table.tagName){var new_map=_tableMap($(table));"up"==direction?_moveUp(_cellOrigin(cell,new_map),table,new_map):"down"==direction&&_moveDown(_cellOrigin(cell,new_map),table,new_map)}}(up,direction):sibling&&("up"==direction&&editor.selection.setAtEnd(sibling),"down"==direction&&editor.selection.setAtStart(sibling))}function _moveUp(origin,table,map){origin.row>0?editor.selection.setAtEnd(map[origin.row-1][origin.col]):_moveWithArrows(0,table,0,"up")}function _moveDown(origin,table,map){var row=parseInt(map[origin.row][origin.col].getAttribute("rowspan"),10)||1;origin.row<map.length-row?editor.selection.setAtStart(map[origin.row+row][origin.col]):_moveWithArrows(0,table,0,"down")}function _hideResizer(){$resizer&&($resizer.find("div").css("opacity",0),$resizer.css("top",0),$resizer.css("left",0),$resizer.css("height",0),$resizer.find("div").css("height",0),$resizer.hide())}function _hideInsertHelper(){$insert_helper&&$insert_helper.removeClass("fr-visible").css("left","-9999px")}function _placeResizer(e,tag_under){var $tag_under=$(tag_under),$table=$tag_under.closest("table"),$table_parent=$table.parent();if(tag_under&&"TD"!=tag_under.tagName&&"TH"!=tag_under.tagName&&($tag_under.closest("td").length>0?tag_under=$tag_under.closest("td"):$tag_under.closest("th").length>0&&(tag_under=$tag_under.closest("th"))),!tag_under||"TD"!=tag_under.tagName&&"TH"!=tag_under.tagName)$resizer&&$tag_under.get(0)!=$resizer.get(0)&&$tag_under.parent().get(0)!=$resizer.get(0)&&editor.core.sameInstance($resizer)&&_hideResizer();else{if($tag_under=$(tag_under),0===editor.$el.find($tag_under).length)return!1;var tag_left=$tag_under.offset().left-1,tag_right=tag_left+$tag_under.outerWidth();if(Math.abs(e.pageX-tag_left)<=editor.opts.tableResizerOffset||Math.abs(tag_right-e.pageX)<=editor.opts.tableResizerOffset){var first,second,resizer_left,max_left,max_right,map=_tableMap($table),tag_origin=_cellOrigin(tag_under,map),tag_end=_cellEnds(tag_origin.row,tag_origin.col,map),resizer_top=$table.offset().top,resizer_height=$table.outerHeight()-1;"rtl"!=editor.opts.direction?e.pageX-tag_left<=editor.opts.tableResizerOffset?(resizer_left=tag_left,tag_origin.col>0?(max_left=tag_left-_columnWidth(tag_origin.col-1,map)+editor.opts.tableResizingLimit,max_right=tag_left+_columnWidth(tag_origin.col,map)-editor.opts.tableResizingLimit,first=tag_origin.col-1,second=tag_origin.col):(first=null,second=0,max_left=$table.offset().left-1-parseInt($table.css("margin-left"),10),max_right=$table.offset().left-1+$table.width()-map[0].length*editor.opts.tableResizingLimit)):tag_right-e.pageX<=editor.opts.tableResizerOffset&&(resizer_left=tag_right,tag_end.col<map[tag_end.row].length&&map[tag_end.row][tag_end.col+1]?(max_left=tag_right-_columnWidth(tag_end.col,map)+editor.opts.tableResizingLimit,max_right=tag_right+_columnWidth(tag_end.col+1,map)-editor.opts.tableResizingLimit,first=tag_end.col,second=tag_end.col+1):(first=tag_end.col,second=null,max_left=$table.offset().left-1+map[0].length*editor.opts.tableResizingLimit,max_right=$table_parent.offset().left-1+$table_parent.width()+parseFloat($table_parent.css("padding-left")))):tag_right-e.pageX<=editor.opts.tableResizerOffset?(resizer_left=tag_right,tag_origin.col>0?(max_left=tag_right-_columnWidth(tag_origin.col,map)+editor.opts.tableResizingLimit,max_right=tag_right+_columnWidth(tag_origin.col-1,map)-editor.opts.tableResizingLimit,first=tag_origin.col,second=tag_origin.col-1):(first=null,second=0,max_left=$table.offset().left+map[0].length*editor.opts.tableResizingLimit,max_right=$table_parent.offset().left-1+$table_parent.width()+parseFloat($table_parent.css("padding-left")))):e.pageX-tag_left<=editor.opts.tableResizerOffset&&(resizer_left=tag_left,tag_end.col<map[tag_end.row].length&&map[tag_end.row][tag_end.col+1]?(max_left=tag_left-_columnWidth(tag_end.col+1,map)+editor.opts.tableResizingLimit,max_right=tag_left+_columnWidth(tag_end.col,map)-editor.opts.tableResizingLimit,first=tag_end.col+1,second=tag_end.col):(first=tag_end.col,second=null,max_left=$table_parent.offset().left+parseFloat($table_parent.css("padding-left")),max_right=$table.offset().left-1+$table.width()-map[0].length*editor.opts.tableResizingLimit)),$resizer||(editor.shared.$table_resizer||(editor.shared.$table_resizer=$('<div class="fr-table-resizer"><div></div></div>')),$resizer=editor.shared.$table_resizer,editor.events.$on($resizer,"mousedown",(function(e){return!editor.core.sameInstance($resizer)||(selectedCells().length>0&&_stopEdit(),1==e.which?(editor.selection.save(),resizingFlag=!0,$resizer.addClass("fr-moving"),_clearSelection(),editor.edit.off(),$resizer.find("div").css("opacity",1),!1):void 0)})),editor.events.$on($resizer,"mousemove",(function(e){if(!editor.core.sameInstance($resizer))return!0;resizingFlag&&(editor.opts.iframe&&(e.pageX-=editor.$iframe.offset().left),_mouseMove(e))})),editor.events.on("shared.destroy",(function(){$resizer.html("").removeData().remove(),$resizer=null}),!0),editor.events.on("destroy",(function(){editor.$el.find(".fr-selected-cell").removeClass("fr-selected-cell"),$resizer.hide().appendTo($("body:first"))}),!0)),$resizer.data("table",$table),$resizer.data("first",first),$resizer.data("second",second),$resizer.data("instance",editor),editor.$wp.append($resizer);var left=resizer_left-editor.win.pageXOffset-editor.opts.tableResizerOffset-editor.$wp.offset().left,top=resizer_top-editor.$wp.offset().top+editor.$wp.scrollTop();editor.opts.iframe&&(left+=editor.$iframe.offset().left,top+=editor.$iframe.offset().top,max_left+=editor.$iframe.offset().left,max_right+=editor.$iframe.offset().left),$resizer.data("max-left",max_left),$resizer.data("max-right",max_right),$resizer.data("origin",resizer_left-editor.win.pageXOffset),$resizer.css("top",top),$resizer.css("left",left),$resizer.css("height",resizer_height),$resizer.find("div").css("height",resizer_height),$resizer.css("padding-left",editor.opts.tableResizerOffset),$resizer.css("padding-right",editor.opts.tableResizerOffset),$resizer.show()}else editor.core.sameInstance($resizer)&&_hideResizer()}}function _showInsertColHelper(e,table){if(editor.$box.find(".fr-line-breaker").is(":visible"))return!1;$insert_helper||_initInsertHelper(),editor.$box.append($insert_helper),$insert_helper.data("instance",editor);var btn_width,$row=$(table).find("tr:first"),mouseX=e.pageX,left=0,top=0;editor.opts.iframe&&(left+=editor.$iframe.offset().left-editor.helpers.scrollLeft(),top+=editor.$iframe.offset().top-editor.helpers.scrollTop()),$row.find("th, td").each((function(){var $td=$(this);return $td.offset().left<=mouseX&&mouseX<$td.offset().left+$td.outerWidth()/2?(btn_width=parseInt($insert_helper.find("a").css("width"),10),$insert_helper.css("top",top+$td.offset().top-editor.$box.offset().top-btn_width-5),$insert_helper.css("left",left+$td.offset().left-editor.$box.offset().left-btn_width/2),$insert_helper.data("selected-cell",$td),$insert_helper.data("position","before"),$insert_helper.addClass("fr-visible"),!1):$td.offset().left+$td.outerWidth()/2<=mouseX&&mouseX<$td.offset().left+$td.outerWidth()?(btn_width=parseInt($insert_helper.find("a").css("width"),10),$insert_helper.css("top",top+$td.offset().top-editor.$box.offset().top-btn_width-5),$insert_helper.css("left",left+$td.offset().left-editor.$box.offset().left+$td.outerWidth()-btn_width/2),$insert_helper.data("selected-cell",$td),$insert_helper.data("position","after"),$insert_helper.addClass("fr-visible"),!1):void 0}))}function _showInsertRowHelper(e,table){if(editor.$box.find(".fr-line-breaker").is(":visible"))return!1;$insert_helper||_initInsertHelper(),editor.$box.append($insert_helper),$insert_helper.data("instance",editor);var btn_width,$table=$(table),mouseY=e.pageY,left=0,top=0;editor.opts.iframe&&(left+=editor.$iframe.offset().left-editor.helpers.scrollLeft(),top+=editor.$iframe.offset().top-editor.helpers.scrollTop()),$table.find("tr").each((function(){var $tr=$(this);return $tr.offset().top<=mouseY&&mouseY<$tr.offset().top+$tr.outerHeight()/2?(btn_width=parseInt($insert_helper.find("a").css("width"),10),$insert_helper.css("top",top+$tr.offset().top-editor.$box.offset().top-btn_width/2),$insert_helper.css("left",left+$tr.offset().left-editor.$box.offset().left-btn_width-5),$insert_helper.data("selected-cell",$tr.find("td:first")),$insert_helper.data("position","above"),$insert_helper.addClass("fr-visible"),!1):$tr.offset().top+$tr.outerHeight()/2<=mouseY&&mouseY<$tr.offset().top+$tr.outerHeight()?(btn_width=parseInt($insert_helper.find("a").css("width"),10),$insert_helper.css("top",top+$tr.offset().top-editor.$box.offset().top+$tr.outerHeight()-btn_width/2),$insert_helper.css("left",left+$tr.offset().left-editor.$box.offset().left-btn_width-5),$insert_helper.data("selected-cell",$tr.find("td:first")),$insert_helper.data("position","below"),$insert_helper.addClass("fr-visible"),!1):void 0}))}function _tagUnder(e){mouseMoveTimer=null;var tag_under=editor.doc.elementFromPoint(e.pageX-editor.win.pageXOffset,e.pageY-editor.win.pageYOffset);editor.opts.tableResizer&&(!editor.popups.areVisible()||editor.popups.areVisible()&&editor.popups.isVisible("table.edit"))&&_placeResizer(e,tag_under),!editor.opts.tableInsertHelper||editor.popups.areVisible()||editor.$tb.hasClass("fr-inline")&&editor.$tb.is(":visible")||function(e,tag_under){if(0===selectedCells().length){var i,tag_below,tag_right;if(tag_under&&("HTML"==tag_under.tagName||"BODY"==tag_under.tagName||editor.node.isElement(tag_under)))for(i=1;i<=editor.opts.tableInsertHelperOffset;i++){if(tag_below=editor.doc.elementFromPoint(e.pageX-editor.win.pageXOffset,e.pageY-editor.win.pageYOffset+i),$(tag_below).hasClass("fr-tooltip"))return!0;if(tag_below&&("TH"==tag_below.tagName||"TD"==tag_below.tagName||"TABLE"==tag_below.tagName)&&($(tag_below).parents(".fr-wrapper").length||editor.opts.iframe))return _showInsertColHelper(e,$(tag_below).closest("table")),!0;if(tag_right=editor.doc.elementFromPoint(e.pageX-editor.win.pageXOffset+i,e.pageY-editor.win.pageYOffset),$(tag_right).hasClass("fr-tooltip"))return!0;if(tag_right&&("TH"==tag_right.tagName||"TD"==tag_right.tagName||"TABLE"==tag_right.tagName)&&($(tag_right).parents(".fr-wrapper").length||editor.opts.iframe))return _showInsertRowHelper(e,$(tag_right).closest("table")),!0}editor.core.sameInstance($insert_helper)&&_hideInsertHelper()}}(e,tag_under)}function _repositionResizer(){if(resizingFlag){var top=$resizer.data("table").offset().top-editor.win.pageYOffset;editor.opts.iframe&&(top+=editor.$iframe.offset().top-editor.helpers.scrollTop()),$resizer.css("top",top)}}function _columnWidth(col,map){var i,width=$(map[0][col]).outerWidth();for(i=1;i<map.length;i++)width=Math.min(width,$(map[i][col]).outerWidth());return width}function _columnsWidth(col1,col2,map){var i,width=0;for(i=col1;i<=col2;i++)width+=_columnWidth(i,map);return width}function _mouseMove(e){if(selectedCells().length>1&&mouseDownFlag&&_clearSelection(),!1===mouseDownFlag&&!1===mouseDownCellFlag&&!1===resizingFlag)mouseMoveTimer&&clearTimeout(mouseMoveTimer),editor.edit.isDisabled()&&!editor.popups.isVisible("table.edit")||(mouseMoveTimer=setTimeout(_tagUnder,30,e));else if(resizingFlag){var pos=e.pageX-editor.win.pageXOffset;editor.opts.iframe&&(pos+=editor.$iframe.offset().left);var left_limit=$resizer.data("max-left"),right_limit=$resizer.data("max-right");pos>=left_limit&&pos<=right_limit?$resizer.css("left",pos-editor.opts.tableResizerOffset-editor.$wp.offset().left):pos<left_limit&&parseFloat($resizer.css("left"),10)>left_limit-editor.opts.tableResizerOffset?$resizer.css("left",left_limit-editor.opts.tableResizerOffset-editor.$wp.offset().left):pos>right_limit&&parseFloat($resizer.css("left"),10)<right_limit-editor.opts.tableResizerOffset&&$resizer.css("left",right_limit-editor.opts.tableResizerOffset-editor.$wp.offset().left)}else mouseDownFlag&&_hideInsertHelper()}function _addMarkersInCell($cell){editor.node.isEmpty($cell.get(0))?$cell.prepend($.FE.MARKERS):$cell.prepend($.FE.START_MARKER).append($.FE.END_MARKER)}function _initInsertHelper(){editor.shared.$ti_helper||(editor.shared.$ti_helper=$('<div class="fr-insert-helper"><a class="fr-floating-btn" role="button" tabIndex="-1" title="'+editor.language.translate("Insert")+'"><svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M22,16.75 L16.75,16.75 L16.75,22 L15.25,22.000 L15.25,16.75 L10,16.75 L10,15.25 L15.25,15.25 L15.25,10 L16.75,10 L16.75,15.25 L22,15.25 L22,16.75 Z"/></svg></a></div>'),editor.events.bindClick(editor.shared.$ti_helper,"a",(function(){var $td=$insert_helper.data("selected-cell"),position=$insert_helper.data("position"),inst=$insert_helper.data("instance")||editor;"before"==position||"after"==position?(editor.undo.saveStep(),$td.addClass("fr-selected-cell"),inst.table.insertColumn(position),$td.removeClass("fr-selected-cell"),editor.undo.saveStep()):("above"==position||"below"==position)&&(editor.undo.saveStep(),$td.addClass("fr-selected-cell"),inst.table.insertRow(position),$td.removeClass("fr-selected-cell"),editor.undo.saveStep()),_hideInsertHelper()})),editor.events.on("shared.destroy",(function(){editor.shared.$ti_helper.html("").removeData().remove(),editor.shared.$ti_helper=null}),!0),editor.events.$on(editor.shared.$ti_helper,"mousemove",(function(e){e.stopPropagation()}),!0),editor.events.$on($(editor.o_win),"scroll",(function(){_hideInsertHelper()}),!0),editor.events.$on(editor.$wp,"scroll",(function(){_hideInsertHelper()}),!0)),$insert_helper=editor.shared.$ti_helper,editor.events.on("destroy",(function(){$insert_helper=null})),editor.tooltip.bind(editor.$box,".fr-insert-helper > a.fr-floating-btn")}function _destroy(){mouseDownCell=null,clearTimeout(mouseMoveTimer)}function selectedCells(){return editor.el.querySelectorAll(".fr-selected-cell")}function selectedTable(){var cells=selectedCells();if(cells.length){for(var cell=cells[0];cell&&"TABLE"!=cell.tagName&&cell.parentNode!=editor.el;)cell=cell.parentNode;return cell&&"TABLE"==cell.tagName?$(cell):$([])}return $([])}return{_init:function(){if(!editor.$wp)return!1;if(!editor.helpers.isMobile()){mouseDownFlag=!1,mouseDownCellFlag=!1,resizingFlag=!1,editor.events.$on(editor.$el,"mousedown",_mouseDown),editor.popups.onShow("image.edit",(function(){_removeSelection(),mouseDownFlag=!1,mouseDownCellFlag=!1})),editor.popups.onShow("link.edit",(function(){_removeSelection(),mouseDownFlag=!1,mouseDownCellFlag=!1})),editor.events.on("commands.mousedown",(function($btn){$btn.parents(".fr-toolbar").length>0&&_removeSelection()})),editor.events.$on(editor.$el,"mouseenter","th, td",_mouseEnter),editor.events.$on(editor.$win,"mouseup",_mouseUp),editor.opts.iframe&&editor.events.$on($(editor.o_win),"mouseup",_mouseUp),editor.events.$on(editor.$win,"mousemove",_mouseMove),editor.events.$on($(editor.o_win),"scroll",_repositionResizer),editor.events.on("contentChanged",(function(){selectedCells().length>0&&(_showEditPopup(),editor.$el.find("img").on("load.selected-cells",(function(){$(this).off("load.selected-cells"),selectedCells().length>0&&_showEditPopup()})))})),editor.events.$on($(editor.o_win),"resize",(function(){_removeSelection()})),editor.events.on("toolbar.esc",(function(){if(selectedCells().length>0)return editor.events.disableBlur(),editor.events.focus(),!1}),!0),editor.events.$on($(editor.o_win),"keydown",(function(){mouseDownFlag&&mouseDownCellFlag&&(mouseDownFlag=!1,mouseDownCellFlag=!1,editor.$el.removeClass("fr-no-selection"),editor.edit.on(),editor.selection.setAtEnd(editor.$el.find(".fr-selected-cell:last").get(0)),editor.selection.restore(),_removeSelection())})),editor.events.$on(editor.$el,"keydown",(function(e){e.shiftKey?!1===function(e){var selection=selectedCells();if(selection.length>0){var fixedCell,handlerCell,map=_tableMap(),key_code=e.which;1==selection.length?handlerCell=fixedCell=selection[0]:(fixedCell=editor.el.querySelector(".fr-cell-fixed"),handlerCell=editor.el.querySelector(".fr-cell-handler"));var handlerOrigin=_cellOrigin(handlerCell,map);if($.FE.KEYCODE.ARROW_RIGHT==key_code){if(handlerOrigin.col<map[0].length-1)return selectCells(fixedCell,map[handlerOrigin.row][handlerOrigin.col+1]),!1}else if($.FE.KEYCODE.ARROW_DOWN==key_code){if(handlerOrigin.row<map.length-1)return selectCells(fixedCell,map[handlerOrigin.row+1][handlerOrigin.col]),!1}else if($.FE.KEYCODE.ARROW_LEFT==key_code){if(handlerOrigin.col>0)return selectCells(fixedCell,map[handlerOrigin.row][handlerOrigin.col-1]),!1}else if($.FE.KEYCODE.ARROW_UP==key_code&&handlerOrigin.row>0)return selectCells(fixedCell,map[handlerOrigin.row-1][handlerOrigin.col]),!1}}(e)&&setTimeout((function(){_showEditPopup()}),0):function(e){var key_code=e.which,sel=editor.selection.blocks();if(sel.length&&("TD"==(sel=sel[0]).tagName||"TH"==sel.tagName)){for(var table=sel;table&&"TABLE"!=table.tagName&&table.parentNode!=editor.el;)table=table.parentNode;if(table&&"TABLE"==table.tagName&&($.FE.KEYCODE.ARROW_LEFT==key_code||$.FE.KEYCODE.ARROW_UP==key_code||$.FE.KEYCODE.ARROW_RIGHT==key_code||$.FE.KEYCODE.ARROW_DOWN==key_code)&&(selectedCells().length>0&&_stopEdit(),editor.browser.webkit&&($.FE.KEYCODE.ARROW_UP==key_code||$.FE.KEYCODE.ARROW_DOWN==key_code))){var node=editor.selection.ranges(0).startContainer;if(node.nodeType==Node.TEXT_NODE&&($.FE.KEYCODE.ARROW_UP==key_code&&node.previousSibling||$.FE.KEYCODE.ARROW_DOWN==key_code&&node.nextSibling))return;e.preventDefault(),e.stopPropagation();var map=_tableMap($(table)),origin=_cellOrigin(sel,map);$.FE.KEYCODE.ARROW_UP==key_code?_moveUp(origin,table,map):$.FE.KEYCODE.ARROW_DOWN==key_code&&_moveDown(origin,table,map),editor.selection.restore()}}}(e)})),editor.events.on("keydown",(function(e){if(!1===function(e){if(e.which==$.FE.KEYCODE.TAB){var $cell;if(selectedCells().length>0)$cell=editor.$el.find(".fr-selected-cell:last");else{var cell=editor.selection.element();"TD"==cell.tagName||"TH"==cell.tagName?$cell=$(cell):cell!=editor.el&&($(cell).parentsUntil(editor.$el,"td").length>0?$cell=$(cell).parents("td:first"):$(cell).parentsUntil(editor.$el,"th").length>0&&($cell=$(cell).parents("th:first")))}if($cell)return e.preventDefault(),!!($(editor.selection.element()).parentsUntil(editor.$el,"ol, ul").length>0&&($(editor.selection.element()).parents("li").prev().length>0||$(editor.selection.element()).is("li")&&$(editor.selection.element()).prev().length>0))||(_stopEdit(),e.shiftKey?$cell.prev().length>0?_addMarkersInCell($cell.prev()):$cell.closest("tr").length>0&&$cell.closest("tr").prev().length>0?_addMarkersInCell($cell.closest("tr").prev().find("td:last")):$cell.closest("tbody").length>0&&$cell.closest("table").find("thead tr").length>0&&_addMarkersInCell($cell.closest("table").find("thead tr th:last")):$cell.next().length>0?_addMarkersInCell($cell.next()):$cell.closest("tr").length>0&&$cell.closest("tr").next().length>0?_addMarkersInCell($cell.closest("tr").next().find("td:first")):$cell.closest("thead").length>0&&$cell.closest("table").find("tbody tr").length>0?_addMarkersInCell($cell.closest("table").find("tbody tr td:first")):($cell.addClass("fr-selected-cell"),insertRow("below"),_removeSelection(),_addMarkersInCell($cell.closest("tr").next().find("td:first"))),editor.selection.restore(),!1)}}(e))return!1;var selected_cells=selectedCells();if(selected_cells.length>0){if(selected_cells.length>0&&editor.keys.ctrlKey(e)&&e.which==$.FE.KEYCODE.A)return _removeSelection(),editor.popups.isVisible("table.edit")&&editor.popups.hide("table.edit"),selected_cells=[],!0;if(e.which==$.FE.KEYCODE.ESC&&editor.popups.isVisible("table.edit"))return _removeSelection(),editor.popups.hide("table.edit"),e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),selected_cells=[],!1;if(selected_cells.length>1&&(e.which==$.FE.KEYCODE.BACKSPACE||e.which==$.FE.KEYCODE.DELETE)){editor.undo.saveStep();for(var i=0;i<selected_cells.length;i++)$(selected_cells[i]).html("<br>"),i==selected_cells.length-1&&$(selected_cells[i]).prepend($.FE.MARKERS);return editor.selection.restore(),editor.undo.saveStep(),selected_cells=[],!1}if(selected_cells.length>1&&e.which!=$.FE.KEYCODE.F10&&!editor.keys.isBrowserAction(e))return e.preventDefault(),selected_cells=[],!1}else if(selected_cells=[],!1===function(e){if(e.altKey&&e.which==$.FE.KEYCODE.SPACE){var cell,el=editor.selection.element();if("TD"==el.tagName||"TH"==el.tagName?cell=el:$(el).closest("td").length>0?cell=$(el).closest("td").get(0):$(el).closest("th").length>0&&(cell=$(el).closest("th").get(0)),cell)return e.preventDefault(),selectCells(cell,cell),_showEditPopup(),!1}}(e))return!1}),!0);var c_selected_cells=[];editor.events.on("html.beforeGet",(function(){c_selected_cells=selectedCells();for(var i=0;i<c_selected_cells.length;i++)c_selected_cells[i].className=(c_selected_cells[i].className||"").replace(/fr-selected-cell/g,"")})),editor.events.on("html.afterGet",(function(){for(var i=0;i<c_selected_cells.length;i++)c_selected_cells[i].className=(c_selected_cells[i].className?c_selected_cells[i].className.trim()+" ":"")+"fr-selected-cell";c_selected_cells=[]})),_initInsertPopup(!0),_initEditPopup(!0)}editor.events.on("destroy",_destroy)},insert:function(rows,cols){var i,j,table="<table "+(editor.opts.tableDefaultWidth?'style="width: '+editor.opts.tableDefaultWidth+';" ':"")+'class="fr-inserted-table"><tbody>',cell_width=100/cols;for(i=0;i<rows;i++){for(table+="<tr>",j=0;j<cols;j++)table+="<td"+(editor.opts.tableDefaultWidth?' style="width: '+cell_width.toFixed(4)+'%;"':"")+">",0===i&&0===j&&(table+=$.FE.MARKERS),table+="<br></td>";table+="</tr>"}table+="</tbody></table>",editor.html.insert(table),editor.selection.restore();var $table=editor.$el.find(".fr-inserted-table");$table.removeClass("fr-inserted-table"),editor.events.trigger("table.inserted",[$table.get(0)])},remove:remove,insertRow:insertRow,deleteRow:function(){var $table=selectedTable();if($table.length>0){var i,j,$row,map=_tableMap(),selection=_currentSelection(map);if(0===selection.min_i&&selection.max_i==map.length-1)remove();else{for(i=selection.max_i;i>=selection.min_i;i--){for($row=$($table.find("tr").not($table.find("table tr")).get(i)),j=0;j<map[i].length;j++)if(0===j||map[i][j]!=map[i][j-1]){var $cell=$(map[i][j]);if(parseInt($cell.attr("rowspan"),10)>1){var rowspan=parseInt($cell.attr("rowspan"),10)-1;1==rowspan?$cell.removeAttr("rowspan"):$cell.attr("rowspan",rowspan)}if(i<map.length-1&&map[i][j]==map[i+1][j]&&(0===i||map[i][j]!=map[i-1][j])){for(var td=map[i][j],col=j;col>0&&map[i][col]==map[i][col-1];)col--;0===col?$($table.find("tr").not($table.find("table tr")).get(i+1)).prepend(td):$(map[i+1][col-1]).after(td)}}var $row_parent=$row.parent();$row.remove(),0===$row_parent.find("tr").length&&$row_parent.remove(),map=_tableMap($table)}_updateCellSpan(0,map.length-1,0,map[0].length-1,$table),selection.min_i>0?editor.selection.setAtEnd(map[selection.min_i-1][0]):editor.selection.setAtEnd(map[0][0]),editor.selection.restore(),editor.popups.hide("table.edit")}}},insertColumn:function(position){var $table=selectedTable();if($table.length>0){var ref_col,map=_tableMap(),selection=_currentSelection(map);ref_col="before"==position?selection.min_j:selection.max_j;var $cell,old_width=100/map[0].length,new_width=100/(map[0].length+1);$table.find("th, td").each((function(){($cell=$(this)).data("old-width",$cell.outerWidth()/$table.outerWidth()*100)})),$table.find("tr").not($table.find("table tr")).each((function(index){for(var ref_td,$row=$(this),col_no=0,td_no=0;col_no-1<ref_col;){if(!(ref_td=$row.find("> th, > td").get(td_no))){ref_td=null;break}ref_td==map[index][col_no]?(col_no+=parseInt($(ref_td).attr("colspan"),10)||1,td_no++):(col_no+=parseInt($(map[index][col_no]).attr("colspan"),10)||1,"after"==position&&(ref_td=0===td_no?-1:$row.find("> th, > td").get(td_no-1)))}var td,$ref_td=$(ref_td);if("after"==position&&col_no-1>ref_col||"before"==position&&ref_col>0&&map[index][ref_col]==map[index][ref_col-1]){if(0===index||index>0&&map[index][ref_col]!=map[index-1][ref_col]){var colspan=parseInt($ref_td.attr("colspan"),10)+1;$ref_td.attr("colspan",colspan),$ref_td.css("width",($ref_td.data("old-width")*new_width/old_width+new_width).toFixed(4)+"%"),$ref_td.removeData("old-width")}}else td=$row.find("th").length>0?'<th style="width: '+new_width.toFixed(4)+'%;"><br></th>':'<td style="width: '+new_width.toFixed(4)+'%;"><br></td>',-1==ref_td?$row.prepend(td):null==ref_td?$row.append(td):"before"==position?$ref_td.before(td):"after"==position&&$ref_td.after(td)})),$table.find("th, td").each((function(){($cell=$(this)).data("old-width")&&($cell.css("width",($cell.data("old-width")*new_width/old_width).toFixed(4)+"%"),$cell.removeData("old-width"))})),editor.popups.isVisible("table.edit")&&_showEditPopup()}},deleteColumn:function(){var $table=selectedTable();if($table.length>0){var i,j,$cell,map=_tableMap(),selection=_currentSelection(map);if(0===selection.min_j&&selection.max_j==map[0].length-1)remove();else{var old_width=0;for(i=0;i<map.length;i++)for(j=0;j<map[0].length;j++)($cell=$(map[i][j])).hasClass("fr-selected-cell")||($cell.data("old-width",$cell.outerWidth()/$table.outerWidth()*100),(j<selection.min_j||j>selection.max_j)&&(old_width+=$cell.outerWidth()/$table.outerWidth()*100));for(old_width/=map.length,j=selection.max_j;j>=selection.min_j;j--)for(i=0;i<map.length;i++)if(0===i||map[i][j]!=map[i-1][j])if($cell=$(map[i][j]),(parseInt($cell.attr("colspan"),10)||1)>1){var colspan=parseInt($cell.attr("colspan"),10)-1;1==colspan?$cell.removeAttr("colspan"):$cell.attr("colspan",colspan),$cell.css("width",(100*($cell.data("old-width")-_columnWidth(j,map))/old_width).toFixed(4)+"%"),$cell.removeData("old-width")}else{var $row=$($cell.parent().get(0));$cell.remove(),0===$row.find("> th, > td").length&&(0===$row.prev().length||0===$row.next().length||$row.prev().find("> th[rowspan], > td[rowspan]").length<$row.prev().find("> th, > td").length)&&$row.remove()}_updateCellSpan(0,map.length-1,0,map[0].length-1,$table),selection.min_j>0?editor.selection.setAtEnd(map[selection.min_i][selection.min_j-1]):editor.selection.setAtEnd(map[selection.min_i][0]),editor.selection.restore(),editor.popups.hide("table.edit"),$table.find("th, td").each((function(){($cell=$(this)).data("old-width")&&($cell.css("width",(100*$cell.data("old-width")/old_width).toFixed(4)+"%"),$cell.removeData("old-width"))}))}}},mergeCells:function(){if(selectedCells().length>1&&(0===editor.$el.find("th.fr-selected-cell").length||0===editor.$el.find("td.fr-selected-cell").length)){_removeKeyboardSelectionHandlers();var i,$cell,selection=_currentSelection(_tableMap()),cells=editor.$el.find(".fr-selected-cell"),$first_cell=$(cells[0]),first_row_cells=$first_cell.parent().find(".fr-selected-cell"),$current_table=$first_cell.closest("table"),content=$first_cell.html(),width=0;for(i=0;i<first_row_cells.length;i++)width+=$(first_row_cells[i]).outerWidth();for($first_cell.css("width",Math.min(100,width/$current_table.outerWidth()*100).toFixed(4)+"%"),selection.min_j<selection.max_j&&$first_cell.attr("colspan",selection.max_j-selection.min_j+1),selection.min_i<selection.max_i&&$first_cell.attr("rowspan",selection.max_i-selection.min_i+1),i=1;i<cells.length;i++)"<br>"!=($cell=$(cells[i])).html()&&""!==$cell.html()&&(content+="<br>"+$cell.html()),$cell.remove();$first_cell.html(content),editor.selection.setAtEnd($first_cell.get(0)),editor.selection.restore(),editor.toolbar.enable(),_updateRowspan(selection.min_i,selection.max_i,$current_table);var empty_trs=$current_table.find("tr:empty");for(i=empty_trs.length-1;i>=0;i--)$(empty_trs[i]).remove();_updateColspan(selection.min_j,selection.max_j,$current_table),_showEditPopup()}},splitCellVertically:function(){if(1==selectedCells().length){var $selected_cell=editor.$el.find(".fr-selected-cell"),current_colspan=parseInt($selected_cell.attr("colspan"),10)||1,parent_width=$selected_cell.parent().outerWidth(),width=$selected_cell.outerWidth(),$new_td=$selected_cell.clone().html("<br>"),map=_tableMap(),cell_origin=_cellOrigin($selected_cell.get(0),map);if(current_colspan>1){var new_colspan=Math.ceil(current_colspan/2);width=_columnsWidth(cell_origin.col,cell_origin.col+new_colspan-1,map)/parent_width*100;var new_width=_columnsWidth(cell_origin.col+new_colspan,cell_origin.col+current_colspan-1,map)/parent_width*100;new_colspan>1?$selected_cell.attr("colspan",new_colspan):$selected_cell.removeAttr("colspan"),current_colspan-new_colspan>1?$new_td.attr("colspan",current_colspan-new_colspan):$new_td.removeAttr("colspan"),$selected_cell.css("width",width.toFixed(4)+"%"),$new_td.css("width",new_width.toFixed(4)+"%")}else{var i;for(i=0;i<map.length;i++)if(0===i||map[i][cell_origin.col]!=map[i-1][cell_origin.col]){var $cell=$(map[i][cell_origin.col]);if(!$cell.is($selected_cell)){var colspan=(parseInt($cell.attr("colspan"),10)||1)+1;$cell.attr("colspan",colspan)}}width=width/parent_width*100/2,$selected_cell.css("width",width.toFixed(4)+"%"),$new_td.css("width",width.toFixed(4)+"%")}$selected_cell.after($new_td),_removeSelection(),editor.popups.hide("table.edit")}},splitCellHorizontally:function(){if(1==selectedCells().length){var $selected_cell=editor.$el.find(".fr-selected-cell"),$current_row=$selected_cell.parent(),$current_table=$selected_cell.closest("table"),current_rowspan=parseInt($selected_cell.attr("rowspan"),10),map=_tableMap(),cell_origin=_cellOrigin($selected_cell.get(0),map),$new_td=$selected_cell.clone().html("<br>");if(current_rowspan>1){var new_rowspan=Math.ceil(current_rowspan/2);new_rowspan>1?$selected_cell.attr("rowspan",new_rowspan):$selected_cell.removeAttr("rowspan"),current_rowspan-new_rowspan>1?$new_td.attr("rowspan",current_rowspan-new_rowspan):$new_td.removeAttr("rowspan");for(var row=cell_origin.row+new_rowspan,col=0===cell_origin.col?cell_origin.col:cell_origin.col-1;col>=0&&(map[row][col]==map[row][col-1]||row>0&&map[row][col]==map[row-1][col]);)col--;-1==col?$($current_table.find("tr").not($current_table.find("table tr")).get(row)).prepend($new_td):$(map[row][col]).after($new_td)}else{var i,$row=$("<tr>").append($new_td);for(i=0;i<map[0].length;i++)if(0===i||map[cell_origin.row][i]!=map[cell_origin.row][i-1]){var $cell=$(map[cell_origin.row][i]);$cell.is($selected_cell)||$cell.attr("rowspan",(parseInt($cell.attr("rowspan"),10)||1)+1)}$current_row.after($row)}_removeSelection(),editor.popups.hide("table.edit")}},addHeader:function(){var $table=selectedTable();if($table.length>0&&0===$table.find("th").length){var i,thead="<thead><tr>",col=0;for($table.find("tr:first > td").each((function(){var $td=$(this);col+=parseInt($td.attr("colspan"),10)||1})),i=0;i<col;i++)thead+="<th><br></th>";thead+="</tr></thead>",$table.prepend(thead),_showEditPopup()}},removeHeader:function(){var $current_table=selectedTable(),$table_header=$current_table.find("thead");if($table_header.length>0)if(0===$current_table.find("tbody tr").length)remove();else if($table_header.remove(),selectedCells().length>0)_showEditPopup();else{editor.popups.hide("table.edit");var td=$current_table.find("tbody tr:first td:first").get(0);td&&(editor.selection.setAtEnd(td),editor.selection.restore())}},setBackground:setBackground,showInsertPopup:function(){var $btn=editor.$tb.find('.fr-command[data-cmd="insertTable"]'),$popup=editor.popups.get("table.insert");if($popup||($popup=_initInsertPopup()),!$popup.hasClass("fr-active")){editor.popups.refresh("table.insert"),editor.popups.setContainer("table.insert",editor.$tb);var left=$btn.offset().left+$btn.outerWidth()/2,top=$btn.offset().top+(editor.opts.toolbarBottom?10:$btn.outerHeight()-10);editor.popups.show("table.insert",left,top,$btn.outerHeight())}},showEditPopup:_showEditPopup,showColorsPopup:_showColorsPopup,back:function(){selectedCells().length>0?_showEditPopup():(editor.popups.hide("table.insert"),editor.toolbar.showInline())},verticalAlign:function(val){editor.$el.find(".fr-selected-cell").css("vertical-align",val)},horizontalAlign:function(val){editor.$el.find(".fr-selected-cell").css("text-align",val)},applyStyle:function(val,obj,multiple_styles,styles){if(obj.length>0){if(!multiple_styles){var classes=Object.keys(styles);classes.splice(classes.indexOf(val),1),obj.removeClass(classes.join(" "))}obj.toggleClass(val)}},selectedTable:selectedTable,selectedCells:selectedCells,customColor:function(){var $input=editor.popups.get("table.colors").find(".fr-table-colors-hex-layer input");$input.length&&setBackground($input.val())},selectCells:selectCells}},$.FE.DefineIcon("insertTable",{NAME:"table"}),$.FE.RegisterCommand("insertTable",{title:"Insert Table",undo:!1,focus:!0,refreshOnCallback:!1,popup:!0,callback:function(){this.popups.isVisible("table.insert")?(this.$el.find(".fr-marker").length&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("table.insert")):this.table.showInsertPopup()},plugin:"table"}),$.FE.RegisterCommand("tableInsert",{callback:function(cmd,rows,cols){this.table.insert(rows,cols),this.popups.hide("table.insert")}}),$.FE.DefineIcon("tableHeader",{NAME:"header",FA5NAME:"heading"}),$.FE.RegisterCommand("tableHeader",{title:"Table Header",focus:!1,toggle:!0,callback:function(){this.popups.get("table.edit").find('.fr-command[data-cmd="tableHeader"]').hasClass("fr-active")?this.table.removeHeader():this.table.addHeader()},refresh:function($btn){var $table=this.table.selectedTable();$table.length>0&&(0===$table.find("th").length?$btn.removeClass("fr-active").attr("aria-pressed",!1):$btn.addClass("fr-active").attr("aria-pressed",!0))}}),$.FE.DefineIcon("tableRows",{NAME:"bars"}),$.FE.RegisterCommand("tableRows",{type:"dropdown",focus:!1,title:"Row",options:{above:"Insert row above",below:"Insert row below",delete:"Delete row"},html:function(){var c='<ul class="fr-dropdown-list" role="presentation">',options=$.FE.COMMANDS.tableRows.options;for(var val in options)options.hasOwnProperty(val)&&(c+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableRows" data-param1="'+val+'" title="'+this.language.translate(options[val])+'">'+this.language.translate(options[val])+"</a></li>");return c+="</ul>"},callback:function(cmd,val){"above"==val||"below"==val?this.table.insertRow(val):this.table.deleteRow()}}),$.FE.DefineIcon("tableColumns",{NAME:"bars fa-rotate-90"}),$.FE.RegisterCommand("tableColumns",{type:"dropdown",focus:!1,title:"Column",options:{before:"Insert column before",after:"Insert column after",delete:"Delete column"},html:function(){var c='<ul class="fr-dropdown-list" role="presentation">',options=$.FE.COMMANDS.tableColumns.options;for(var val in options)options.hasOwnProperty(val)&&(c+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableColumns" data-param1="'+val+'" title="'+this.language.translate(options[val])+'">'+this.language.translate(options[val])+"</a></li>");return c+="</ul>"},callback:function(cmd,val){"before"==val||"after"==val?this.table.insertColumn(val):this.table.deleteColumn()}}),$.FE.DefineIcon("tableCells",{NAME:"square-o",FA5NAME:"square"}),$.FE.RegisterCommand("tableCells",{type:"dropdown",focus:!1,title:"Cell",options:{merge:"Merge cells","vertical-split":"Vertical split","horizontal-split":"Horizontal split"},html:function(){var c='<ul class="fr-dropdown-list" role="presentation">',options=$.FE.COMMANDS.tableCells.options;for(var val in options)options.hasOwnProperty(val)&&(c+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableCells" data-param1="'+val+'" title="'+this.language.translate(options[val])+'">'+this.language.translate(options[val])+"</a></li>");return c+="</ul>"},callback:function(cmd,val){"merge"==val?this.table.mergeCells():"vertical-split"==val?this.table.splitCellVertically():this.table.splitCellHorizontally()},refreshOnShow:function($btn,$dropdown){this.$el.find(".fr-selected-cell").length>1?($dropdown.find('a[data-param1="vertical-split"]').addClass("fr-disabled").attr("aria-disabled",!0),$dropdown.find('a[data-param1="horizontal-split"]').addClass("fr-disabled").attr("aria-disabled",!0),$dropdown.find('a[data-param1="merge"]').removeClass("fr-disabled").attr("aria-disabled",!1)):($dropdown.find('a[data-param1="merge"]').addClass("fr-disabled").attr("aria-disabled",!0),$dropdown.find('a[data-param1="vertical-split"]').removeClass("fr-disabled").attr("aria-disabled",!1),$dropdown.find('a[data-param1="horizontal-split"]').removeClass("fr-disabled").attr("aria-disabled",!1))}}),$.FE.DefineIcon("tableRemove",{NAME:"trash"}),$.FE.RegisterCommand("tableRemove",{title:"Remove Table",focus:!1,callback:function(){this.table.remove()}}),$.FE.DefineIcon("tableStyle",{NAME:"paint-brush"}),$.FE.RegisterCommand("tableStyle",{title:"Table Style",type:"dropdown",focus:!1,html:function(){var c='<ul class="fr-dropdown-list" role="presentation">',options=this.opts.tableStyles;for(var val in options)options.hasOwnProperty(val)&&(c+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableStyle" data-param1="'+val+'" title="'+this.language.translate(options[val])+'">'+this.language.translate(options[val])+"</a></li>");return c+="</ul>"},callback:function(cmd,val){this.table.applyStyle(val,this.$el.find(".fr-selected-cell").closest("table"),this.opts.tableMultipleStyles,this.opts.tableStyles)},refreshOnShow:function($btn,$dropdown){var $table=this.$el.find(".fr-selected-cell").closest("table");$table&&$dropdown.find(".fr-command").each((function(){var cls=$(this).data("param1"),active=$table.hasClass(cls);$(this).toggleClass("fr-active",active).attr("aria-selected",active)}))}}),$.FE.DefineIcon("tableCellBackground",{NAME:"tint"}),$.FE.RegisterCommand("tableCellBackground",{title:"Cell Background",focus:!1,popup:!0,callback:function(){this.table.showColorsPopup()}}),$.FE.RegisterCommand("tableCellBackgroundColor",{undo:!0,focus:!1,callback:function(cmd,val){this.table.setBackground(val)}}),$.FE.DefineIcon("tableBack",{NAME:"arrow-left"}),$.FE.RegisterCommand("tableBack",{title:"Back",undo:!1,focus:!1,back:!0,callback:function(){this.table.back()},refresh:function($btn){0!==this.table.selectedCells().length||this.opts.toolbarInline?($btn.removeClass("fr-hidden"),$btn.next(".fr-separator").removeClass("fr-hidden")):($btn.addClass("fr-hidden"),$btn.next(".fr-separator").addClass("fr-hidden"))}}),$.FE.DefineIcon("tableCellVerticalAlign",{NAME:"arrows-v",FA5NAME:"arrows-alt-v"}),$.FE.RegisterCommand("tableCellVerticalAlign",{type:"dropdown",focus:!1,title:"Vertical Align",options:{Top:"Align Top",Middle:"Align Middle",Bottom:"Align Bottom"},html:function(){var c='<ul class="fr-dropdown-list" role="presentation">',options=$.FE.COMMANDS.tableCellVerticalAlign.options;for(var val in options)options.hasOwnProperty(val)&&(c+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableCellVerticalAlign" data-param1="'+val.toLowerCase()+'" title="'+this.language.translate(options[val])+'">'+this.language.translate(val)+"</a></li>");return c+="</ul>"},callback:function(cmd,val){this.table.verticalAlign(val)},refreshOnShow:function($btn,$dropdown){$dropdown.find('.fr-command[data-param1="'+this.$el.find(".fr-selected-cell").css("vertical-align")+'"]').addClass("fr-active").attr("aria-selected",!0)}}),$.FE.DefineIcon("tableCellHorizontalAlign",{NAME:"align-left"}),$.FE.DefineIcon("align-left",{NAME:"align-left"}),$.FE.DefineIcon("align-right",{NAME:"align-right"}),$.FE.DefineIcon("align-center",{NAME:"align-center"}),$.FE.DefineIcon("align-justify",{NAME:"align-justify"}),$.FE.RegisterCommand("tableCellHorizontalAlign",{type:"dropdown",focus:!1,title:"Horizontal Align",options:{left:"Align Left",center:"Align Center",right:"Align Right",justify:"Align Justify"},html:function(){var c='<ul class="fr-dropdown-list" role="presentation">',options=$.FE.COMMANDS.tableCellHorizontalAlign.options;for(var val in options)options.hasOwnProperty(val)&&(c+='<li role="presentation"><a class="fr-command fr-title" tabIndex="-1" role="option" data-cmd="tableCellHorizontalAlign" data-param1="'+val+'" title="'+this.language.translate(options[val])+'">'+this.icon.create("align-"+val)+'<span class="fr-sr-only">'+this.language.translate(options[val])+"</span></a></li>");return c+="</ul>"},callback:function(cmd,val){this.table.horizontalAlign(val)},refresh:function($btn){var selected_cells=this.table.selectedCells();selected_cells.length&&$btn.find("> *:first").replaceWith(this.icon.create("align-"+this.helpers.getAlignment($(selected_cells[0]))))},refreshOnShow:function($btn,$dropdown){$dropdown.find('.fr-command[data-param1="'+this.helpers.getAlignment(this.$el.find(".fr-selected-cell:first"))+'"]').addClass("fr-active").attr("aria-selected",!0)}}),$.FE.DefineIcon("tableCellStyle",{NAME:"magic"}),$.FE.RegisterCommand("tableCellStyle",{title:"Cell Style",type:"dropdown",focus:!1,html:function(){var c='<ul class="fr-dropdown-list" role="presentation">',options=this.opts.tableCellStyles;for(var val in options)options.hasOwnProperty(val)&&(c+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableCellStyle" data-param1="'+val+'" title="'+this.language.translate(options[val])+'">'+this.language.translate(options[val])+"</a></li>");return c+="</ul>"},callback:function(cmd,val){this.table.applyStyle(val,this.$el.find(".fr-selected-cell"),this.opts.tableCellMultipleStyles,this.opts.tableCellStyles)},refreshOnShow:function($btn,$dropdown){var $cell=this.$el.find(".fr-selected-cell:first");$cell&&$dropdown.find(".fr-command").each((function(){var cls=$(this).data("param1"),active=$cell.hasClass(cls);$(this).toggleClass("fr-active",active).attr("aria-selected",active)}))}}),$.FE.RegisterCommand("tableCellBackgroundCustomColor",{title:"OK",undo:!0,callback:function(){this.table.customColor()}}),$.FE.DefineIcon("tableColorRemove",{NAME:"eraser"})}(jQuery),function($){"use strict";$.extend($.FE.POPUP_TEMPLATES,{"video.insert":"[_BUTTONS_][_BY_URL_LAYER_][_EMBED_LAYER_]","video.edit":"[_BUTTONS_]","video.size":"[_BUTTONS_][_SIZE_LAYER_]"}),$.extend($.FE.DEFAULTS,{videoInsertButtons:["videoBack","|","videoByURL","videoEmbed"],videoEditButtons:["videoDisplay","videoAlign","videoSize","videoRemove"],videoResize:!0,videoSizeButtons:["videoBack","|"],videoSplitHTML:!1,videoTextNear:!0,videoDefaultAlign:"center",videoDefaultDisplay:"block",videoMove:!0}),$.FE.VIDEO_PROVIDERS=[{test_regex:/^.*((youtu.be)|(youtube.com))\/((v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))?\??v?=?([^#\&\?]*).*/,url_regex:/(?:https?:\/\/)?(?:www\.)?(?:m\.)?(?:youtube\.com|youtu\.be)\/(?:watch\?v=|embed\/)?([0-9a-zA-Z_\-]+)(.+)?/g,url_text:"//www.youtube.com/embed/$1",html:'<iframe width="640" height="360" src="{url}?wmode=opaque" frameborder="0" allowfullscreen></iframe>'},{test_regex:/^.*(vimeo\.com\/)((channels\/[A-z]+\/)|(groups\/[A-z]+\/videos\/))?([0-9]+)/,url_regex:/(?:https?:\/\/)?(?:www\.)?(?:vimeo\.com)\/(?:channels\/[A-z]+\/|groups\/[A-z]+\/videos\/)?(.+)/g,url_text:"//player.vimeo.com/video/$1",html:'<iframe width="640" height="360" src="{url}" frameborder="0" allowfullscreen></iframe>'},{test_regex:/^.+(dailymotion.com|dai.ly)\/(video|hub)?\/?([^_]+)[^#]*(#video=([^_&]+))?/,url_regex:/(?:https?:\/\/)?(?:www\.)?(?:dailymotion\.com|dai\.ly)\/(?:video|hub)?\/?(.+)/g,url_text:"//www.dailymotion.com/embed/video/$1",html:'<iframe width="640" height="360" src="{url}" frameborder="0" allowfullscreen></iframe>'},{test_regex:/^.+(screen.yahoo.com)\/[^_&]+/,url_regex:"",url_text:"",html:'<iframe width="640" height="360" src="{url}?format=embed" frameborder="0" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true" allowtransparency="true"></iframe>'},{test_regex:/^.+(rutube.ru)\/[^_&]+/,url_regex:/(?:https?:\/\/)?(?:www\.)?(?:rutube\.ru)\/(?:video)?\/?(.+)/g,url_text:"//rutube.ru/play/embed/$1",html:'<iframe width="640" height="360" src="{url}" frameborder="0" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true" allowtransparency="true"></iframe>'}],$.FE.VIDEO_EMBED_REGEX=/^\W*((<iframe.*><\/iframe>)|(<embed.*>))\W*$/i,$.FE.PLUGINS.video=function(editor){var $overlay,$handler,$video_resizer,$current_video,touchScroll;function _refreshInsertPopup(){var $popup=editor.popups.get("video.insert");$popup.find(".fr-video-by-url-layer input").val("").trigger("change"),$popup.find(".fr-video-embed-layer textarea").val("").trigger("change")}function _showEditPopup(){var $popup=editor.popups.get("video.edit");$popup||($popup=function(){var video_buttons="";editor.opts.videoEditButtons.length>=1&&(video_buttons+='<div class="fr-buttons">',video_buttons+=editor.button.buildList(editor.opts.videoEditButtons),video_buttons+="</div>");var template={buttons:video_buttons},$popup=editor.popups.create("video.edit",template);return editor.events.$on(editor.$wp,"scroll.video-edit",(function(){$current_video&&editor.popups.isVisible("video.edit")&&_showEditPopup()})),$popup}()),editor.popups.setContainer("video.edit",$(editor.opts.scrollableContainer)),editor.popups.refresh("video.edit");var $video_obj=$current_video.find("iframe, embed, video"),left=$video_obj.offset().left+$video_obj.outerWidth()/2,top=$video_obj.offset().top+$video_obj.outerHeight();editor.popups.show("video.edit",left,top,$video_obj.outerHeight())}function _initInsertPopup(delayed){if(delayed)return editor.popups.onRefresh("video.insert",_refreshInsertPopup),!0;var video_buttons="";editor.opts.videoInsertButtons.length>1&&(video_buttons='<div class="fr-buttons">'+editor.button.buildList(editor.opts.videoInsertButtons)+"</div>");var by_url_layer="";editor.opts.videoInsertButtons.indexOf("videoByURL")>=0&&(by_url_layer='<div class="fr-video-by-url-layer fr-layer fr-active" id="fr-video-by-url-layer-'+editor.id+'"><div class="fr-input-line"><input type="text" placeholder="http://" tabIndex="1"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="videoInsertByURL" tabIndex="2">'+editor.language.translate("Insert")+"</button></div></div>");var embed_layer="";editor.opts.videoInsertButtons.indexOf("videoEmbed")>=0&&(embed_layer='<div class="fr-video-embed-layer fr-layer" id="fr-video-embed-layer-'+editor.id+'"><div class="fr-input-line"><textarea type="text" placeholder="'+editor.language.translate("Embedded Code")+'" tabIndex="1" rows="5"></textarea></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="videoInsertEmbed" tabIndex="2">'+editor.language.translate("Insert")+"</button></div></div>");var template={buttons:video_buttons,by_url_layer:by_url_layer,embed_layer:embed_layer};return editor.popups.create("video.insert",template)}function insert(embedded_code){editor.events.focus(!0),editor.selection.restore(),editor.html.insert('<span contenteditable="false" draggable="true" class="fr-jiv fr-video fr-dv'+editor.opts.videoDefaultDisplay[0]+("center"!=editor.opts.videoDefaultAlign?" fr-fv"+editor.opts.videoDefaultAlign[0]:"")+'">'+embedded_code+"</span>",!1,editor.opts.videoSplitHTML),editor.popups.hide("video.insert");var $video=editor.$el.find(".fr-jiv");$video.removeClass("fr-jiv"),$video.toggleClass("fr-draggable",editor.opts.videoMove),editor.events.trigger("video.inserted",[$video])}function _handlerMousedown(e){if(!editor.core.sameInstance($video_resizer))return!0;e.preventDefault(),e.stopPropagation();var c_x=e.pageX||(e.originalEvent.touches?e.originalEvent.touches[0].pageX:null),c_y=e.pageY||(e.originalEvent.touches?e.originalEvent.touches[0].pageY:null);if(!c_x||!c_y)return!1;editor.undo.canDo()||editor.undo.saveStep(),($handler=$(this)).data("start-x",c_x),$handler.data("start-y",c_y),$overlay.show(),editor.popups.hideAll(),_unmarkExit()}function _handlerMousemove(e){if(!editor.core.sameInstance($video_resizer))return!0;if($handler){e.preventDefault();var c_x=e.pageX||(e.originalEvent.touches?e.originalEvent.touches[0].pageX:null),c_y=e.pageY||(e.originalEvent.touches?e.originalEvent.touches[0].pageY:null);if(!c_x||!c_y)return!1;var s_x=$handler.data("start-x"),s_y=$handler.data("start-y");$handler.data("start-x",c_x),$handler.data("start-y",c_y);var diff_x=c_x-s_x,diff_y=c_y-s_y,$video_obj=$current_video.find("iframe, embed, video"),width=$video_obj.width(),height=$video_obj.height();($handler.hasClass("fr-hnw")||$handler.hasClass("fr-hsw"))&&(diff_x=0-diff_x),($handler.hasClass("fr-hnw")||$handler.hasClass("fr-hne"))&&(diff_y=0-diff_y),$video_obj.css("width",width+diff_x),$video_obj.css("height",height+diff_y),$video_obj.removeAttr("width"),$video_obj.removeAttr("height"),_repositionResizer()}}function _handlerMouseup(e){if(!editor.core.sameInstance($video_resizer))return!0;$handler&&$current_video&&(e&&e.stopPropagation(),$handler=null,$overlay.hide(),_repositionResizer(),_showEditPopup(),editor.undo.saveStep())}function _getHandler(pos){return'<div class="fr-handler fr-h'+pos+'"></div>'}function _repositionResizer(){var doc;$video_resizer||(editor.shared.$video_resizer?($video_resizer=editor.shared.$video_resizer,$overlay=editor.shared.$vid_overlay,editor.events.on("destroy",(function(){$video_resizer.removeClass("fr-active").appendTo($("body"))}),!0)):(editor.shared.$video_resizer=$('<div class="fr-video-resizer"></div>'),$video_resizer=editor.shared.$video_resizer,editor.events.$on($video_resizer,"mousedown",(function(e){e.stopPropagation()}),!0),editor.opts.videoResize&&($video_resizer.append(_getHandler("nw")+_getHandler("ne")+_getHandler("sw")+_getHandler("se")),editor.shared.$vid_overlay=$('<div class="fr-video-overlay"></div>'),$overlay=editor.shared.$vid_overlay,doc=$video_resizer.get(0).ownerDocument,$(doc).find("body").append($overlay))),editor.events.on("shared.destroy",(function(){$video_resizer.html("").removeData().remove(),$video_resizer=null,editor.opts.videoResize&&($overlay.remove(),$overlay=null)}),!0),editor.helpers.isMobile()||editor.events.$on($(editor.o_win),"resize.video",(function(){_exitEdit(!0)})),editor.opts.videoResize&&(doc=$video_resizer.get(0).ownerDocument,editor.events.$on($video_resizer,editor._mousedown,".fr-handler",_handlerMousedown),editor.events.$on($(doc),editor._mousemove,_handlerMousemove),editor.events.$on($(doc.defaultView||doc.parentWindow),editor._mouseup,_handlerMouseup),editor.events.$on($overlay,"mouseleave",_handlerMouseup))),(editor.$wp||$(editor.opts.scrollableContainer)).append($video_resizer),$video_resizer.data("instance",editor);var $video_obj=$current_video.find("iframe, embed, video");$video_resizer.css("top",(editor.opts.iframe?$video_obj.offset().top-1:$video_obj.offset().top-editor.$wp.offset().top-1)+editor.$wp.scrollTop()).css("left",(editor.opts.iframe?$video_obj.offset().left-1:$video_obj.offset().left-editor.$wp.offset().left-1)+editor.$wp.scrollLeft()).css("width",$video_obj.outerWidth()).css("height",$video_obj.height()).addClass("fr-active")}function _edit(e){if(e&&"touchend"==e.type&&touchScroll)return!0;if(e.preventDefault(),e.stopPropagation(),editor.edit.isDisabled())return!1;for(var i=0;i<$.FE.INSTANCES.length;i++)$.FE.INSTANCES[i]!=editor&&$.FE.INSTANCES[i].events.trigger("video.hideResizer");editor.toolbar.disable(),editor.helpers.isMobile()&&(editor.events.disableBlur(),editor.$el.blur(),editor.events.enableBlur()),$current_video=$(this),$(this).addClass("fr-active"),editor.opts.iframe&&editor.size.syncIframe(),_repositionResizer(),_showEditPopup(),editor.selection.clear(),editor.button.bulkRefresh(),editor.events.trigger("image.hideResizer")}function _exitEdit(force_exit){$current_video&&(editor.shared.vid_exit_flag||!0===force_exit)&&($video_resizer.removeClass("fr-active"),editor.toolbar.enable(),$current_video.removeClass("fr-active"),$current_video=null,_unmarkExit())}function _markExit(){editor.shared.vid_exit_flag=!0}function _unmarkExit(){editor.shared.vid_exit_flag=!1}function _refreshSizePopup(){if($current_video){var $popup=editor.popups.get("video.size"),$video_obj=$current_video.find("iframe, embed, video");$popup.find('input[name="width"]').val($video_obj.get(0).style.width||$video_obj.attr("width")).trigger("change"),$popup.find('input[name="height"]').val($video_obj.get(0).style.height||$video_obj.attr("height")).trigger("change")}}function showSizePopup(){var $popup=editor.popups.get("video.size");$popup||($popup=_initSizePopup()),editor.popups.refresh("video.size"),editor.popups.setContainer("video.size",$(editor.opts.scrollableContainer));var $video_obj=$current_video.find("iframe, embed, video"),left=$video_obj.offset().left+$video_obj.width()/2,top=$video_obj.offset().top+$video_obj.height();editor.popups.show("video.size",left,top,$video_obj.height())}function _initSizePopup(delayed){if(delayed)return editor.popups.onRefresh("video.size",_refreshSizePopup),!0;var template={buttons:'<div class="fr-buttons">'+editor.button.buildList(editor.opts.videoSizeButtons)+"</div>",size_layer:'<div class="fr-video-size-layer fr-layer fr-active" id="fr-video-size-layer-'+editor.id+'"><div class="fr-video-group"><div class="fr-input-line"><input type="text" name="width" placeholder="'+editor.language.translate("Width")+'" tabIndex="1"></div><div class="fr-input-line"><input type="text" name="height" placeholder="'+editor.language.translate("Height")+'" tabIndex="1"></div></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="videoSetSize" tabIndex="2">'+editor.language.translate("Update")+"</button></div></div>"},$popup=editor.popups.create("video.size",template);return editor.events.$on(editor.$wp,"scroll",(function(){$current_video&&editor.popups.isVisible("video.size")&&showSizePopup()})),$popup}function remove(){if($current_video&&!1!==editor.events.trigger("video.beforeRemove",[$current_video])){var $video=$current_video;editor.popups.hideAll(),_exitEdit(!0),editor.selection.setBefore($video.get(0))||editor.selection.setAfter($video.get(0)),$video.remove(),editor.selection.restore(),editor.html.fillEmptyBlocks(),editor.events.trigger("video.removed",[$video])}}function _convertStyleToClasses($video){if(!$video.hasClass("fr-dvi")&&!$video.hasClass("fr-dvb")){var flt=$video.css("float");$video.css("float","none"),"block"==$video.css("display")?($video.css("float",flt),0===parseInt($video.css("margin-left"),10)&&($video.attr("style")||"").indexOf("margin-right: auto")>=0?$video.addClass("fr-fvl"):0===parseInt($video.css("margin-right"),10)&&($video.attr("style")||"").indexOf("margin-left: auto")>=0&&$video.addClass("fr-fvr"),$video.addClass("fr-dvb")):($video.css("float",flt),"left"==$video.css("float")?$video.addClass("fr-fvl"):"right"==$video.css("float")&&$video.addClass("fr-fvr"),$video.addClass("fr-dvi")),$video.css("margin",""),$video.css("float",""),$video.css("display",""),$video.css("z-index",""),$video.css("position",""),$video.css("overflow",""),$video.css("vertical-align","")}editor.opts.videoTextNear||$video.removeClass("fr-dvi").addClass("fr-dvb")}function _refreshVideoList(){editor.$el.find("video").filter((function(){return 0===$(this).parents("span.fr-video").length})).wrap('<span class="fr-video" contenteditable="false"></span>'),editor.$el.find("embed, iframe").filter((function(){if(editor.browser.safari&&this.getAttribute("src")&&this.setAttribute("src",this.src),$(this).parents("span.fr-video").length>0)return!1;for(var link=$(this).attr("src"),i=0;i<$.FE.VIDEO_PROVIDERS.length;i++){if($.FE.VIDEO_PROVIDERS[i].test_regex.test(link))return!0}return!1})).map((function(){return 0===$(this).parents("object").length?this:$(this).parents("object").get(0)})).wrap('<span class="fr-video" contenteditable="false"></span>');for(var videos=editor.$el.find("span.fr-video"),i=0;i<videos.length;i++)_convertStyleToClasses($(videos[i]));videos.toggleClass("fr-draggable",editor.opts.videoMove)}return editor.shared.vid_exit_flag=!1,{_init:function(){editor.events.on("mousedown window.mousedown",_markExit),editor.events.on("window.touchmove",_unmarkExit),editor.events.on("mouseup window.mouseup",_exitEdit),editor.events.on("commands.mousedown",(function($btn){$btn.parents(".fr-toolbar").length>0&&_exitEdit()})),editor.events.on("blur video.hideResizer commands.undo commands.redo element.dropped",(function(){_exitEdit(!0)})),editor.helpers.isMobile()&&(editor.events.$on(editor.$el,"touchstart","span.fr-video",(function(){touchScroll=!1})),editor.events.$on(editor.$el,"touchmove",(function(){touchScroll=!0}))),editor.events.on("html.set",_refreshVideoList),_refreshVideoList(),editor.events.$on(editor.$el,"mousedown","span.fr-video",(function(e){e.stopPropagation()})),editor.events.$on(editor.$el,"click touchend","span.fr-video",_edit),editor.events.on("keydown",(function(e){var key_code=e.which;return!$current_video||key_code!=$.FE.KEYCODE.BACKSPACE&&key_code!=$.FE.KEYCODE.DELETE?$current_video&&key_code==$.FE.KEYCODE.ESC?(_exitEdit(!0),e.preventDefault(),!1):$current_video&&!editor.keys.ctrlKey(e)?(e.preventDefault(),!1):void 0:(e.preventDefault(),remove(),!1)}),!0),editor.events.on("keydown",(function(){editor.$el.find("span.fr-video:empty").remove()})),_initInsertPopup(!0),_initSizePopup(!0)},showInsertPopup:function(){var $btn=editor.$tb.find('.fr-command[data-cmd="insertVideo"]'),$popup=editor.popups.get("video.insert");if($popup||($popup=_initInsertPopup()),!$popup.hasClass("fr-active")){editor.popups.refresh("video.insert"),editor.popups.setContainer("video.insert",editor.$tb);var left=$btn.offset().left+$btn.outerWidth()/2,top=$btn.offset().top+(editor.opts.toolbarBottom?10:$btn.outerHeight()-10);editor.popups.show("video.insert",left,top,$btn.outerHeight())}},showLayer:function(name){var left,top,$popup=editor.popups.get("video.insert");if(!$current_video&&!editor.opts.toolbarInline){var $btn=editor.$tb.find('.fr-command[data-cmd="insertVideo"]');left=$btn.offset().left+$btn.outerWidth()/2,top=$btn.offset().top+(editor.opts.toolbarBottom?10:$btn.outerHeight()-10)}editor.opts.toolbarInline&&(top=$popup.offset().top-editor.helpers.getPX($popup.css("margin-top")),$popup.hasClass("fr-above")&&(top+=$popup.outerHeight())),$popup.find(".fr-layer").removeClass("fr-active"),$popup.find(".fr-"+name+"-layer").addClass("fr-active"),editor.popups.show("video.insert",left,top,0)},refreshByURLButton:function($btn){editor.popups.get("video.insert").find(".fr-video-by-url-layer").hasClass("fr-active")&&$btn.addClass("fr-active")},refreshEmbedButton:function($btn){editor.popups.get("video.insert").find(".fr-video-embed-layer").hasClass("fr-active")&&$btn.addClass("fr-active")},insertByURL:function(link){void 0===link&&(link=editor.popups.get("video.insert").find('.fr-video-by-url-layer input[type="text"]').val()||"");var video=null;if(editor.helpers.isURL(link))for(var i=0;i<$.FE.VIDEO_PROVIDERS.length;i++){var vp=$.FE.VIDEO_PROVIDERS[i];if(vp.test_regex.test(link)){video=link.replace(vp.url_regex,vp.url_text),video=vp.html.replace(/\{url\}/,video);break}}video?insert(video):editor.events.trigger("video.linkError",[link])},insertEmbed:function(code){void 0===code&&(code=editor.popups.get("video.insert").find(".fr-video-embed-layer textarea").val()||""),0!==code.length&&$.FE.VIDEO_EMBED_REGEX.test(code)?insert(code):editor.events.trigger("video.codeError",[code])},insert:insert,align:function(val){$current_video.removeClass("fr-fvr fr-fvl"),"left"==val?$current_video.addClass("fr-fvl"):"right"==val&&$current_video.addClass("fr-fvr"),_repositionResizer(),_showEditPopup()},refreshAlign:function($btn){if(!$current_video)return!1;$current_video.hasClass("fr-fvl")?$btn.find("> *:first").replaceWith(editor.icon.create("align-left")):$current_video.hasClass("fr-fvr")?$btn.find("> *:first").replaceWith(editor.icon.create("align-right")):$btn.find("> *:first").replaceWith(editor.icon.create("align-justify"))},refreshAlignOnShow:function($btn,$dropdown){var alignment="justify";$current_video.hasClass("fr-fvl")?alignment="left":$current_video.hasClass("fr-fvr")&&(alignment="right"),$dropdown.find('.fr-command[data-param1="'+alignment+'"]').addClass("fr-active")},display:function(val){$current_video.removeClass("fr-dvi fr-dvb"),"inline"==val?$current_video.addClass("fr-dvi"):"block"==val&&$current_video.addClass("fr-dvb"),_repositionResizer(),_showEditPopup()},refreshDisplayOnShow:function($btn,$dropdown){var d="block";$current_video.hasClass("fr-dvi")&&(d="inline"),$dropdown.find('.fr-command[data-param1="'+d+'"]').addClass("fr-active")},remove:remove,showSizePopup:showSizePopup,back:function(){$current_video?$current_video.trigger("click"):(editor.events.disableBlur(),editor.selection.restore(),editor.events.enableBlur(),editor.popups.hide("video.insert"),editor.toolbar.showInline())},setSize:function(width,height){if($current_video){var $popup=editor.popups.get("video.size"),$video_obj=$current_video.find("iframe, embed, video");$video_obj.css("width",width||$popup.find('input[name="width"]').val()),$video_obj.css("height",height||$popup.find('input[name="height"]').val()),$video_obj.get(0).style.width&&$video_obj.removeAttr("width"),$video_obj.get(0).style.height&&$video_obj.removeAttr("height"),$popup.find("input").blur(),setTimeout((function(){$current_video.trigger("click")}),editor.helpers.isAndroid()?50:0)}},get:function(){return $current_video}}},$.FE.RegisterCommand("insertVideo",{title:"Insert Video",undo:!1,focus:!0,refreshAfterCallback:!1,popup:!0,callback:function(){this.popups.isVisible("video.insert")?(this.$el.find(".fr-marker")&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("video.insert")):this.video.showInsertPopup()},plugin:"video"}),$.FE.DefineIcon("insertVideo",{NAME:"video-camera"}),$.FE.DefineIcon("videoByURL",{NAME:"link"}),$.FE.RegisterCommand("videoByURL",{title:"By URL",undo:!1,focus:!1,callback:function(){this.video.showLayer("video-by-url")},refresh:function($btn){this.video.refreshByURLButton($btn)}}),$.FE.DefineIcon("videoEmbed",{NAME:"code"}),$.FE.RegisterCommand("videoEmbed",{title:"Embedded Code",undo:!1,focus:!1,callback:function(){this.video.showLayer("video-embed")},refresh:function($btn){this.video.refreshEmbedButton($btn)}}),$.FE.RegisterCommand("videoInsertByURL",{undo:!0,focus:!0,callback:function(){this.video.insertByURL()}}),$.FE.RegisterCommand("videoInsertEmbed",{undo:!0,focus:!0,callback:function(){this.video.insertEmbed()}}),$.FE.DefineIcon("videoDisplay",{NAME:"star"}),$.FE.RegisterCommand("videoDisplay",{title:"Display",type:"dropdown",options:{inline:"Inline",block:"Break Text"},callback:function(cmd,val){this.video.display(val)},refresh:function($btn){this.opts.videoTextNear||$btn.addClass("fr-hidden")},refreshOnShow:function($btn,$dropdown){this.video.refreshDisplayOnShow($btn,$dropdown)}}),$.FE.DefineIcon("videoAlign",{NAME:"align-center"}),$.FE.RegisterCommand("videoAlign",{type:"dropdown",title:"Align",options:{left:"Align Left",justify:"None",right:"Align Right"},html:function(){var c='<ul class="fr-dropdown-list">',options=$.FE.COMMANDS.videoAlign.options;for(var val in options)options.hasOwnProperty(val)&&(c+='<li><a class="fr-command fr-title" data-cmd="videoAlign" data-param1="'+val+'" title="'+this.language.translate(options[val])+'">'+this.icon.create("align-"+val)+"</a></li>");return c+="</ul>"},callback:function(cmd,val){this.video.align(val)},refresh:function($btn){this.video.refreshAlign($btn)},refreshOnShow:function($btn,$dropdown){this.video.refreshAlignOnShow($btn,$dropdown)}}),$.FE.DefineIcon("videoRemove",{NAME:"trash"}),$.FE.RegisterCommand("videoRemove",{title:"Remove",callback:function(){this.video.remove()}}),$.FE.DefineIcon("videoSize",{NAME:"arrows-alt"}),$.FE.RegisterCommand("videoSize",{undo:!1,focus:!1,title:"Change Size",callback:function(){this.video.showSizePopup()}}),$.FE.DefineIcon("videoBack",{NAME:"arrow-left"}),$.FE.RegisterCommand("videoBack",{title:"Back",undo:!1,focus:!1,back:!0,callback:function(){this.video.back()},refresh:function($btn){this.video.get()||this.opts.toolbarInline?($btn.removeClass("fr-hidden"),$btn.next(".fr-separator").removeClass("fr-hidden")):($btn.addClass("fr-hidden"),$btn.next(".fr-separator").addClass("fr-hidden"))}}),$.FE.RegisterCommand("videoSetSize",{undo:!0,focus:!1,callback:function(){this.video.setSize()}})}(jQuery),function($){"use strict";$.extend($.FE.POPUP_TEMPLATES,{"audio.insert":"[_BUTTONS_][_BY_URL_LAYER_][_EMBED_LAYER_]","audio.edit":"[_BUTTONS_]","audio.size":"[_BUTTONS_][_SIZE_LAYER_]"}),$.extend($.FE.DEFAULTS,{audioInsertButtons:["audioBack","|","audioByURL","audioEmbed"],audioEditButtons:["audioDisplay","audioAlign","audioSize","audioRemove"],audioResize:!0,audioSizeButtons:["audioBack","|"],audioSplitHTML:!1,audioTextNear:!0,audioDefaultAlign:"center",audioDefaultDisplay:"block",audioMove:!0}),$.FE.VIDEO_PROVIDERS=[],$.FE.VIDEO_EMBED_REGEX=/^\W*((<iframe.*><\/iframe>)|(<embed.*>))\W*$/i,$.FE.PLUGINS.audio=function(editor){var $overlay,$handler,$audio_resizer,$current_audio,touchScroll;function _refreshInsertPopup(){var $popup=editor.popups.get("audio.insert");$popup.find(".fr-audio-by-url-layer input").val("").trigger("change"),$popup.find(".fr-audio-embed-layer textarea").val("").trigger("change")}function _showEditPopup(){var $popup=editor.popups.get("audio.edit");$popup||($popup=function(){var audio_buttons="";editor.opts.audioEditButtons.length>=1&&(audio_buttons+='<div class="fr-buttons">',audio_buttons+=editor.button.buildList(editor.opts.audioEditButtons),audio_buttons+="</div>");var template={buttons:audio_buttons},$popup=editor.popups.create("audio.edit",template);return editor.events.$on(editor.$wp,"scroll.audio-edit",(function(){$current_audio&&editor.popups.isVisible("audio.edit")&&_showEditPopup()})),$popup}()),editor.popups.setContainer("audio.edit",$(editor.opts.scrollableContainer)),editor.popups.refresh("audio.edit");var $audio_obj=$current_audio.find("iframe, embed, audio"),left=$audio_obj.offset().left+$audio_obj.outerWidth()/2,top=$audio_obj.offset().top+$audio_obj.outerHeight();editor.popups.show("audio.edit",left,top,$audio_obj.outerHeight())}function _initInsertPopup(delayed){if(delayed)return editor.popups.onRefresh("audio.insert",_refreshInsertPopup),!0;var audio_buttons="";editor.opts.audioInsertButtons.length>1&&(audio_buttons='<div class="fr-buttons">'+editor.button.buildList(editor.opts.audioInsertButtons)+"</div>");var by_url_layer="";editor.opts.audioInsertButtons.indexOf("audioByURL")>=0&&(by_url_layer='<div class="fr-audio-by-url-layer fr-layer fr-active" id="fr-audio-by-url-layer-'+editor.id+'"><div class="fr-input-line"><input type="text" placeholder="http://" tabIndex="1"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="audioInsertByURL" tabIndex="2">'+editor.language.translate("Insert")+"</button></div></div>");var embed_layer="";editor.opts.audioInsertButtons.indexOf("audioEmbed")>=0&&(embed_layer='<div class="fr-audio-embed-layer fr-layer" id="fr-audio-embed-layer-'+editor.id+'"><div class="fr-input-line"><textarea type="text" placeholder="'+editor.language.translate("Embedded Code")+'" tabIndex="1" rows="5"></textarea></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="audioInsertEmbed" tabIndex="2">'+editor.language.translate("Insert")+"</button></div></div>");var template={buttons:audio_buttons,by_url_layer:by_url_layer,embed_layer:embed_layer};return editor.popups.create("audio.insert",template)}function insert(embedded_code){editor.events.focus(!0),editor.selection.restore(),editor.html.insert('<span contenteditable="false" draggable="true" class="fr-jiv fr-video fr-dv'+editor.opts.audioDefaultDisplay[0]+("center"!=editor.opts.audioDefaultAlign?" fr-fv"+editor.opts.audioDefaultAlign[0]:"")+'">'+embedded_code+"</span>",!1,editor.opts.audioSplitHTML),editor.popups.hide("audio.insert");var $audio=editor.$el.find(".fr-jiv");$audio.removeClass("fr-jiv"),$audio.toggleClass("fr-draggable",editor.opts.audioMove),editor.events.trigger("audio.inserted",[$audio])}function _handlerMousedown(e){if(!editor.core.sameInstance($audio_resizer))return!0;e.preventDefault(),e.stopPropagation();var c_x=e.pageX||(e.originalEvent.touches?e.originalEvent.touches[0].pageX:null),c_y=e.pageY||(e.originalEvent.touches?e.originalEvent.touches[0].pageY:null);if(!c_x||!c_y)return!1;editor.undo.canDo()||editor.undo.saveStep(),($handler=$(this)).data("start-x",c_x),$handler.data("start-y",c_y),$overlay.show(),editor.popups.hideAll(),_unmarkExit()}function _handlerMousemove(e){if(!editor.core.sameInstance($audio_resizer))return!0;if($handler){e.preventDefault();var c_x=e.pageX||(e.originalEvent.touches?e.originalEvent.touches[0].pageX:null),c_y=e.pageY||(e.originalEvent.touches?e.originalEvent.touches[0].pageY:null);if(!c_x||!c_y)return!1;var s_x=$handler.data("start-x"),s_y=$handler.data("start-y");$handler.data("start-x",c_x),$handler.data("start-y",c_y);var diff_x=c_x-s_x,diff_y=c_y-s_y,$audio_obj=$current_audio.find("iframe, embed, audio"),width=$audio_obj.width(),height=$audio_obj.height();($handler.hasClass("fr-hnw")||$handler.hasClass("fr-hsw"))&&(diff_x=0-diff_x),($handler.hasClass("fr-hnw")||$handler.hasClass("fr-hne"))&&(diff_y=0-diff_y),$audio_obj.css("width",width+diff_x),$audio_obj.css("height",height+diff_y),$audio_obj.removeAttr("width"),$audio_obj.removeAttr("height"),_repositionResizer()}}function _handlerMouseup(e){if(!editor.core.sameInstance($audio_resizer))return!0;$handler&&$current_audio&&(e&&e.stopPropagation(),$handler=null,$overlay.hide(),_repositionResizer(),_showEditPopup(),editor.undo.saveStep())}function _getHandler(pos){return'<div class="fr-handler fr-h'+pos+'"></div>'}function _repositionResizer(){var doc;$audio_resizer||(editor.shared.$audio_resizer?($audio_resizer=editor.shared.$audio_resizer,$overlay=editor.shared.$audio_overlay,editor.events.on("destroy",(function(){$audio_resizer.removeClass("fr-active").appendTo($("body"))}),!0)):(editor.shared.$audio_resizer=$('<div class="fr-video-resizer"></div>'),$audio_resizer=editor.shared.$audio_resizer,editor.events.$on($audio_resizer,"mousedown",(function(e){e.stopPropagation()}),!0),editor.opts.audioResize&&($audio_resizer.append(_getHandler("nw")+_getHandler("ne")+_getHandler("sw")+_getHandler("se")),editor.shared.$audio_overlay=$('<div class="fr-video-overlay"></div>'),$overlay=editor.shared.$audio_overlay,doc=$audio_resizer.get(0).ownerDocument,$(doc).find("body").append($overlay))),editor.events.on("shared.destroy",(function(){$audio_resizer.html("").removeData().remove(),$audio_resizer=null,editor.opts.audioResize&&($overlay.remove(),$overlay=null)}),!0),editor.helpers.isMobile()||editor.events.$on($(editor.o_win),"resize.audio",(function(){_exitEdit(!0)})),editor.opts.audioResize&&(doc=$audio_resizer.get(0).ownerDocument,editor.events.$on($audio_resizer,editor._mousedown,".fr-handler",_handlerMousedown),editor.events.$on($(doc),editor._mousemove,_handlerMousemove),editor.events.$on($(doc.defaultView||doc.parentWindow),editor._mouseup,_handlerMouseup),editor.events.$on($overlay,"mouseleave",_handlerMouseup))),(editor.$wp||$(editor.opts.scrollableContainer)).append($audio_resizer),$audio_resizer.data("instance",editor);var $audio_obj=$current_audio.find("iframe, embed, audio");$audio_resizer.css("top",(editor.opts.iframe?$audio_obj.offset().top-1:$audio_obj.offset().top-editor.$wp.offset().top-1)+editor.$wp.scrollTop()).css("left",(editor.opts.iframe?$audio_obj.offset().left-1:$audio_obj.offset().left-editor.$wp.offset().left-1)+editor.$wp.scrollLeft()).css("width",$audio_obj.outerWidth()).css("height",$audio_obj.height()).addClass("fr-active")}function _edit(e){if(e&&"touchend"==e.type&&touchScroll)return!0;if(e.preventDefault(),e.stopPropagation(),editor.edit.isDisabled())return!1;for(var i=0;i<$.FE.INSTANCES.length;i++)$.FE.INSTANCES[i]!=editor&&$.FE.INSTANCES[i].events.trigger("audio.hideResizer");editor.toolbar.disable(),editor.helpers.isMobile()&&(editor.events.disableBlur(),editor.$el.blur(),editor.events.enableBlur()),$current_audio=$(this),$(this).addClass("fr-active"),editor.opts.iframe&&editor.size.syncIframe(),_repositionResizer(),_showEditPopup(),editor.selection.clear(),editor.button.bulkRefresh(),editor.events.trigger("image.hideResizer")}function _exitEdit(force_exit){$current_audio&&(editor.shared.audio_exit_flag||!0===force_exit)&&($audio_resizer.removeClass("fr-active"),editor.toolbar.enable(),$current_audio.removeClass("fr-active"),$current_audio=null,_unmarkExit())}function _markExit(){editor.shared.audio_exit_flag=!0}function _unmarkExit(){editor.shared.audio_exit_flag=!1}function _refreshSizePopup(){if($current_audio){var $popup=editor.popups.get("audio.size"),$audio_obj=$current_audio.find("iframe, embed, audio");$popup.find('input[name="width"]').val($audio_obj.get(0).style.width||$audio_obj.attr("width")).trigger("change"),$popup.find('input[name="height"]').val($audio_obj.get(0).style.height||$audio_obj.attr("height")).trigger("change")}}function showSizePopup(){var $popup=editor.popups.get("audio.size");$popup||($popup=_initSizePopup()),editor.popups.refresh("audio.size"),editor.popups.setContainer("audio.size",$(editor.opts.scrollableContainer));var $audio_obj=$current_audio.find("iframe, embed, audio"),left=$audio_obj.offset().left+$audio_obj.width()/2,top=$audio_obj.offset().top+$audio_obj.height();editor.popups.show("audio.size",left,top,$audio_obj.height())}function _initSizePopup(delayed){if(delayed)return editor.popups.onRefresh("audio.size",_refreshSizePopup),!0;var template={buttons:'<div class="fr-buttons">'+editor.button.buildList(editor.opts.audioSizeButtons)+"</div>",size_layer:'<div class="fr-video-size-layer fr-layer fr-active" id="fr-video-size-layer-'+editor.id+'"><div class="fr-audio-group"><div class="fr-input-line"><input type="text" name="width" placeholder="'+editor.language.translate("Width")+'" tabIndex="1"></div><div class="fr-input-line"><input type="text" name="height" placeholder="'+editor.language.translate("Height")+'" tabIndex="1"></div></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="audioSetSize" tabIndex="2">'+editor.language.translate("Update")+"</button></div></div>"},$popup=editor.popups.create("audio.size",template);return editor.events.$on(editor.$wp,"scroll",(function(){$current_audio&&editor.popups.isVisible("audio.size")&&showSizePopup()})),$popup}function remove(){if($current_audio&&!1!==editor.events.trigger("audio.beforeRemove",[$current_audio])){var $audio=$current_audio;editor.popups.hideAll(),_exitEdit(!0),editor.selection.setBefore($audio.get(0))||editor.selection.setAfter($audio.get(0)),$audio.remove(),editor.selection.restore(),editor.html.fillEmptyBlocks(),editor.events.trigger("audio.removed",[$audio])}}function _convertStyleToClasses($audio){if(!$audio.hasClass("fr-dvi")&&!$audio.hasClass("fr-dvb")){var flt=$audio.css("float");$audio.css("float","none"),"block"==$audio.css("display")?($audio.css("float",flt),0===parseInt($audio.css("margin-left"),10)&&($audio.attr("style")||"").indexOf("margin-right: auto")>=0?$audio.addClass("fr-fvl"):0===parseInt($audio.css("margin-right"),10)&&($audio.attr("style")||"").indexOf("margin-left: auto")>=0&&$audio.addClass("fr-fvr"),$audio.addClass("fr-dvb")):($audio.css("float",flt),"left"==$audio.css("float")?$audio.addClass("fr-fvl"):"right"==$audio.css("float")&&$audio.addClass("fr-fvr"),$audio.addClass("fr-dvi")),$audio.css("margin",""),$audio.css("float",""),$audio.css("display",""),$audio.css("z-index",""),$audio.css("position",""),$audio.css("overflow",""),$audio.css("vertical-align","")}editor.opts.audioTextNear||$audio.removeClass("fr-dvi").addClass("fr-dvb")}function _refreshAudioList(){editor.$el.find("audio").filter((function(){return 0===$(this).parents("span.fr-video").length})).wrap('<span class="fr-video" contenteditable="false"></span>'),editor.$el.find("embed, iframe").filter((function(){if(editor.browser.safari&&this.getAttribute("src")&&this.setAttribute("src",this.src),$(this).parents("span.fr-video").length>0)return!1;for(var link=$(this).attr("src"),i=0;i<$.FE.VIDEO_PROVIDERS.length;i++){if($.FE.VIDEO_PROVIDERS[i].test_regex.test(link))return!0}return!1})).map((function(){return 0===$(this).parents("object").length?this:$(this).parents("object").get(0)})).wrap('<span class="fr-video" contenteditable="false"></span>');for(var audios=editor.$el.find("span.fr-video"),i=0;i<audios.length;i++)_convertStyleToClasses($(audios[i]));audios.toggleClass("fr-draggable",editor.opts.audioMove)}return editor.shared.audio_exit_flag=!1,{_init:function(){editor.events.on("mousedown window.mousedown",_markExit),editor.events.on("window.touchmove",_unmarkExit),editor.events.on("mouseup window.mouseup",_exitEdit),editor.events.on("commands.mousedown",(function($btn){$btn.parents(".fr-toolbar").length>0&&_exitEdit()})),editor.events.on("blur audio.hideResizer commands.undo commands.redo element.dropped",(function(){_exitEdit(!0)})),editor.helpers.isMobile()&&(editor.events.$on(editor.$el,"touchstart","span.fr-video",(function(){touchScroll=!1})),editor.events.$on(editor.$el,"touchmove",(function(){touchScroll=!0}))),editor.events.on("html.set",_refreshAudioList),_refreshAudioList(),editor.events.$on(editor.$el,"mousedown","span.fr-video",(function(e){e.stopPropagation()})),editor.events.$on(editor.$el,"click touchend","span.fr-video",_edit),editor.events.on("keydown",(function(e){var key_code=e.which;return!$current_audio||key_code!=$.FE.KEYCODE.BACKSPACE&&key_code!=$.FE.KEYCODE.DELETE?$current_audio&&key_code==$.FE.KEYCODE.ESC?(_exitEdit(!0),e.preventDefault(),!1):$current_audio&&!editor.keys.ctrlKey(e)?(e.preventDefault(),!1):void 0:(e.preventDefault(),remove(),!1)}),!0),editor.events.on("keydown",(function(){editor.$el.find("span.fr-video:empty").remove()})),_initInsertPopup(!0),_initSizePopup(!0)},showInsertPopup:function(){var $btn=editor.$tb.find('.fr-command[data-cmd="insertAudio"]'),$popup=editor.popups.get("audio.insert");if($popup||($popup=_initInsertPopup()),!$popup.hasClass("fr-active")){editor.popups.refresh("audio.insert"),editor.popups.setContainer("audio.insert",editor.$tb);var left=$btn.offset().left+$btn.outerWidth()/2,top=$btn.offset().top+(editor.opts.toolbarBottom?10:$btn.outerHeight()-10);editor.popups.show("audio.insert",left,top,$btn.outerHeight())}},showLayer:function(name){var left,top,$popup=editor.popups.get("audio.insert");if(!$current_audio&&!editor.opts.toolbarInline){var $btn=editor.$tb.find('.fr-command[data-cmd="insertAudio"]');left=$btn.offset().left+$btn.outerWidth()/2,top=$btn.offset().top+(editor.opts.toolbarBottom?10:$btn.outerHeight()-10)}editor.opts.toolbarInline&&(top=$popup.offset().top-editor.helpers.getPX($popup.css("margin-top")),$popup.hasClass("fr-above")&&(top+=$popup.outerHeight())),$popup.find(".fr-layer").removeClass("fr-active"),$popup.find(".fr-"+name+"-layer").addClass("fr-active"),editor.popups.show("audio.insert",left,top,0)},refreshByURLButton:function($btn){editor.popups.get("audio.insert").find(".fr-audio-by-url-layer").hasClass("fr-active")&&$btn.addClass("fr-active")},refreshEmbedButton:function($btn){editor.popups.get("audio.insert").find(".fr-audio-embed-layer").hasClass("fr-active")&&$btn.addClass("fr-active")},insertByURL:function(link){void 0===link&&(link=editor.popups.get("audio.insert").find('.fr-audio-by-url-layer input[type="text"]').val()||"");var audio=null;if(editor.helpers.isURL(link))for(var i=0;i<$.FE.VIDEO_PROVIDERS.length;i++){var vp=$.FE.VIDEO_PROVIDERS[i];if(vp.test_regex.test(link)){audio=link.replace(vp.url_regex,vp.url_text),audio=vp.html.replace(/\{url\}/,audio);break}}audio?insert(audio):editor.events.trigger("audio.linkError",[link])},insertEmbed:function(code){void 0===code&&(code=editor.popups.get("audio.insert").find(".fr-audio-embed-layer textarea").val()||""),0!==code.length&&$.FE.VIDEO_EMBED_REGEX.test(code)?insert(code):editor.events.trigger("audio.codeError",[code])},insert:insert,align:function(val){$current_audio.removeClass("fr-fvr fr-fvl"),"left"==val?$current_audio.addClass("fr-fvl"):"right"==val&&$current_audio.addClass("fr-fvr"),_repositionResizer(),_showEditPopup()},refreshAlign:function($btn){if(!$current_audio)return!1;$current_audio.hasClass("fr-fvl")?$btn.find("> *:first").replaceWith(editor.icon.create("align-left")):$current_audio.hasClass("fr-fvr")?$btn.find("> *:first").replaceWith(editor.icon.create("align-right")):$btn.find("> *:first").replaceWith(editor.icon.create("align-justify"))},refreshAlignOnShow:function($btn,$dropdown){var alignment="justify";$current_audio.hasClass("fr-fvl")?alignment="left":$current_audio.hasClass("fr-fvr")&&(alignment="right"),$dropdown.find('.fr-command[data-param1="'+alignment+'"]').addClass("fr-active")},display:function(val){$current_audio.removeClass("fr-dvi fr-dvb"),"inline"==val?$current_audio.addClass("fr-dvi"):"block"==val&&$current_audio.addClass("fr-dvb"),_repositionResizer(),_showEditPopup()},refreshDisplayOnShow:function($btn,$dropdown){var d="block";$current_audio.hasClass("fr-dvi")&&(d="inline"),$dropdown.find('.fr-command[data-param1="'+d+'"]').addClass("fr-active")},remove:remove,showSizePopup:showSizePopup,back:function(){$current_audio?$current_audio.trigger("click"):(editor.events.disableBlur(),editor.selection.restore(),editor.events.enableBlur(),editor.popups.hide("audio.insert"),editor.toolbar.showInline())},setSize:function(width,height){if($current_audio){var $popup=editor.popups.get("audio.size"),$audio_obj=$current_audio.find("iframe, embed, audio");$audio_obj.css("width",width||$popup.find('input[name="width"]').val()),$audio_obj.css("height",height||$popup.find('input[name="height"]').val()),$audio_obj.get(0).style.width&&$audio_obj.removeAttr("width"),$audio_obj.get(0).style.height&&$audio_obj.removeAttr("height"),$popup.find("input").blur(),setTimeout((function(){$current_audio.trigger("click")}),editor.helpers.isAndroid()?50:0)}},get:function(){return $current_audio}}},$.FE.RegisterCommand("insertAudio",{title:"Insert Audio",undo:!1,focus:!0,refreshAfterCallback:!1,popup:!0,callback:function(){this.popups.isVisible("audio.insert")?(this.$el.find(".fr-marker")&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("audio.insert")):this.audio.showInsertPopup()},plugin:"audio"}),$.FE.DefineIcon("insertAudio",{NAME:"volume-up"}),$.FE.DefineIcon("audioByURL",{NAME:"link"}),$.FE.RegisterCommand("audioByURL",{title:"By URL",undo:!1,focus:!1,callback:function(){this.audio.showLayer("audio-by-url")},refresh:function($btn){this.audio.refreshByURLButton($btn)}}),$.FE.DefineIcon("audioEmbed",{NAME:"code"}),$.FE.RegisterCommand("audioEmbed",{title:"Embedded Code",undo:!1,focus:!1,callback:function(){this.audio.showLayer("audio-embed")},refresh:function($btn){this.audio.refreshEmbedButton($btn)}}),$.FE.RegisterCommand("audioInsertByURL",{undo:!0,focus:!0,callback:function(){this.audio.insertByURL()}}),$.FE.RegisterCommand("audioInsertEmbed",{undo:!0,focus:!0,callback:function(){this.audio.insertEmbed()}}),$.FE.DefineIcon("audioDisplay",{NAME:"star"}),$.FE.RegisterCommand("audioDisplay",{title:"Display",type:"dropdown",options:{inline:"Inline",block:"Break Text"},callback:function(cmd,val){this.audio.display(val)},refresh:function($btn){this.opts.audioTextNear||$btn.addClass("fr-hidden")},refreshOnShow:function($btn,$dropdown){this.audio.refreshDisplayOnShow($btn,$dropdown)}}),$.FE.DefineIcon("audioAlign",{NAME:"align-center"}),$.FE.RegisterCommand("audioAlign",{type:"dropdown",title:"Align",options:{left:"Align Left",justify:"None",right:"Align Right"},html:function(){var c='<ul class="fr-dropdown-list">',options=$.FE.COMMANDS.audioAlign.options;for(var val in options)options.hasOwnProperty(val)&&(c+='<li><a class="fr-command fr-title" data-cmd="audioAlign" data-param1="'+val+'" title="'+this.language.translate(options[val])+'">'+this.icon.create("align-"+val)+"</a></li>");return c+="</ul>"},callback:function(cmd,val){this.audio.align(val)},refresh:function($btn){this.audio.refreshAlign($btn)},refreshOnShow:function($btn,$dropdown){this.audio.refreshAlignOnShow($btn,$dropdown)}}),$.FE.DefineIcon("audioRemove",{NAME:"trash"}),$.FE.RegisterCommand("audioRemove",{title:"Remove",callback:function(){this.audio.remove()}}),$.FE.DefineIcon("audioSize",{NAME:"arrows-alt"}),$.FE.RegisterCommand("audioSize",{undo:!1,focus:!1,title:"Change Size",callback:function(){this.audio.showSizePopup()}}),$.FE.DefineIcon("audioBack",{NAME:"arrow-left"}),$.FE.RegisterCommand("audioBack",{title:"Back",undo:!1,focus:!1,back:!0,callback:function(){this.audio.back()},refresh:function($btn){this.audio.get()||this.opts.toolbarInline?($btn.removeClass("fr-hidden"),$btn.next(".fr-separator").removeClass("fr-hidden")):($btn.addClass("fr-hidden"),$btn.next(".fr-separator").addClass("fr-hidden"))}}),$.FE.RegisterCommand("audioSetSize",{undo:!0,focus:!1,callback:function(){this.audio.setSize()}})}(jQuery),function($){$.FE.PLUGINS.quote=function(editor){function _deepestParent(node){for(;node.parentNode&&node.parentNode!=editor.el;)node=node.parentNode;return node}return{apply:function(val){editor.selection.save(),editor.html.wrap(!0,!0,!0,!0),editor.selection.restore(),"increase"==val?function(){var i,blocks=editor.selection.blocks();for(i=0;i<blocks.length;i++)blocks[i]=_deepestParent(blocks[i]);editor.selection.save();var $quote=$("<blockquote>");for($quote.insertBefore(blocks[0]),i=0;i<blocks.length;i++)$quote.append(blocks[i]);editor.html.unwrap(),editor.selection.restore()}():"decrease"==val&&function(){var i,blocks=editor.selection.blocks();for(i=0;i<blocks.length;i++)"BLOCKQUOTE"!=blocks[i].tagName&&(blocks[i]=$(blocks[i]).parentsUntil(editor.$el,"BLOCKQUOTE").get(0));for(editor.selection.save(),i=0;i<blocks.length;i++)blocks[i]&&$(blocks[i]).replaceWith(blocks[i].innerHTML);editor.html.unwrap(),editor.selection.restore()}()}}},$.FE.RegisterShortcut($.FE.KEYCODE.SINGLE_QUOTE,"quote","increase","'"),$.FE.RegisterShortcut($.FE.KEYCODE.SINGLE_QUOTE,"quote","decrease","'",!0),$.FE.RegisterCommand("quote",{title:"Quote",type:"dropdown",html:function(){var c='<ul class="fr-dropdown-list" role="presentation">',options={increase:"Increase",decrease:"Decrease"};for(var val in options)if(options.hasOwnProperty(val)){var shortcut=this.shortcuts.get("quote."+val);c+='<li role="presentation"><a class="fr-command fr-active '+val+'" tabIndex="-1" role="option" data-cmd="quote" data-param1="'+val+'" title="'+options[val]+'">'+this.language.translate(options[val])+(shortcut?'<span class="fr-shortcut">'+shortcut+"</span>":"")+"</a></li>"}return c+="</ul>"},callback:function(cmd,val){this.quote.apply(val)},plugin:"quote"}),$.FE.DefineIcon("quote",{NAME:"quote-left"})}(jQuery),function($){$.extend($.FE.DEFAULTS,{fontSize:["8","9","10","11","12","14","18","24","30","36","48","60","72","96"],fontSizeSelection:!1,fontSizeDefaultSelection:"12",fontSizeUnit:"px"}),$.FE.PLUGINS.fontSize=function(editor){return{apply:function(val){editor.format.applyStyle("font-size",val)},refreshOnShow:function($btn,$dropdown){var val=$(editor.selection.element()).css("font-size");"pt"===editor.opts.fontSizeUnit&&(val=Math.round(72*parseFloat(val,10)/96)+"pt"),$dropdown.find(".fr-command.fr-active").removeClass("fr-active").attr("aria-selected",!1),$dropdown.find('.fr-command[data-param1="'+val+'"]').addClass("fr-active").attr("aria-selected",!0);var $list=$dropdown.find(".fr-dropdown-list"),$active=$dropdown.find(".fr-active").parent();$active.length?$list.parent().scrollTop($active.offset().top-$list.offset().top-($list.parent().outerHeight()/2-$active.outerHeight()/2)):$list.parent().scrollTop(0)},refresh:function($btn){if(editor.opts.fontSizeSelection){var val=editor.helpers.getPX($(editor.selection.element()).css("font-size"));"pt"===editor.opts.fontSizeUnit&&(val=Math.round(72*parseFloat(val,10)/96)+"pt"),$btn.find("> span").text(val)}}}},$.FE.RegisterCommand("fontSize",{type:"dropdown",title:"Font Size",displaySelection:function(editor){return editor.opts.fontSizeSelection},displaySelectionWidth:30,defaultSelection:function(editor){return editor.opts.fontSizeDefaultSelection},html:function(){for(var c='<ul class="fr-dropdown-list" role="presentation">',options=this.opts.fontSize,i=0;i<options.length;i++){var val=options[i];c+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="fontSize" data-param1="'+val+this.opts.fontSizeUnit+'" title="'+val+'">'+val+"</a></li>"}return c+="</ul>"},callback:function(cmd,val){this.fontSize.apply(val)},refresh:function($btn){this.fontSize.refresh($btn)},refreshOnShow:function($btn,$dropdown){this.fontSize.refreshOnShow($btn,$dropdown)},plugin:"fontSize"}),$.FE.DefineIcon("fontSize",{NAME:"text-height"})}(jQuery),function($){$.extend($.FE.DEFAULTS,{fontFamily:{"Arial,Helvetica,sans-serif":"Arial","Georgia,serif":"Georgia","Impact,Charcoal,sans-serif":"Impact","Tahoma,Geneva,sans-serif":"Tahoma","Times New Roman,Times,serif,-webkit-standard":"Times New Roman","Verdana,Geneva,sans-serif":"Verdana"},fontFamilySelection:!1,fontFamilyDefaultSelection:"Font Family"}),$.FE.PLUGINS.fontFamily=function(editor){function _getArray(val){var font_array=val.replace(/(sans-serif|serif|monospace|cursive|fantasy)/gi,"").replace(/"|'| /g,"").split(",");return $.grep(font_array,(function(txt){return txt.length>0}))}function _matches(array1,array2){for(var i=0;i<array1.length;i++)for(var j=0;j<array2.length;j++)if(array1[i].toLowerCase()==array2[j].toLowerCase())return[i,j];return null}function _getSelection(){var font_array=_getArray($(editor.selection.element()).css("font-family")),font_matches=[];for(var key in editor.opts.fontFamily)if(editor.opts.fontFamily.hasOwnProperty(key)){var match=_matches(font_array,_getArray(key));match&&font_matches.push([key,match])}return 0===font_matches.length?null:(font_matches.sort((function(a,b){var f_diff=a[1][0]-b[1][0];return 0===f_diff?a[1][1]-b[1][1]:f_diff})),font_matches[0][0])}return{apply:function(val){editor.format.applyStyle("font-family",val)},refreshOnShow:function($btn,$dropdown){$dropdown.find(".fr-command.fr-active").removeClass("fr-active").attr("aria-selected",!1),$dropdown.find('.fr-command[data-param1="'+_getSelection()+'"]').addClass("fr-active").attr("aria-selected",!0);var $list=$dropdown.find(".fr-dropdown-list"),$active=$dropdown.find(".fr-active").parent();$active.length?$list.parent().scrollTop($active.offset().top-$list.offset().top-($list.parent().outerHeight()/2-$active.outerHeight()/2)):$list.parent().scrollTop(0)},refresh:function($btn){if(editor.opts.fontFamilySelection){var val=$(editor.selection.element()).css("font-family").replace(/(sans-serif|serif|monospace|cursive|fantasy)/gi,"").replace(/"|'|/g,"").split(",");$btn.find("> span").text(editor.opts.fontFamily[_getSelection()]||val[0]||editor.language.translate(editor.opts.fontFamilyDefaultSelection))}}}},$.FE.RegisterCommand("fontFamily",{type:"dropdown",displaySelection:function(editor){return editor.opts.fontFamilySelection},defaultSelection:function(editor){return editor.opts.fontFamilyDefaultSelection},displaySelectionWidth:120,html:function(){var c='<ul class="fr-dropdown-list" role="presentation">',options=this.opts.fontFamily;for(var val in options)options.hasOwnProperty(val)&&(c+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="fontFamily" data-param1="'+val+'" style="font-family: '+val+'" title="'+options[val]+'">'+options[val]+"</a></li>");return c+="</ul>"},title:"Font Family",callback:function(cmd,val){this.fontFamily.apply(val)},refresh:function($btn){this.fontFamily.refresh($btn)},refreshOnShow:function($btn,$dropdown){this.fontFamily.refreshOnShow($btn,$dropdown)},plugin:"fontFamily"}),$.FE.DefineIcon("fontFamily",{NAME:"font"})}(jQuery),function($){$.extend($.FE.POPUP_TEMPLATES,{emoticons:"[_BUTTONS_][_EMOTICONS_]"}),$.extend($.FE.DEFAULTS,{emoticonsStep:8,emoticonsSet:[{code:"1f600",desc:"Grinning face"},{code:"1f601",desc:"Grinning face with smiling eyes"},{code:"1f602",desc:"Face with tears of joy"},{code:"1f603",desc:"Smiling face with open mouth"},{code:"1f604",desc:"Smiling face with open mouth and smiling eyes"},{code:"1f605",desc:"Smiling face with open mouth and cold sweat"},{code:"1f606",desc:"Smiling face with open mouth and tightly-closed eyes"},{code:"1f607",desc:"Smiling face with halo"},{code:"1f608",desc:"Smiling face with horns"},{code:"1f609",desc:"Winking face"},{code:"1f60a",desc:"Smiling face with smiling eyes"},{code:"1f60b",desc:"Face savoring delicious food"},{code:"1f60c",desc:"Relieved face"},{code:"1f60d",desc:"Smiling face with heart-shaped eyes"},{code:"1f60e",desc:"Smiling face with sunglasses"},{code:"1f60f",desc:"Smirking face"},{code:"1f610",desc:"Neutral face"},{code:"1f611",desc:"Expressionless face"},{code:"1f612",desc:"Unamused face"},{code:"1f613",desc:"Face with cold sweat"},{code:"1f614",desc:"Pensive face"},{code:"1f615",desc:"Confused face"},{code:"1f616",desc:"Confounded face"},{code:"1f617",desc:"Kissing face"},{code:"1f618",desc:"Face throwing a kiss"},{code:"1f619",desc:"Kissing face with smiling eyes"},{code:"1f61a",desc:"Kissing face with closed eyes"},{code:"1f61b",desc:"Face with stuck out tongue"},{code:"1f61c",desc:"Face with stuck out tongue and winking eye"},{code:"1f61d",desc:"Face with stuck out tongue and tightly-closed eyes"},{code:"1f61e",desc:"Disappointed face"},{code:"1f61f",desc:"Worried face"},{code:"1f620",desc:"Angry face"},{code:"1f621",desc:"Pouting face"},{code:"1f622",desc:"Crying face"},{code:"1f623",desc:"Persevering face"},{code:"1f624",desc:"Face with look of triumph"},{code:"1f625",desc:"Disappointed but relieved face"},{code:"1f626",desc:"Frowning face with open mouth"},{code:"1f627",desc:"Anguished face"},{code:"1f628",desc:"Fearful face"},{code:"1f629",desc:"Weary face"},{code:"1f62a",desc:"Sleepy face"},{code:"1f62b",desc:"Tired face"},{code:"1f62c",desc:"Grimacing face"},{code:"1f62d",desc:"Loudly crying face"},{code:"1f62e",desc:"Face with open mouth"},{code:"1f62f",desc:"Hushed face"},{code:"1f630",desc:"Face with open mouth and cold sweat"},{code:"1f631",desc:"Face screaming in fear"},{code:"1f632",desc:"Astonished face"},{code:"1f633",desc:"Flushed face"},{code:"1f634",desc:"Sleeping face"},{code:"1f635",desc:"Dizzy face"},{code:"1f636",desc:"Face without mouth"},{code:"1f637",desc:"Face with medical mask"}],emoticonsButtons:["emoticonsBack","|"],emoticonsUseImage:!0}),$.FE.PLUGINS.emoticons=function(editor){function _inEmoticon(){if(!editor.selection.isCollapsed())return!1;var s_el=editor.selection.element(),e_el=editor.selection.endElement();if(s_el&&editor.node.hasClass(s_el,"fr-emoticon"))return s_el;if(e_el&&editor.node.hasClass(e_el,"fr-emoticon"))return e_el;var range=editor.selection.ranges(0),container=range.startContainer;if(container.nodeType==Node.ELEMENT_NODE&&container.childNodes.length>0&&range.startOffset>0){var node=container.childNodes[range.startOffset-1];if(editor.node.hasClass(node,"fr-emoticon"))return node}return!1}function _emoticonsHTML(){for(var emoticons_html='<div style="text-align: center">',i=0;i<editor.opts.emoticonsSet.length;i++)0!==i&&i%editor.opts.emoticonsStep==0&&(emoticons_html+="<br>"),emoticons_html+='<span class="fr-command fr-emoticon" tabIndex="-1" data-cmd="insertEmoticon" title="'+editor.language.translate(editor.opts.emoticonsSet[i].desc)+'" role="button" data-param1="'+editor.opts.emoticonsSet[i].code+'">'+(editor.opts.emoticonsUseImage?'<img src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.0.1/assets/svg/'+editor.opts.emoticonsSet[i].code+'.svg"/>':"&#x"+editor.opts.emoticonsSet[i].code+";")+'<span class="fr-sr-only">'+editor.language.translate(editor.opts.emoticonsSet[i].desc)+"&nbsp;&nbsp;&nbsp;</span></span>";return editor.opts.emoticonsUseImage&&(emoticons_html+='<p style="font-size: 12px; text-align: center; padding: 0 5px;">Emoji free by <a class="fr-link" tabIndex="-1" href="http://emojione.com/" target="_blank" rel="nofollow noopener noreferrer" role="link" aria-label="Open Emoji One website.">Emoji One</a></p>'),emoticons_html+="</div>"}return{_init:function(){var setDeletable=function(){for(var emtcs=editor.el.querySelectorAll(".fr-emoticon:not(.fr-deletable)"),i=0;i<emtcs.length;i++)emtcs[i].className+=" fr-deletable"};setDeletable(),editor.events.on("html.set",setDeletable),editor.events.on("keydown",(function(e){if(editor.keys.isCharacter(e.which)&&editor.selection.inEditor()){var range=editor.selection.ranges(0),el=_inEmoticon();editor.node.hasClass(el,"fr-emoticon-img")&&el&&(0===range.startOffset&&editor.selection.element()===el?$(el).before($.FE.MARKERS+$.FE.INVISIBLE_SPACE):$(el).after($.FE.INVISIBLE_SPACE+$.FE.MARKERS),editor.selection.restore())}})),editor.events.on("keyup",(function(e){for(var emtcs=editor.el.querySelectorAll(".fr-emoticon"),i=0;i<emtcs.length;i++)void 0!==emtcs[i].textContent&&0===emtcs[i].textContent.replace(/\u200B/gi,"").length&&$(emtcs[i]).remove();if(!(e.which>=$.FE.KEYCODE.ARROW_LEFT&&e.which<=$.FE.KEYCODE.ARROW_DOWN)){var el=_inEmoticon();editor.node.hasClass(el,"fr-emoticon-img")&&($(el).append($.FE.MARKERS),editor.selection.restore())}}))},insert:function(emoticon,img){var el=_inEmoticon(),range=editor.selection.ranges(0);el?(0===range.startOffset&&editor.selection.element()===el?$(el).before($.FE.MARKERS+$.FE.INVISIBLE_SPACE):range.startOffset>0&&editor.selection.element()===el&&range.commonAncestorContainer.parentNode.classList.contains("fr-emoticon")&&$(el).after($.FE.INVISIBLE_SPACE+$.FE.MARKERS),editor.selection.restore(),editor.html.insert('<span class="fr-emoticon fr-deletable'+(img?" fr-emoticon-img":"")+'"'+(img?' style="background: url('+img+');"':"")+">"+(img?"&nbsp;":emoticon)+"</span>&nbsp;"+$.FE.MARKERS,!0)):editor.html.insert('<span class="fr-emoticon fr-deletable'+(img?" fr-emoticon-img":"")+'"'+(img?' style="background: url('+img+');"':"")+">"+(img?"&nbsp;":emoticon)+"</span>&nbsp;",!0)},showEmoticonsPopup:function(){var $btn=editor.$tb.find('.fr-command[data-cmd="emoticons"]'),$popup=editor.popups.get("emoticons");if($popup||($popup=function(){var emoticons_buttons="";editor.opts.toolbarInline&&editor.opts.emoticonsButtons.length>0&&(emoticons_buttons='<div class="fr-buttons fr-emoticons-buttons">'+editor.button.buildList(editor.opts.emoticonsButtons)+"</div>");var template={buttons:emoticons_buttons,emoticons:_emoticonsHTML()},$popup=editor.popups.create("emoticons",template);return editor.tooltip.bind($popup,".fr-emoticon"),function($popup){editor.events.on("popup.tab",(function(e){var $focused_item=$(e.currentTarget);if(!editor.popups.isVisible("emoticons")||!$focused_item.is("span, a"))return!0;var status,index,$el,key_code=e.which;if($.FE.KEYCODE.TAB==key_code){if($focused_item.is("span.fr-emoticon")&&e.shiftKey||$focused_item.is("a")&&!e.shiftKey){var $tb=$popup.find(".fr-buttons");status=!editor.accessibility.focusToolbar($tb,!!e.shiftKey)}if(!1!==status){var $tabElements=$popup.find("span.fr-emoticon:focus:first, span.fr-emoticon:visible:first, a");$focused_item.is("span.fr-emoticon")&&($tabElements=$tabElements.not("span.fr-emoticon:not(:focus)")),index=$tabElements.index($focused_item),index=e.shiftKey?((index-1)%$tabElements.length+$tabElements.length)%$tabElements.length:(index+1)%$tabElements.length,$el=$tabElements.get(index),editor.events.disableBlur(),$el.focus(),status=!1}}else if($.FE.KEYCODE.ARROW_UP==key_code||$.FE.KEYCODE.ARROW_DOWN==key_code||$.FE.KEYCODE.ARROW_LEFT==key_code||$.FE.KEYCODE.ARROW_RIGHT==key_code){if($focused_item.is("span.fr-emoticon")){var $emoticons=$focused_item.parent().find("span.fr-emoticon");index=$emoticons.index($focused_item);var columns=editor.opts.emoticonsStep,lines=Math.floor($emoticons.length/columns),column=index%columns,nextIndex=Math.floor(index/columns)*columns+column,dimension=lines*columns;$.FE.KEYCODE.ARROW_UP==key_code?nextIndex=((nextIndex-columns)%dimension+dimension)%dimension:$.FE.KEYCODE.ARROW_DOWN==key_code?nextIndex=(nextIndex+columns)%dimension:$.FE.KEYCODE.ARROW_LEFT==key_code?nextIndex=((nextIndex-1)%dimension+dimension)%dimension:$.FE.KEYCODE.ARROW_RIGHT==key_code&&(nextIndex=(nextIndex+1)%dimension),$el=$($emoticons.get(nextIndex)),editor.events.disableBlur(),$el.focus(),status=!1}}else $.FE.KEYCODE.ENTER==key_code&&($focused_item.is("a")?$focused_item[0].click():editor.button.exec($focused_item),status=!1);return!1===status&&(e.preventDefault(),e.stopPropagation()),status}),!0)}($popup),$popup}()),!$popup.hasClass("fr-active")){editor.popups.refresh("emoticons"),editor.popups.setContainer("emoticons",editor.$tb);var left=$btn.offset().left+$btn.outerWidth()/2,top=$btn.offset().top+(editor.opts.toolbarBottom?10:$btn.outerHeight()-10);editor.popups.show("emoticons",left,top,$btn.outerHeight())}},hideEmoticonsPopup:function(){editor.popups.hide("emoticons")},back:function(){editor.popups.hide("emoticons"),editor.toolbar.showInline()}}},$.FE.DefineIcon("emoticons",{NAME:"smile-o",FA5NAME:"smile"}),$.FE.RegisterCommand("emoticons",{title:"Emoticons",undo:!1,focus:!0,refreshOnCallback:!1,popup:!0,callback:function(){this.popups.isVisible("emoticons")?(this.$el.find(".fr-marker").length&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("emoticons")):this.emoticons.showEmoticonsPopup()},plugin:"emoticons"}),$.FE.RegisterCommand("insertEmoticon",{callback:function(cmd,code){this.emoticons.insert("&#x"+code+";",this.opts.emoticonsUseImage?"https://cdnjs.cloudflare.com/ajax/libs/emojione/2.0.1/assets/svg/"+code+".svg":null),this.emoticons.hideEmoticonsPopup()}}),$.FE.DefineIcon("emoticonsBack",{NAME:"arrow-left"}),$.FE.RegisterCommand("emoticonsBack",{title:"Back",undo:!1,focus:!1,back:!0,refreshAfterCallback:!1,callback:function(){this.emoticons.back()}})}(jQuery),function($){$.extend($.FE.POPUP_TEMPLATES,{"colors.picker":"[_BUTTONS_][_TEXT_COLORS_][_BACKGROUND_COLORS_][_CUSTOM_COLOR_]"}),$.extend($.FE.DEFAULTS,{colorsText:["#61BD6D","#1ABC9C","#54ACD2","#2C82C9","#9365B8","#475577","#CCCCCC","#41A85F","#00A885","#3D8EB9","#2969B0","#553982","#28324E","#000000","#F7DA64","#FBA026","#EB6B56","#E25041","#A38F84","#EFEFEF","#FFFFFF","#FAC51C","#F37934","#D14841","#B8312F","#7C706B","#D1D5D8","REMOVE"],colorsBackground:["#61BD6D","#1ABC9C","#54ACD2","#2C82C9","#9365B8","#475577","#CCCCCC","#41A85F","#00A885","#3D8EB9","#2969B0","#553982","#28324E","#000000","#F7DA64","#FBA026","#EB6B56","#E25041","#A38F84","#EFEFEF","#FFFFFF","#FAC51C","#F37934","#D14841","#B8312F","#7C706B","#D1D5D8","REMOVE"],colorsStep:7,colorsHEXInput:!0,colorsDefaultTab:"text",colorsButtons:["colorsBack","|","-"]});var tabs=["text","background"];$.FE.PLUGINS.colors=function(editor){function _hideColorsPopup(){editor.popups.hide("colors.picker")}function _colorPickerHTML(tab){for(var colors="text"==tab?editor.opts.colorsText:editor.opts.colorsBackground,colors_html='<div class="fr-color-set fr-'+tab+"-color"+(editor.opts.colorsDefaultTab==tab||"text"!=editor.opts.colorsDefaultTab&&"background"!=editor.opts.colorsDefaultTab&&"text"==tab?" fr-selected-set":"")+'">',i=0;i<colors.length;i++)0!==i&&i%editor.opts.colorsStep==0&&(colors_html+="<br>"),"REMOVE"!=colors[i]?colors_html+='<span class="fr-command fr-select-color" style="background: '+colors[i]+';" tabIndex="-1" aria-selected="false" role="button" data-cmd="'+tab+'Color" data-param1="'+colors[i]+'"><span class="fr-sr-only">'+editor.language.translate("Color")+" "+colors[i]+"&nbsp;&nbsp;&nbsp;</span></span>":colors_html+='<span class="fr-command fr-select-color" data-cmd="'+tab+'Color" tabIndex="-1" role="button" data-param1="REMOVE" title="'+editor.language.translate("Clear Formatting")+'">'+editor.icon.create("remove")+'<span class="fr-sr-only">'+editor.language.translate("Clear Formatting")+"</span></span>";return colors_html+"</div>"}function _updateColor(val){var $popup=editor.popups.get("colors.picker"),$selectionColor=$popup.find(".fr-"+val+"-color .fr-active-item").attr("data-param1"),$input=$popup.find(".fr-color-hex-layer input"),tab=$popup.find('.fr-colors-tab[data-param1="'+val+'"]');$input.length&&tab.hasClass("fr-selected-tab")&&$input.val($selectionColor).trigger("change")}function background(val){"REMOVE"!=val?editor.format.applyStyle("background-color",editor.helpers.HEXtoRGB(val)):editor.format.removeStyle("background-color"),_hideColorsPopup()}function text(val){"REMOVE"!=val?editor.format.applyStyle("color",editor.helpers.HEXtoRGB(val)):editor.format.removeStyle("color"),_hideColorsPopup()}return{showColorsPopup:function(){var $btn=editor.$tb.find('.fr-command[data-cmd="color"]'),$popup=editor.popups.get("colors.picker");if($popup||($popup=function(){var colors_buttons='<div class="fr-buttons fr-colors-buttons">';editor.opts.toolbarInline&&editor.opts.colorsButtons.length>0&&(colors_buttons+=editor.button.buildList(editor.opts.colorsButtons));colors_buttons+=(tabs_html='<div class="fr-colors-tabs fr-group">',tabs_html+='<span class="fr-colors-tab '+("background"==editor.opts.colorsDefaultTab?"":"fr-selected-tab ")+'fr-command" tabIndex="-1" role="button" aria-pressed="'+("background"!=editor.opts.colorsDefaultTab)+'" data-param1="text" data-cmd="colorChangeSet" title="'+editor.language.translate("Text")+'">'+editor.language.translate("Text")+"</span>",(tabs_html+='<span class="fr-colors-tab '+("background"==editor.opts.colorsDefaultTab?"fr-selected-tab":"")+'fr-command" tabIndex="-1" role="button" aria-pressed="'+("background"==editor.opts.colorsDefaultTab)+'" data-param1="background" data-cmd="colorChangeSet" title="'+editor.language.translate("Background")+'">'+editor.language.translate("Background")+"</span>")+"</div></div>");var tabs_html;var custom_color="";editor.opts.colorsHEXInput&&(custom_color='<div class="fr-color-hex-layer fr-active fr-layer" id="fr-color-hex-layer-'+editor.id+'"><div class="fr-input-line"><input maxlength="7" id="fr-color-hex-layer-text-'+editor.id+'" type="text" placeholder="'+editor.language.translate("HEX Color")+'" tabIndex="1" aria-required="true"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="customColor" tabIndex="2" role="button">'+editor.language.translate("OK")+"</button></div></div>");var template={buttons:colors_buttons,text_colors:_colorPickerHTML("text"),background_colors:_colorPickerHTML("background"),custom_color:custom_color},$popup=editor.popups.create("colors.picker",template);return function($popup){editor.events.on("popup.tab",(function(e){var $focused_item=$(e.currentTarget);if(!editor.popups.isVisible("colors.picker")||!$focused_item.is("span"))return!0;var key_code=e.which,status=!0;if($.FE.KEYCODE.TAB==key_code){var $tb=$popup.find(".fr-buttons");status=!editor.accessibility.focusToolbar($tb,!!e.shiftKey)}else if($.FE.KEYCODE.ARROW_UP==key_code||$.FE.KEYCODE.ARROW_DOWN==key_code||$.FE.KEYCODE.ARROW_LEFT==key_code||$.FE.KEYCODE.ARROW_RIGHT==key_code){if($focused_item.is("span.fr-select-color")){var $colors=$focused_item.parent().find("span.fr-select-color"),index=$colors.index($focused_item),columns=editor.opts.colorsStep,lines=Math.floor($colors.length/columns),column=index%columns,nextIndex=Math.floor(index/columns)*columns+column,dimension=lines*columns;$.FE.KEYCODE.ARROW_UP==key_code?nextIndex=((nextIndex-columns)%dimension+dimension)%dimension:$.FE.KEYCODE.ARROW_DOWN==key_code?nextIndex=(nextIndex+columns)%dimension:$.FE.KEYCODE.ARROW_LEFT==key_code?nextIndex=((nextIndex-1)%dimension+dimension)%dimension:$.FE.KEYCODE.ARROW_RIGHT==key_code&&(nextIndex=(nextIndex+1)%dimension);var $el=$($colors.get(nextIndex));editor.events.disableBlur(),$el.focus(),status=!1}}else $.FE.KEYCODE.ENTER==key_code&&(editor.button.exec($focused_item),status=!1);return!1===status&&(e.preventDefault(),e.stopPropagation()),status}),!0)}($popup),$popup}()),!$popup.hasClass("fr-active"))if(editor.popups.setContainer("colors.picker",editor.$tb),tabs.map((function(tab){!function(tab){var color_type,$popup=editor.popups.get("colors.picker"),$element=$(editor.selection.element());color_type="background"==tab?"background-color":"color";var $current_color=$popup.find(".fr-"+tab+"-color .fr-select-color");$current_color.find(".fr-selected-color").remove(),$current_color.removeClass("fr-active-item"),$current_color.not('[data-param1="REMOVE"]').attr("aria-selected",!1);for(;$element.get(0)!=editor.el;){if("transparent"!=$element.css(color_type)&&"rgba(0, 0, 0, 0)"!=$element.css(color_type)){var $select_color=$popup.find(".fr-"+tab+'-color .fr-select-color[data-param1="'+editor.helpers.RGBToHex($element.css(color_type))+'"]');$select_color.append('<span class="fr-selected-color" aria-hidden="true"></span>'),$select_color.addClass("fr-active-item").attr("aria-selected",!0);break}$element=$element.parent()}_updateColor(tab)}(tab)})),$btn.is(":visible")){var left=$btn.offset().left+$btn.outerWidth()/2,top=$btn.offset().top+(editor.opts.toolbarBottom?10:$btn.outerHeight()-10);editor.popups.show("colors.picker",left,top,$btn.outerHeight())}else editor.position.forSelection($popup),editor.popups.show("colors.picker")},hideColorsPopup:_hideColorsPopup,changeSet:function($tab,val){$tab.hasClass("fr-selected-tab")||($tab.siblings().removeClass("fr-selected-tab").attr("aria-pressed",!1),$tab.addClass("fr-selected-tab").attr("aria-pressed",!0),$tab.parents(".fr-popup").find(".fr-color-set").removeClass("fr-selected-set"),$tab.parents(".fr-popup").find(".fr-color-set.fr-"+val+"-color").addClass("fr-selected-set"),_updateColor(val)),editor.accessibility.focusPopup($tab.parents(".fr-popup"))},background:background,customColor:function(){var $popup=editor.popups.get("colors.picker"),$input=$popup.find(".fr-color-hex-layer input");if($input.length){var color=$input.val();"background"==$popup.find(".fr-selected-tab").attr("data-param1")?background(color):text(color)}},text:text,back:function(){editor.popups.hide("colors.picker"),editor.toolbar.showInline()}}},$.FE.DefineIcon("colors",{NAME:"tint"}),$.FE.RegisterCommand("color",{title:"Colors",undo:!1,focus:!0,refreshOnCallback:!1,popup:!0,callback:function(){this.popups.isVisible("colors.picker")?(this.$el.find(".fr-marker").length&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("colors.picker")):this.colors.showColorsPopup()},plugin:"colors"}),$.FE.RegisterCommand("textColor",{undo:!0,callback:function(cmd,val){this.colors.text(val)}}),$.FE.RegisterCommand("backgroundColor",{undo:!0,callback:function(cmd,val){this.colors.background(val)}}),$.FE.RegisterCommand("colorChangeSet",{undo:!1,focus:!1,callback:function(cmd,val){var $tab=this.popups.get("colors.picker").find('.fr-command[data-cmd="'+cmd+'"][data-param1="'+val+'"]');this.colors.changeSet($tab,val)}}),$.FE.DefineIcon("colorsBack",{NAME:"arrow-left"}),$.FE.RegisterCommand("colorsBack",{title:"Back",undo:!1,focus:!1,back:!0,refreshAfterCallback:!1,callback:function(){this.colors.back()}}),$.FE.RegisterCommand("customColor",{title:"OK",undo:!0,callback:function(){this.colors.customColor()}}),$.FE.DefineIcon("remove",{NAME:"eraser"})}(jQuery),function($){$.FE.URLRegEx="(^| |\\u00A0)("+$.FE.LinkRegEx+"|([a-z0-9+-_.]{1,}@[a-z0-9+-_.]{1,}\\.[a-z0-9+-_]{1,}))$",$.FE.PLUGINS.url=function(editor){var rel=null;function _linkReplaceHandler(match,p1,p2){for(var dots="";p2.length&&"."==p2[p2.length-1];)dots+=".",p2=p2.substring(0,p2.length-1);var link=p2;if(editor.opts.linkConvertEmailAddress)editor.helpers.isEmail(link)&&!/^mailto:.*/i.test(link)&&(link="mailto:"+link);else if(editor.helpers.isEmail(link))return p1+p2;return/^((http|https|ftp|ftps|mailto|tel|sms|notes|data)\:)/i.test(link)||(link="//"+link),(p1||"")+"<a"+(editor.opts.linkAlwaysBlank?' target="_blank"':"")+(rel?' rel="'+rel+'"':"")+' data-fr-linked="true" href="'+link+'">'+p2.replace(/&amp;/g,"&").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</a>"+dots}function _getRegEx(){return new RegExp($.FE.URLRegEx,"gi")}function _convertToLink(html){return editor.opts.linkAlwaysNoFollow&&(rel="nofollow"),editor.opts.linkAlwaysBlank&&(editor.opts.linkNoOpener&&(rel?rel+=" noopener":rel="noopener"),editor.opts.linkNoReferrer&&(rel?rel+=" noreferrer":rel="noreferrer")),html.replace(_getRegEx(),_linkReplaceHandler)}function _isA(node){return!!node&&("A"===node.tagName||!(!node.parentNode||node.parentNode==editor.el)&&_isA(node.parentNode))}function _lastPart(text){var splits=text.split(" ");return splits[splits.length-1]}function _inlineType(){var range=editor.selection.ranges(0),node=range.startContainer;if(!node||node.nodeType!==Node.TEXT_NODE||range.startOffset!==(node.textContent||"").length)return!1;if(_isA(node))return!1;if(_getRegEx().test(_lastPart(node.textContent))){$(node).before(_convertToLink(node.textContent));var $link=$(node.parentNode).find("a[data-fr-linked]");$link.removeAttr("data-fr-linked"),node.parentNode.removeChild(node),editor.events.trigger("url.linked",[$link.get(0)])}else if(node.textContent.split(" ").length<=2&&node.previousSibling&&"A"===node.previousSibling.tagName){var text=node.previousSibling.innerText+node.textContent;_getRegEx().test(_lastPart(text))&&($(node.previousSibling).replaceWith(_convertToLink(text)),node.parentNode.removeChild(node))}}return{_init:function(){editor.events.on("keypress",(function(e){!editor.selection.isCollapsed()||"."!=e.key&&")"!=e.key&&"("!=e.key||_inlineType()}),!0),editor.events.on("keydown",(function(e){var keycode=e.which;!editor.selection.isCollapsed()||keycode!=$.FE.KEYCODE.ENTER&&keycode!=$.FE.KEYCODE.SPACE||_inlineType()}),!0),editor.events.on("paste.beforeCleanup",(function(html){if(editor.helpers.isURL(html)){var rel_attr=null;return editor.opts.linkAlwaysBlank&&(editor.opts.linkNoOpener&&(rel_attr?rel_attr+=" noopener":rel_attr="noopener"),editor.opts.linkNoReferrer&&(rel_attr?rel_attr+=" noreferrer":rel_attr="noreferrer")),"<a"+(editor.opts.linkAlwaysBlank?' target="_blank"':"")+(rel_attr?' rel="'+rel_attr+'"':"")+' href="'+html+'" >'+html+"</a>"}}))}}}}(jQuery),function($){$.extend($.FE.DEFAULTS,{lineBreakerTags:["table","hr","form","dl","span.fr-video",".fr-embedly"],lineBreakerOffset:15,lineBreakerHorizontalOffset:10}),$.FE.PLUGINS.lineBreaker=function(editor){var $line_breaker,mouseDownFlag,mouseMoveTimer;function _show($tag1,$tag2){var breakerTop,breakerLeft,breakerWidth,parent_tag,parent_top,parent_bottom,tag_top,tag_bottom;if(null==$tag1)parent_top=(parent_tag=$tag2.parent()).offset().top,breakerTop=(tag_top=$tag2.offset().top)-Math.min((tag_top-parent_top)/2,editor.opts.lineBreakerOffset),breakerWidth=parent_tag.outerWidth(),breakerLeft=parent_tag.offset().left;else if(null==$tag2)(parent_bottom=(parent_tag=$tag1.parent()).offset().top+parent_tag.outerHeight())<(tag_bottom=$tag1.offset().top+$tag1.outerHeight())&&(parent_bottom=(parent_tag=$(parent_tag).parent()).offset().top+parent_tag.outerHeight()),breakerTop=tag_bottom+Math.min(Math.abs(parent_bottom-tag_bottom)/2,editor.opts.lineBreakerOffset),breakerWidth=parent_tag.outerWidth(),breakerLeft=parent_tag.offset().left;else{parent_tag=$tag1.parent();var tag1_bottom=$tag1.offset().top+$tag1.height(),tag2_top=$tag2.offset().top;if(tag1_bottom>tag2_top)return!1;breakerTop=(tag1_bottom+tag2_top)/2,breakerWidth=parent_tag.outerWidth(),breakerLeft=parent_tag.offset().left}editor.opts.iframe&&(breakerLeft+=editor.$iframe.offset().left-editor.helpers.scrollLeft(),breakerTop+=editor.$iframe.offset().top-editor.helpers.scrollTop()),editor.$box.append($line_breaker),$line_breaker.css("top",breakerTop-editor.win.pageYOffset),$line_breaker.css("left",breakerLeft-editor.win.pageXOffset),$line_breaker.css("width",breakerWidth),$line_breaker.data("tag1",$tag1),$line_breaker.data("tag2",$tag2),$line_breaker.addClass("fr-visible").data("instance",editor)}function _checkTag(tag){if(tag){var $tag=$(tag);if(0===editor.$el.find($tag).length)return null;if(tag.nodeType!=Node.TEXT_NODE&&$tag.is(editor.opts.lineBreakerTags.join(",")))return $tag;if($tag.parents(editor.opts.lineBreakerTags.join(",")).length>0)return tag=$tag.parents(editor.opts.lineBreakerTags.join(",")).get(0),0!==editor.$el.find(tag).length&&$(tag).is(editor.opts.lineBreakerTags.join(","))?$(tag):null}return null}function _tagAt(x,y){var tag=editor.doc.elementFromPoint(x,y);return tag&&!$(tag).closest(".fr-line-breaker").length&&!editor.node.isElement(tag)&&tag!=editor.$wp.get(0)&&function(tag){if(void 0!==tag.inFroalaWrapper)return tag.inFroalaWrapper;for(var o_tag=tag;tag.parentNode&&tag.parentNode!==editor.$wp.get(0);)tag=tag.parentNode;return o_tag.inFroalaWrapper=tag.parentNode==editor.$wp.get(0),o_tag.inFroalaWrapper}(tag)?tag:null}function _searchTagVertically(x,y,step){for(var i=step,tag=null;i<=editor.opts.lineBreakerOffset&&!tag;)(tag=_tagAt(x,y-i))||(tag=_tagAt(x,y+i)),i+=step;return tag}function _searchTagHorizontally(x,y,direction){for(var tag=null,limit=100;!tag&&x>editor.$box.offset().left&&x<editor.$box.offset().left+editor.$box.outerWidth()&&limit>0;)(tag=_tagAt(x,y))||(tag=_searchTagVertically(x,y,5)),"left"==direction?x-=editor.opts.lineBreakerHorizontalOffset:x+=editor.opts.lineBreakerHorizontalOffset,limit-=editor.opts.lineBreakerHorizontalOffset;return tag}function _tagUnder(e){mouseMoveTimer=null;var $tag=null,tag=null,tag_under=editor.doc.elementFromPoint(e.pageX-editor.win.pageXOffset,e.pageY-editor.win.pageYOffset);tag_under&&("HTML"==tag_under.tagName||"BODY"==tag_under.tagName||editor.node.isElement(tag_under)||(tag_under.getAttribute("class")||"").indexOf("fr-line-breaker")>=0)?((tag=_searchTagVertically(e.pageX-editor.win.pageXOffset,e.pageY-editor.win.pageYOffset,1))||(tag=_searchTagHorizontally(e.pageX-editor.win.pageXOffset-editor.opts.lineBreakerHorizontalOffset,e.pageY-editor.win.pageYOffset,"left")),tag||(tag=_searchTagHorizontally(e.pageX-editor.win.pageXOffset+editor.opts.lineBreakerHorizontalOffset,e.pageY-editor.win.pageYOffset,"right")),$tag=_checkTag(tag)):$tag=_checkTag(tag_under),$tag?function($tag,mouseY){var $sibling,tag,tag_top=$tag.offset().top,tag_bottom=$tag.offset().top+$tag.outerHeight();if(Math.abs(tag_bottom-mouseY)<=editor.opts.lineBreakerOffset||Math.abs(mouseY-tag_top)<=editor.opts.lineBreakerOffset)if(Math.abs(tag_bottom-mouseY)<Math.abs(mouseY-tag_top)){for(var next_node=(tag=$tag.get(0)).nextSibling;next_node&&next_node.nodeType==Node.TEXT_NODE&&0===next_node.textContent.length;)next_node=next_node.nextSibling;if(!next_node)return _show($tag,null),!0;if($sibling=_checkTag(next_node))return _show($tag,$sibling),!0}else{if(!(tag=$tag.get(0)).previousSibling)return _show(null,$tag),!0;if($sibling=_checkTag(tag.previousSibling))return _show($sibling,$tag),!0}$line_breaker.removeClass("fr-visible").removeData("instance")}($tag,e.pageY):editor.core.sameInstance($line_breaker)&&$line_breaker.removeClass("fr-visible").removeData("instance")}function _mouseTimer(e){return!($line_breaker.hasClass("fr-visible")&&!editor.core.sameInstance($line_breaker))&&(editor.popups.areVisible()||editor.el.querySelector(".fr-selected-cell")?($line_breaker.removeClass("fr-visible"),!0):void(!1!==mouseDownFlag||editor.edit.isDisabled()||(mouseMoveTimer&&clearTimeout(mouseMoveTimer),mouseMoveTimer=setTimeout(_tagUnder,30,e))))}function _hide(){mouseMoveTimer&&clearTimeout(mouseMoveTimer),$line_breaker&&$line_breaker.hasClass("fr-visible")&&$line_breaker.removeClass("fr-visible").removeData("instance")}function _mouseDown(){mouseDownFlag=!0,_hide()}function _mouseUp(){mouseDownFlag=!1}function _doLineBreak(e){e.preventDefault();var instance=$line_breaker.data("instance")||editor;$line_breaker.removeClass("fr-visible").removeData("instance");var $tag1=$line_breaker.data("tag1"),$tag2=$line_breaker.data("tag2"),default_tag=editor.html.defaultTag();null==$tag1?default_tag&&"TD"!=$tag2.parent().get(0).tagName&&0===$tag2.parents(default_tag).length?$tag2.before("<"+default_tag+">"+$.FE.MARKERS+"<br></"+default_tag+">"):$tag2.before($.FE.MARKERS+"<br>"):default_tag&&"TD"!=$tag1.parent().get(0).tagName&&0===$tag1.parents(default_tag).length?$tag1.after("<"+default_tag+">"+$.FE.MARKERS+"<br></"+default_tag+">"):$tag1.after($.FE.MARKERS+"<br>"),instance.selection.restore()}return{_init:function(){if(!editor.$wp)return!1;editor.shared.$line_breaker||(editor.shared.$line_breaker=$('<div class="fr-line-breaker"><a class="fr-floating-btn" role="button" tabIndex="-1" title="'+editor.language.translate("Break")+'"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><rect x="21" y="11" width="2" height="8"/><rect x="14" y="17" width="7" height="2"/><path d="M14.000,14.000 L14.000,22.013 L9.000,18.031 L14.000,14.000 Z"/></svg></a></div>')),$line_breaker=editor.shared.$line_breaker,editor.events.on("shared.destroy",(function(){$line_breaker.html("").removeData().remove(),$line_breaker=null}),!0),editor.events.on("destroy",(function(){$line_breaker.removeData("instance").removeClass("fr-visible").appendTo("body:first"),clearTimeout(mouseMoveTimer)}),!0),editor.events.$on($line_breaker,"mousemove",(function(e){e.stopPropagation()}),!0),editor.events.bindClick($line_breaker,"a",_doLineBreak),mouseDownFlag=!1,editor.events.$on(editor.$win,"mousemove",_mouseTimer),editor.events.$on($(editor.win),"scroll",_hide),editor.events.on("popups.show.table.edit",_hide),editor.events.on("commands.after",_hide),editor.events.$on($(editor.win),"mousedown",_mouseDown),editor.events.$on($(editor.win),"mouseup",_mouseUp)}}}}(jQuery),function($){$.extend($.FE.DEFAULTS,{entities:"&quot;&#39;&iexcl;&cent;&pound;&curren;&yen;&brvbar;&sect;&uml;&copy;&ordf;&laquo;&not;&shy;&reg;&macr;&deg;&plusmn;&sup2;&sup3;&acute;&micro;&para;&middot;&cedil;&sup1;&ordm;&raquo;&frac14;&frac12;&frac34;&iquest;&Agrave;&Aacute;&Acirc;&Atilde;&Auml;&Aring;&AElig;&Ccedil;&Egrave;&Eacute;&Ecirc;&Euml;&Igrave;&Iacute;&Icirc;&Iuml;&ETH;&Ntilde;&Ograve;&Oacute;&Ocirc;&Otilde;&Ouml;&times;&Oslash;&Ugrave;&Uacute;&Ucirc;&Uuml;&Yacute;&THORN;&szlig;&agrave;&aacute;&acirc;&atilde;&auml;&aring;&aelig;&ccedil;&egrave;&eacute;&ecirc;&euml;&igrave;&iacute;&icirc;&iuml;&eth;&ntilde;&ograve;&oacute;&ocirc;&otilde;&ouml;&divide;&oslash;&ugrave;&uacute;&ucirc;&uuml;&yacute;&thorn;&yuml;&OElig;&oelig;&Scaron;&scaron;&Yuml;&fnof;&circ;&tilde;&Alpha;&Beta;&Gamma;&Delta;&Epsilon;&Zeta;&Eta;&Theta;&Iota;&Kappa;&Lambda;&Mu;&Nu;&Xi;&Omicron;&Pi;&Rho;&Sigma;&Tau;&Upsilon;&Phi;&Chi;&Psi;&Omega;&alpha;&beta;&gamma;&delta;&epsilon;&zeta;&eta;&theta;&iota;&kappa;&lambda;&mu;&nu;&xi;&omicron;&pi;&rho;&sigmaf;&sigma;&tau;&upsilon;&phi;&chi;&psi;&omega;&thetasym;&upsih;&piv;&ensp;&emsp;&thinsp;&zwnj;&zwj;&lrm;&rlm;&ndash;&mdash;&lsquo;&rsquo;&sbquo;&ldquo;&rdquo;&bdquo;&dagger;&Dagger;&bull;&hellip;&permil;&prime;&Prime;&lsaquo;&rsaquo;&oline;&frasl;&euro;&image;&weierp;&real;&trade;&alefsym;&larr;&uarr;&rarr;&darr;&harr;&crarr;&lArr;&uArr;&rArr;&dArr;&hArr;&forall;&part;&exist;&empty;&nabla;&isin;&notin;&ni;&prod;&sum;&minus;&lowast;&radic;&prop;&infin;&ang;&and;&or;&cap;&cup;&int;&there4;&sim;&cong;&asymp;&ne;&equiv;&le;&ge;&sub;&sup;&nsub;&sube;&supe;&oplus;&otimes;&perp;&sdot;&lceil;&rceil;&lfloor;&rfloor;&lang;&rang;&loz;&spades;&clubs;&hearts;&diams;"}),$.FE.PLUGINS.entities=function(editor){var _reg_exp,_map;function _process(el){var text=el.textContent;if(text.match(_reg_exp)){for(var new_text="",j=0;j<text.length;j++)_map[text[j]]?new_text+=_map[text[j]]:new_text+=text[j];el.textContent=new_text}}function _encode(el){if(el&&["STYLE","SCRIPT","svg","IFRAME"].indexOf(el.tagName)>=0)return!0;for(var contents=editor.node.contents(el),i=0;i<contents.length;i++)contents[i].nodeType==Node.TEXT_NODE?_process(contents[i]):_encode(contents[i]);el.nodeType==Node.TEXT_NODE&&_process(el)}function _encodeEntities(html){return 0===html.length?"":editor.clean.exec(html,_encode).replace(/\&amp;/g,"&")}return{_init:function(){editor.opts.htmlSimpleAmpersand||(editor.opts.entities=editor.opts.entities+"&amp;");var entities_text=$("<div>").html(editor.opts.entities).text(),entities_array=editor.opts.entities.split(";");_map={},_reg_exp="";for(var i=0;i<entities_text.length;i++){var chr=entities_text.charAt(i);_map[chr]=entities_array[i]+";",_reg_exp+="\\"+chr+(i<entities_text.length-1?"|":"")}_reg_exp=new RegExp("("+_reg_exp+")","g"),editor.events.on("html.get",_encodeEntities,!0)}}}}(jQuery),function($){$.extend($.FE.DEFAULTS,{dragInline:!0}),$.FE.PLUGINS.draggable=function(editor){function _dragStart(e){return!(!e.originalEvent||!e.originalEvent.target||e.originalEvent.target.nodeType!=Node.TEXT_NODE)||(e.target&&"A"==e.target.tagName&&1==e.target.childNodes.length&&"IMG"==e.target.childNodes[0].tagName&&(e.target=e.target.childNodes[0]),$(e.target).hasClass("fr-draggable")?(editor.undo.canDo()||editor.undo.saveStep(),editor.opts.dragInline?editor.$el.attr("contenteditable",!0):editor.$el.attr("contenteditable",!1),editor.opts.toolbarInline&&editor.toolbar.hide(),$(e.target).addClass("fr-dragging"),editor.browser.msie||editor.browser.edge||editor.selection.clear(),void e.originalEvent.dataTransfer.setData("text","Froala")):(editor.browser.msie||e.preventDefault(),!1))}function _tagOK(tag_under){return!(tag_under&&("HTML"==tag_under.tagName||"BODY"==tag_under.tagName||editor.node.isElement(tag_under)))}function _setHelperSize(top,left,width){editor.opts.iframe&&(top+=editor.$iframe.offset().top,left+=editor.$iframe.offset().left),$draggable_helper.offset().top!=top&&$draggable_helper.css("top",top),$draggable_helper.offset().left!=left&&$draggable_helper.css("left",left),$draggable_helper.width()!=width&&$draggable_helper.css("width",width)}function _dragOver(e){e.originalEvent.dataTransfer.dropEffect="move",editor.opts.dragInline?function(){for(var $draggedEl=null,i=0;i<$.FE.INSTANCES.length;i++)if(($draggedEl=$.FE.INSTANCES[i].$el.find(".fr-dragging")).length)return $draggedEl.get(0)}()||!editor.browser.msie&&!editor.browser.edge||e.preventDefault():(e.preventDefault(),function(e){var tag_under=editor.doc.elementFromPoint(e.originalEvent.pageX-editor.win.pageXOffset,e.originalEvent.pageY-editor.win.pageYOffset);if(!_tagOK(tag_under)){for(var top_offset=0,top_tag=tag_under;!_tagOK(top_tag)&&top_tag==tag_under&&e.originalEvent.pageY-editor.win.pageYOffset-top_offset>0;)top_offset++,top_tag=editor.doc.elementFromPoint(e.originalEvent.pageX-editor.win.pageXOffset,e.originalEvent.pageY-editor.win.pageYOffset-top_offset);(!_tagOK(top_tag)||$draggable_helper&&0===editor.$el.find(top_tag).length&&top_tag!=$draggable_helper.get(0))&&(top_tag=null);for(var bottom_offset=0,bottom_tag=tag_under;!_tagOK(bottom_tag)&&bottom_tag==tag_under&&e.originalEvent.pageY-editor.win.pageYOffset+bottom_offset<$(editor.doc).height();)bottom_offset++,bottom_tag=editor.doc.elementFromPoint(e.originalEvent.pageX-editor.win.pageXOffset,e.originalEvent.pageY-editor.win.pageYOffset+bottom_offset);(!_tagOK(bottom_tag)||$draggable_helper&&0===editor.$el.find(bottom_tag).length&&bottom_tag!=$draggable_helper.get(0))&&(bottom_tag=null),tag_under=null==bottom_tag&&top_tag?top_tag:bottom_tag&&null==top_tag?bottom_tag:bottom_tag&&top_tag?top_offset<bottom_offset?top_tag:bottom_tag:null}if($(tag_under).hasClass("fr-drag-helper"))return!1;if(tag_under&&!editor.node.isBlock(tag_under)&&(tag_under=editor.node.blockParent(tag_under)),tag_under&&["TD","TH","TR","THEAD","TBODY"].indexOf(tag_under.tagName)>=0&&(tag_under=$(tag_under).parents("table").get(0)),tag_under&&["LI"].indexOf(tag_under.tagName)>=0&&(tag_under=$(tag_under).parents("UL, OL").get(0)),tag_under&&!$(tag_under).hasClass("fr-drag-helper")){var above;$draggable_helper||($.FE.$draggable_helper||($.FE.$draggable_helper=$('<div class="fr-drag-helper"></div>')),$draggable_helper=$.FE.$draggable_helper,editor.events.on("shared.destroy",(function(){$draggable_helper.html("").removeData().remove(),$draggable_helper=null}),!0)),above=e.originalEvent.pageY<$(tag_under).offset().top+$(tag_under).outerHeight()/2;var $tag_under=$(tag_under),margin=0;above||0!==$tag_under.next().length?(above||($tag_under=$tag_under.next()),"before"==$draggable_helper.data("fr-position")&&$tag_under.is($draggable_helper.data("fr-tag"))||($tag_under.prev().length>0&&(margin=parseFloat($tag_under.prev().css("margin-bottom"))||0),margin=Math.max(margin,parseFloat($tag_under.css("margin-top"))||0),_setHelperSize($tag_under.offset().top-margin/2-editor.$box.offset().top,$tag_under.offset().left-editor.win.pageXOffset-editor.$box.offset().left,$tag_under.width()),$draggable_helper.data("fr-position","before"))):"after"==$draggable_helper.data("fr-position")&&$tag_under.is($draggable_helper.data("fr-tag"))||(margin=parseFloat($tag_under.css("margin-bottom"))||0,_setHelperSize($tag_under.offset().top+$(tag_under).height()+margin/2-editor.$box.offset().top,$tag_under.offset().left-editor.win.pageXOffset-editor.$box.offset().left,$tag_under.width()),$draggable_helper.data("fr-position","after")),$draggable_helper.data("fr-tag",$tag_under),$draggable_helper.addClass("fr-visible"),$draggable_helper.appendTo(editor.$box)}else $draggable_helper&&editor.$box.find($draggable_helper).length>0&&$draggable_helper.removeClass("fr-visible")}(e))}function _dragEnter(e){e.originalEvent.dataTransfer.dropEffect="move",editor.opts.dragInline||e.preventDefault()}function _documentDragEnd(e){editor.$el.attr("contenteditable",!0);var $draggedEl=editor.$el.find(".fr-dragging");$draggable_helper&&$draggable_helper.hasClass("fr-visible")&&editor.$box.find($draggable_helper).length?_drop(e):$draggedEl.length&&(e.preventDefault(),e.stopPropagation()),$draggable_helper&&editor.$box.find($draggable_helper).length&&$draggable_helper.removeClass("fr-visible"),$draggedEl.removeClass("fr-dragging")}function _drop(e){var $draggedEl,inst;"true"!==editor.$el.attr("contenteditable")&&editor.$el.attr("contenteditable",!0);for(var i=0;i<$.FE.INSTANCES.length;i++)if(($draggedEl=$.FE.INSTANCES[i].$el.find(".fr-dragging")).length){inst=$.FE.INSTANCES[i];break}if($draggedEl.length){if(e.preventDefault(),e.stopPropagation(),$draggable_helper&&$draggable_helper.hasClass("fr-visible")&&editor.$box.find($draggable_helper).length)$draggable_helper.data("fr-tag")[$draggable_helper.data("fr-position")]('<span class="fr-marker"></span>'),$draggable_helper.removeClass("fr-visible");else if(!1===editor.markers.insertAtPoint(e.originalEvent))return!1;if($draggedEl.removeClass("fr-dragging"),!1===($draggedEl=editor.events.chainTrigger("element.beforeDrop",$draggedEl)))return!1;var $droppedEl=$draggedEl;if($draggedEl.parent().is("A")&&1==$draggedEl.parent().get(0).childNodes.length&&($droppedEl=$draggedEl.parent()),editor.core.isEmpty())editor.events.focus();else editor.$el.find(".fr-marker").replaceWith($.FE.MARKERS),editor.selection.restore();if(inst==editor||editor.undo.canDo()||editor.undo.saveStep(),editor.core.isEmpty())editor.$el.html($droppedEl);else{var marker=editor.markers.insert();0===$droppedEl.find(marker).length?$(marker).replaceWith($droppedEl):0===$draggedEl.find(marker).length&&$(marker).replaceWith($draggedEl),$draggedEl.after($.FE.MARKERS),editor.selection.restore()}return editor.popups.hideAll(),editor.selection.save(),editor.$el.find(editor.html.emptyBlockTagsQuery()).not("TD, TH, LI, .fr-inner").not(editor.opts.htmlAllowedEmptyTags.join(",")).remove(),editor.html.wrap(),editor.html.fillEmptyBlocks(),editor.selection.restore(),editor.undo.saveStep(),editor.opts.iframe&&editor.size.syncIframe(),inst!=editor&&(inst.popups.hideAll(),inst.$el.find(inst.html.emptyBlockTagsQuery()).not("TD, TH, LI, .fr-inner").remove(),inst.html.wrap(),inst.html.fillEmptyBlocks(),inst.undo.saveStep(),inst.events.trigger("element.dropped"),inst.opts.iframe&&inst.size.syncIframe()),editor.events.trigger("element.dropped",[$droppedEl]),!1}$draggable_helper&&$draggable_helper.removeClass("fr-visible"),editor.undo.canDo()||editor.undo.saveStep(),setTimeout((function(){editor.undo.saveStep()}),0)}function _cleanOnGet(el){if(el&&"DIV"==el.tagName&&editor.node.hasClass(el,"fr-drag-helper"))el.parentNode.removeChild(el);else if(el&&el.nodeType==Node.ELEMENT_NODE)for(var els=el.querySelectorAll("div.fr-drag-helper"),i=0;i<els.length;i++)els[i].parentNode.removeChild(els[i])}var $draggable_helper;return{_init:function(){editor.opts.enter==$.FE.ENTER_BR&&(editor.opts.dragInline=!0),editor.events.on("dragstart",_dragStart,!0),editor.events.on("dragover",_dragOver,!0),editor.events.on("dragenter",_dragEnter,!0),editor.events.on("document.dragend",_documentDragEnd,!0),editor.events.on("document.drop",_documentDragEnd,!0),editor.events.on("drop",_drop,!0),editor.events.on("html.processGet",_cleanOnGet)}}}}(jQuery),jQuery.FE.PLUGINS.codeBeautifier=function(){var exports,nonASCIIidentifierStartChars,nonASCIIidentifierStart,nonASCIIidentifier,acorn={};function css_beautify(source_text,options){var NESTED_AT_RULE={"@page":!0,"@font-face":!0,"@keyframes":!0,"@media":!0,"@supports":!0,"@document":!0},CONDITIONAL_GROUP_RULE={"@media":!0,"@supports":!0,"@document":!0};options=options||{},source_text=(source_text=source_text||"").replace(/\r\n|[\r\u2028\u2029]/g,"\n");var indentSize=options.indent_size||4,indentCharacter=options.indent_char||" ",selectorSeparatorNewline=void 0===options.selector_separator_newline||options.selector_separator_newline,end_with_newline=void 0!==options.end_with_newline&&options.end_with_newline,newline_between_rules=void 0===options.newline_between_rules||options.newline_between_rules,eol=options.eol?options.eol:"\n";"string"==typeof indentSize&&(indentSize=parseInt(indentSize,10)),options.indent_with_tabs&&(indentCharacter="\t",indentSize=1),eol=eol.replace(/\\r/,"\r").replace(/\\n/,"\n");var ch,whiteRe=/^\s+$/,pos=-1,parenLevel=0;function next(){return(ch=source_text.charAt(++pos))||""}function peek(skipWhitespace){var result,prev_pos=pos;return skipWhitespace&&eatWhitespace(),result=source_text.charAt(pos+1)||"",pos=prev_pos-1,next(),result}function eatString(endChars){for(var start=pos;next();)if("\\"===ch)next();else{if(-1!==endChars.indexOf(ch))break;if("\n"===ch)break}return source_text.substring(start,pos+1)}function eatWhitespace(){for(var result="";whiteRe.test(peek());)next(),result+=ch;return result}function skipWhitespace(){var result="";for(ch&&whiteRe.test(ch)&&(result=ch);whiteRe.test(next());)result+=ch;return result}function eatComment(singleLine){var start=pos;for(singleLine="/"===peek(),next();next();){if(!singleLine&&"*"===ch&&"/"===peek()){next();break}if(singleLine&&"\n"===ch)return source_text.substring(start,pos)}return source_text.substring(start,pos)+ch}function lookBack(str){return source_text.substring(pos-str.length,pos).toLowerCase()===str}function foundNestedPseudoClass(){for(var openParen=0,i=pos+1;i<source_text.length;i++){var ch=source_text.charAt(i);if("{"===ch)return!0;if("("===ch)openParen+=1;else if(")"===ch){if(0==openParen)return!1;openParen-=1}else if(";"===ch||"}"===ch)return!1}return!1}for(var prev_pos,str,basebaseIndentString=source_text.match(/^[\t ]*/)[0],singleIndent=new Array(indentSize+1).join(indentCharacter),indentLevel=0,nestedLevel=0,print={"{":function(ch){print.singleSpace(),output.push(ch),print.newLine()},"}":function(ch){print.newLine(),output.push(ch),print.newLine()},_lastCharWhitespace:function(){return whiteRe.test(output[output.length-1])},newLine:function(keepWhitespace){output.length&&(keepWhitespace||"\n"===output[output.length-1]||print.trim(),output.push("\n"),basebaseIndentString&&output.push(basebaseIndentString))},singleSpace:function(){output.length&&!print._lastCharWhitespace()&&output.push(" ")},preserveSingleSpace:function(){isAfterSpace&&print.singleSpace()},trim:function(){for(;print._lastCharWhitespace();)output.pop()}},output=[],insideRule=!1,insidePropertyValue=!1,enteringConditionalGroup=!1,top_ch="",last_top_ch="";;){var whitespace=skipWhitespace(),isAfterSpace=""!==whitespace,isAfterNewline=-1!==whitespace.indexOf("\n");if(last_top_ch=top_ch,top_ch=ch,!ch)break;if("/"===ch&&"*"===peek()){var header=0===indentLevel;(isAfterNewline||header)&&print.newLine(),output.push(eatComment()),print.newLine(),header&&print.newLine(!0)}else if("/"===ch&&"/"===peek())isAfterNewline||"{"===last_top_ch||print.trim(),print.singleSpace(),output.push(eatComment()),print.newLine();else if("@"===ch){print.preserveSingleSpace(),output.push(ch);var variableOrRule=(prev_pos=void 0,str=void 0,prev_pos=pos,str=eatString(": ,;{}()[]/='\""),pos=prev_pos-1,next(),str);variableOrRule.match(/[ :]$/)&&(next(),variableOrRule=eatString(": ").replace(/\s$/,""),output.push(variableOrRule),print.singleSpace()),(variableOrRule=variableOrRule.replace(/\s$/,""))in NESTED_AT_RULE&&(nestedLevel+=1,variableOrRule in CONDITIONAL_GROUP_RULE&&(enteringConditionalGroup=!0))}else"#"===ch&&"{"===peek()?(print.preserveSingleSpace(),output.push(eatString("}"))):"{"===ch?"}"===peek(!0)?(eatWhitespace(),next(),print.singleSpace(),output.push("{}"),print.newLine(),newline_between_rules&&0===indentLevel&&print.newLine(!0)):(indentLevel++,basebaseIndentString+=singleIndent,print["{"](ch),enteringConditionalGroup?(enteringConditionalGroup=!1,insideRule=indentLevel>nestedLevel):insideRule=indentLevel>=nestedLevel):"}"===ch?(indentLevel--,basebaseIndentString=basebaseIndentString.slice(0,-indentSize),print["}"](ch),insideRule=!1,insidePropertyValue=!1,nestedLevel&&nestedLevel--,newline_between_rules&&0===indentLevel&&print.newLine(!0)):":"===ch?(eatWhitespace(),!insideRule&&!enteringConditionalGroup||lookBack("&")||foundNestedPseudoClass()?":"===peek()?(next(),output.push("::")):output.push(":"):(insidePropertyValue=!0,output.push(":"),print.singleSpace())):'"'===ch||"'"===ch?(print.preserveSingleSpace(),output.push(eatString(ch))):";"===ch?(insidePropertyValue=!1,output.push(ch),print.newLine()):"("===ch?lookBack("url")?(output.push(ch),eatWhitespace(),next()&&(")"!==ch&&'"'!==ch&&"'"!==ch?output.push(eatString(")")):pos--)):(parenLevel++,print.preserveSingleSpace(),output.push(ch),eatWhitespace()):")"===ch?(output.push(ch),parenLevel--):","===ch?(output.push(ch),eatWhitespace(),selectorSeparatorNewline&&!insidePropertyValue&&parenLevel<1?print.newLine():print.singleSpace()):"]"===ch?output.push(ch):"["===ch?(print.preserveSingleSpace(),output.push(ch)):"="===ch?(eatWhitespace(),ch="=",output.push(ch)):(print.preserveSingleSpace(),output.push(ch))}var sweetCode="";return basebaseIndentString&&(sweetCode+=basebaseIndentString),sweetCode+=output.join("").replace(/[\r\n\t ]+$/,""),end_with_newline&&(sweetCode+="\n"),"\n"!=eol&&(sweetCode=sweetCode.replace(/[\n]/g,eol)),sweetCode}function in_array(what,arr){for(var i=0;i<arr.length;i+=1)if(arr[i]===what)return!0;return!1}function trim(s){return s.replace(/^\s+|\s+$/g,"")}function js_beautify(js_source_text,options){return new Beautifier(js_source_text,options).beautify()}exports=acorn,nonASCIIidentifierStartChars="ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛰᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々-〇〡-〩〱-〵〸-〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",nonASCIIidentifierStart=new RegExp("["+nonASCIIidentifierStartChars+"]"),nonASCIIidentifier=new RegExp("["+nonASCIIidentifierStartChars+"̀-ͯ҃-֑҇-ׇֽֿׁׂׅׄؐ-ؚؠ-ىٲ-ۓۧ-ۨۻ-ۼܰ-݊ࠀ-ࠔࠛ-ࠣࠥ-ࠧࠩ-࠭ࡀ-ࡗࣤ-ࣾऀ-ःऺ-़ा-ॏ॑-ॗॢ-ॣ०-९ঁ-ঃ়া-ৄেৈৗয়-ৠਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑ੦-ੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢ-ૣ૦-૯ଁ-ଃ଼ା-ୄେୈୋ-୍ୖୗୟ-ୠ୦-୯ஂா-ூெ-ைொ-்ௗ௦-௯ఁ-ఃె-ైొ-్ౕౖౢ-ౣ౦-౯ಂಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢ-ೣ೦-೯ംഃെ-ൈൗൢ-ൣ൦-൯ංඃ්ා-ුූෘ-ෟෲෳิ-ฺเ-ๅ๐-๙ິ-ູ່-ໍ໐-໙༘༙༠-༩༹༵༷ཁ-ཇཱ-྄྆-྇ྍ-ྗྙ-ྼ࿆က-ဩ၀-၉ၧ-ၭၱ-ၴႂ-ႍႏ-ႝ፝-፟ᜎ-ᜐᜠ-ᜰᝀ-ᝐᝲᝳក-ឲ៝០-៩᠋-᠍᠐-᠙ᤠ-ᤫᤰ-᤻ᥑ-ᥭᦰ-ᧀᧈ-ᧉ᧐-᧙ᨀ-ᨕᨠ-ᩓ᩠-᩿᩼-᪉᪐-᪙ᭆ-ᭋ᭐-᭙᭫-᭳᮰-᮹᯦-᯳ᰀ-ᰢ᱀-᱉ᱛ-ᱽ᳐-᳒ᴀ-ᶾḁ-ἕ‌‍‿⁀⁔⃐-⃥⃜⃡-⃰ⶁ-ⶖⷠ-ⷿ〡-〨゙゚Ꙁ-ꙭꙴ-꙽ꚟ꛰-꛱ꟸ-ꠀ꠆ꠋꠣ-ꠧꢀ-ꢁꢴ-꣄꣐-꣙ꣳ-ꣷ꤀-꤉ꤦ-꤭ꤰ-ꥅꦀ-ꦃ꦳-꧀ꨀ-ꨧꩀ-ꩁꩌ-ꩍ꩐-꩙ꩻꫠ-ꫩꫲ-ꫳꯀ-ꯡ꯬꯭꯰-꯹ﬠ-ﬨ︀-️︠-︦︳︴﹍-﹏０-９＿]"),exports.newline=/[\n\r\u2028\u2029]/,exports.lineBreak=new RegExp("\r\n|"+exports.newline.source),exports.allLineBreaks=new RegExp(exports.lineBreak.source,"g"),exports.isIdentifierStart=function(code){return code<65?36===code||64===code:code<91||(code<97?95===code:code<123||code>=170&&nonASCIIidentifierStart.test(String.fromCharCode(code)))},exports.isIdentifierChar=function(code){return code<48?36===code:code<58||!(code<65)&&(code<91||(code<97?95===code:code<123||code>=170&&nonASCIIidentifier.test(String.fromCharCode(code))))};var MODE_BlockStatement="BlockStatement",MODE_Statement="Statement",MODE_ObjectLiteral="ObjectLiteral",MODE_ArrayLiteral="ArrayLiteral",MODE_ForInitializer="ForInitializer",MODE_Conditional="Conditional",MODE_Expression="Expression";function Beautifier(js_source_text,options){var output,token_pos,Tokenizer,current_token,last_type,last_last_text,indent_string,flags,previous_flags,flag_store,prefix,handlers,opt,tokens=[],baseIndentString="";function create_flags(flags_base,mode){var next_indent_level=0;return flags_base&&(next_indent_level=flags_base.indentation_level,!output.just_added_newline()&&flags_base.line_indent_level>next_indent_level&&(next_indent_level=flags_base.line_indent_level)),{mode:mode,parent:flags_base,last_text:flags_base?flags_base.last_text:"",last_word:flags_base?flags_base.last_word:"",declaration_statement:!1,declaration_assignment:!1,multiline_frame:!1,if_block:!1,else_block:!1,do_block:!1,do_while:!1,in_case_statement:!1,in_case:!1,case_body:!1,indentation_level:next_indent_level,line_indent_level:flags_base?flags_base.line_indent_level:next_indent_level,start_line_index:output.get_line_number(),ternary_depth:0}}for(handlers={TK_START_EXPR:function(){start_of_statement();var next_mode=MODE_Expression;if("["===current_token.text){if("TK_WORD"===last_type||")"===flags.last_text)return"TK_RESERVED"===last_type&&in_array(flags.last_text,Tokenizer.line_starters)&&(output.space_before_token=!0),set_mode(next_mode),print_token(),indent(),void(opt.space_in_paren&&(output.space_before_token=!0));next_mode=MODE_ArrayLiteral,is_array(flags.mode)&&("["!==flags.last_text&&(","!==flags.last_text||"]"!==last_last_text&&"}"!==last_last_text)||opt.keep_array_indentation||print_newline())}else"TK_RESERVED"===last_type&&"for"===flags.last_text?next_mode=MODE_ForInitializer:"TK_RESERVED"===last_type&&in_array(flags.last_text,["if","while"])&&(next_mode=MODE_Conditional);";"===flags.last_text||"TK_START_BLOCK"===last_type?print_newline():"TK_END_EXPR"===last_type||"TK_START_EXPR"===last_type||"TK_END_BLOCK"===last_type||"."===flags.last_text?allow_wrap_or_preserved_newline(current_token.wanted_newline):"TK_RESERVED"===last_type&&"("===current_token.text||"TK_WORD"===last_type||"TK_OPERATOR"===last_type?"TK_RESERVED"===last_type&&("function"===flags.last_word||"typeof"===flags.last_word)||"*"===flags.last_text&&"function"===last_last_text?opt.space_after_anon_function&&(output.space_before_token=!0):"TK_RESERVED"!==last_type||!in_array(flags.last_text,Tokenizer.line_starters)&&"catch"!==flags.last_text||opt.space_before_conditional&&(output.space_before_token=!0):output.space_before_token=!0,"("===current_token.text&&"TK_RESERVED"===last_type&&"await"===flags.last_word&&(output.space_before_token=!0),"("===current_token.text&&("TK_EQUALS"!==last_type&&"TK_OPERATOR"!==last_type||start_of_object_property()||allow_wrap_or_preserved_newline()),set_mode(next_mode),print_token(),opt.space_in_paren&&(output.space_before_token=!0),indent()},TK_END_EXPR:function(){for(;flags.mode===MODE_Statement;)restore_mode();flags.multiline_frame&&allow_wrap_or_preserved_newline("]"===current_token.text&&is_array(flags.mode)&&!opt.keep_array_indentation),opt.space_in_paren&&("TK_START_EXPR"!==last_type||opt.space_in_empty_paren?output.space_before_token=!0:(output.trim(),output.space_before_token=!1)),"]"===current_token.text&&opt.keep_array_indentation?(print_token(),restore_mode()):(restore_mode(),print_token()),output.remove_redundant_indentation(previous_flags),flags.do_while&&previous_flags.mode===MODE_Conditional&&(previous_flags.mode=MODE_Expression,flags.do_block=!1,flags.do_while=!1)},TK_START_BLOCK:function(){var next_token=get_token(1),second_token=get_token(2);second_token&&(":"===second_token.text&&in_array(next_token.type,["TK_STRING","TK_WORD","TK_RESERVED"])||in_array(next_token.text,["get","set"])&&in_array(second_token.type,["TK_WORD","TK_RESERVED"]))?in_array(last_last_text,["class","interface"])?set_mode(MODE_BlockStatement):set_mode(MODE_ObjectLiteral):set_mode(MODE_BlockStatement);var empty_anonymous_function=!next_token.comments_before.length&&"}"===next_token.text&&"function"===flags.last_word&&"TK_END_EXPR"===last_type;"expand"===opt.brace_style||"none"===opt.brace_style&&current_token.wanted_newline?"TK_OPERATOR"!==last_type&&(empty_anonymous_function||"TK_EQUALS"===last_type||"TK_RESERVED"===last_type&&is_special_word(flags.last_text)&&"else"!==flags.last_text)?output.space_before_token=!0:print_newline(!1,!0):"TK_OPERATOR"!==last_type&&"TK_START_EXPR"!==last_type?"TK_START_BLOCK"===last_type?print_newline():output.space_before_token=!0:is_array(previous_flags.mode)&&","===flags.last_text&&("}"===last_last_text?output.space_before_token=!0:print_newline()),print_token(),indent()},TK_END_BLOCK:function(){for(;flags.mode===MODE_Statement;)restore_mode();var empty_braces="TK_START_BLOCK"===last_type;"expand"===opt.brace_style?empty_braces||print_newline():empty_braces||(is_array(flags.mode)&&opt.keep_array_indentation?(opt.keep_array_indentation=!1,print_newline(),opt.keep_array_indentation=!0):print_newline()),restore_mode(),print_token()},TK_WORD:handle_word,TK_RESERVED:handle_word,TK_SEMICOLON:function(){for(start_of_statement()&&(output.space_before_token=!1);flags.mode===MODE_Statement&&!flags.if_block&&!flags.do_block;)restore_mode();print_token()},TK_STRING:function(){start_of_statement()||"TK_RESERVED"===last_type||"TK_WORD"===last_type?output.space_before_token=!0:"TK_COMMA"===last_type||"TK_START_EXPR"===last_type||"TK_EQUALS"===last_type||"TK_OPERATOR"===last_type?start_of_object_property()||allow_wrap_or_preserved_newline():print_newline(),print_token()},TK_EQUALS:function(){start_of_statement(),flags.declaration_statement&&(flags.declaration_assignment=!0),output.space_before_token=!0,print_token(),output.space_before_token=!0},TK_OPERATOR:function(){if(start_of_statement(),"TK_RESERVED"===last_type&&is_special_word(flags.last_text))return output.space_before_token=!0,void print_token();if("*"!==current_token.text||"TK_DOT"!==last_type){if(":"===current_token.text&&flags.in_case)return flags.case_body=!0,indent(),print_token(),print_newline(),void(flags.in_case=!1);if("::"!==current_token.text){"TK_OPERATOR"===last_type&&allow_wrap_or_preserved_newline();var space_before=!0,space_after=!0;in_array(current_token.text,["--","++","!","~"])||in_array(current_token.text,["-","+"])&&(in_array(last_type,["TK_START_BLOCK","TK_START_EXPR","TK_EQUALS","TK_OPERATOR"])||in_array(flags.last_text,Tokenizer.line_starters)||","===flags.last_text)?(space_before=!1,space_after=!1,!current_token.wanted_newline||"--"!==current_token.text&&"++"!==current_token.text||print_newline(!1,!0),";"===flags.last_text&&is_expression(flags.mode)&&(space_before=!0),"TK_RESERVED"===last_type?space_before=!0:"TK_END_EXPR"===last_type?space_before=!("]"===flags.last_text&&("--"===current_token.text||"++"===current_token.text)):"TK_OPERATOR"===last_type&&(space_before=in_array(current_token.text,["--","-","++","+"])&&in_array(flags.last_text,["--","-","++","+"]),in_array(current_token.text,["+","-"])&&in_array(flags.last_text,["--","++"])&&(space_after=!0)),flags.mode!==MODE_BlockStatement&&flags.mode!==MODE_Statement||"{"!==flags.last_text&&";"!==flags.last_text||print_newline()):":"===current_token.text?0===flags.ternary_depth?space_before=!1:flags.ternary_depth-=1:"?"===current_token.text?flags.ternary_depth+=1:"*"===current_token.text&&"TK_RESERVED"===last_type&&"function"===flags.last_text&&(space_before=!1,space_after=!1),output.space_before_token=output.space_before_token||space_before,print_token(),output.space_before_token=space_after}else print_token()}else print_token()},TK_COMMA:function(){if(flags.declaration_statement)return is_expression(flags.parent.mode)&&(flags.declaration_assignment=!1),print_token(),void(flags.declaration_assignment?(flags.declaration_assignment=!1,print_newline(!1,!0)):(output.space_before_token=!0,opt.comma_first&&allow_wrap_or_preserved_newline()));print_token(),flags.mode===MODE_ObjectLiteral||flags.mode===MODE_Statement&&flags.parent.mode===MODE_ObjectLiteral?(flags.mode===MODE_Statement&&restore_mode(),print_newline()):(output.space_before_token=!0,opt.comma_first&&allow_wrap_or_preserved_newline())},TK_BLOCK_COMMENT:function(){if(output.raw)return output.add_raw_token(current_token),void(current_token.directives&&"end"===current_token.directives.preserve&&(opt.test_output_raw||(output.raw=!1)));if(current_token.directives)return print_newline(!1,!0),print_token(),"start"===current_token.directives.preserve&&(output.raw=!0),void print_newline(!1,!0);if(!acorn.newline.test(current_token.text)&&!current_token.wanted_newline)return output.space_before_token=!0,print_token(),void(output.space_before_token=!0);var j,lines=function(s){s=s.replace(/\x0d/g,"");for(var out=[],idx=s.indexOf("\n");-1!==idx;)out.push(s.substring(0,idx)),idx=(s=s.substring(idx+1)).indexOf("\n");return s.length&&out.push(s),out}(current_token.text),javadoc=!1,starless=!1,lastIndent=current_token.whitespace_before,lastIndentLength=lastIndent.length;for(print_newline(!1,!0),lines.length>1&&(function(lines,c){for(var i=0;i<lines.length;i++)if(trim(lines[i]).charAt(0)!==c)return!1;return!0}(lines.slice(1),"*")?javadoc=!0:function(lines,indent){for(var line,i=0,len=lines.length;i<len;i++)if((line=lines[i])&&0!==line.indexOf(indent))return!1;return!0}(lines.slice(1),lastIndent)&&(starless=!0)),print_token(lines[0]),j=1;j<lines.length;j++)print_newline(!1,!0),javadoc?print_token(" "+lines[j].replace(/^\s+/g,"")):starless&&lines[j].length>lastIndentLength?print_token(lines[j].substring(lastIndentLength)):output.add_token(lines[j]);print_newline(!1,!0)},TK_COMMENT:function(){current_token.wanted_newline?print_newline(!1,!0):output.trim(!0),output.space_before_token=!0,print_token(),print_newline(!1,!0)},TK_DOT:function(){start_of_statement(),"TK_RESERVED"===last_type&&is_special_word(flags.last_text)?output.space_before_token=!0:allow_wrap_or_preserved_newline(")"===flags.last_text&&opt.break_chained_methods),print_token()},TK_UNKNOWN:function(){print_token(),"\n"===current_token.text[current_token.text.length-1]&&print_newline()},TK_EOF:function(){for(;flags.mode===MODE_Statement;)restore_mode()}},opt={},void 0!==(options=options||{}).braces_on_own_line&&(opt.brace_style=options.braces_on_own_line?"expand":"collapse"),opt.brace_style=options.brace_style?options.brace_style:opt.brace_style?opt.brace_style:"collapse","expand-strict"===opt.brace_style&&(opt.brace_style="expand"),opt.indent_size=options.indent_size?parseInt(options.indent_size,10):4,opt.indent_char=options.indent_char?options.indent_char:" ",opt.eol=options.eol?options.eol:"\n",opt.preserve_newlines=void 0===options.preserve_newlines||options.preserve_newlines,opt.break_chained_methods=void 0!==options.break_chained_methods&&options.break_chained_methods,opt.max_preserve_newlines=void 0===options.max_preserve_newlines?0:parseInt(options.max_preserve_newlines,10),opt.space_in_paren=void 0!==options.space_in_paren&&options.space_in_paren,opt.space_in_empty_paren=void 0!==options.space_in_empty_paren&&options.space_in_empty_paren,opt.jslint_happy=void 0!==options.jslint_happy&&options.jslint_happy,opt.space_after_anon_function=void 0!==options.space_after_anon_function&&options.space_after_anon_function,opt.keep_array_indentation=void 0!==options.keep_array_indentation&&options.keep_array_indentation,opt.space_before_conditional=void 0===options.space_before_conditional||options.space_before_conditional,opt.unescape_strings=void 0!==options.unescape_strings&&options.unescape_strings,opt.wrap_line_length=void 0===options.wrap_line_length?0:parseInt(options.wrap_line_length,10),opt.e4x=void 0!==options.e4x&&options.e4x,opt.end_with_newline=void 0!==options.end_with_newline&&options.end_with_newline,opt.comma_first=void 0!==options.comma_first&&options.comma_first,opt.test_output_raw=void 0!==options.test_output_raw&&options.test_output_raw,opt.jslint_happy&&(opt.space_after_anon_function=!0),options.indent_with_tabs&&(opt.indent_char="\t",opt.indent_size=1),opt.eol=opt.eol.replace(/\\r/,"\r").replace(/\\n/,"\n"),indent_string="";opt.indent_size>0;)indent_string+=opt.indent_char,opt.indent_size-=1;var preindent_index=0;if(js_source_text&&js_source_text.length){for(;" "===js_source_text.charAt(preindent_index)||"\t"===js_source_text.charAt(preindent_index);)baseIndentString+=js_source_text.charAt(preindent_index),preindent_index+=1;js_source_text=js_source_text.substring(preindent_index)}function handle_token(local_token){var newlines=local_token.newlines;if(opt.keep_array_indentation&&is_array(flags.mode))for(i=0;i<newlines;i+=1)print_newline(i>0);else if(opt.max_preserve_newlines&&newlines>opt.max_preserve_newlines&&(newlines=opt.max_preserve_newlines),opt.preserve_newlines&&local_token.newlines>1){print_newline();for(var i=1;i<newlines;i+=1)print_newline(!0)}handlers[(current_token=local_token).type]()}function allow_wrap_or_preserved_newline(force_linewrap){force_linewrap=void 0!==force_linewrap&&force_linewrap,output.just_added_newline()||(opt.preserve_newlines&&current_token.wanted_newline||force_linewrap||opt.wrap_line_length&&output.current_line.get_character_count()+current_token.text.length+(output.space_before_token?1:0)>=opt.wrap_line_length)&&print_newline(!1,!0)}function print_newline(force_newline,preserve_statement_flags){if(!preserve_statement_flags&&";"!==flags.last_text&&","!==flags.last_text&&"="!==flags.last_text&&"TK_OPERATOR"!==last_type)for(;flags.mode===MODE_Statement&&!flags.if_block&&!flags.do_block;)restore_mode();output.add_new_line(force_newline)&&(flags.multiline_frame=!0)}function print_token_line_indentation(){output.just_added_newline()&&(opt.keep_array_indentation&&is_array(flags.mode)&&current_token.wanted_newline?(output.current_line.push(current_token.whitespace_before),output.space_before_token=!1):output.set_indent(flags.indentation_level)&&(flags.line_indent_level=flags.indentation_level))}function print_token(printable_token){output.raw?output.add_raw_token(current_token):(opt.comma_first&&"TK_COMMA"===last_type&&output.just_added_newline()&&","===output.previous_line.last()&&(output.previous_line.pop(),print_token_line_indentation(),output.add_token(","),output.space_before_token=!0),printable_token=printable_token||current_token.text,print_token_line_indentation(),output.add_token(printable_token))}function indent(){flags.indentation_level+=1}function set_mode(mode){flags?(flag_store.push(flags),previous_flags=flags):previous_flags=create_flags(null,mode),flags=create_flags(previous_flags,mode)}function is_array(mode){return mode===MODE_ArrayLiteral}function is_expression(mode){return in_array(mode,[MODE_Expression,MODE_ForInitializer,MODE_Conditional])}function restore_mode(){flag_store.length>0&&(previous_flags=flags,flags=flag_store.pop(),previous_flags.mode===MODE_Statement&&output.remove_redundant_indentation(previous_flags))}function start_of_object_property(){return flags.parent.mode===MODE_ObjectLiteral&&flags.mode===MODE_Statement&&(":"===flags.last_text&&0===flags.ternary_depth||"TK_RESERVED"===last_type&&in_array(flags.last_text,["get","set"]))}function start_of_statement(){return!!("TK_RESERVED"===last_type&&in_array(flags.last_text,["var","let","const"])&&"TK_WORD"===current_token.type||"TK_RESERVED"===last_type&&"do"===flags.last_text||"TK_RESERVED"===last_type&&"return"===flags.last_text&&!current_token.wanted_newline||"TK_RESERVED"===last_type&&"else"===flags.last_text&&("TK_RESERVED"!==current_token.type||"if"!==current_token.text)||"TK_END_EXPR"===last_type&&(previous_flags.mode===MODE_ForInitializer||previous_flags.mode===MODE_Conditional)||"TK_WORD"===last_type&&flags.mode===MODE_BlockStatement&&!flags.in_case&&"--"!==current_token.text&&"++"!==current_token.text&&"function"!==last_last_text&&"TK_WORD"!==current_token.type&&"TK_RESERVED"!==current_token.type||flags.mode===MODE_ObjectLiteral&&(":"===flags.last_text&&0===flags.ternary_depth||"TK_RESERVED"===last_type&&in_array(flags.last_text,["get","set"])))&&(set_mode(MODE_Statement),indent(),"TK_RESERVED"===last_type&&in_array(flags.last_text,["var","let","const"])&&"TK_WORD"===current_token.type&&(flags.declaration_statement=!0),start_of_object_property()||allow_wrap_or_preserved_newline("TK_RESERVED"===current_token.type&&in_array(current_token.text,["do","for","if","while"])),!0)}function is_special_word(word){return in_array(word,["case","return","do","if","throw","else"])}function get_token(offset){var index=token_pos+(offset||0);return index<0||index>=tokens.length?null:tokens[index]}function handle_word(){if("TK_RESERVED"===current_token.type&&flags.mode!==MODE_ObjectLiteral&&in_array(current_token.text,["set","get"])&&(current_token.type="TK_WORD"),"TK_RESERVED"===current_token.type&&flags.mode===MODE_ObjectLiteral&&":"==get_token(1).text&&(current_token.type="TK_WORD"),start_of_statement()||!current_token.wanted_newline||is_expression(flags.mode)||"TK_OPERATOR"===last_type&&"--"!==flags.last_text&&"++"!==flags.last_text||"TK_EQUALS"===last_type||!opt.preserve_newlines&&"TK_RESERVED"===last_type&&in_array(flags.last_text,["var","let","const","set","get"])||print_newline(),flags.do_block&&!flags.do_while){if("TK_RESERVED"===current_token.type&&"while"===current_token.text)return output.space_before_token=!0,print_token(),output.space_before_token=!0,void(flags.do_while=!0);print_newline(),flags.do_block=!1}if(flags.if_block)if(flags.else_block||"TK_RESERVED"!==current_token.type||"else"!==current_token.text){for(;flags.mode===MODE_Statement;)restore_mode();flags.if_block=!1,flags.else_block=!1}else flags.else_block=!0;return"TK_RESERVED"===current_token.type&&("case"===current_token.text||"default"===current_token.text&&flags.in_case_statement)?(print_newline(),(flags.case_body||opt.jslint_happy)&&(flags.indentation_level>0&&(!flags.parent||flags.indentation_level>flags.parent.indentation_level)&&(flags.indentation_level-=1),flags.case_body=!1),print_token(),flags.in_case=!0,void(flags.in_case_statement=!0)):("TK_RESERVED"===current_token.type&&"function"===current_token.text&&((in_array(flags.last_text,["}",";"])||output.just_added_newline()&&!in_array(flags.last_text,["[","{",":","=",","]))&&(output.just_added_blankline()||current_token.comments_before.length||(print_newline(),print_newline(!0))),"TK_RESERVED"===last_type||"TK_WORD"===last_type?"TK_RESERVED"===last_type&&in_array(flags.last_text,["get","set","new","return","export","async"])||"TK_RESERVED"===last_type&&"default"===flags.last_text&&"export"===last_last_text?output.space_before_token=!0:print_newline():"TK_OPERATOR"===last_type||"="===flags.last_text?output.space_before_token=!0:(flags.multiline_frame||!is_expression(flags.mode)&&!is_array(flags.mode))&&print_newline()),"TK_COMMA"!==last_type&&"TK_START_EXPR"!==last_type&&"TK_EQUALS"!==last_type&&"TK_OPERATOR"!==last_type||start_of_object_property()||allow_wrap_or_preserved_newline(),"TK_RESERVED"===current_token.type&&in_array(current_token.text,["function","get","set"])?(print_token(),void(flags.last_word=current_token.text)):(prefix="NONE","TK_END_BLOCK"===last_type?"TK_RESERVED"===current_token.type&&in_array(current_token.text,["else","catch","finally"])?"expand"===opt.brace_style||"end-expand"===opt.brace_style||"none"===opt.brace_style&&current_token.wanted_newline?prefix="NEWLINE":(prefix="SPACE",output.space_before_token=!0):prefix="NEWLINE":"TK_SEMICOLON"===last_type&&flags.mode===MODE_BlockStatement?prefix="NEWLINE":"TK_SEMICOLON"===last_type&&is_expression(flags.mode)?prefix="SPACE":"TK_STRING"===last_type?prefix="NEWLINE":"TK_RESERVED"===last_type||"TK_WORD"===last_type||"*"===flags.last_text&&"function"===last_last_text?prefix="SPACE":"TK_START_BLOCK"===last_type?prefix="NEWLINE":"TK_END_EXPR"===last_type&&(output.space_before_token=!0,prefix="NEWLINE"),"TK_RESERVED"===current_token.type&&in_array(current_token.text,Tokenizer.line_starters)&&")"!==flags.last_text&&(prefix="else"===flags.last_text||"export"===flags.last_text?"SPACE":"NEWLINE"),"TK_RESERVED"===current_token.type&&in_array(current_token.text,["else","catch","finally"])?"TK_END_BLOCK"!==last_type||"expand"===opt.brace_style||"end-expand"===opt.brace_style||"none"===opt.brace_style&&current_token.wanted_newline?print_newline():(output.trim(!0),"}"!==output.current_line.last()&&print_newline(),output.space_before_token=!0):"NEWLINE"===prefix?"TK_RESERVED"===last_type&&is_special_word(flags.last_text)?output.space_before_token=!0:"TK_END_EXPR"!==last_type?"TK_START_EXPR"===last_type&&"TK_RESERVED"===current_token.type&&in_array(current_token.text,["var","let","const"])||":"===flags.last_text||("TK_RESERVED"===current_token.type&&"if"===current_token.text&&"else"===flags.last_text?output.space_before_token=!0:print_newline()):"TK_RESERVED"===current_token.type&&in_array(current_token.text,Tokenizer.line_starters)&&")"!==flags.last_text&&print_newline():flags.multiline_frame&&is_array(flags.mode)&&","===flags.last_text&&"}"===last_last_text?print_newline():"SPACE"===prefix&&(output.space_before_token=!0),print_token(),flags.last_word=current_token.text,"TK_RESERVED"===current_token.type&&"do"===current_token.text&&(flags.do_block=!0),void("TK_RESERVED"===current_token.type&&"if"===current_token.text&&(flags.if_block=!0))))}last_type="TK_START_BLOCK",last_last_text="",(output=new Output(indent_string,baseIndentString)).raw=opt.test_output_raw,flag_store=[],set_mode(MODE_BlockStatement),this.beautify=function(){var local_token,sweet_code;for(Tokenizer=new tokenizer(js_source_text,opt,indent_string),tokens=Tokenizer.tokenize(),token_pos=0;local_token=get_token();){for(var i=0;i<local_token.comments_before.length;i++)handle_token(local_token.comments_before[i]);handle_token(local_token),last_last_text=flags.last_text,last_type=local_token.type,flags.last_text=local_token.text,token_pos+=1}return sweet_code=output.get_code(),opt.end_with_newline&&(sweet_code+="\n"),"\n"!=opt.eol&&(sweet_code=sweet_code.replace(/[\n]/g,opt.eol)),sweet_code}}function OutputLine(parent){var _character_count=0,_indent_count=-1,_items=[],_empty=!0;this.set_indent=function(level){_character_count=parent.baseIndentLength+level*parent.indent_length,_indent_count=level},this.get_character_count=function(){return _character_count},this.is_empty=function(){return _empty},this.last=function(){return this._empty?null:_items[_items.length-1]},this.push=function(input){_items.push(input),_character_count+=input.length,_empty=!1},this.pop=function(){var item=null;return _empty||(item=_items.pop(),_character_count-=item.length,_empty=0===_items.length),item},this.remove_indent=function(){_indent_count>0&&(_indent_count-=1,_character_count-=parent.indent_length)},this.trim=function(){for(;" "===this.last();)_items.pop(),_character_count-=1;_empty=0===_items.length},this.toString=function(){var result="";return this._empty||(_indent_count>=0&&(result=parent.indent_cache[_indent_count]),result+=_items.join("")),result}}function Output(indent_string,baseIndentString){baseIndentString=baseIndentString||"",this.indent_cache=[baseIndentString],this.baseIndentLength=baseIndentString.length,this.indent_length=indent_string.length,this.raw=!1;var lines=[];this.baseIndentString=baseIndentString,this.indent_string=indent_string,this.previous_line=null,this.current_line=null,this.space_before_token=!1,this.add_outputline=function(){this.previous_line=this.current_line,this.current_line=new OutputLine(this),lines.push(this.current_line)},this.add_outputline(),this.get_line_number=function(){return lines.length},this.add_new_line=function(force_newline){return!(1===this.get_line_number()&&this.just_added_newline()||!force_newline&&this.just_added_newline()||(this.raw||this.add_outputline(),0))},this.get_code=function(){return lines.join("\n").replace(/[\r\n\t ]+$/,"")},this.set_indent=function(level){if(lines.length>1){for(;level>=this.indent_cache.length;)this.indent_cache.push(this.indent_cache[this.indent_cache.length-1]+this.indent_string);return this.current_line.set_indent(level),!0}return this.current_line.set_indent(0),!1},this.add_raw_token=function(token){for(var x=0;x<token.newlines;x++)this.add_outputline();this.current_line.push(token.whitespace_before),this.current_line.push(token.text),this.space_before_token=!1},this.add_token=function(printable_token){this.add_space_before_token(),this.current_line.push(printable_token)},this.add_space_before_token=function(){this.space_before_token&&!this.just_added_newline()&&this.current_line.push(" "),this.space_before_token=!1},this.remove_redundant_indentation=function(frame){if(!frame.multiline_frame&&frame.mode!==MODE_ForInitializer&&frame.mode!==MODE_Conditional)for(var index=frame.start_line_index,output_length=lines.length;index<output_length;)lines[index].remove_indent(),index++},this.trim=function(eat_newlines){for(eat_newlines=void 0!==eat_newlines&&eat_newlines,this.current_line.trim(indent_string,baseIndentString);eat_newlines&&lines.length>1&&this.current_line.is_empty();)lines.pop(),this.current_line=lines[lines.length-1],this.current_line.trim();this.previous_line=lines.length>1?lines[lines.length-2]:null},this.just_added_newline=function(){return this.current_line.is_empty()},this.just_added_blankline=function(){return!!this.just_added_newline()&&(1===lines.length||lines[lines.length-2].is_empty())}}var Token=function(type,text,newlines,whitespace_before,mode,parent){this.type=type,this.text=text,this.comments_before=[],this.newlines=newlines||0,this.wanted_newline=newlines>0,this.whitespace_before=whitespace_before||"",this.parent=null,this.directives=null};function tokenizer(input,opts,indent_string){var whitespace="\n\r\t ".split(""),digit=/[0-9]/,digit_oct=/[01234567]/,digit_hex=/[0123456789abcdefABCDEF]/,punct="+ - * / % & ++ -- = += -= *= /= %= == === != !== > < >= <= >> << >>> >>>= >>= <<= && &= | || ! ~ , : ? ^ ^= |= :: =>".split(" ");this.line_starters="continue,try,throw,return,var,let,const,if,switch,case,default,for,while,break,function,import,export".split(",");var n_newlines,whitespace_before_token,in_html_comment,tokens,parser_pos,input_length,reserved_words=this.line_starters.concat(["do","in","else","get","set","new","catch","finally","typeof","yield","async","await"]),block_comment_pattern=/([\s\S]*?)((?:\*\/)|$)/g,comment_pattern=/([^\n\r\u2028\u2029]*)/g,directives_block_pattern=/\/\* beautify( \w+[:]\w+)+ \*\//g,directive_pattern=/ (\w+)[:](\w+)/g,directives_end_ignore_pattern=/([\s\S]*?)((?:\/\*\sbeautify\signore:end\s\*\/)|$)/g,template_pattern=/((<\?php|<\?=)[\s\S]*?\?>)|(<%[\s\S]*?%>)/g;function tokenize_next(){var resulting_string,last_token,whitespace_on_this_line=[];if(n_newlines=0,whitespace_before_token="",parser_pos>=input_length)return["","TK_EOF"];last_token=tokens.length?tokens[tokens.length-1]:new Token("TK_START_BLOCK","{");var c=input.charAt(parser_pos);for(parser_pos+=1;in_array(c,whitespace);){if(acorn.newline.test(c)?"\n"===c&&"\r"===input.charAt(parser_pos-2)||(n_newlines+=1,whitespace_on_this_line=[]):whitespace_on_this_line.push(c),parser_pos>=input_length)return["","TK_EOF"];c=input.charAt(parser_pos),parser_pos+=1}if(whitespace_on_this_line.length&&(whitespace_before_token=whitespace_on_this_line.join("")),digit.test(c)){var allow_decimal=!0,allow_e=!0,local_digit=digit;for("0"===c&&parser_pos<input_length&&/[Xxo]/.test(input.charAt(parser_pos))?(allow_decimal=!1,allow_e=!1,c+=input.charAt(parser_pos),parser_pos+=1,local_digit=/[o]/.test(input.charAt(parser_pos))?digit_oct:digit_hex):(c="",parser_pos-=1);parser_pos<input_length&&local_digit.test(input.charAt(parser_pos));)c+=input.charAt(parser_pos),parser_pos+=1,allow_decimal&&parser_pos<input_length&&"."===input.charAt(parser_pos)&&(c+=input.charAt(parser_pos),parser_pos+=1,allow_decimal=!1),allow_e&&parser_pos<input_length&&/[Ee]/.test(input.charAt(parser_pos))&&(c+=input.charAt(parser_pos),(parser_pos+=1)<input_length&&/[+-]/.test(input.charAt(parser_pos))&&(c+=input.charAt(parser_pos),parser_pos+=1),allow_e=!1,allow_decimal=!1);return[c,"TK_WORD"]}if(acorn.isIdentifierStart(input.charCodeAt(parser_pos-1))){if(parser_pos<input_length)for(;acorn.isIdentifierChar(input.charCodeAt(parser_pos))&&(c+=input.charAt(parser_pos),(parser_pos+=1)!==input_length););return"TK_DOT"===last_token.type||"TK_RESERVED"===last_token.type&&in_array(last_token.text,["set","get"])||!in_array(c,reserved_words)?[c,"TK_WORD"]:"in"===c?[c,"TK_OPERATOR"]:[c,"TK_RESERVED"]}if("("===c||"["===c)return[c,"TK_START_EXPR"];if(")"===c||"]"===c)return[c,"TK_END_EXPR"];if("{"===c)return[c,"TK_START_BLOCK"];if("}"===c)return[c,"TK_END_BLOCK"];if(";"===c)return[c,"TK_SEMICOLON"];if("/"===c){var comment="";if("*"===input.charAt(parser_pos)){var comment_match;parser_pos+=1,block_comment_pattern.lastIndex=parser_pos,comment="/*"+(comment_match=block_comment_pattern.exec(input))[0],parser_pos+=comment_match[0].length;var directives=function(text){if(!text.match(directives_block_pattern))return null;var directives={};directive_pattern.lastIndex=0;for(var directive_match=directive_pattern.exec(text);directive_match;)directives[directive_match[1]]=directive_match[2],directive_match=directive_pattern.exec(text);return directives}(comment);return directives&&"start"===directives.ignore&&(directives_end_ignore_pattern.lastIndex=parser_pos,comment+=(comment_match=directives_end_ignore_pattern.exec(input))[0],parser_pos+=comment_match[0].length),[comment=comment.replace(acorn.lineBreak,"\n"),"TK_BLOCK_COMMENT",directives]}if("/"===input.charAt(parser_pos))return parser_pos+=1,comment_pattern.lastIndex=parser_pos,comment="//"+(comment_match=comment_pattern.exec(input))[0],parser_pos+=comment_match[0].length,[comment,"TK_COMMENT"]}if("`"===c||"'"===c||'"'===c||("/"===c||opts.e4x&&"<"===c&&input.slice(parser_pos-1).match(/^<([-a-zA-Z:0-9_.]+|{[^{}]*}|!\[CDATA\[[\s\S]*?\]\])(\s+[-a-zA-Z:0-9_.]+\s*=\s*('[^']*'|"[^"]*"|{.*?}))*\s*(\/?)\s*>/))&&("TK_RESERVED"===last_token.type&&in_array(last_token.text,["return","case","throw","else","do","typeof","yield"])||"TK_END_EXPR"===last_token.type&&")"===last_token.text&&last_token.parent&&"TK_RESERVED"===last_token.parent.type&&in_array(last_token.parent.text,["if","while","for"])||in_array(last_token.type,["TK_COMMENT","TK_START_EXPR","TK_START_BLOCK","TK_END_BLOCK","TK_OPERATOR","TK_EQUALS","TK_EOF","TK_SEMICOLON","TK_COMMA"]))){var sep=c,esc=!1,has_char_escapes=!1;if(resulting_string=c,"/"===sep)for(var in_char_class=!1;parser_pos<input_length&&(esc||in_char_class||input.charAt(parser_pos)!==sep)&&!acorn.newline.test(input.charAt(parser_pos));)resulting_string+=input.charAt(parser_pos),esc?esc=!1:(esc="\\"===input.charAt(parser_pos),"["===input.charAt(parser_pos)?in_char_class=!0:"]"===input.charAt(parser_pos)&&(in_char_class=!1)),parser_pos+=1;else if(opts.e4x&&"<"===sep){var xmlRegExp=/<(\/?)([-a-zA-Z:0-9_.]+|{[^{}]*}|!\[CDATA\[[\s\S]*?\]\])(\s+[-a-zA-Z:0-9_.]+\s*=\s*('[^']*'|"[^"]*"|{.*?}))*\s*(\/?)\s*>/g,xmlStr=input.slice(parser_pos-1),match=xmlRegExp.exec(xmlStr);if(match&&0===match.index){for(var rootTag=match[2],depth=0;match;){var isEndTag=!!match[1],tagName=match[2],isSingletonTag=!!match[match.length-1]||"![CDATA["===tagName.slice(0,8);if(tagName!==rootTag||isSingletonTag||(isEndTag?--depth:++depth),depth<=0)break;match=xmlRegExp.exec(xmlStr)}var xmlLength=match?match.index+match[0].length:xmlStr.length;return xmlStr=xmlStr.slice(0,xmlLength),parser_pos+=xmlLength-1,[xmlStr=xmlStr.replace(acorn.lineBreak,"\n"),"TK_STRING"]}}else for(;parser_pos<input_length&&(esc||input.charAt(parser_pos)!==sep&&("`"===sep||!acorn.newline.test(input.charAt(parser_pos))));)(esc||"`"===sep)&&acorn.newline.test(input.charAt(parser_pos))?("\r"===input.charAt(parser_pos)&&"\n"===input.charAt(parser_pos+1)&&(parser_pos+=1),resulting_string+="\n"):resulting_string+=input.charAt(parser_pos),esc?("x"!==input.charAt(parser_pos)&&"u"!==input.charAt(parser_pos)||(has_char_escapes=!0),esc=!1):esc="\\"===input.charAt(parser_pos),parser_pos+=1;if(has_char_escapes&&opts.unescape_strings&&(resulting_string=function(s){for(var c,esc=!1,out="",pos=0,s_hex="",escaped=0;esc||pos<s.length;)if(c=s.charAt(pos),pos++,esc){if(esc=!1,"x"===c)s_hex=s.substr(pos,2),pos+=2;else{if("u"!==c){out+="\\"+c;continue}s_hex=s.substr(pos,4),pos+=4}if(!s_hex.match(/^[0123456789abcdefABCDEF]+$/))return s;if((escaped=parseInt(s_hex,16))>=0&&escaped<32){out+="x"===c?"\\x"+s_hex:"\\u"+s_hex;continue}if(34===escaped||39===escaped||92===escaped)out+="\\"+String.fromCharCode(escaped);else{if("x"===c&&escaped>126&&escaped<=255)return s;out+=String.fromCharCode(escaped)}}else"\\"===c?esc=!0:out+=c;return out}(resulting_string)),parser_pos<input_length&&input.charAt(parser_pos)===sep&&(resulting_string+=sep,parser_pos+=1,"/"===sep))for(;parser_pos<input_length&&acorn.isIdentifierStart(input.charCodeAt(parser_pos));)resulting_string+=input.charAt(parser_pos),parser_pos+=1;return[resulting_string,"TK_STRING"]}if("#"===c){if(0===tokens.length&&"!"===input.charAt(parser_pos)){for(resulting_string=c;parser_pos<input_length&&"\n"!==c;)resulting_string+=c=input.charAt(parser_pos),parser_pos+=1;return[trim(resulting_string)+"\n","TK_UNKNOWN"]}var sharp="#";if(parser_pos<input_length&&digit.test(input.charAt(parser_pos))){do{sharp+=c=input.charAt(parser_pos),parser_pos+=1}while(parser_pos<input_length&&"#"!==c&&"="!==c);return"#"===c||("["===input.charAt(parser_pos)&&"]"===input.charAt(parser_pos+1)?(sharp+="[]",parser_pos+=2):"{"===input.charAt(parser_pos)&&"}"===input.charAt(parser_pos+1)&&(sharp+="{}",parser_pos+=2)),[sharp,"TK_WORD"]}}if("<"===c&&("?"===input.charAt(parser_pos)||"%"===input.charAt(parser_pos))){template_pattern.lastIndex=parser_pos-1;var template_match=template_pattern.exec(input);if(template_match)return c=template_match[0],parser_pos+=c.length-1,[c=c.replace(acorn.lineBreak,"\n"),"TK_STRING"]}if("<"===c&&"\x3c!--"===input.substring(parser_pos-1,parser_pos+3)){for(parser_pos+=3,c="\x3c!--";!acorn.newline.test(input.charAt(parser_pos))&&parser_pos<input_length;)c+=input.charAt(parser_pos),parser_pos++;return in_html_comment=!0,[c,"TK_COMMENT"]}if("-"===c&&in_html_comment&&"--\x3e"===input.substring(parser_pos-1,parser_pos+2))return in_html_comment=!1,parser_pos+=2,["--\x3e","TK_COMMENT"];if("."===c)return[c,"TK_DOT"];if(in_array(c,punct)){for(;parser_pos<input_length&&in_array(c+input.charAt(parser_pos),punct)&&(c+=input.charAt(parser_pos),!((parser_pos+=1)>=input_length)););return","===c?[c,"TK_COMMA"]:"="===c?[c,"TK_EQUALS"]:[c,"TK_OPERATOR"]}return[c,"TK_UNKNOWN"]}this.tokenize=function(){var next,last,token_values;input_length=input.length,parser_pos=0,in_html_comment=!1,tokens=[];for(var open=null,open_stack=[],comments=[];!last||"TK_EOF"!==last.type;){for(token_values=tokenize_next(),next=new Token(token_values[1],token_values[0],n_newlines,whitespace_before_token);"TK_COMMENT"===next.type||"TK_BLOCK_COMMENT"===next.type||"TK_UNKNOWN"===next.type;)"TK_BLOCK_COMMENT"===next.type&&(next.directives=token_values[2]),comments.push(next),token_values=tokenize_next(),next=new Token(token_values[1],token_values[0],n_newlines,whitespace_before_token);comments.length&&(next.comments_before=comments,comments=[]),"TK_START_BLOCK"===next.type||"TK_START_EXPR"===next.type?(next.parent=last,open_stack.push(open),open=next):("TK_END_BLOCK"===next.type||"TK_END_EXPR"===next.type)&&open&&("]"===next.text&&"["===open.text||")"===next.text&&"("===open.text||"}"===next.text&&"{"===open.text)&&(next.parent=open.parent,open=open_stack.pop()),tokens.push(next),last=next}return tokens}}return{run:function(html_source,options){function rtrim(s){return s.replace(/\s+$/g,"")}var multi_parser,indent_inner_html,indent_size,indent_character,wrap_line_length,brace_style,unformatted,preserve_newlines,max_preserve_newlines,indent_handlebars,wrap_attributes,wrap_attributes_indent_size,end_with_newline,extra_liners;for(void 0!==(options=options||{}).wrap_line_length&&0!==parseInt(options.wrap_line_length,10)||void 0===options.max_char||0===parseInt(options.max_char,10)||(options.wrap_line_length=options.max_char),indent_inner_html=void 0!==options.indent_inner_html&&options.indent_inner_html,indent_size=void 0===options.indent_size?4:parseInt(options.indent_size,10),indent_character=void 0===options.indent_char?" ":options.indent_char,brace_style=void 0===options.brace_style?"collapse":options.brace_style,wrap_line_length=0===parseInt(options.wrap_line_length,10)?32786:parseInt(options.wrap_line_length||250,10),unformatted=options.unformatted||["a","span","img","bdo","em","strong","dfn","code","samp","kbd","var","cite","abbr","acronym","q","sub","sup","tt","i","b","big","small","u","s","strike","font","ins","del","address","pre"],preserve_newlines=void 0===options.preserve_newlines||options.preserve_newlines,max_preserve_newlines=preserve_newlines?isNaN(parseInt(options.max_preserve_newlines,10))?32786:parseInt(options.max_preserve_newlines,10):0,indent_handlebars=void 0!==options.indent_handlebars&&options.indent_handlebars,wrap_attributes=void 0===options.wrap_attributes?"auto":options.wrap_attributes,wrap_attributes_indent_size=void 0===options.wrap_attributes_indent_size?indent_size:parseInt(options.wrap_attributes_indent_size,10)||indent_size,end_with_newline=void 0!==options.end_with_newline&&options.end_with_newline,extra_liners=Array.isArray(options.extra_liners)?options.extra_liners.concat():"string"==typeof options.extra_liners?options.extra_liners.split(","):"head,body,/html".split(","),options.indent_with_tabs&&(indent_character="\t",indent_size=1),multi_parser=new function(){return this.pos=0,this.token="",this.current_mode="CONTENT",this.tags={parent:"parent1",parentcount:1,parent1:""},this.tag_type="",this.token_text=this.last_token=this.last_text=this.token_type="",this.newlines=0,this.indent_content=indent_inner_html,this.Utils={whitespace:"\n\r\t ".split(""),single_token:"br,input,link,meta,source,!doctype,basefont,base,area,hr,wbr,param,img,isindex,embed".split(","),extra_liners:extra_liners,in_array:function(what,arr){for(var i=0;i<arr.length;i++)if(what==arr[i])return!0;return!1}},this.is_whitespace=function(text){for(;0<text.length;text++)if(!this.Utils.in_array(text.charAt(0),this.Utils.whitespace))return!1;return!0},this.traverse_whitespace=function(){var input_char="";if(input_char=this.input.charAt(this.pos),this.Utils.in_array(input_char,this.Utils.whitespace)){for(this.newlines=0;this.Utils.in_array(input_char,this.Utils.whitespace);)preserve_newlines&&"\n"==input_char&&this.newlines<=max_preserve_newlines&&(this.newlines+=1),this.pos++,input_char=this.input.charAt(this.pos);return!0}return!1},this.space_or_wrap=function(content){this.line_char_count>=this.wrap_line_length?(this.print_newline(!1,content),this.print_indentation(content)):(this.line_char_count++,content.push(" "))},this.get_content=function(){for(var input_char="",content=[];"<"!=this.input.charAt(this.pos);){if(this.pos>=this.input.length)return content.length?content.join(""):["","TK_EOF"];if(this.traverse_whitespace())this.space_or_wrap(content);else{if(indent_handlebars){var peek3=this.input.substr(this.pos,3);if("{{#"==peek3||"{{/"==peek3)break;if("{{!"==peek3)return[this.get_tag(),"TK_TAG_HANDLEBARS_COMMENT"];if("{{"==this.input.substr(this.pos,2)&&"{{else}}"==this.get_tag(!0))break}input_char=this.input.charAt(this.pos),this.pos++,this.line_char_count++,content.push(input_char)}}return content.length?content.join(""):""},this.get_contents_to=function(name){if(this.pos==this.input.length)return["","TK_EOF"];var content="",reg_match=new RegExp("</"+name+"\\s*>","igm");reg_match.lastIndex=this.pos;var reg_array=reg_match.exec(this.input),end_script=reg_array?reg_array.index:this.input.length;return this.pos<end_script&&(content=this.input.substring(this.pos,end_script),this.pos=end_script),content},this.record_tag=function(tag){this.tags[tag+"count"]?(this.tags[tag+"count"]++,this.tags[tag+this.tags[tag+"count"]]=this.indent_level):(this.tags[tag+"count"]=1,this.tags[tag+this.tags[tag+"count"]]=this.indent_level),this.tags[tag+this.tags[tag+"count"]+"parent"]=this.tags.parent,this.tags.parent=tag+this.tags[tag+"count"]},this.retrieve_tag=function(tag){if(this.tags[tag+"count"]){for(var temp_parent=this.tags.parent;temp_parent&&tag+this.tags[tag+"count"]!=temp_parent;)temp_parent=this.tags[temp_parent+"parent"];temp_parent&&(this.indent_level=this.tags[tag+this.tags[tag+"count"]],this.tags.parent=this.tags[temp_parent+"parent"]),delete this.tags[tag+this.tags[tag+"count"]+"parent"],delete this.tags[tag+this.tags[tag+"count"]],1==this.tags[tag+"count"]?delete this.tags[tag+"count"]:this.tags[tag+"count"]--}},this.indent_to_tag=function(tag){if(this.tags[tag+"count"]){for(var temp_parent=this.tags.parent;temp_parent&&tag+this.tags[tag+"count"]!=temp_parent;)temp_parent=this.tags[temp_parent+"parent"];temp_parent&&(this.indent_level=this.tags[tag+this.tags[tag+"count"]])}},this.get_tag=function(peek){var tag_start,tag_start_char,input_char="",content=[],comment="",space=!1,first_attr=!0,orig_pos=this.pos,orig_line_char_count=this.line_char_count;peek=void 0!==peek&&peek;do{if(this.pos>=this.input.length)return peek&&(this.pos=orig_pos,this.line_char_count=orig_line_char_count),content.length?content.join(""):["","TK_EOF"];if(input_char=this.input.charAt(this.pos),this.pos++,this.Utils.in_array(input_char,this.Utils.whitespace))space=!0;else{if("'"!=input_char&&'"'!=input_char||(input_char+=this.get_unformatted(input_char),space=!0),"="==input_char&&(space=!1),content.length&&"="!=content[content.length-1]&&">"!=input_char&&space){if(this.space_or_wrap(content),space=!1,!first_attr&&"force"==wrap_attributes&&"/"!=input_char){this.print_newline(!0,content),this.print_indentation(content);for(var count=0;count<wrap_attributes_indent_size;count++)content.push(indent_character)}for(var i=0;i<content.length;i++)if(" "==content[i]){first_attr=!1;break}}if(indent_handlebars&&"<"==tag_start_char&&input_char+this.input.charAt(this.pos)=="{{"&&(input_char+=this.get_unformatted("}}"),content.length&&" "!=content[content.length-1]&&"<"!=content[content.length-1]&&(input_char=" "+input_char),space=!0),"<"!=input_char||tag_start_char||(tag_start=this.pos-1,tag_start_char="<"),indent_handlebars&&!tag_start_char&&content.length>=2&&"{"==content[content.length-1]&&"{"==content[content.length-2]&&(tag_start="#"==input_char||"/"==input_char||"!"==input_char?this.pos-3:this.pos-2,tag_start_char="{"),this.line_char_count++,content.push(input_char),content[1]&&("!"==content[1]||"?"==content[1]||"%"==content[1])){content=[this.get_comment(tag_start)];break}if(indent_handlebars&&content[1]&&"{"==content[1]&&content[2]&&"!"==content[2]){content=[this.get_comment(tag_start)];break}if(indent_handlebars&&"{"==tag_start_char&&content.length>2&&"}"==content[content.length-2]&&"}"==content[content.length-1])break}}while(">"!=input_char);var tag_index,tag_offset,tag_complete=content.join("");tag_index=-1!=tag_complete.indexOf(" ")?tag_complete.indexOf(" "):"{"==tag_complete[0]?tag_complete.indexOf("}"):tag_complete.indexOf(">"),tag_offset="<"!=tag_complete[0]&&indent_handlebars?"#"==tag_complete[2]?3:2:1;var tag_check=tag_complete.substring(tag_offset,tag_index).toLowerCase();return"/"==tag_complete.charAt(tag_complete.length-2)||this.Utils.in_array(tag_check,this.Utils.single_token)?peek||(this.tag_type="SINGLE"):indent_handlebars&&"{"==tag_complete[0]&&"else"==tag_check?peek||(this.indent_to_tag("if"),this.tag_type="HANDLEBARS_ELSE",this.indent_content=!0,this.traverse_whitespace()):this.is_unformatted(tag_check,unformatted)?(comment=this.get_unformatted("</"+tag_check+">",tag_complete),content.push(comment),this.pos,this.tag_type="SINGLE"):"script"==tag_check&&(-1==tag_complete.search("type")||tag_complete.search("type")>-1&&tag_complete.search(/\b(text|application)\/(x-)?(javascript|ecmascript|jscript|livescript)/)>-1)?peek||(this.record_tag(tag_check),this.tag_type="SCRIPT"):"style"==tag_check&&(-1==tag_complete.search("type")||tag_complete.search("type")>-1&&tag_complete.search("text/css")>-1)?peek||(this.record_tag(tag_check),this.tag_type="STYLE"):"!"==tag_check.charAt(0)?peek||(this.tag_type="SINGLE",this.traverse_whitespace()):peek||("/"==tag_check.charAt(0)?(this.retrieve_tag(tag_check.substring(1)),this.tag_type="END"):(this.record_tag(tag_check),"html"!=tag_check.toLowerCase()&&(this.indent_content=!0),this.tag_type="START"),this.traverse_whitespace()&&this.space_or_wrap(content),this.Utils.in_array(tag_check,this.Utils.extra_liners)&&(this.print_newline(!1,this.output),this.output.length&&"\n"!=this.output[this.output.length-2]&&this.print_newline(!0,this.output))),peek&&(this.pos=orig_pos,this.line_char_count=orig_line_char_count),content.join("")},this.get_comment=function(start_pos){var comment="",delimiter=">",matched=!1;this.pos=start_pos;var input_char=this.input.charAt(this.pos);for(this.pos++;this.pos<=this.input.length&&((comment+=input_char)[comment.length-1]!=delimiter[delimiter.length-1]||-1==comment.indexOf(delimiter));)!matched&&comment.length<10&&(0===comment.indexOf("<![if")?(delimiter="<![endif]>",matched=!0):0===comment.indexOf("<![cdata[")?(delimiter="]]>",matched=!0):0===comment.indexOf("<![")?(delimiter="]>",matched=!0):0===comment.indexOf("\x3c!--")?(delimiter="--\x3e",matched=!0):0===comment.indexOf("{{!")?(delimiter="}}",matched=!0):0===comment.indexOf("<?")?(delimiter="?>",matched=!0):0===comment.indexOf("<%")&&(delimiter="%>",matched=!0)),input_char=this.input.charAt(this.pos),this.pos++;return comment},this.get_unformatted=function(delimiter,orig_tag){if(orig_tag&&-1!=orig_tag.toLowerCase().indexOf(delimiter))return"";var input_char="",content="",min_index=0,space=!0;do{if(this.pos>=this.input.length)return content;if(input_char=this.input.charAt(this.pos),this.pos++,this.Utils.in_array(input_char,this.Utils.whitespace)){if(!space){this.line_char_count--;continue}if("\n"==input_char||"\r"==input_char){content+="\n",this.line_char_count=0;continue}}content+=input_char,this.line_char_count++,space=!0,indent_handlebars&&"{"==input_char&&content.length&&"{"==content[content.length-2]&&(min_index=(content+=this.get_unformatted("}}")).length)}while(-1==content.toLowerCase().indexOf(delimiter,min_index));return content},this.get_token=function(){var token;if("TK_TAG_SCRIPT"==this.last_token||"TK_TAG_STYLE"==this.last_token){var type=this.last_token.substr(7);return"string"!=typeof(token=this.get_contents_to(type))?token:[token,"TK_"+type]}return"CONTENT"==this.current_mode?"string"!=typeof(token=this.get_content())?token:[token,"TK_CONTENT"]:"TAG"==this.current_mode?"string"!=typeof(token=this.get_tag())?token:[token,"TK_TAG_"+this.tag_type]:void 0},this.get_full_indent=function(level){return(level=this.indent_level+level||0)<1?"":new Array(level+1).join(this.indent_string)},this.is_unformatted=function(tag_check,unformatted){if(!this.Utils.in_array(tag_check,unformatted))return!1;if("a"!=tag_check.toLowerCase()||!this.Utils.in_array("a",unformatted))return!0;var tag=(this.get_tag(!0)||"").match(/^\s*<\s*\/?([a-z]*)\s*[^>]*>\s*$/);return!(tag&&!this.Utils.in_array(tag,unformatted))},this.printer=function(js_source,indent_character,indent_size,wrap_line_length,brace_style){this.input=js_source||"",this.output=[],this.indent_character=indent_character,this.indent_string="",this.indent_size=indent_size,this.brace_style=brace_style,this.indent_level=0,this.wrap_line_length=wrap_line_length,this.line_char_count=0;for(var i=0;i<this.indent_size;i++)this.indent_string+=this.indent_character;this.print_newline=function(force,arr){this.line_char_count=0,arr&&arr.length&&(force||"\n"!=arr[arr.length-1])&&("\n"!=arr[arr.length-1]&&(arr[arr.length-1]=rtrim(arr[arr.length-1])),arr.push("\n"))},this.print_indentation=function(arr){for(var i=0;i<this.indent_level;i++)arr.push(this.indent_string),this.line_char_count+=this.indent_string.length},this.print_token=function(text){this.is_whitespace(text)&&!this.output.length||((text||""!==text)&&this.output.length&&"\n"==this.output[this.output.length-1]&&(this.print_indentation(this.output),text=text.replace(/^\s+/g,"")),this.print_token_raw(text))},this.print_token_raw=function(text){this.newlines>0&&(text=rtrim(text)),text&&""!==text&&(text.length>1&&"\n"==text[text.length-1]?(this.output.push(text.slice(0,-1)),this.print_newline(!1,this.output)):this.output.push(text));for(var n=0;n<this.newlines;n++)this.print_newline(n>0,this.output);this.newlines=0},this.indent=function(){this.indent_level++},this.unindent=function(){this.indent_level>0&&this.indent_level--}},this},multi_parser.printer(html_source,indent_character,indent_size,wrap_line_length,brace_style);;){var t=multi_parser.get_token();if(multi_parser.token_text=t[0],multi_parser.token_type=t[1],"TK_EOF"==multi_parser.token_type)break;switch(multi_parser.token_type){case"TK_TAG_START":multi_parser.print_newline(!1,multi_parser.output),multi_parser.print_token(multi_parser.token_text),multi_parser.indent_content&&(multi_parser.indent(),multi_parser.indent_content=!1),multi_parser.current_mode="CONTENT";break;case"TK_TAG_STYLE":case"TK_TAG_SCRIPT":multi_parser.print_newline(!1,multi_parser.output),multi_parser.print_token(multi_parser.token_text),multi_parser.current_mode="CONTENT";break;case"TK_TAG_END":if("TK_CONTENT"==multi_parser.last_token&&""===multi_parser.last_text){var tag_name=multi_parser.token_text.match(/\w+/)[0],tag_extracted_from_last_output=null;multi_parser.output.length&&(tag_extracted_from_last_output=multi_parser.output[multi_parser.output.length-1].match(/(?:<|{{#)\/?\s*(\w+)/)),(null==tag_extracted_from_last_output||tag_extracted_from_last_output[1]!=tag_name&&!multi_parser.Utils.in_array(tag_extracted_from_last_output[1],unformatted))&&multi_parser.print_newline(!1,multi_parser.output)}multi_parser.print_token(multi_parser.token_text),multi_parser.current_mode="CONTENT";break;case"TK_TAG_SINGLE":var tag_check=multi_parser.token_text.match(/^\s*<([a-z-]+)/i);tag_check&&multi_parser.Utils.in_array(tag_check[1],unformatted)||multi_parser.print_newline(!1,multi_parser.output),multi_parser.print_token(multi_parser.token_text),multi_parser.current_mode="CONTENT";break;case"TK_TAG_HANDLEBARS_ELSE":multi_parser.print_token(multi_parser.token_text),multi_parser.indent_content&&(multi_parser.indent(),multi_parser.indent_content=!1),multi_parser.current_mode="CONTENT";break;case"TK_TAG_HANDLEBARS_COMMENT":case"TK_CONTENT":multi_parser.print_token(multi_parser.token_text),multi_parser.current_mode="TAG";break;case"TK_STYLE":case"TK_SCRIPT":if(""!==multi_parser.token_text){multi_parser.print_newline(!1,multi_parser.output);var _beautifier,text=multi_parser.token_text,script_indent_level=1;"TK_SCRIPT"==multi_parser.token_type?_beautifier=js_beautify:"TK_STYLE"==multi_parser.token_type&&(_beautifier=css_beautify),"keep"==options.indent_scripts?script_indent_level=0:"separate"==options.indent_scripts&&(script_indent_level=-multi_parser.indent_level);var indentation=multi_parser.get_full_indent(script_indent_level);if(_beautifier)text=_beautifier(text.replace(/^\s*/,indentation),options);else{var _level=text.match(/^\s*/)[0].match(/[^\n\r]*$/)[0].split(multi_parser.indent_string).length-1,reindent=multi_parser.get_full_indent(script_indent_level-_level);text=text.replace(/^\s*/,indentation).replace(/\r\n|\r|\n/g,"\n"+reindent).replace(/\s+$/,"")}text&&(multi_parser.print_token_raw(text),multi_parser.print_newline(!0,multi_parser.output))}multi_parser.current_mode="TAG";break;default:""!==multi_parser.token_text&&multi_parser.print_token(multi_parser.token_text)}multi_parser.last_token=multi_parser.token_type,multi_parser.last_text=multi_parser.token_text}var sweet_code=multi_parser.output.join("").replace(/[\r\n\t ]+$/,"");return end_with_newline&&(sweet_code+="\n"),sweet_code}}},function($){if($.FroalaEditor.PLUGINS.mediaManager=function(editor){function _insertVideoFallback(link){var $richEditorNode=editor.$el.closest('[data-control="richeditor"]'),title=link.substring(link.lastIndexOf("/")+1);$richEditorNode.richEditor("insertVideo",link,title),editor.popups.hide("video.insert")}function _insertAudioFallback(link){var $richEditorNode=editor.$el.closest('[data-control="richeditor"]'),title=link.substring(link.lastIndexOf("/")+1);$richEditorNode.richEditor("insertAudio",link,title),editor.popups.hide("audio.insert")}function _destroy(){}return{_init:function(){editor.events.on("destroy",_destroy,!0),editor.events.on("video.linkError",_insertVideoFallback),editor.events.on("audio.linkError",_insertAudioFallback)},insertFile:function(){editor.selection.save(),new $.oc.mediaManager.popup({alias:"ocmediamanager",cropAndInsertButton:!1,onInsert:function(items){if(editor.events.focus(!0),editor.selection.restore(),items.length)if(items.length>1)$.oc.alert($.oc.lang.get("mediamanager.invalid_file_single_insert"));else{for(var link,textIsEmpty=""===(text=editor.selection.text()).trim(),i=0,len=items.length;i<len;i++){var text=textIsEmpty?items[i].title:text;link=items[i].publicUrl}editor.html.insert('<a href="'+link+'" id="fr-inserted-file" class="fr-file">'+text+"</a>"),editor.$el.find("#fr-inserted-file").removeAttr("id"),this.hide(),editor.undo.saveStep()}else $.oc.alert($.oc.lang.get("mediamanager.invalid_file_empty_insert"))}})},insertImage:function(){editor.selection.save();var $currentImage=editor.image.get();new $.oc.mediaManager.popup({alias:"ocmediamanager",cropAndInsertButton:!0,onInsert:function(items){if(editor.events.focus(!0),editor.selection.restore(),items.length){for(var imagesInserted=0,i=0,len=items.length;i<len;i++)"image"===items[i].documentType?(editor.image.insert(items[i].publicUrl,!1,{},$currentImage),1==++imagesInserted&&($currentImage=null)):$.oc.alert($.oc.lang.get("mediamanager.invalid_image_invalid_insert",'The file "'+items[i].title+'" is not an image.'));0!==imagesInserted&&(this.hide(),editor.undo.saveStep())}else $.oc.alert($.oc.lang.get("mediamanager.invalid_image_empty_insert"))}})},insertVideo:function(callback){editor.selection.save(),new $.oc.mediaManager.popup({alias:"ocmediamanager",cropAndInsertButton:!1,onInsert:function(items){if(editor.events.focus(!0),editor.selection.restore(),items.length)if(items.length>1)$.oc.alert($.oc.lang.get("mediamanager.invalid_file_single_insert"));else{var item=items[0];if("video"===item.documentType){if(callback)callback(item.publicUrl,item.title);else editor.$el.closest('[data-control="richeditor"]').richEditor("insertVideo",item.publicUrl,item.title);this.hide()}else $.oc.alert($.oc.lang.get("mediamanager.invalid_video_invalid_insert",'The file "'+item.title+'" is not a video.'))}else $.oc.alert($.oc.lang.get("mediamanager.invalid_video_empty_insert"))}})},insertAudio:function(callback){editor.selection.save(),new $.oc.mediaManager.popup({alias:"ocmediamanager",cropAndInsertButton:!1,onInsert:function(items){if(editor.events.focus(!0),editor.selection.restore(),items.length)if(items.length>1)$.oc.alert($.oc.lang.get("mediamanager.invalid_file_single_insert"));else{var item=items[0];if("audio"===item.documentType){if(callback)callback(item.publicUrl,item.title);else editor.$el.closest('[data-control="richeditor"]').richEditor("insertAudio",item.publicUrl,item.title);this.hide()}else $.oc.alert($.oc.lang.get("mediamanager.invalid_audio_invalid_insert",'The file "'+item.title+'" is not an audio file.'))}else $.oc.alert($.oc.lang.get("mediamanager.invalid_audio_empty_insert"))}})}}},!($.FE.PLUGINS.link&&$.FE.PLUGINS.file&&$.FE.PLUGINS.image&&$.FE.PLUGINS.video))throw new Error("Media manager plugin requires link, file, image and video plugin.");$.FE.DEFAULTS.imageInsertButtons.push("mmImageManager"),$.FE.RegisterCommand("mmImageManager",{title:"Browse",undo:!1,focus:!1,callback:function(){this.mediaManager.insertImage()},plugin:"mediaManager"}),$.FE.DefineIcon("mmImageManager",{NAME:"folder-o"}),$.FE.DEFAULTS.fileInsertButtons.push("mmFileManager"),$.FE.RegisterCommand("mmFileManager",{title:"Browse",undo:!1,focus:!1,callback:function(){this.mediaManager.insertFile()},plugin:"mediaManager"}),$.FE.DefineIcon("mmFileManager",{NAME:"folder-o"}),$.FE.DEFAULTS.videoInsertButtons.push("mmVideoManager"),$.FE.RegisterCommand("mmVideoManager",{title:"Browse",undo:!1,focus:!1,callback:function(){this.mediaManager.insertVideo()},plugin:"mediaManager"}),$.FE.DefineIcon("mmVideoManager",{NAME:"folder-o"}),$.FE.DEFAULTS.audioInsertButtons.push("mmAudioManager"),$.FE.RegisterCommand("mmAudioManager",{title:"Browse",undo:!1,focus:!1,callback:function(){this.mediaManager.insertAudio()},plugin:"mediaManager"}),$.FE.DefineIcon("mmAudioManager",{NAME:"folder-o"})}(jQuery),function($){$.FroalaEditor.PLUGINS.pageLinks=function(editor){function onPageLookupInserted(item){editor.link.insert(item.link,$('input.fr-link-attr[name="text"]',editor.popups.get("link.insert")).val()||item.params.title)}function onPageLookupShown(){editor.selection.save()}return{_init:function(){},insertLink:function(){oc.pageLookup.popup({alias:"ocpagelookup",value:$('input.fr-link-attr[name="href"]',editor.popups.get("link.insert")).val(),onInsert:onPageLookupInserted,onShown:onPageLookupShown,singleMode:!0})}}},$.FE.DefineIcon("linkPageRoute",{NAME:"folder-o"}),$.FE.RegisterCommand("linkPageRoute",{title:"Choose Link",undo:!1,focus:!1,callback:function(){this.pageLinks.insertLink()},plugin:"pageLinks"}),$.FE.DefineIcon("insertPageLink",{NAME:"link"}),$.FE.RegisterShortcut($.FE.KEYCODE.K,"insertPageLink",null,"K"),oc.pageLookup?($.FE.DEFAULTS.linkInsertButtons=["linkBack","|","linkPageRoute"],$.FE.RegisterCommand("insertPageLink",{title:"Insert Link",undo:!1,focus:!0,refreshOnCallback:!1,popup:!0,callback:function(){this.link.showInsertPopup(),this.popups.hide("link.insert"),this.pageLinks.insertLink()},plugin:"pageLinks"})):$.FE.RegisterCommand("insertPageLink",{title:"Insert Link",undo:!1,focus:!0,refreshOnCallback:!1,popup:!0,callback:function(){this.popups.isVisible("link.insert")?(this.$el.find(".fr-marker").length&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("link.insert")):this.link.showInsertPopup()},plugin:"link"})}(jQuery),function($){$.FroalaEditor.PLUGINS.figures=function(editor){function insertElement($el){var html=$("<div />").append($el.clone()).remove().html();editor.events.focus(!0),editor.selection.restore(),editor.html.insert(html),editor.html.cleanEmptyTags(),$("figure",editor.$el).each((function(){var $this=$(this),$parent=$this.parent("p"),$next=$this.next("p");$parent.length&&$this.insertAfter($parent),$next.length&&0==$next.text().trim().length&&$next.remove()})),editor.undo.saveStep(),_initUiBlocks()}function _makeUiBlockElement(){var $node=$('<figure contenteditable="false" tabindex="0" data-ui-block="true">&nbsp;</figure>');return $node.get(0).contentEditable=!1,$node}function _initUiBlocks(){$("[data-video], [data-audio]",editor.$el).each((function(){$(this).addClass("fr-draggable").attr({"data-ui-block":"true",draggable:"true",tabindex:"0"}).html("&nbsp;"),this.contentEditable=!1}))}function _handleUiBlockCaretClearEmpty($block,$p){void 0!==$block.attr("data-ui-block")&&0==$.trim($p.text()).length&&($p.remove(),_handleUiBlockCaretIn($block),editor.undo.saveStep())}function _handleUiBlockCaretIn($block){return void 0!==$block.attr("data-ui-block")&&($block.focus(),editor.selection.clear(),!0)}function _focusUiBlockOrText($block,gotoStart){$block.length&&(_handleUiBlockCaretIn($block)||(gotoStart?(editor.selection.setAtStart($block.get(0)),editor.selection.restore()):(editor.selection.setAtEnd($block.get(0)),editor.selection.restore())))}function _onKeydown(ev){if(function(ev){if("ArrowDown"===ev.key||"ArrowUp"===ev.key||"Backspace"===ev.key||"Delete"===ev.key){var $block=$(editor.selection.element());if($block.is("br")&&($block=$block.parent()),$block.length)switch(ev.key){case"ArrowUp":_handleUiBlockCaretIn($block.prev());break;case"ArrowDown":_handleUiBlockCaretIn($block.next());break;case"Delete":_handleUiBlockCaretClearEmpty($block.next(),$block);break;case"Backspace":_handleUiBlockCaretClearEmpty($block.prev(),$block)}}}(ev),ev.isDefaultPrevented())return!1}function _onFigureKeydown(ev){if(ev.target&&void 0!==$(ev.target).attr("data-ui-block")&&function(ev,block){if("ArrowDown"===ev.key||"ArrowUp"===ev.key||"Enter"===ev.key||"Backspace"===ev.key||"Delete"===ev.key){switch(ev.key){case"ArrowDown":_focusUiBlockOrText($(block).next(),!0);break;case"ArrowUp":_focusUiBlockOrText($(block).prev(),!1);break;case"Enter":$("<p><br/></p>").insertAfter(block),editor.selection.setAfter(block),editor.selection.restore(),editor.undo.saveStep();break;case"Backspace":case"Delete":var $nextFocus=$(block).next(),gotoStart=!0;0==$nextFocus.length&&($nextFocus=$(block).prev(),gotoStart=!1),_focusUiBlockOrText($nextFocus,gotoStart),$(block).remove(),editor.undo.saveStep()}ev.preventDefault()}}(ev,ev.target),ev.isDefaultPrevented())return!1}function _onSync(html){var $domTree=$("<div>"+html+"</div>");return $domTree.find("[data-video], [data-audio]").each((function(){$(this).removeAttr("contenteditable data-ui-block tabindex draggable").removeClass("fr-draggable fr-dragging")})),$domTree.html()}function _destroy(){editor.$el.off("keydown","figure",_onFigureKeydown)}return{_init:function(){editor.events.on("initialized",_initUiBlocks),editor.events.on("html.set",_initUiBlocks),editor.events.on("html.get",_onSync),editor.events.on("keydown",_onKeydown),editor.events.on("destroy",_destroy,!0),editor.$el.on("keydown","figure",_onFigureKeydown)},insert:insertElement,insertVideo:function(url,text){var $node=_makeUiBlockElement();$node.attr("data-video",url),$node.attr("data-label",text),insertElement($node)},insertAudio:function(url,text){var $node=_makeUiBlockElement();$node.attr("data-audio",url),$node.attr("data-label",text),insertElement($node)}}}}(jQuery);
